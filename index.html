<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AQULA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@okxweb3/coin-ethereum@latest/dist/index.umd.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/png" href="favicon_512x512.png" sizes="512x512" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
/* Import Fonts */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

/* Root Variables */
:root {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
  --card: 222.2 84% 4.9%;
  --card-foreground: 210 40% 98%;
  --border: 217.2 32.6% 17.5%;
}

/* Global Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html,
body {
  height: 100%;
  margin: 0;
  overflow-x: hidden;
  overflow-y: hidden;
  background: linear-gradient(to bottom right, #000000, #1e293b);
  color: #f1f5f9;
  overscroll-behavior: none;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

html::-webkit-scrollbar,
body::-webkit-scrollbar {
  display: none;
}

body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  font-family: 'Orbitron', system-ui, sans-serif;
}

p {
  margin: 0 0 10px 0;
  text-align: justify;
}

strong {
  font-weight: bold;
}

/* Animations */
@keyframes loadingProgress {
  0% { width: 0%; }
  100% { width: 100%; }
}

@keyframes spin-slow {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes spin-slower {
  from { transform: rotate(0deg); }
  to { transform: rotate(-360deg); }
}

@keyframes mining-ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

@keyframes mining-pulse {
  0% { box-shadow: 0 0 10px rgba(52, 152, 219, 0.8); }
  50% { box-shadow: 0 0 20px rgba(52, 152, 219, 1); }
  100% { box-shadow: 0 0 10px rgba(52, 152, 219, 0.8); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-5px); }
  40%, 80% { transform: translateX(5px); }
}

/* Effects */
.drop-shadow-gold {
  filter: drop-shadow(0 0 5px gold);
}

.drop-shadow-silver {
  filter: drop-shadow(0 0 5px silver);
}

.drop-shadow-bronze {
  filter: drop-shadow(0 0 5px #cd7f32);
}

.shadow-neon {
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.4), 0 0 16px rgba(255, 255, 255, 0.3);
}

.trophy {
  filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.5));
}

.mining-ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.7);
  transform: scale(0);
  animation: mining-ripple 600ms linear;
  pointer-events: none;
  width: 100px;
  height: 100px;
  margin-top: -50px;
  margin-left: -50px;
}

/* Layout */
.sidebar {
  width: 310px;
  height: calc(100vh - 4rem);
  position: fixed;
  top: 4rem;
  left: 0;
  overflow-y: auto;
  padding: 1rem;
  background: rgba(15, 23, 42, 0.8);
  border-right: 1px solid rgba(51, 65, 85, 0.5);
  scrollbar-width: none;
}

.sidebar::-webkit-scrollbar {
  display: none;
}

.main-content {
  margin-left: 310px;
  padding: 1.5rem;
  height: calc(100vh - 4rem);
  margin-top: 0;
  overflow-y: auto;
  background: transparent;
  scrollbar-width: none;
}

.main-content::-webkit-scrollbar {
  display: none;
}

/* Components */
.card {
  background: rgba(30, 41, 59, 0.5);
  border: 1px solid rgba(51, 65, 85, 0.5);
  border-radius: 0.5rem;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.card::-webkit-scrollbar {
  display: none;
}

.flip-card {
  perspective: 1000px;
}

.flip-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.flip-card-front,
.flip-card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 0.5rem;
}

.flip-card-front {
  background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
  border: 1px solid rgba(71, 85, 105, 0.3);
}

.flip-card-back {
  background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(2, 6, 23, 0.95) 100%);
  transform: rotateY(180deg);
  border: 1px solid rgba(100, 116, 139, 0.2);
}

.flip-card:hover .flip-card-inner {
  transform: rotateY(180deg);
}

.badge {
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  line-height: 1rem;
  font-weight: 500;
  display: inline-block;
}

button {
  border-radius: 0.375rem;
}

.nav-active {
  background: rgba(30, 41, 59, 0.5);
  color: #22d3ee !important;
}

/* Chat Components */
.chat-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.chat-messages {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.chat-message {
  display: flex;
  flex-direction: column;
  max-width: 80%;
  padding: 0.75rem;
  border-radius: 0.5rem;
  background: rgba(30, 41, 59, 0.7);
  border: 1px solid rgba(51, 65, 85, 0.5);
}

.chat-message.mine {
  align-self: flex-end;
  background: rgba(34, 211, 238, 0.2);
  border-color: rgba(34, 211, 238, 0.5);
}

.chat-message .avatar {
  width: 1.5rem;
  height: 1.5rem;
  border-radius: 50%;
  background: rgba(34, 211, 238, 0.5);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.chat-message .content {
  font-size: 0.875rem;
  color: #e2e8f0;
}

.chat-message .meta {
  font-size: 0.75rem;
  color: #94a3b8;
  margin-top: 0.25rem;
}

.chat-input {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.chat-input-container {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

/* Voice Message */
.voice-message-container {
  margin-top: 8px;
  max-width: 280px;
}

.voice-message {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background-color: #f0f2f5;
  border-radius: 8px;
}

.voice-message.mine {
  background-color: #d9fdd3;
}

.play-pause-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  color: #3b4a54;
}

.waveform-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.waveform {
  height: 4px;
  background-color: rgba(11, 20, 26, 0.15);
  border-radius: 2px;
  overflow: hidden;
  position: relative;
}

.progress {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background-color: #3b4a54;
  border-radius: 2px;
}

.duration {
  font-size: 11px;
  color: #3b4a54;
  align-self: flex-start;
}

.status {
  font-size: 14px;
  color: #8696a0;
  margin-left: 4px;
}

/* Autocomplete Suggestions */
#mentionSuggestions {
  z-index: 10;
}

.suggestion-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
}

.suggestion-item:hover {
  background: #f3f4f6 !important;
}

.suggestion-item .avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.875rem;
}

/* Overlays and Modals */
#authModal {
  display: flex;
}

#loadingOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  z-index: 100;
}

#loadingOverlay.hidden {
  opacity: 0;
  pointer-events: none;
}

/* Page Transitions */
.page {
  opacity: 1;
}

.page-hidden {
  opacity: 0;
  display: none;
}

.content-hidden {
  display: none;
}

/* Mining Button */
#toggleMiningBtn {
  position: relative;
  overflow: hidden;
}

#toggleMiningBtn.starting {
  box-shadow: 0 0 15px rgba(46, 204, 113, 0.6);
  background: linear-gradient(135deg, #2ecc71, #27ae60);
}

#toggleMiningBtn.stopping {
  box-shadow: 0 0 15px rgba(231, 76, 60, 0.6);
  background: linear-gradient(135deg, #e74c3c, #c0392b);
}

#toggleMiningBtn.mining-active {
  animation: mining-pulse 2s infinite;
  box-shadow: 0 0 20px rgba(52, 152, 219, 0.8);
}

/* Toast Notifications */
.toast {
  position: fixed;
  top: 5rem;
  right: 1rem;
  z-index: 9999;
  padding: 1rem;
  border-radius: 0.5rem;
  color: white;
  background-color: rgba(0, 0, 0, 0.8);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  pointer-events: none;
}

/* Error States */
.input-error {
  border-color: red !important;
  background: rgba(255, 0, 0, 0.1);
  border: 1px solid rgba(255, 0, 0, 0.8);
}

.input-error + .error-message {
  display: block;
  color: #f87171;
  font-size: 0.75rem;
  margin-top: 0.25rem;
}

.error-message {
  color: red;
  font-size: 12px;
  margin-top: 4px;
}

.error-text {
  display: flex;
  align-items: center;
  gap: 5px;
}

.shake {
  animation: shake 0.5s ease-in-out;
}

/* Scrollbar Customization */
textarea::-webkit-scrollbar {
  width: 6px;
}

textarea::-webkit-scrollbar-track {
  background: rgba(30, 41, 59, 0.3);
  border-radius: 9999px;
}

textarea::-webkit-scrollbar-thumb {
  background: rgba(71, 85, 105, 0.5);
  border-radius: 9999px;
}

textarea::-webkit-scrollbar-thumb:hover {
  background: rgba(71, 85, 105, 0.6);
}

.overflow-y-auto {
  scrollbar-width: none;
}

.overflow-y-auto::-webkit-scrollbar {
  display: none;
}

#log-container {
  scrollbar-width: none;
  -ms-overflow-style: none;
}

#log-container::-webkit-scrollbar {
  display: none;
}

/* Utility Classes */
.animate-spin-slow {
  animation: spin-slow 3s linear infinite;
}

.animate-spin-slower {
  animation: spin-slower 6s linear infinite;
}

/* Status Indicators */
#syncProgress,
#syncProgressTest,
#nodeLatency,
#currentPeer {
  display: inline-block !important;
  opacity: 1 !important;
  visibility: visible !important;
  color: #f1f5f9;
}

/* Responsive Design */
@media (max-width: 768px) {
  .sidebar {
    width: 200px;
    transform: translateX(-100%);
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .main-content {
    margin-left: 0;
    padding: 1rem;
  }
}

@media (max-width: 640px) {
  .chat-message {
    max-width: 85%;
  }

  .voice-message-container {
    max-width: 100%;
  }

  #mentionSuggestions {
    max-width: 100%;
  }
}
</style>
  </head>
  <body class="dark relative">
   <canvas
  id="particleCanvas"
  class="absolute inset-0 w-full h-full opacity-30 pointer-events-none"
></canvas>
<div id="toastContainer" class="fixed bottom-5 right-5 z-[100] space-y-2"></div>


    
    <header class="w-full bg-slate-900/80 backdrop-blur-md border-b border-slate-800 p-4 z-10 fixed top-0" style="height: 4rem; padding: 0 1rem;">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <img src="AQLALOG.png" alt="A Icon" class="h-12 w-12 object-contain" />
          <span class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
            AQULA
          </span>
        </div>
       
          <div class="flex items-center space-x-3">
            <div class="relative">
            
            </div>
            <button
              title="Toggle theme"
              id="themeToggle"
              class="text-slate-400 hover:text-slate-100 p-2"
            >
              <i data-lucide="moon" class="h-5 w-5"></i>
            </button>
            <div id="userSection" class="flex items-center space-x-2">
              <button
                id="loginBtn"
                class="text-slate-100 bg-cyan-600 hover:bg-cyan-700 rounded-md px-3 py-1.5 flex items-center"
              >
                <i data-lucide="user" class="h-4 w-4 mr-2"></i> Login
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
    
    <div class="flex flex-1 overflow-hidden pt-16 bg-transparent content-hidden">
      <div class="sidebar">
        <!-- Sidebar content remains unchanged -->
      </div>
      <main class="main-content">
        <!-- Main content remains unchanged -->
      </main>
    </div>

    <div id="loadingOverlay" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/80 backdrop-blur-sm hidden">
      <div class="flex flex-col items-center">
        <div class="relative w-32 h-32">
          <!-- Pulsing Galaxy Core -->
          <div class="absolute inset-4 rounded-full bg-gradient-to-br from-cyan-500/10 to-blue-500/10 shadow-inner animate-pulse"></div>
          
          <!-- Concentric Circles -->
          <div class="absolute inset-0 border-4 border-cyan-500/20 rounded-full animate-ping"></div>
          <div class="absolute inset-2 border-4 border-t-cyan-400 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin shadow-[0_0_10px_2px_rgba(34,211,238,0.3)]"></div>
          <div class="absolute inset-4 border-4 border-r-purple-400 border-t-transparent border-b-transparent border-l-transparent rounded-full animate-spin-slow shadow-[0_0_8px_1px_rgba(192,132,252,0.3)]"></div>
          <div class="absolute inset-6 border-4 border-b-blue-400 border-t-transparent border-r-transparent border-l-transparent rounded-full animate-spin-slower shadow-[0_0_6px_1px_rgba(96,165,250,0.3)]"></div>
          <div class="absolute inset-8 border-4 border-l-green-400 border-t-transparent border-r-transparent border-b-transparent rounded-full animate-spin shadow-[0_0_5px_1px_rgba(74,222,128,0.3)]"></div>
          
          <!-- Center Particle -->
          <div class="absolute inset-10 rounded-full bg-cyan-400/80 animate-pulse shadow-[0_0_15px_5px_rgba(34,211,238,0.4)]"></div>
        </div>
        
        <!-- Text with Futuristic Colors -->
        <div class="mt-6 text-center">
          <div class="font-mono text-sm tracking-wider flex items-center justify-center">
            <span class="animate-pulse text-cyan-300">S</span>
            <span class="animate-pulse delay-75 text-purple-300">Y</span>
            <span class="animate-pulse delay-100 text-blue-300">S</span>
            <span class="animate-pulse delay-150 text-indigo-300">T</span>
            <span class="animate-pulse delay-200 text-violet-300">E</span>
            <span class="animate-pulse delay-250 text-fuchsia-300">M</span>
            <span class="mx-2 text-gray-400">•</span>
            <span class="animate-pulse delay-300 text-cyan-400">I</span>
            <span class="animate-pulse delay-350 text-emerald-300">N</span>
            <span class="animate-pulse delay-400 text-teal-300">I</span>
            <span class="animate-pulse delay-450 text-sky-300">T</span>
            <span class="animate-pulse delay-500 text-rose-300">I</span>
            <span class="animate-pulse delay-550 text-pink-300">A</span>
            <span class="animate-pulse delay-600 text-amber-300">L</span>
            <span class="animate-pulse delay-650 text-lime-300">I</span>
            <span class="animate-pulse delay-700 text-yellow-300">Z</span>
            <span class="animate-pulse delay-750 text-orange-300">I</span>
            <span class="animate-pulse delay-800 text-red-300">N</span>
            <span class="animate-pulse delay-850 text-green-300">G</span>
          </div>
          
          <!-- Progress Bar (width matched to text) -->
          <div class="mt-2 h-0.5 bg-gray-700 rounded-full overflow-hidden" style="width: calc(19 * 0.5rem + 0.5rem);">
            <div class="h-full bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full animate-progress"></div>
          </div>
          
          <!-- Hex Codes -->
          <div class="text-xs text-gray-500 font-mono mt-1">A Q U L A</div>
        </div>
      </div>
    </div>
    
    <style>
      @keyframes progress {
        from { width: 0%; }
        to { width: 100%; }
      }
      .animate-progress {
        animation: progress 2.5s ease-in-out infinite;
      }
    </style>

    <div id="authModal"
    class="fixed inset-0 bg-transparent flex items-center justify-center z-50 overflow-hidden">

    <!-- Video Background -->
    <video autoplay muted loop playsinline class="absolute inset-0 w-full h-full px object-cover">
        <source src="authmodal.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Overlay Gradient -->
    <div class="absolute inset-0 bg-gradient-to-b from-slate-900/80 via-slate-900/60 to-slate-900/90"></div>

    <!-- Modal Card -->
    <div class="relative z-10 bg-gradient-to-br from-slate-900 via-slate-800/80 to-slate-900 border border-slate-700/30 rounded-lg p-6 w-full max-w-sm shadow-lg shadow-cyan-500/5 transform transition-all duration-300 scale-90 backdrop-blur-sm">
      <!-- Konten modal di sini -->
  
      
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2 class="text-2xl font-bold text-slate-100 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
            </svg>
            <span class="bg-gradient-to-r from-cyan-400 to-cyan-600 bg-clip-text text-transparent">Welcome Back</span>
          </h2>
          <p class="text-xs text-slate-500 mt-1">Access your premium dashboard</p>
        </div>
        <button id="closeAuthModal" class="text-slate-400 hover:text-slate-200 transition-colors">
          
        </button>
      </div>
      <div class="space-y-6">
        <!-- LOGIN FORM -->
        <div id="loginForm">
          <div class="space-y-5">
            <!-- Email Input -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Email Address</label>
              <div class="relative">
                <input id="emailInput" type="email"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="you@example.com" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- Password Input -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Password</label>
              <div class="relative">
                <input id="passwordInput" type="password"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="••••••••" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
                <!-- Tombol Mata dengan data-target -->
                <button class="absolute right-3 top-3 text-slate-500 hover:text-slate-300 transition-colors show-password" data-target="passwordInput">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </div>
              <div class="flex justify-end mt-2">
                <button id="forgotPasswordBtn" class="text-xs text-cyan-400 hover:text-cyan-300 transition-colors">Forgot password?</button>
              </div>
            </div>

            <!-- Submit Button -->
            <button id="emailAuthBtn"
              class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-500 hover:to-cyan-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center group">
              <span class="group-hover:translate-x-1 transition-transform">Continue</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
          </div>
        </div>

        <!-- FORGOT PASSWORD FORM -->
        <div id="forgotPasswordForm" class="hidden">
          <div class="space-y-5">
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Email Address</label>
              <div class="relative">
                <input id="resetEmailInput" type="email"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="you@example.com" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                </div>
              </div>
            </div>
            <button id="resetPasswordBtn"
              class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-500 hover:to-cyan-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center group">
              <span class="group-hover:translate-x-1 transition-transform">Reset Password</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
            <div class="text-center">
              <button id="backToLoginBtn" class="text-xs text-cyan-400 hover:text-cyan-300 transition-colors">Back to Login</button>
            </div>
          </div>
        </div>

        <!-- REGISTER FORM -->
        <div id="registerForm" class="hidden">
          <div class="space-y-5">

            <!-- Full Name -->
            <div id="fullNameGroup">
              <label class="block text-sm font-medium text-slate-400 mb-2">Full Name</label>
              <div class="relative">
                <input id="fullNameInput" type="text"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="John Doe" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- Email -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Email Address</label>
              <div class="relative">
                <input id="regEmailInput" type="email"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="you@example.com" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- Password -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Password</label>
              <div class="relative">
                <input id="regPasswordInput" type="password"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="••••••••" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
                <!-- Tombol Mata dengan data-target -->
                <button class="absolute right-3 top-3 text-slate-500 hover:text-slate-300 transition-colors show-password" data-target="regPasswordInput">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Referral Code -->
            <div id="referralCodeGroup">
              <label class="block text-sm font-medium text-slate-400 mb-2">Referral Code
                <span class="text-slate-500 text-xs">(optional)</span></label>
              <div class="relative">
                <input id="referralInput" type="text"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="ABCD1234" />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                  </svg>
                </div>
              </div>
            </div>

            <!-- Register Button -->
            <button id="registerBtn"
              class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-500 hover:to-cyan-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center group">
              <span class="group-hover:translate-x-1 transition-transform">Create Account</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Divider -->
        <div class="relative">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-slate-700/30"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-slate-900 text-slate-400">Or continue with</span>
          </div>
        </div>

        <!-- Social Auth Buttons -->
        <div class="grid grid-cols-2 gap-3">
          <button id="googleAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://www.google.com/favicon.ico" alt="Google" class="h-4 w-4" />
            <span>Google</span>
          </button>
          <button id="metamaskAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://metamask.io/favicon.ico" alt="MetaMask" class="h-4 w-4" />
            <span>MetaMask</span>
          </button>
          <button id="phantomAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://mate.tools/s/dGOqmKUm" alt="Phantom" class="h-4 w-4" />
            <span>Phantom</span>
          </button>
          <button id="okxAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://mate.tools/s/WNjPYxYj" alt="OKX" class="h-4 w-4" />
            <span>OKX</span>
          </button>
        </div>

        <!-- Toggle Auth -->
        <div class="text-center text-sm text-slate-400">
          <button id="toggleAuthBtn"
            class="text-cyan-400 hover:text-cyan-300 font-medium transition-colors">
            Need an account? <span class="underline">Register here</span>
          </button>
        </div>
      </div>
    </div>
  </div>



  
    <div
      id="deleteAccountModal"
      class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-slate-900 text-slate-100 border border-slate-700 rounded-lg p-6 w-full max-w-md card"
      >
        <h2 class="text-xl font-bold mb-4">Confirm Account Deletion</h2>
        <p class="text-sm text-slate-400 mb-6">
          Are you sure you want to delete your account? This action cannot be
          undone.
        </p>
        <div class="flex justify-end space-x-4">
          <button
            id="cancelDeleteBtn"
            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md"
          >
            No
          </button>
          <button
            id="confirmDeleteBtn"
            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md"
          >
            Yes
          </button>
        </div>
      </div>
    </div>
    </div>
    
    <div class="sidebar">
      <div class="bg-slate-900/50 border border-slate-700/50 rounded-xl p-5 h-full card">
        <div id="userProfile" class="mb-6 p-4 bg-gradient-to-br from-slate-800/60 to-slate-800/30 rounded-xl border border-slate-700/50 shadow-lg">
          <div class="flex items-start space-x-3 mb-4">
            <div id="sidebarProfilePicture" class="h-12 w-12 rounded-full bg-gradient-to-br from-cyan-600 to-blue-600 text-white flex items-center justify-center font-medium flex-shrink-0">
              <span id="profileInitial" class="text-lg">U</span>
            </div>
            <div class="min-w-0">
              <div id="userEmail" class="text-sm font-medium text-slate-100 truncate max-w-[180px] hover:max-w-none transition-all duration-200"></div>
              <div id="userWallet" class="text-xs text-slate-300/80 truncate max-w-[180px] hover:max-w-none transition-all duration-200 mt-1"></div>
            </div>
          </div>
          <div class="space-y-3 pt-2 border-t border-slate-700/40">
            <div class="flex justify-between items-center text-xs">
              <span class="text-slate-300/80">Points</span>
              <span id="userPoints" class="font-medium text-cyan-400 bg-cyan-400/10 px-2 py-0.5 rounded-full">0</span>
            </div>
            <div class="flex justify-between items-center text-xs">
              <span class="text-slate-300/80">Device Score</span>
              <span id="deviceScore" class="font-medium text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded-full">0</span>
            </div>
            <div class="flex justify-between items-center text-xs">
              <span class="text-slate-300/80">Booster</span>
              <span id="userBooster" class="font-medium text-purple-400 bg-purple-400/10 px-2 py-0.5 rounded-full">None</span>
            </div>
          </div>
        </div>
        <nav class="space-y-1.5">
          <button
            id="navDashboard"
            class="w-full flex items-center text-cyan-400 bg-gradient-to-r from-cyan-900/30 to-cyan-900/10 rounded-lg px-4 py-2.5 nav-active transition-all duration-200 hover:bg-cyan-900/20 group"
          >
            <i data-lucide="command" class="h-4 w-4 mr-3 text-cyan-300 group-hover:text-cyan-200"></i> 
            <span class="font-medium">Dashboard</span>
          </button>
          
          <button
            id="navBooster"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
          <i data-lucide="rocket" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i>
          <span class="font-medium">Booster</span>
          </button>
          <button
          id="navDataCenter"
          class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
        >
          <i data-lucide="database" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
          <span class="font-medium">Data Center</span>
          <span id="labelDataCenter" class="ml-auto text-[10px] bg-blue-400/20 text-blue-300 px-2 py-0.5 rounded-full border border-blue-400/30">Cloud</span>
        </button>

       
        
        <button
          id="navNetwork"
          class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
        >
          <i data-lucide="globe" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
          <span class="font-medium">Network</span>
          <span id="labelNetwork" class="ml-auto text-[10px] bg-blue-400/20 text-blue-300 px-2 py-0.5 rounded-full border border-blue-400/30">Futuristic</span>
        </button>

        
        
          <button
            id="navSecurity"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="shield" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Security</span>
          </button>
          
          <button
            id="navLeaderboard"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="trophy" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Leaderboard</span>
          </button>
          
          <button
            id="navCommunications"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="message-square" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i>
            <span class="font-medium">Communications</span>
          </button>
          
          <button
            id="navSettings"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="settings" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Settings</span>
          </button>
          
          <div class="absolute bottom-4 left-4 right-4">
            <div id="particleContainer" class="w-full h-20 relative rounded-xl overflow-hidden shadow-lg">
              <!-- 3D Particle Animation will render here -->
            </div>
          </div>
</div>
</div>
</div>
</div>



<div class="main-content">
  <div id="pageDashboard" class="page">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left Column (2/3 width) -->
      <div class="col-span-2 space-y-6">
        <!-- Mining Controls Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">MINING CONTROLS</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-5">
              <!-- Mining Status -->
              <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                  <span class="text-sm font-medium text-slate-300">Mining Status</span>
                </div>
                <span id="miningStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-red-900/40 to-red-800/30 text-red-400 border border-red-700/50">
                  <span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span>
                  Inactive
                </span>
              </div>
              <!-- Current Points -->
              <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span class="text-sm font-medium text-slate-300">Current Points</span>
                </div>
                <div id="currentPoints" class="text-sm font-bold text-cyan-400 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                  0
                </div>
              </div>
              <!-- Device Score -->
              <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                  </svg>
                  <span class="text-sm font-medium text-slate-300">Device Score</span>
                </div>
                <div id="currentDeviceScore" class="text-sm font-bold text-cyan-400 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                  0
                </div>
              </div>
              <!-- Booster -->
             <!-- Booster -->
  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
    <div class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z" />
      </svg>
      <span class="text-sm font-medium text-slate-300">Booster</span>
    </div>
    <div id="currentBooster" class="text-sm font-medium text-amber-400 bg-gradient-to-r from-amber-900/30 to-amber-800/20 px-3 py-1 rounded-full border border-amber-700/50">
      None
    </div>
  </div>
  <!-- Referral Speed -->
  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all mt-2">
    <div class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <span class="text-sm font-medium text-slate-300">Referral Speed</span>
    </div>
    <div id="referralSpeed" class="text-sm font-medium text-cyan-400 bg-gradient-to-r from-cyan-900/30 to-cyan-800/20 px-3 py-1 rounded-full border border-cyan-700/50">
      0x
    </div>
  </div>
  <!-- Mining Button -->
  <button id="toggleMiningBtn" class="w-full bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/30 flex items-center justify-center group">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 group-hover:animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
    </svg>
    Start Mining
    <span class="ml-2 text-xs opacity-70 group-hover:opacity-100"></span>
  </button>
</div>
</div>
</div>


          <!-- System Overview Card -->
    <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl m-4">
      <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
          <div class="flex items-center justify-between">
              <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                  </svg>
                  <h3 class="text-lg font-semibold text-slate-100 tracking-wide">SYSTEM OVERVIEW</h3>
              </div>
              <div class="flex items-center space-x-2">
                  <span class="bg-gradient-to-r from-cyan-600/20 to-blue-600/20 text-cyan-400 border border-cyan-500/50 rounded-md px-2 py-1 text-xs flex items-center">
                      <span class="h-1.5 w-1.5 rounded-full bg-cyan-500 mr-1 animate-pulse"></span>
                      LIVE MONITORING
                  </span>
                  <button class="text-slate-400 hover:text-cyan-400 p-2 transition-colors" title="Refresh System Status">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                      </svg>
                  </button>
              </div>
          </div>
      </div>
      <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- CPU Usage -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-cyan-500/30 p-5 relative overflow-hidden">
                  <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-cyan-500/10"></div>
                  <div class="flex items-center justify-between mb-4">
                      <div class="text-sm text-slate-400 font-medium">CPU USAGE</div>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                      </svg>
                  </div>
                  <div id="cpuUsage" class="text-3xl font-bold mb-1 text-slate-100 flex items-end">
                      --<span class="text-lg text-slate-400 ml-1">%</span>
                  </div>
                  <div class="text-xs text-slate-500 font-mono cpu-info">Varies by device | Unknown Cores</div>
                  <div class="mt-4 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                      <div class="cpu-bar h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full" style="width: 0%"></div>
                  </div>
              </div>
              <!-- Memory Usage -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-purple-500/30 p-5 relative overflow-hidden">
                  <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-purple-500/10"></div>
                  <div class="flex items-center justify-between mb-4">
                      <div class="text-sm text-slate-400 font-medium">MEMORY</div>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
                      </svg>
                  </div>
                  <div id="memoryUsage" class="text-3xl font-bold mb-1 text-slate-100 flex items-end">
                      --<span class="text-lg text-slate-400 ml-1">%</span>
                  </div>
                  <div class="text-xs text-slate-500 font-mono">-- GB / -- GB</div>
                  <div class="mt-4 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                      <div class="memory-bar h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full" style="width: 0%"></div>
                  </div>
              </div>
              <!-- Network Usage -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-blue-500/30 p-5 relative overflow-hidden">
                  <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-blue-500/10"></div>
                  <div class="flex items-center justify-between mb-4">
                      <div class="text-sm text-slate-400 font-medium">NETWORK</div>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
                      </svg>
                  </div>
                  <div id="networkUsage" class="text-3xl font-bold mb-1 text-slate-100 flex items-end">
                      --<span class="text-lg text-slate-400 ml-1">%</span>
                  </div>
                  <div class="text-xs text-slate-500 font-mono">-- GB/s | -- ms</div>
                  <div class="mt-4 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                      <div class="network-bar h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full" style="width: 0%"></div>
                  </div>
              </div>
          </div>

          <!-- Performance Chart Tabs -->
          <div class="mt-8">
            <div class="flex items-center justify-between mb-4">
              <!-- Tab Buttons -->
              <div class="flex space-x-1 bg-slate-800/50 p-1 rounded-lg border border-slate-700/50">
                <button id="tabPerformance" class="px-4 py-2 text-sm font-medium text-slate-100 bg-slate-700/50 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500">Performance</button>
                <button id="tabProcesses" class="px-4 py-2 text-sm font-medium text-slate-400 hover:text-slate-100 hover:bg-slate-700/50 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500">Processes</button>
                <button id="tabStorage" class="px-4 py-2 text-sm font-medium text-slate-400 hover:text-slate-100 hover:bg-slate-700/50 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500">Storage</button>
              </div>
              <!-- Legend -->
              <div class="flex items-center space-x-3 text-xs text-slate-400">
                <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-cyan-500 mr-1.5"></div>CPU</div>
                <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-purple-500 mr-1.5"></div>Memory</div>
                <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-blue-500 mr-1.5"></div>Network</div>
              </div>
            </div>
            <!-- Tab Content -->
            <div id="performanceTab" class="h-72 bg-gradient-to-br from-slate-800/30 to-slate-900/40 rounded-xl border border-slate-700/50 overflow-hidden relative">
              <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIj48ZGVmcz48cGF0dGVybiBpZD0iZ3JpZCIgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj48cGF0aCBkPSJNIDIwIDAgTCAwIDAgMCAyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMDUpIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=')] opacity-20"></div>
              <canvas id="performanceChartTab" class="h-full w-full z-10"></canvas>
              <!-- System Load Display -->
              <div class="absolute bottom-4 right-4 bg-slate-900/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-slate-700/50 shadow-lg">
                  <div class="text-xs text-slate-400 uppercase tracking-wider">System Load</div>
                  <div id="systemLoad" class="text-xl font-mono text-cyan-400">0<span class="text-sm">%</span></div>
              </div>
            </div>
            <div id="processesTab" class="hidden h-72 bg-gradient-to-br from-slate-800/30 to-slate-900/40 rounded-xl border border-slate-700/50 overflow-auto relative">
              <table class="w-full text-sm text-slate-100">
                <thead>
                  <tr class="bg-slate-700/50">
                    <th class="px-4 py-2 text-left">Process</th>
                    <th class="px-4 py-2 text-left">CPU (%)</th>
                    <th class="px-4 py-2 text-left">Memory (MB)</th>
                  </tr>
                </thead>
                <tbody id="processesTable"></tbody>
              </table>
            </div>
            <div id="storageTab" class="hidden h-72 bg-gradient-to-br from-slate-800/30 to-slate-900/40 rounded-xl border border-slate-700/50 overflow-hidden relative">
              <div class="p-6">
                <div class="text-sm text-slate-400 font-medium">STORAGE USAGE</div>
                <div id="storageInfo" class="mt-2 text-slate-100"></div>
              </div>
            </div>
          </div>
      </div>
  </div>

        <!-- Security Status Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">SECURITY STATUS</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- Firewall -->
              <div id="firewallStatus" class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Firewall</div>
                <span id="firewallBadge" class="bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs">Active</span>
              </div>
              <!-- Intrusion Detection -->
              <div id="intrusionStatus" class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Intrusion Detection</div>
                <span id="intrusionBadge" class="bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs">Active</span>
              </div>
              <!-- Encryption -->
              <div id="encryptionStatus" class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Encryption</div>
                <span id="encryptionBadge" class="bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs">Active</span>
              </div>
              <!-- Threat Database -->
              <div class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Threat Database</div>
                <div id="threatDbTime" class="text-sm text-cyan-400">
                  Updated <span class="text-slate-500">12 min ago</span>
                </div>
              </div>
              <!-- Security Level -->
              <div class="pt-2 mt-2 border-t border-slate-700/50">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-sm font-medium text-slate-300">Security Level</div>
                  <div id="securityLevelText" class="text-sm text-cyan-400">75%</div>
                </div>
                <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                  <div id="securityLevelBar" class="h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full" style="width: 75%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- System Alerts Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">SYSTEM ALERTS</h3>
            </div>
          </div>
          <div id="systemAlertsContainer" class="p-6 space-y-3">
            <!-- Alert akan ditambahkan di sini -->
          </div>
          <div id="systemAlertsContainer" class="p-6 space-y-3"></div>
<div id="alertPaginationContainer" class="mt-4 flex justify-center items-center space-x-2"></div>
        </div>


        <!-- Premium AI Communications Log -->
<div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
  <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
    <div class="absolute -top-1 -right-1">
      <span class="relative flex h-3 w-3">
        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-500 opacity-75"></span>
        <span class="relative inline-flex rounded-full h-3 w-3 bg-cyan-600"></span>
      </span>
    </div>
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="p-2 bg-cyan-600/20 rounded-lg border border-cyan-500/30 shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
          </svg>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-slate-100 tracking-tight">AI Communications</h3>
          <p class="text-xs text-slate-400 flex items-center mt-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
            </svg>
            Secure connection • Real-time updates
          </p>
        </div>
      </div>
      <span class="bg-gradient-to-r from-cyan-900/30 to-blue-800/30 text-cyan-400 border border-cyan-700/50 rounded-lg px-3 py-1.5 text-xs font-medium flex items-center shadow-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
        <span id="new-ai-messages">0 New Messages</span>
      </span>
    </div>
  </div>
  <div class="p-6 h-96 overflow-y-auto" id="ai-log-container">
    <div class="space-y-4" id="ai-log-messages">
      <!-- Default message -->
      <div class="flex items-start">
        <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
        </div>
        <div class="bg-slate-800/60 border border-slate-700/50 rounded-xl p-4 text-sm text-slate-300">
          <div class="font-medium text-cyan-400 mb-1 flex items-center">
            AI Assistant
            <span class="ml-2 text-xs px-2 py-0.5 bg-slate-700/50 rounded-full text-slate-400">System</span>
          </div>
          <p>Welcome to your secure AI communication channel. How may I assist you today?</p>
          <div class="text-xs text-slate-500 mt-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Just now
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="p-4 border-t border-slate-700/60 bg-gradient-to-b from-slate-800/70 to-slate-900/90">
    <div class="flex items-center space-x-3">
      <button id="ai-attach-file-btn" class="p-2 rounded-lg bg-slate-800/50 border border-slate-700/50 hover:bg-slate-700/50 transition-all text-slate-400 hover:text-slate-300" title="Attach File">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
        </svg>
      </button>
      <input type="file" id="ai-file-input" accept="image/*" class="hidden" />
      <input
        type="text"
        id="ai-message-input"
        placeholder="Type your message..."
        class="flex-1 bg-slate-800/50 border border-slate-700/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all placeholder-slate-500 text-slate-300"
      />
      <button
        id="ai-send-button"
        class="bg-gradient-to-r from-cyan-600 to-blue-700 hover:from-cyan-500 hover:to-blue-600 rounded-xl p-3 transition-all shadow-md hover:shadow-cyan-500/20 flex items-center justify-center"
        title="Send Message"
        aria-label="Send Message"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
        </svg>
      </button>
    </div>
    <div class="flex items-center justify-between mt-3 px-1">
      <div id="ai-template-panel" class="flex items-center space-x-4 hidden">
        <button class="text-xs text-slate-500 hover:text-slate-400 transition-all" data-template="What are the main features of Aqula mining?">Features</button>
        <button class="text-xs text-slate-500 hover:text-slate-400 transition-all" data-template="How does Aqula mining work?">How it works</button>
        <button class="text-xs text-slate-500 hover:text-slate-400 transition-all" data-template="What is the future vision of Aqula?">Future vision</button>
      </div>
      <div class="text-xs text-slate-500 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
        </svg>
        End-to-end encrypted
      </div>
    </div>
    <div id="ai-template-panel" class="flex flex-col space-y-2 p-3 bg-slate-800/50 rounded-lg border border-slate-700/50 text-xs hidden">
      <button class="text-left text-slate-400 hover:text-white transition-all px-2 py-1 rounded" data-template="What are the main features of Aqula mining?">Features</button>
      <button class="text-left text-slate-400 hover:text-white transition-all px-2 py-1 rounded" data-template="How does Aqula mining work?">How It Works</button>
      <button class="text-left text-slate-400 hover:text-white transition-all px-2 py-1 rounded" data-template="What is the future vision of Aqula?">Future Vision</button>
    </div>
    
    <button id="ai-toggle-templates" class="text-xs text-slate-500 hover:text-slate-400 flex items-center mt-2 transition-all">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
      </svg>
      Show Templates
    </button>
  </div>
</div>
      </div>

      <!-- Right Column (1/3 width) -->
      <div class="space-y-6">
        <!-- System Time Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="bg-gradient-to-br from-slate-800 to-slate-900/90 p-6 border-b border-slate-700/50">
            <div class="text-center">
              <div class="text-xs text-slate-500 mb-1 font-mono tracking-wider">SYSTEM TIME</div>
              <div id="systemTime" class="text-4xl font-mono text-cyan-400 mb-1 tracking-tighter">
                00:00:00
              </div>
              <div id="systemDate" class="text-sm text-slate-400 font-medium">
                Jan 1, 2025
              </div>
            </div>
          </div>
          <div class="p-5">
            <div class="grid grid-cols-2 gap-3">
              <!-- UPTIME -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-lg p-3 border border-slate-700/50">
                <div class="text-xs text-slate-500 mb-1 font-mono">UPTIME</div>
                <div id="uptime" class="text-sm font-mono text-slate-200">
                  00d 00:00:00
                </div>
              </div>
              <!-- TIME ZONE -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-lg p-3 border border-slate-700/50">
                <div class="text-xs text-slate-500 mb-1 font-mono">TIME ZONE</div>
                <div id="timezone" class="text-sm font-mono text-slate-200">
                  UTC+00:00
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Premium Quick Actions Dashboard -->
        <div class="card bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl overflow-hidden border border-slate-700/40 shadow-2xl backdrop-blur-sm">
          <div class="p-5 border-b border-slate-700/40 bg-gradient-to-r from-slate-800/90 to-slate-900/90 relative overflow-hidden">
            <div class="absolute inset-0 opacity-10 [background-image:linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] [background-size:24px_24px]"></div>
            <div class="flex items-center relative z-10">
              <div class="p-1.5 bg-cyan-500/10 rounded-lg border border-cyan-500/20 mr-3 backdrop-blur-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex-1">QUICK ACTIONS</h3>
              <div class="h-1.5 w-8 bg-gradient-to-r from-cyan-500/70 to-blue-500/70 rounded-full"></div>
            </div>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-2 gap-3">
              <!-- Security Scan Button -->
              <button id="btnSecurityScan" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Security Scan</span>
              </button>
              <!-- View Log Button -->
              <button id="btnViewLog" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">View Scan Log</span>
              </button>
              <!-- Sync Data Button -->
              <button id="btnSyncData" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Sync Data</span>
              </button>
              <!-- Backup Button -->
              <button id="btnBackup" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Backup</span>
              </button>
              <!-- Console Button -->
              <button id="btnConsole" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Console</span>
              </button>
            </div>
            <!-- Scan Log Section -->
            <div class="mt-6">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-xs font-medium text-slate-400/90 uppercase tracking-wider">SCAN RESULT LOG</h4>
                <div class="flex space-x-2">
                  <button class="text-xs text-slate-500 hover:text-cyan-400 transition-colors duration-200">Clear</button>
                  <button class="text-xs text-slate-500 hover:text-cyan-400 transition-colors duration-200">Export</button>
                </div>
              </div>
              <div id="scanResultLog" class="bg-slate-900/60 border border-slate-700/30 rounded-lg p-4 h-48 overflow-y-auto font-mono text-xs text-slate-300 space-y-2 backdrop-blur-sm">
                <div class="text-slate-500">> Checking file permissions...</div>
              </div>
            </div>
            <!-- Progress Bar -->
            <div id="scanProgressContainer" class="mt-4 hidden">
              <div class="flex items-center justify-between text-xs text-slate-400 mb-1.5">
                <span>Scan Progress</span>
                <span id="scanProgressText">0%</span>
              </div>
              <div class="w-full bg-slate-800/60 rounded-full h-1.5 overflow-hidden">
                <div id="scanProgressBar" class="h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all duration-500 ease-out" style="width: 0%">
                  <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Resource Allocation Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">RESOURCE ALLOCATION</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- Processing Power -->
              <div>
                <div class="flex items-center justify-between mb-1">
                  <div class="text-sm text-slate-400">Processing Power</div>
                  <div id="procPercent" class="text-xs text-cyan-400">42% allocated</div>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div id="procBar" class="h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full w-[42%]"></div>
                </div>
              </div>
              <!-- Memory Allocation -->
              <div>
                <div class="flex items-center justify-between mb-1">
                  <div class="text-sm text-slate-400">Memory Allocation</div>
                  <div id="memPercent" class="text-xs text-purple-400">68% allocated</div>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div id="memBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full" style="width: 68%"></div>
                </div>
              </div>
              <!-- Network Bandwidth -->
              <div>
                <div class="flex items-center justify-between mb-1">
                  <div class="text-sm text-slate-400">Network Bandwidth</div>
                  <div id="netPercent" class="text-xs text-blue-400">35% allocated</div>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div id="netBar" class="h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full w-[35%]"></div>
                </div>
              </div>
              <!-- Priority Level -->
              <div class="pt-3 border-t border-slate-700/50">
                <div class="flex items-center justify-between text-sm">
                  <div class="text-slate-400">Priority Level</div>
                  <div class="flex items-center">
                    <input id="prioritySlider"
                      type="range"
                      min="1"
                      max="5"
                      value="3"
                      class="w-24 mr-2 accent-cyan-500"
                    />
                    <span id="priorityValue" class="text-cyan-400 font-mono">3/5</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Neural Interface Card with Real Functionality -->
<div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl hover:shadow-cyan-500/10 transition-all">
  <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
    <div class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
        <path d="M8 12h.01M12 12h.01M16 12h.01" class="stroke-cyan-300" />
      </svg>
      <h3 class="text-lg font-semibold text-slate-100 tracking-wide">NEURAL INTERFACE</h3>
      <span id="connectionStatus" class="ml-auto px-2 py-1 text-xs bg-cyan-600/30 text-cyan-300 rounded-full border border-cyan-400/20 flex items-center">
        <span class="w-2 h-2 rounded-full bg-cyan-400 mr-1 animate-pulse"></span>
        CONNECTING
      </span>
    </div>
  
  <div class="p-6">
    <div class="space-y-5">
      <!-- Brainwave Sync -->
      <div class="p-4 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" />
              <path d="M12 8v4l3 3" class="stroke-cyan-300" />
            </svg>
            <span class="text-sm text-slate-300">Neural Synchronization</span>
          </div>
          <div class="relative">
            <input id="neuralSyncSlider" type="range" min="0" max="100" value="0" 
                   class="w-24 h-1 bg-slate-700 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-cyan-400">
            <span id="syncValue" class="absolute -top-5 right-0 text-xs text-cyan-300">0%</span>
          </div>
        </div>
        <div class="flex space-x-1.5 mt-2 items-center">
          <svg id="syncIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
          </svg>
          <div class="flex-1 h-1.5 bg-slate-700 rounded-full overflow-hidden">
            <div id="syncProgress" class="h-full bg-gradient-to-r from-cyan-500 to-cyan-400 transition-all duration-300" style="width: 0%"></div>
          </div>
        </div>
      </div>
      <div class="p-4 mt-4 bg-slate-800/50 rounded-lg border border-slate-700/50">
        <canvas id="waveformCanvas" width="400" height="80"></canvas>
      </div>
    </div>
    

      <!-- Cognitive Modules -->
      <div class="p-4 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
            </svg>
            <span class="text-sm text-slate-300">Cognitive Modules</span>
          </div>
          <div class="flex space-x-2">
            <button id="decreaseModule" class="w-7 h-7 flex items-center justify-center rounded-lg bg-slate-700/50 border border-slate-600/50 text-cyan-300 hover:bg-cyan-600/30 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </button>
            <span id="moduleCount" class="w-7 h-7 flex items-center justify-center rounded-lg bg-slate-700/30 border border-slate-600/50 text-slate-200 text-xs">0x</span>
            <button id="increaseModule" class="w-7 h-7 flex items-center justify-center rounded-lg bg-slate-700/50 border border-slate-600/50 text-cyan-300 hover:bg-cyan-600/30 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
      <!-- Neural Presets -->
      <div class="pt-3">
        <div class="flex items-center mb-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
          </svg>
          <h4 class="text-xs uppercase tracking-wider text-cyan-400/80">PRESET MODES</h4>
        </div>
        <div class="grid grid-cols-3 gap-2">
          <button id="focusMode" class="py-2 px-1 text-xs rounded-lg border border-slate-700/50 bg-slate-800/30 text-slate-200 hover:bg-cyan-600/20 transition-colors flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
            Focus
          </button>
          <button id="creativeMode" class="py-2 px-1 text-xs rounded-lg border border-slate-700/50 bg-slate-800/30 text-slate-200 hover:bg-cyan-600/20 transition-colors flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            Creative
          </button>
          <button id="relaxMode" class="py-2 px-1 text-xs rounded-lg border border-slate-700/50 bg-slate-800/30 text-slate-200 hover:bg-cyan-600/20 transition-colors flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
            </svg>
            Relax
          </button>
        </div>
      </div>
      <!-- Neural Status -->
      <div class="pt-4 mt-3 border-t border-slate-700/50">
        <div class="flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
          </svg>
          <div class="flex-1">
            <div class="flex justify-between text-xs text-slate-400 mb-1">
              <span>Neural Link</span>
              <span id="linkStability">0% Stable</span>
            </div>
            <div class="h-1.5 bg-slate-700 rounded-full overflow-hidden">
              <div id="linkStabilityBar" class="h-full bg-gradient-to-r from-cyan-500 to-cyan-400 transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
</div>





<!-- Hidden Audio Players -->
<audio id="focusAudio" src="https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/chat-media/musik/fokus.mp3" preload="auto"></audio>
<audio id="creativeAudio" src="https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/chat-media/musik/creative.mp3" preload="auto"></audio>
<audio id="relaxAudio" src="https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/chat-media/musik/relax.mp3" preload="auto"></audio>

<script>
// Simulate device connection
document.addEventListener('DOMContentLoaded', function() {
  // Connection status simulation
  const connectionStatus = document.getElementById('connectionStatus');
  // Simulate device connection sequence
  setTimeout(() => {
    connectionStatus.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-400 mr-1 animate-pulse"></span> CONNECTED`;
    connectionStatus.className = connectionStatus.className.replace('bg-cyan-600/30', 'bg-green-600/30').replace('border-cyan-400/20', 'border-green-400/20');
    // Initialize values after connection
    updateSyncValue(72);
    updateModuleCount(3);
    updateLinkStability(82);
  }, 2000);

  // Neural Sync Slider
  const syncSlider = document.getElementById('neuralSyncSlider');
  const syncValue = document.getElementById('syncValue');
  const syncProgress = document.getElementById('syncProgress');
  const syncIcon = document.getElementById('syncIcon');

  syncSlider.addEventListener('input', function() {
    updateSyncValue(this.value);
  });

  function updateSyncValue(value) {
    syncValue.textContent = `${value}%`;
    syncProgress.style.width = `${value}%`;

    if (value > 70) {
      syncIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />`;
    } else if (value > 30) {
      syncIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />`;
    } else {
      syncIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 5v6m0 0v6m0-6h6m-6 0H7" />`;
    }

    console.log(`Setting neural sync to ${value}%`);
  }

  // Cognitive Modules
  const decreaseBtn = document.getElementById('decreaseModule');
  const increaseBtn = document.getElementById('increaseModule');
  const moduleCount = document.getElementById('moduleCount');
  let modules = 0;

  decreaseBtn.addEventListener('click', function() {
    if (modules > 0) {
      updateModuleCount(modules - 1);
    }
  });

  increaseBtn.addEventListener('click', function() {
    if (modules < 5) {
      updateModuleCount(modules + 1);
    }
  });

  function updateModuleCount(count) {
    modules = count;
    moduleCount.textContent = `${count}x`;
    console.log(`Setting cognitive modules to ${count}x`);
  }

  // Preset Modes
  const focusMode = document.getElementById('focusMode');
  const creativeMode = document.getElementById('creativeMode');
  const relaxMode = document.getElementById('relaxMode');

  [focusMode, creativeMode, relaxMode].forEach(btn => {
    btn.addEventListener('click', function() {
      [focusMode, creativeMode, relaxMode].forEach(b => 
        b.classList.remove('bg-cyan-600/40', 'border-cyan-400/50'));
      this.classList.add('bg-cyan-600/40', 'border-cyan-400/50');

      if (this === focusMode) {
        updateSyncValue(85);
        updateModuleCount(4);
        updateLinkStability(90);
        syncSlider.value = 85;
      } else if (this === creativeMode) {
        updateSyncValue(65);
        updateModuleCount(5);
        updateLinkStability(75);
        syncSlider.value = 65;
      } else {
        updateSyncValue(40);
        updateModuleCount(2);
        updateLinkStability(95);
        syncSlider.value = 40;
      }
      console.log(`Activated ${this.textContent.trim()} mode`);
    });
  });

  // Link Stability
  const linkStability = document.getElementById('linkStability');
  const linkStabilityBar = document.getElementById('linkStabilityBar');

  function updateLinkStability(value) {
    linkStability.textContent = `${value}% Stable`;
    linkStabilityBar.style.width = `${value}%`;

    if (value > 80) {
      linkStabilityBar.className = linkStabilityBar.className.replace(/from-[\w-]+ to-[\w-]+/, 'from-green-500 to-green-400');
    } else if (value > 50) {
      linkStabilityBar.className = linkStabilityBar.className.replace(/from-[\w-]+ to-[\w-]+/, 'from-cyan-500 to-cyan-400');
    } else {
      linkStabilityBar.className = linkStabilityBar.className.replace(/from-[\w-]+ to-[\w-]+/, 'from-yellow-500 to-yellow-400');
    }
  }

  setInterval(() => {
    const fluctuation = Math.floor(Math.random() * 6) - 3;
    const currentStability = parseInt(linkStability.textContent);
    const newStability = Math.min(100, Math.max(0, currentStability + fluctuation));
    updateLinkStability(newStability);
  }, 5000);

  // === MUSIK INTEGRATION === //
  const focusAudio = document.getElementById('focusAudio');
  const creativeAudio = document.getElementById('creativeAudio');
  const relaxAudio = document.getElementById('relaxAudio');

  function stopAllAudio() {
    focusAudio.pause();
    creativeAudio.pause();
    relaxAudio.pause();
    focusAudio.currentTime = 0;
    creativeAudio.currentTime = 0;
    relaxAudio.currentTime = 0;
  }

  focusMode.addEventListener('click', () => {
    stopAllAudio();
    focusAudio.play().catch(() => {
      console.log("Autoplay diblokir browser");
    });
  });

  creativeMode.addEventListener('click', () => {
    stopAllAudio();
    creativeAudio.play().catch(() => {
      console.log("Autoplay diblokir browser");
    });
  });

  relaxMode.addEventListener('click', () => {
    stopAllAudio();
    relaxAudio.play().catch(() => {
      console.log("Autoplay diblokir browser");
    });
  });

  syncSlider.addEventListener('input', function () {
    const value = parseInt(this.value) / 100;
    focusAudio.volume = value;
    creativeAudio.volume = value;
    relaxAudio.volume = value;
  });
});
</script>


<!-- Crypto Realtime Info Card -->
<div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
  <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
    <div class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <h3 class="text-lg font-semibold text-slate-100 tracking-wide">CRYPTO REALTIME INFO</h3>
    </div>
  </div>
  <div class="p-6">
    <div class="mb-4">
      <label for="coinSelect" class="block text-sm text-slate-400 mb-2">Pilih Koin:</label>
      <select id="coinSelect" class="w-full p-2 rounded-md bg-slate-800/70 border border-slate-700 text-white focus:outline-none focus:border-cyan-500">
        <option value="bitcoin">Bitcoin (BTC)</option>
        <option value="ethereum">Ethereum (ETH)</option>
        <option value="tether">Tether (USDT)</option>
        <option value="usd-coin">USD Coin (USDC)</option>
        <option value="binancecoin">BNB (BNB)</option>
        <option value="solana">Solana (SOL)</option>
        <option value="xrp">XRP (XRP)</option>
        <option value="cardano">Cardano (ADA)</option>
        <option value="dogecoin">Dogecoin (DOGE)</option>
        <option value="polkadot">Polkadot (DOT)</option>
        <option value="avalanche-2">Avalanche (AVAX)</option>
        <option value="chainlink">Chainlink (LINK)</option>
        <option value="litecoin">Litecoin (LTC)</option>
        <option value="uniswap">Uniswap (UNI)</option>
        <option value="monero">Monero (XMR)</option>
        <option value="litecoin">Litecoin (LTC)</option>
        <option value="stellar">Stellar (XLM)</option>
        <option value="algorand">Algorand (ALGO)</option>
        <option value="filecoin">Filecoin (FIL)</option>
        <option value="eos">EOS (EOS)</option>
        <option value="vechain">VeChain (VET)</option>
        <option value="theta-token">Theta Network (THETA)</option>
        <option value="maker">Maker (MKR)</option>
        <option value="aave-token">Aave (AAVE)</option>
        <option value="compound">Compound (COMP)</option>
      </select>
    </div>

    <div class="mb-4">
      <p class="text-slate-300 text-sm">Harga Terkini:</p>
      <p id="cryptoPrice" class="text-2xl font-bold text-emerald-400">--</p>
    </div>

    <div class="mb-4">
      <p class="text-slate-300 text-sm">Perubahan 24 Jam:</p>
      <p id="priceChange" class="text-base font-medium text-yellow-400">--</p>
    </div>

    <div class="mb-4">
      <p class="text-slate-300 text-sm">Volume 24 Jam:</p>
      <p id="volume24h" class="text-base font-medium text-blue-400">--</p>
    </div>

    <div class="mb-4">
      <p class="text-slate-300 text-sm">Market Cap:</p>
      <p id="marketCap" class="text-base font-medium text-purple-400">--</p>
    </div>

    <div class="mb-4">
      <p class="text-slate-300 text-sm">High / Low 24 Jam:</p>
      <p id="highLow" class="text-base font-medium text-orange-400">--</p>
    </div>

    <div class="h-48 mt-4">
      <canvas id="cryptoChart"></canvas>
    </div>
  </div>
</div>


<!-- Script -->
<script>
  // === DOM Elements untuk Crypto ===
  const coinSelect = document.getElementById('coinSelect');
  const cryptoPrice = document.getElementById('cryptoPrice');
  const priceChange = document.getElementById('priceChange');
  const volume24h = document.getElementById('volume24h');
  const marketCap = document.getElementById('marketCap');
  const highLow = document.getElementById('highLow');

  let selectedCurrency = 'usd'; // tetap gunakan usd karena kraken hanya support USD pair

  // === Chart Crypto ===
  const ctxCrypto = document.getElementById('cryptoChart').getContext('2d');
  let cryptoChart = new Chart(ctxCrypto, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Harga (USD)',
        data: [],
        borderColor: '#10B981',
        backgroundColor: 'rgba(16, 185, 129, 0.1)',
        borderWidth: 2,
        tension: 0.4,
        pointRadius: 0,
        fill: true
      }]
    },
    options: {
      responsive: true,
      animation: false,
      scales: {
        x: { display: false },
        y: { beginAtZero: false }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `USD ${context.parsed.y.toFixed(2)}`;
            }
          }
        }
      }
    }
  });

  // === Fungsi Fetch via Proxy AllOrigins
  async function proxyFetch(url) {
    const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
    return res.json();
  }

  // Mapping Coin ID ke Pair Kraken
  const coinToPairMap = {
    bitcoin: 'BTCUSD',
    ethereum: 'ETHUSD',
    tether: 'USDTUSD',
    'usd-coin': 'USDCUSD',
    binancecoin: 'BNBUSD',
    solana: 'SOLUSD',
    xrp: 'XRPUSD',
    cardano: 'ADAUSD',
    dogecoin: 'DOGEUSD',
    polkadot: 'DOTUSD',
    'avalanche-2': 'AVAXUSD',
    chainlink: 'LINKUSD',
    litecoin: 'LTCUSD',
    uniswap: 'UNIUSD',
    monero: 'XMRUSD',
    stellar: 'XLMUSD',
    algorand: 'ALGOUSD',
    filecoin: 'FILUSD',
    eos: 'EOSUSD',
    vechain: 'VETUSD',
    'theta-token': 'THETAUSD',
    maker: 'MKRUSD',
    'aave-token': 'AAVEUSD',
    compound: 'COMPUSD'
  };

  // === Fungsi Ambil Data Crypto dari Kraken ===
  async function fetchCryptoData(coinId = 'bitcoin') {
    try {
      const pair = coinToPairMap[coinId];
      if (!pair) throw new Error("Pair tidak ditemukan");

      // Harga Terkini
      const priceData = await proxyFetch(`https://api.kraken.com/0/public/Ticker?pair=${pair}`);
      const ticker = Object.values(priceData.result)[0];
      const price = parseFloat(ticker.c[0]);
      cryptoPrice.textContent = `$${price.toLocaleString(undefined, { minimumFractionDigits: 2 })}`;

      // Volume 24 jam
      const volume = parseFloat(ticker.v[1]); // volume 24 jam
      volume24h.textContent = `$${volume.toLocaleString()}`;

      // High / Low 24 Jam
      const high = parseFloat(ticker.h[0]);
      const low = parseFloat(ticker.l[0]);
      highLow.textContent = `$${low.toLocaleString()} / $${high.toLocaleString()}`;

      // Tidak ada market cap di Kraken
      marketCap.textContent = '--';

      // Perubahan 24 Jam (manual)
      const changePercent = ((price - low) / low * 100).toFixed(2);
      priceChange.textContent = `${changePercent}%`;
      priceChange.className = `text-base font-medium ${
        changePercent >= 0 ? 'text-green-400' : 'text-red-400'
      }`;

      // Histori 7 Hari (OHLC Interval 60 menit)
      const since = Math.floor(Date.now() / 1000) - 604800; // 7 hari lalu
      const historyData = await proxyFetch(`https://api.kraken.com/0/public/OHLC?pair=${pair}&interval=60&since=${since}`);
      const ohlc = Object.values(historyData.result)[0];

      const prices = ohlc.map(item => item[4]); // Close price
      const timestamps = ohlc.map(item => {
        const date = new Date(item[0] * 1000); // timestamp dalam detik
        return `${date.getMonth()+1}/${date.getDate()}`;
      });

      cryptoChart.data.labels = timestamps;
      cryptoChart.data.datasets[0].data = prices.map(p => parseFloat(p));
      cryptoChart.update();

    } catch (error) {
      console.error("Error fetching crypto data from Kraken:", error);
      cryptoPrice.textContent = 'Gagal memuat';
      priceChange.textContent = '--';
      volume24h.textContent = '--';
      marketCap.textContent = '--';
      highLow.textContent = '--';
    }
  }

  // === Event Listener Dropdown Koin ===
  coinSelect.addEventListener('change', () => {
    fetchCryptoData(coinSelect.value);
  });

  // === Load Awal ===
  fetchCryptoData();

  // === Update Otomatis Setiap 30 Detik ===
  setInterval(() => {
    fetchCryptoData(coinSelect.value);
  }, 30000);
</script>








        <!-- Environment Controls Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <!-- Icon (Placeholder, as original was empty) -->
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">ENVIRONMENT CONTROLS</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- Power Management -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                  </svg>
                  <span class="text-sm text-slate-300">Power Management</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input id="powerManagementToggle" type="checkbox" class="sr-only peer">
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
              
              <!-- Security Protocol -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                  <span class="text-sm text-slate-300">Security Protocol</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <label for="securityProtocolToggle" class="sr-only">Security Protocol Toggle</label>
                  <input 
                    id="securityProtocolToggle" 
                    type="checkbox" 
                    class="sr-only peer" 
                    checked
                    aria-label="Toggle security protocol"
                    title="Enable or disable security protocol"
                  >
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
              <!-- Power Saving Mode -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  <span class="text-sm text-slate-300">Power Saving Mode</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input id="powerSavingModeToggle" type="checkbox" class="sr-only peer">
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
              <!-- Auto Shutdown -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                  </svg>
                  <span class="text-sm text-slate-300">Auto Shutdown</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input id="autoShutdownToggle" type="checkbox" class="sr-only peer" checked>
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  


  <div id="pageBooster" class="page page-hidden px-4 sm:px-6">
    <div class="mb-4 sm:mb-6">
      <h2 class="text-xl sm:text-2xl font-bold text-slate-100 mb-2 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-8 sm:w-8 mr-2 sm:mr-3 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z" />
        </svg>
        Performance Boosters
      </h2>
      <p class="text-sm sm:text-base text-slate-400">Upgrade your mining experience with powerful boosters</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
      <!-- Elite Booster -->
      <div class="flip-card card group max-w-full">
        <div class="flip-card-inner">
          <div class="flip-card-front p-4 sm:p-6 flex flex-col">
            <div class="flex justify-between items-start mb-3 sm:mb-4">
              <div>
                <div class="flex items-center gap-2">
                  <i data-lucide="zap" class="h-4 w-4 sm:h-5 sm:w-5 text-cyan-400"></i>
                  <h3 class="text-lg sm:text-xl font-bold text-cyan-400">Elite Booster</h3>
                </div>
                <div class="badge bg-cyan-900/40 text-cyan-400 border-cyan-400/30 mt-1 text-xs sm:text-sm">Popular</div>
              </div>
              <div class="text-2xl sm:text-3xl font-bold text-slate-100 font-mono">3x</div>
            </div>
            <div class="flex-1 space-y-3 sm:space-y-4">
              <div class="flex items-center text-slate-300">
                <i data-lucide="clock" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-cyan-400"></i>
                <span class="text-xs sm:text-sm">30-day validity</span>
              </div>
              <div class="flex items-center text-slate-300">
                <i data-lucide="bar-chart-2" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-cyan-400"></i>
                <span class="text-xs sm:text-sm">Triple mining speed</span>
              </div>
            </div>
            <div class="mt-4 sm:mt-6">
              <div class="flex justify-between items-center mb-2">
                <span class="text-xs text-slate-400">Price</span>
                <span class="text-base sm:text-lg font-bold text-slate-100">0.0001 ETH</span>
              </div>
              <button class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30 purchase-btn" data-booster="elite" data-price="0.0001">
                <i data-lucide="shopping-cart" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Purchase Now
              </button>
            </div>
          </div>
          <div class="flip-card-back p-4 sm:p-6 flex flex-col">
            <div class="flex items-center gap-2 mb-3 sm:mb-4">
              <i data-lucide="zap" class="h-4 w-4 sm:h-5 sm:w-5 text-cyan-400"></i>
              <h4 class="text-base sm:text-lg font-bold text-cyan-400">Elite Benefits</h4>
            </div>
            <ul class="space-y-2 sm:space-y-3 flex-1">
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Triple your mining speed with advanced algorithms</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">30-day full access to premium features</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Priority customer support 24/7</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Daily bonus rewards</span>
              </li>
            </ul>
            <div class="mt-4 sm:mt-6">
              <button class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30 purchase-btn" data-booster="elite" data-price="0.0001">
                <i data-lucide="credit-card" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Buy Now
              </button>
              <p class="text-xs text-center text-slate-500 mt-2">Boost your mining with Elite power!</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Epic Booster -->
      <div class="flip-card card group max-w-full">
        <div class="flip-card-inner">
          <div class="flip-card-front p-4 sm:p-6 flex flex-col">
            <div class="flex justify-between items-start mb-3 sm:mb-4">
              <div>
                <div class="flex items-center gap-2">
                  <i data-lucide="sparkles" class="h-4 w-4 sm:h-5 sm:w-5 text-purple-400"></i>
                  <h3 class="text-lg sm:text-xl font-bold text-purple-400">Epic Booster</h3>
                </div>
                <div class="badge bg-purple-900/40 text-purple-400 border-purple-400/30 mt-1 text-xs sm:text-sm">Best Value</div>
              </div>
              <div class="text-2xl sm:text-3xl font-bold text-slate-100 font-mono">5x</div>
            </div>
            <div class="flex-1 space-y-3 sm:space-y-4">
              <div class="flex items-center text-slate-300">
                <i data-lucide="clock" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-purple-400"></i>
                <span class="text-xs sm:text-sm">45-day validity</span>
              </div>
              <div class="flex items-center text-slate-300">
                <i data-lucide="bar-chart-2" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-purple-400"></i>
                <span class="text-xs sm:text-sm">5x mining speed</span>
              </div>
            </div>
            <div class="mt-4 sm:mt-6">
              <div class="flex justify-between items-center mb-2">
                <span class="text-xs text-slate-400">Price</span>
                <span class="text-base sm:text-lg font-bold text-slate-100">0.0003 ETH</span>
              </div>
              <button class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-purple-500/20 hover:shadow-purple-500/30 purchase-btn" data-booster="epic" data-price="0.0003">
                <i data-lucide="shopping-cart" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Purchase Now
              </button>
            </div>
          </div>
          <div class="flip-card-back p-4 sm:p-6 flex flex-col">
            <div class="flex items-center gap-2 mb-3 sm:mb-4">
              <i data-lucide="sparkles" class="h-4 w-4 sm:h-5 sm:w-5 text-purple-400"></i>
              <h4 class="text-base sm:text-lg font-bold text-purple-400">Epic Benefits</h4>
            </div>
            <ul class="space-y-2 sm:space-y-3 flex-1">
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">5x mining speed with optimized performance</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">45-day premium access period</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Enhanced analytics dashboard</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Weekly bonus rewards</span>
              </li>
            </ul>
            <div class="mt-4 sm:mt-6">
              <button class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-purple-500/20 hover:shadow-purple-500/30 purchase-btn" data-booster="epic" data-price="0.0003">
                <i data-lucide="credit-card" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Buy Now
              </button>
              <p class="text-xs text-center text-slate-500 mt-2">Unleash epic mining performance!</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Pro Booster -->
      <div class="flip-card card group max-w-full">
        <div class="flip-card-inner">
          <div class="flip-card-front p-4 sm:p-6 flex flex-col">
            <div class="flex justify-between items-start mb-3 sm:mb-4">
              <div>
                <div class="flex items-center gap-2">
                  <i data-lucide="crown" class="h-4 w-4 sm:h-5 sm:w-5 text-blue-400"></i>
                  <h3 class="text-lg sm:text-xl font-bold text-blue-400">Pro Booster</h3>
                </div>
                <div class="badge bg-blue-900/40 text-blue-400 border-blue-400/30 mt-1 text-xs sm:text-sm">Advanced</div>
              </div>
              <div class="text-2xl sm:text-3xl font-bold text-slate-100 font-mono">10x</div>
            </div>
            <div class="flex-1 space-y-3 sm:space-y-4">
              <div class="flex items-center text-slate-300">
                <i data-lucide="clock" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-blue-400"></i>
                <span class="text-xs sm:text-sm">60-day validity</span>
              </div>
              <div class="flex items-center text-slate-300">
                <i data-lucide="bar-chart-2" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-blue-400"></i>
                <span class="text-xs sm:text-sm">10x mining speed</span>
              </div>
            </div>
            <div class="mt-4 sm:mt-6">
              <div class="flex justify-between items-center mb-2">
                <span class="text-xs text-slate-400">Price</span>
                <span class="text-base sm:text-lg font-bold text-slate-100">0.009 ETH</span>
              </div>
              <button class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 purchase-btn" data-booster="pro" data-price="0.009">
                <i data-lucide="shopping-cart" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Purchase Now
              </button>
            </div>
          </div>
          <div class="flip-card-back p-4 sm:p-6 flex flex-col">
            <div class="flex items-center gap-2 mb-3 sm:mb-4">
              <i data-lucide="crown" class="h-4 w-4 sm:h-5 sm:w-5 text-blue-400"></i>
              <h4 class="text-base sm:text-lg font-bold text-blue-400">Pro Benefits</h4>
            </div>
            <ul class="space-y-2 sm:space-y-3 flex-1">
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">10x mining speed with professional tools</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">60-day extended premium access</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Premium support & advanced insights</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Exclusive Pro mining pools</span>
              </li>
            </ul>
            <div class="mt-4 sm:mt-6">
              <button class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 purchase-btn" data-booster="pro" data-price="0.009">
                <i data-lucide="credit-card" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Buy Now
              </button>
              <p class="text-xs text-center text-slate-500 mt-2">Go pro with unmatched mining speed!</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Diamond Booster -->
      <div class="flip-card card group max-w-full">
        <div class="flip-card-inner">
          <div class="flip-card-front p-4 sm:p-6 flex flex-col">
            <div class="flex justify-between items-start mb-3 sm:mb-4">
              <div>
                <div class="flex items-center gap-2">
                  <i data-lucide="gem" class="h-4 w-4 sm:h-5 sm:w-5 text-amber-400"></i>
                  <h3 class="text-lg sm:text-xl font-bold text-amber-400">Diamond Booster</h3>
                </div>
                <div class="badge bg-amber-900/40 text-amber-400 border-amber-400/30 mt-1 text-xs sm:text-sm">VIP</div>
              </div>
              <div class="text-2xl sm:text-3xl font-bold text-slate-100 font-mono">15x</div>
            </div>
            <div class="flex-1 space-y-3 sm:space-y-4">
              <div class="flex items-center text-slate-300electrical">
                <i data-lucide="clock" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-amber-400"></i>
                <span class="text-xs sm:text-sm">90-day validity</span>
              </div>
              <div class="flex items-center text-slate-300">
                <i data-lucide="bar-chart-2" class="h-3 w-3 sm:h-4 sm:w-4 mr-2 text-amber-400"></i>
                <span class="text-xs sm:text-sm">15x mining speed</span>
              </div>
            </div>
            <div class="mt-4 sm:mt-6">
              <div class="flex justify-between items-center mb-2">
                <span class="text-xs text-slate-400">Price</span>
                <span class="text-base sm:text-lg font-bold text-slate-100">0.01 ETH</span>
              </div>
              <button class="w-full bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-amber-500/20 hover:shadow-amber-500/30 purchase-btn" data-booster="diamond" data-price="0.01">
                <i data-lucide="shopping-cart" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Purchase Now
              </button>
            </div>
          </div>
          <div class="flip-card-back p-4 sm:p-6 flex flex-col">
            <div class="flex items-center gap-2 mb-3 sm:mb-4">
              <i data-lucide="gem" class="h-4 w-4 sm:h-5 sm:w-5 text-amber-400"></i>
              <h4 class="text-base sm:text-lg font-bold text-amber-400">Diamond Benefits</h4>
            </div>
            <ul class="space-y-2 sm:space-y-3 flex-1">
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">15x ultimate mining speed performance</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">90-day VIP access period</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">VIP features & exclusive rewards</span>
              </li>
              <li class="flex items-start">
                <i data-lucide="check-circle" class="h-3 w-3 sm:h-4 sm:w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                <span class="text-xs sm:text-sm text-slate-300">Personal account manager</span>
              </li>
            </ul>
            <div class="mt-4 sm:mt-6">
              <button class="w-full bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white rounded-lg py-2 sm:py-3 px-3 sm:px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-amber-500/20 hover:shadow-amber-500/30 purchase-btn" data-booster="diamond" data-price="0.01">
                <i data-lucide="credit-card" class="h-3 w-3 sm:h-4 sm:w-4"></i>
                Buy Now
              </button>
              <p class="text-xs text-center text-slate-500 mt-2">Shine bright with diamond-tier mining!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <style>

  
  /* Responsive adjustments for smaller screens */
  @media (max-width: 640px) {
    .flip-card {
      min-height: 250px;
    }
  
    .flip-card-front,
    .flip-card-back {
      font-size: 0.875rem;
    }
  
    .purchase-btn {
      min-height: 2.5rem;
      touch-action: manipulation;
    }
  }
  </style>
       
    


    <style>
      /* Animasi FadeIn */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fadeIn {
        animation: fadeIn 0.5s ease-in-out;
      }
  
      /* Animasi Pulse untuk Node */
      @keyframes pulse {
        0% { transform: scale(1); opacity: 0.7; }
        50% { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1); opacity: 0.7; }
      }
      .animate-pulse-node {
        animation: pulse 2s infinite;
      }
  
      /* Custom Scrollbar */
      .scrollbar-thin {
        scrollbar-width: thin;
      }
      .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb {
        background-color: rgba(59, 130, 246, 0.5);
        border-radius: 9999px;
      }
      .scrollbar-thin::-webkit-scrollbar-track {
        background-color: rgba(30, 41, 59, 0.5);
      }
  
      /* Node Map Styling */
      .node-map {
        position: relative;
        background: url('https://via.placeholder.com/800x400?text=World+Map') no-repeat center center;
        background-size: cover;
        height: 400px;
        border-radius: 12px;
        overflow: hidden;
      }
      .node {
        position: absolute;
        width: 12px;
        height: 12px;
        background-color: rgba(34, 211, 238, 0.8);
        border-radius: 50%;
        box-shadow: 0 0 15px rgba(34, 211, 238, 0.5);
      }
    </style>
  
  
  <div id="pagenetwork" class="page">
    <!-- Futuristic Header with Animated Gradient -->
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row lg:items-end justify-between mb-8">
            <div>
                <div class="flex items-center space-x-3">
                    <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <h1 class="text-4xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500">AQULA NETWORK</h1>
                </div>
                <p class="text-sm text-slate-400 mt-2 flex items-center">
                    <span class="h-2 w-2 rounded-full bg-emerald-500 mr-2 animate-pulse"></span>
                    <span>The Future of Decentralized Mining</span>
                </p>
            </div>
            <div class="mt-4 lg:mt-0 flex space-x-3">
                <div class="px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-sm font-mono" id="networkClock">00:00:00 UTC</span>
                </div>
                <div class="px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
                    </svg>
                    <span class="text-sm font-mono" id="networkVersion">v2.5.8</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 pb-12 space-y-8">
        <!-- Network Status Overview Card - Enhanced with 3D Effect -->
        <div class="card bg-gradient-to-br from-slate-800/70 via-slate-900/50 to-slate-800/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl relative">
            <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzEgMCAwIDEzNC4zMSAwIDMwMHMxMzQuMzEgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMSAzMDAtMzAwUzQ2NS42OSAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi42MjcgMjQyLjYyN1MxNjUuOTcgNTQyLjYyNyAzMDAgNTQyLjYyNyA1NDIuNjI3IDQzNC4wMyA1NDIuNjI3IDMwMCA0MzQuMDMgNTcuMzczIDMwMCA1Ny4zNzN6IiBmaWxsPSIjZmZmIi8+PC9nPjwvc3ZnPg==')]"></div>
            <div class="p-6 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 via-slate-900/80 to-slate-800/80 relative z-10">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center mr-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-slate-100 tracking-wide">AQULA MINING STATUS</h3>
                            <p class="text-xs text-slate-400 mt-1">Real-time network performance metrics</p>
                        </div>
                    </div>
                    <span class="bg-gradient-to-r from-emerald-600/20 to-green-600/20 text-emerald-400 border border-emerald-500/50 rounded-lg px-3 py-1.5 text-sm flex items-center shadow-lg shadow-emerald-500/10">
                        <span class="h-2 w-2 rounded-full bg-emerald-500 mr-2 animate-pulse"></span>
                        NETWORK OPERATIONAL
                    </span>
                </div>
            </div>
            <div class="p-6 relative z-10">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Online Miners - Enhanced -->
                    <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-cyan-500/30 p-5 relative overflow-hidden group hover:border-cyan-500/60 transition-all duration-300">
                        <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-cyan-500/10 group-hover:bg-cyan-500/20 transition-all duration-300"></div>
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm text-slate-400 font-medium tracking-wider">ONLINE MINERS</div>
                            <div class="h-8 w-8 rounded-lg bg-cyan-500/10 flex items-center justify-center group-hover:bg-cyan-500/20 transition-all duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500/80 group-hover:text-cyan-400 transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                        </div>
                        <div id="minersOnline" class="text-4xl font-bold mb-1 text-slate-100 flex items-end">
                            0<span class="text-lg text-slate-400 ml-2">Miners</span>
                        </div>
                        <div class="mt-6 flex items-center">
                            <div class="flex-1 h-1.5 bg-slate-700/50 rounded-full overflow-hidden mr-3">
                                <div id="minersProgress" class="h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full" style="width: 0%"></div>
                            </div>
                            <span id="minersChange" class="text-xs font-mono text-cyan-400">+0.0%</span>
                        </div>
                    </div>

                    <!-- Network Latency - Enhanced -->
                    <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-purple-500/30 p-5 relative overflow-hidden group hover:border-purple-500/60 transition-all duration-300">
                        <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-purple-500/10 group-hover:bg-purple-500/20 transition-all duration-300"></div>
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm text-slate-400 font-medium tracking-wider">NETWORK LATENCY</div>
                            <div class="h-8 w-8 rounded-lg bg-purple-500/10 flex items-center justify-center group-hover:bg-purple-500/20 transition-all duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-500/80 group-hover:text-purple-400 transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                        </div>
                        <div id="latency" class="text-4xl font-bold mb-1 text-slate-100 flex items-end">
                            0<span class="text-lg text-slate-400 ml-2">ms</span>
                        </div>
                        <div class="mt-6 flex items-center">
                            <div class="flex-1 h-1.5 bg-slate-700/50 rounded-full overflow-hidden mr-3">
                                <div id="latencyProgress" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full" style="width: 0%"></div>
                            </div>
                            <span id="latencyChange" class="text-xs font-mono text-purple-400">-0.0%</span>
                        </div>
                    </div>

                    <!-- Total Points - Enhanced -->
                    <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-yellow-500/30 p-5 relative overflow-hidden group hover:border-yellow-500/60 transition-all duration-300">
                        <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-yellow-500/10 group-hover:bg-yellow-500/20 transition-all duration-300"></div>
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm text-slate-400 font-medium tracking-wider">TOTAL POINTS</div>
                            <div class="h-8 w-8 rounded-lg bg-yellow-500/10 flex items-center justify-center group-hover:bg-yellow-500/20 transition-all duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500/80 group-hover:text-yellow-400 transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                        </div>
                        <div id="totalPoints" class="text-4xl font-bold mb-1 text-slate-100 flex items-end">
                            0<span class="text-lg text-slate-400 ml-2">AQULA</span>
                        </div>
                        <div class="mt-6 flex items-center">
                            <div class="flex-1 h-1.5 bg-slate-700/50 rounded-full overflow-hidden mr-3">
                                <div id="pointsProgress" class="h-full bg-gradient-to-r from-yellow-500 to-amber-500 rounded-full" style="width: 0%"></div>
                            </div>
                            <span id="pointsChange" class="text-xs font-mono text-yellow-400">+0.0%</span>
                        </div>
                    </div>
                </div>

                <!-- Chart Section - Enhanced with Glass Morphism -->
                <div class="mt-8 bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-sm font-semibold text-slate-300 tracking-wider">NETWORK ACTIVITY (24H)</h4>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 text-xs bg-slate-700/50 text-slate-300 rounded-lg">1D</button>
                            <button class="px-3 py-1 text-xs bg-slate-800/70 text-slate-400 rounded-lg">1W</button>
                            <button class="px-3 py-1 text-xs bg-slate-800/70 text-slate-400 rounded-lg">1M</button>
                        </div>
                    </div>
                    <canvas id="networkChart" class="w-full h-72"></canvas>
                </div>
            </div>
        </div>

        <!-- Network Details Tabs - Enhanced with Floating Effect -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl p-6 relative">
            <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzEgMCAwIDEzNC4zMSAwIDMwMHMxMzQuMzEgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMSAzMDAtMzAwUzQ2NS42OSAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi42MjcgMjQyLjYyN1MxNjUuOTcgNTQyLjYyNyAzMDAgNTQyLjYyNyA1NDIuNjI3IDQzNC4wMyA1NDIuNjI3IDMwMCA0MzQuMDMgNTcuMzczIDMwMCA1Ny4zNzN6IiBmaWxsPSIjZmZmIi8+PC9nPjwvc3ZnPg==')]"></div>
            <div class="relative z-10">
                <div class="flex space-x-1 bg-slate-800/50 p-1 rounded-xl border border-slate-700/50 mb-6">
                    <button onclick="showTab('tabOverview')" class="px-5 py-2.5 text-sm font-medium text-slate-100 bg-gradient-to-br from-slate-700/50 to-slate-800/70 rounded-lg focus:outline-none flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                        </svg>
                        Overview
                    </button>
                    <button onclick="showTab('tabMiners')" class="px-5 py-2.5 text-sm font-medium text-slate-400 hover:text-slate-100 hover:bg-slate-700/50 rounded-lg flex items-center transition-all duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        Miners
                    </button>
                    <button onclick="showTab('tabPoints')" class="px-5 py-2.5 text-sm font-medium text-slate-400 hover:text-slate-100 hover:bg-slate-700/50 rounded-lg flex items-center transition-all duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Points
                    </button>
                </div>

                <div id="tabOverview" class="tab-content">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-5">
                      <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-cyan-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18v4H3V4z" />
                        </svg>
                        NETWORK SUMMARY
                      </h4>
                      <p id="overviewText" class="text-slate-300 text-sm leading-relaxed">
                        AQULA Network is currently operating at optimal capacity with decentralized nodes across 12 regions. 
                        The blockchain has processed over 2.4M transactions this month with 99.98% uptime. 
                        New mining rewards protocol v2.5 is active since block #4,821,903.
                      </p>
                    </div>
                    <div class="bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-5">
                      <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        PERFORMANCE METRICS
                      </h4>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <div class="text-xs text-slate-400 mb-1">BLOCKS/DAY</div>
                          <div id="blocksPerDay" class="text-xl font-bold text-slate-100">14,892</div>
                        </div>
                        <div>
                          <div class="text-xs text-slate-400 mb-1">AVG. TX FEE</div>
                          <div id="avgTxFee" class="text-xl font-bold text-slate-100">0.0021 AQULA</div>
                        </div>
                        <div>
                          <div class="text-xs text-slate-400 mb-1">DIFFICULTY</div>
                          <div id="difficulty" class="text-xl font-bold text-slate-100">18.76 TH</div>
                        </div>
                        <div>
                          <div class="text-xs text-slate-400 mb-1">HASH RATE</div>
                          <div id="hashRate" class="text-xl font-bold text-slate-100">1.42 EH/s</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="tabMiners" class="tab-content hidden">
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                      <table class="w-full text-sm text-slate-100">
                        <thead>
                          <tr class="bg-slate-700/50 border-b border-slate-700/50">
                            <th class="px-5 py-3 text-left font-medium">MINER ID</th>
                            <th class="px-5 py-3 text-left font-medium">LOCATION</th>
                            <th class="px-5 py-3 text-left font-medium">HASH RATE</th>
                            <th class="px-5 py-3 text-left font-medium">STATUS</th>
                            <th class="px-5 py-3 text-left font-medium">LAST ACTIVE</th>
                          </tr>
                        </thead>
                        <tbody id="minersTableBody" class="divide-y divide-slate-700/50">
                          <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                      </table>
                    </div>
                    <div class="px-5 py-3 border-t border-slate-700/50 text-xs text-slate-400 flex items-center justify-between">
                      <span>Showing <span id="minersCount">0</span> of <span id="totalMiners">0</span> active miners</span>
                      <div class="flex space-x-2">
                        <button class="px-3 py-1 bg-slate-700/50 rounded-lg text-slate-300">Previous</button>
                        <button class="px-3 py-1 bg-slate-700/50 rounded-lg text-slate-300">Next</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="tabPoints" class="tab-content hidden">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-5">
                      <h4 class="text-sm font-semibold text-slate-300 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        POINTS DISTRIBUTION
                      </h4>
                      <canvas id="pointsChart" class="w-full h-48"></canvas>
                    </div>
                    <div class="bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-5">
                      <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                        POINTS ACTIVITY
                      </h4>
                      <p id="pointsText" class="text-slate-300 text-sm leading-relaxed mb-4">
                        AQULA Points continue to accumulate across the network with an average of 12,450 points mined per hour. 
                        The current reward rate stands at 8.2 AQULA per TH/s with halving scheduled in approximately 1,204 blocks.
                      </p>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <div class="text-xs text-slate-400 mb-1">TODAY'S REWARDS</div>
                          <div id="todayRewards" class="text-xl font-bold text-slate-100">298,800 AQULA</div>
                        </div>
                        <div>
                          <div class="text-xs text-slate-400 mb-1">AVG. PER MINER</div>
                          <div id="avgPerMiner" class="text-xl font-bold text-slate-100">24.5 AQULA</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
        </div>

       <!-- Two Column Layout for Bottom Sections -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
  <!-- Left Column -->
  <div class="space-y-8">
      <!-- Real-Time Transaction Feed - Enhanced -->
      <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl p-6 relative" style="height: 600px; width: 100%; max-height: 720px; box-sizing: border-box;">
          <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzEgMCAwIDEzNC4zMSAwIDMwMHMxMzQuMzEgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMSAzMDAtMzAwUzQ2NS42OSAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi42MjcgMjQyLjYyN1MxNjUuOTcgNTQyLjYyNyAzMDAgNTQyLjYyNyA1NDIuNjI3IDQzNC4wMyA1NDIuNjI3IDMwMCA0MzQuMDMgNTcuMzczIDMwMCA1Ny4zNzN6IiBmaWxsPSIjZmZmIi8+PC9nPjwvc3ZnPg==')]"></div>
          <div class="relative z-10">
              <div class="flex items-center justify-between mb-6">
                  <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                      <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                          </svg>
                      </div>
                      <div>
                          <div>TRANSACTION FEED</div>
                          <div class="text-xs text-slate-400 mt-1">Real-time network transactions</div>
                      </div>
                  </h3>
                  <span class="bg-blue-600/20 text-blue-400 border border-blue-500/50 rounded-lg px-3 py-1.5 text-sm flex items-center shadow-lg shadow-blue-500/10">
                      <span class="h-2 w-2 rounded-full bg-blue-500 mr-2 animate-pulse"></span>
                      LIVE SYNC
                  </span>
              </div>
              <div id="transactionFeed" class="space-y-3 max-h-96 overflow-y-auto scrollbar-hide scrollbar-thumb-blue-500/50 scrollbar-track-slate-800/50 pr-2">
                  <!-- Data akan diisi oleh JavaScript -->
              </div>
          </div>
      </div>

      <!-- Mining Performance Analytics - Enhanced -->
      <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl p-6 relative" style="height: 600px; width: 100%; max-height: 720px; box-sizing: border-box;">
          <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzEgMCAwIDEzNC4zMSAwIDMwMHMxMzQuMzEgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMSAzMDAtMzAwUzQ2NS42OSAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi62NyAyNDIuNjI3UzE2NS45NyA1NDIuNjI3IDMwMCA1NDIuNjI3IDU0Mi62MjcgNDM0LjAzIDU0Mi62MjcgMzAwIDQzNC4wMyA1Ny4zNzMgMzAwIDU3LjM3M3oiIGZpbGw9IiNmZmYiLz48L2c+PC9zdmc+')]"></div>
          <div class="relative z-10">
              <div class="flex items-center justify-between mb-6">
                  <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                      <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center mr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                          </svg>
                      </div>
                      <div>
                          <div>MINING PERFORMANCE</div>
                          <div class="text-xs text-slate-400 mt-1">Network efficiency metrics</div>
                      </div>
                  </h3>
                  <div class="flex items-center space-x-2">
                      <span class="text-xs text-slate-400">Last 24h</span>
                      <button class="p-1 bg-slate-700/50 rounded-lg">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                           </svg>
                      </button>
                  </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- Hash Rate -->
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-green-500/20 rounded-xl p-5 group hover:border-green-500/40 transition-all duration-300">
                      <div class="flex items-center justify-between mb-3">
                          <div class="text-sm text-slate-400 font-medium">AVG. HASH RATE</div>
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500/60 group-hover:text-green-400 transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                          </svg>
                      </div>
                      <div id="hashRate" class="text-3xl font-bold text-slate-100 mb-2">0<span class="text-lg text-slate-400 ml-1">TH/s</span></div>
                      <div class="flex items-center">
                          <div class="flex-1 h-2 bg-slate-700/50 rounded-full overflow-hidden mr-3">
                              <div id="hashRateProgress" class="h-full bg-gradient-to-r from-green-500 to-teal-500 rounded-full" style="width: 0%"></div>
                          </div>
                          <span id="hashRateChange" class="text-xs font-mono text-green-400">+0.0%</span>
                      </div>
                  </div>
                  <!-- Efficiency -->
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-green-500/20 rounded-xl p-5 group hover:border-green-500/40 transition-all duration-300">
                      <div class="flex items-center justify-between mb-3">
                          <div class="text-sm text-slate-400 font-medium">MINING EFFICIENCY</div>
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500/60 group-hover:text-green-400 transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                          </svg>
                      </div>
                      <div id="efficiency" class="text-3xl font-bold text-slate-100 mb-2">0<span class="text-lg text-slate-400 ml-1">%</span></div>
                      <div class="flex items-center">
                          <div class="flex-1 h-2 bg-slate-700/50 rounded-full overflow-hidden mr-3">
                              <div id="efficiencyProgress" class="h-full bg-gradient-to-r from-green-500 to-teal-500 rounded-full" style="width: 0%"></div>
                          </div>
                          <span id="efficiencyChange" class="text-xs font-mono text-green-400">+0.0%</span>
                      </div>
                  </div>
              </div>
              <div class="mt-6 bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4">
                  <canvas id="performanceChart" class="w-full h-60"></canvas>
              </div>
          </div>
      </div>
      <!-- Left Column: Quantum Node Sync Monitor -->
      <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl p-6 relative max-h-[720px] overflow-y-auto scrollbar-hide scrollbar-thumb-purple-500/30 scrollbar-track-slate-900/50" style="height: 600px; width: 100%; max-height: 720px; box-sizing: border-box;">
          <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzEgMCAwIDEzNC4zMSAwIDMwMHMxMzQuMzEgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMSAzMDAtMzAwUzQ2NS42OSAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi62MjcgMjQyLjYyN1MxNjUuOTcgNTQyLjYyNyAzMDAgNTQyLjYyNyA1NDIuNjI3IDQzNC4wMyA1NDIuNjI3IDMwMCA0MzQuMDMgNTcuMzczIDMwMCA1Ny4zNzN6IiBmaWxsPSIjZmZmIi8+PC9nPjwvc3ZnPg==')]"></div>
          <div class="relative z-10">
              <!-- Header -->
              <div class="flex items-center justify-between mb-6">
                  <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                      <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center mr-3 shadow-lg shadow-purple-500/30">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                          </svg>
                      </div>
                      <div>
                          <div>QUANTUM NODE SYNC</div>
                          <div class="text-xs text-slate-400 mt-1">Network Status Monitor</div>
                      </div>
                  </h3>
                  <span class="bg-purple-600/20 text-purple-400 border border-purple-500/50 rounded-lg px-3 py-1.5 text-sm flex items-center shadow-lg shadow-purple-500/10">
                      <span class="h-2 w-2 rounded-full bg-purple-500 mr-2 animate-pulse"></span>
                      SYNCING
                  </span>
              </div>
              <!-- Stats Grid -->
              <div class="grid grid-cols-1 gap-4">
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-purple-500/20 rounded-lg p-4 group hover:border-purple-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">NODE LATENCY</div>
                      <div id="nodeLatency" class="text-2xl font-bold text-slate-100">0.0 ms</div>
                  </div>
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-purple-500/20 rounded-lg p-4 group hover:border-purple-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">SYNC PROGRESS</div>
                      <div id="syncProgressTest" class="text-2xl font-bold text-slate-100">0%</div>
                  </div>
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-purple-500/20 rounded-lg p-4 group hover:border-purple-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">CURRENT PEER</div>
                      <div id="currentPeer" class="text-sm font-mono text-purple-400 truncate">peer-7.qchain.net</div>
                  </div>
              </div>
              <!-- Chart Section -->
              <div class="mt-6 bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4">
                  <canvas id="quantumSyncChart" class="w-full h-48"></canvas>
              </div>
              <!-- Footer Info -->
              <div class="mt-4 text-right">
                  <div class="text-xs text-slate-500 italic">Powered by Aqula QuantumChain Protocol v3.7</div>
              </div>
          </div>
      </div>
  </div>
  <style>
      #syncProgress, #syncProgressTest, #nodeLatency, #currentPeer {
          display: inline-block !important;
          opacity: 1 !important;
          visibility: visible !important;
          color: #067aee;
      }
  </style>
  <!-- Right Column -->
  <div class="space-y-8">
      <!-- Blockchain Node Map - Enhanced -->
      <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl p-6 relative" style="height: 600px; width: 100%; max-height: 720px; box-sizing: border-box;">
          <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzEgMCAwIDEzNC4zMSAwIDMwMHMxMzQuMzEgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMSAzMDAtMzAwUzQ2NS42OSAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi62MjcgMjQyLjYyN1MxNjUuOTcgNTQyLjYyNyAzMDAgNTQyLjYyNyA1NDIuNjI3IDQzNC4wMyA1NDIuNjI3IDMwMCA0MzQuMDMgNTcuMzczIDMwMCA1Ny4zNzN6IiBmaWxsPSIjZmZmIi8+PC9nPjwvc3ZnPg==')]"></div>
          <div class="relative z-10">
              <div class="flex items-center justify-between mb-6">
                  <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                      <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center mr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 004 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                      </div>
                      <div>
                          <div>BLOCKCHAIN NODE MAP</div>
                          <div class="text-xs text-slate-400 mt-1">Global node distribution</div>
                      </div>
                  </h3>
                  <span class="bg-cyan-600/20 text-cyan-400 border border-cyan-500/50 rounded-lg px-3 py-1.5 text-sm flex items-center shadow-lg shadow-cyan-500/10">
                      <span class="h-2 w-2 rounded-full bg-cyan-500 mr-2 animate-pulse"></span>
                      LIVE UPDATES
                  </span>
              </div>
              <div id="nodeMap" class="node-map relative h-64 bg-slate-900/50 rounded-xl border border-slate-700/50 flex items-center justify-center">
                  <div class="text-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-cyan-500/30 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 004 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <p class="text-sm text-slate-400">Loading global node map...</p>
                  </div>
              </div>
              <div class="mt-4 text-sm text-slate-400 flex items-center justify-between">
                  <p>Showing <span id="nodeCount" class="font-bold text-slate-200">0</span> active nodes across <span id="nodeRegions" class="font-bold text-slate-200">0</span> regions</p>
                  <button class="text-xs bg-slate-800/50 border border-slate-700/50 rounded-lg px-3 py-1 flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                      </svg>
                      Refresh
                  </button>
              </div>
          </div>
      </div>
      <!-- Block Validation Tracker - Enhanced -->
      <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl p-6 relative" style="height: 600px; width: 100%; max-height: 720px; box-sizing: border-box;">
          <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzEgMCAwIDEzNC4zMSAwIDMwMHMxMzQuMzEgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMSAzMDAtMzAwUzQ2NS42OSAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi62MjcgMjQyLjYyN1MxNjUuOTcgNTQyLjYyNyAzMDAgNTQyLjYyNyA1NDIuNjI3IDQzNC4wMyA1NDIuNjI3IDMwMCA0MzQuMDMgNTcuMzczIDMwMCA1Ny4zNzN6IiBmaWxsPSIjZmZmIi8+PC9nPjwvc3ZnPg==')]"></div>
          <div class="relative z-10">
              <div class="flex items-center justify-between mb-6">
                  <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                      <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center mr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                      </div>
                      <div>
                          <div>BLOCK VALIDATION</div>
                          <div class="text-xs text-slate-400 mt-1">Consensus tracking</div>
                      </div>
                  </h3>
                  <span class="bg-purple-600/20 text-purple-400 border border-purple-500/50 rounded-lg px-3 py-1.5 text-sm flex items-center shadow-lg shadow-purple-500/10">
                      <span class="h-2 w-2 rounded-full bg-purple-500 mr-2 animate-pulse"></span>
                      VALIDATING
                  </span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-purple-500/20 rounded-lg p-4 group hover:border-purple-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">LATEST BLOCK</div>
                      <div id="latestBlock" class="text-2xl font-bold text-slate-100 font-mono">0</div>
                  </div>
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-purple-500/20 rounded-lg p-4 group hover:border-purple-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">VALIDATION TIME</div>
                      <div id="validationTime" class="text-2xl font-bold text-slate-100">0<span class="text-lg text-slate-400 ml-1">s</span></div>
                  </div>
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-purple-500/20 rounded-lg p-4 group hover:border-purple-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">BLOCK HASH</div>
                      <div id="blockHash" class="text-sm font-mono text-purple-400 truncate">0x0000...0000</div>
                  </div>
              </div>
              <div class="mt-6 bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4">
                  <canvas id="validationChart" class="w-full h-48"></canvas>
              </div>
          </div>
      </div>
      <!-- Smart Contract Activity Monitor - Enhanced -->
      <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-2xl overflow-hidden border border-slate-700/50 shadow-2xl p-6 relative" style="height: 600px; width: 100%; max-height: 720px; box-sizing: border-box;">
          <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIiBvcGFjaXR5PSIwLjAzIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zMDAgMEMxMzQuMzIgMCAwIDEzNC4zMiAwIDMwMHMxMzQuMzIgMzAwIDMwMCAzMDAgMzAwLTEzNC4zMiAzMDAtMzAwUzQ2NS42OCAwIDMwMCAwem0wIDU3LjM3M2MtMTM0LjAzIDAtMjQyLjYyNyAxMDguNTk4LTI0Mi62MjcgMjQyLjYyN1MxNjUuOTcgNTQyLjYyNyAzMDAgNTQyLjYyNyA1NDIuNjI3IDQzNC4wMyA1NDIuNjI3IDMwMCA0MzQuMDMgNTcuMzczIDMwMCA1Ny4zNzN6IiBmaWxsPSIjZmZmIi8+PC9nPjwvc3ZnPg==')]"></div>
          <div class="relative z-10">
              <div class="flex items-center justify-between mb-6">
                  <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                      <div class="h-10 w-10 rounded-lg bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center mr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                          </svg>
                      </div>
                      <div>
                          <div>SMART CONTRACTS</div>
                          <div class="text-xs text-slate-400 mt-1">Execution activity</div>
                      </div>
                  </h3>
                  <span class="bg-pink-600/20 text-pink-400 border border-pink-500/50 rounded-lg px-3 py-1.5 text-sm flex items-center shadow-lg shadow-pink-500/10">
                      <span class="h-2 w-2 rounded-full bg-pink-500 mr-2 animate-pulse"></span>
                      ACTIVE
                  </span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-pink-500/20 rounded-lg p-4 group hover:border-pink-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">CONTRACT CALLS</div>
                      <div id="contractCalls" class="text-2xl font-bold text-slate-100">0</div>
                  </div>
                  <div class="bg-slate-800/30 backdrop-blur-sm border border-pink-500/20 rounded-lg p-4 group hover:border-pink-500/40 transition-all duration-300">
                      <div class="text-xs text-slate-400 font-medium mb-2">EXECUTION SUCCESS</div>
                      <div id="executionSuccess" class="text-2xl font-bold text-slate-100">0<span class="text-lg text-slate-400 ml-1">%</span></div>
                  </div>
              </div>
              <div id="contractActivity" class="bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 max-h-64 overflow-y-auto scrollbar-hide scrollbar-thumb-pink-500/50 scrollbar-track-slate-800/50 space-y-3">
                  <!-- Data akan diisi oleh JavaScript -->
              </div>
          </div>
      </div>
  </div>
</div>
    </div>
</div>







    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
      
      :root {
          --primary: #06b6d4;
          --primary-dark: #0891b2;
          --dark: #0f172a;
          --darker: #020617;
          --light: #f8fafc;
          --gray: #334155;
      }
      
      body {
          font-family: 'Inter', sans-serif;
          background-color: var(--darker);
          color: var(--light);
      }
      
      .glass-card {
          background: rgba(15, 23, 42, 0.7);
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.08);
      }
      
      .folder-klassik {
          background: linear-gradient(135deg, rgba(109, 40, 217, 0.2) 0%, rgba(124, 58, 237, 0.15) 100%);
          border: 1px solid rgba(167, 139, 250, 0.15);
      }
      
      .folder-minimalis {
          background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(8, 145, 178, 0.15) 100%);
          border: 1px solid rgba(103, 232, 249, 0.15);
      }
      
      .folder-pastel {
          background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(219, 39, 119, 0.15) 100%);
          border: 1px solid rgba(251, 207, 232, 0.15);
      }
      
      .folder-gelap {
          background: linear-gradient(135deg, rgba(30, 41, 59, 0.3) 0%, rgba(15, 23, 42, 0.25) 100%);
          border: 1px solid rgba(51, 65, 85, 0.3);
      }
      
      .folder-futuristik {
          background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(124, 58, 237, 0.15) 100%);
          border: 1px solid rgba(196, 181, 253, 0.15);
      }
      
      .progress-bar {
          height: 6px;
          border-radius: 3px;
          background: rgba(255, 255, 255, 0.1);
          overflow: hidden;
      }
      
      .progress-fill {
          height: 100%;
          border-radius: 3px;
          background: linear-gradient(90deg, var(--primary), var(--primary-dark));
          transition: width 0.5s ease;
      }
      
      .file-item:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 6px -1px rgba(6, 182, 212, 0.1), 0 2px 4px -1px rgba(6, 182, 212, 0.06);
      }
      
      .folder-item:hover {
          transform: translateY(-3px);
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      
      .upload-area {
          border: 2px dashed rgba(255, 255, 255, 0.1);
          transition: all 0.3s ease;
      }
      
      .upload-area:hover {
          border-color: var(--primary);
          background: rgba(6, 182, 212, 0.05);
      }
      
      .upload-area.dragover {
          border-color: var(--primary);
          background: rgba(6, 182, 212, 0.1);
      }
      
      .notification-badge {
          position: absolute;
          top: -6px;
          right: -6px;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #ef4444;
          color: white;
          font-size: 10px;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      
      .search-input:focus {
          outline: none;
          box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.5);
      }
      
      .animate-pulse {
          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      
      @keyframes pulse {
          0%, 100% {
              opacity: 1;
          }
          50% {
              opacity: 0.5;
          }
      }
      /* Animasi touch ripple */
.touch-ripple {
    position: relative;
    overflow: hidden;
}

.touch-ripple-active::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(6, 182, 212, 0.3); /* Warna ripple (cyan-400 dengan opacity) */
    border-radius: 50%;
    transform: translate(-50%, -50%);
    animation: ripple 0.3s ease-out;
}

@keyframes ripple {
    0% {
        width: 0;
        height: 0;
        opacity: 1;
    }
    100% {
        width: 200%;
        height: 200%;
        opacity: 0;
    }
}

/* Pastikan folder content dapat discroll */
#folderContent {
    height: calc(100vh - 200px); /* Sesuaikan tinggi berdasarkan layout Anda */
    overflow-y: auto;
    padding-bottom: 20px; /* Memberikan ruang untuk scroll */
}
  </style>


<div id="pageDataCenter" class="page">
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- Left Column (3/4 width) -->
      <div class="lg:col-span-3 space-y-6">
          <!-- Header with Search and User -->
          <div class="flex items-center justify-between mb-6">
              <div>
                  <h1 class="text-2xl font-bold text-white flex items-center">
                      <i data-lucide="database" class="h-6 w-6 text-cyan-400 mr-3"></i>
                      Data Center Dashboard
                  </h1>
                  <p class="text-sm text-slate-400 mt-1">Manage your files and storage efficiently</p>
              </div>
              <div class="flex items-center space-x-4">
                  <div class="relative">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                          <i data-lucide="search" class="h-4 w-4 text-slate-400"></i>
                      </div>
                      <input id="searchInput" type="text" class="search-input bg-slate-800/50 text-sm rounded-lg pl-10 pr-4 py-2 border border-slate-700/50 focus:border-cyan-500 transition-all w-64" placeholder="Search files...">
                  </div>
                  <div class="relative">
                      <button id="notifBtn" class="p-2 rounded-full bg-slate-800/50 hover:bg-slate-700/50 transition-all relative">
                          <i data-lucide="bell" class="h-5 w-5 text-slate-300"></i>
                          <span id="notifBadge" class="notification-badge hidden">0</span>
                      </button>
                  </div>
                  <div class="flex items-center space-x-2">
                      <div id="userAvatar" class="h-8 w-8 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white font-medium text-xs">JD</div>
                      <span id="userName" class="text-sm font-medium text-slate-300">Loading...</span>
                      <i data-lucide="chevron-down" class="h-4 w-4 text-slate-400"></i>
                  </div>
              </div>
          </div>
          
          <!-- Data Center Controls Card -->
          <div class="glass-card rounded-xl overflow-hidden shadow-xl">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80 flex items-center justify-between">
                  <div class="flex items-center">
                      <i data-lucide="database" class="h-6 w-6 text-cyan-400 mr-3"></i>
                      <h3 class="text-lg font-semibold text-white tracking-wide">DATA CENTER</h3>
                  </div>
                  <div class="flex items-center space-x-2">
                      <button id="refreshBtn" class="bg-slate-800/50 hover:bg-slate-700/50 text-slate-300 rounded-lg py-1 px-3 text-sm font-medium transition-all flex items-center">
                          <i data-lucide="refresh-cw" class="h-4 w-4 mr-1"></i>
                          Refresh
                      </button>
                      <button id="newFolderBtn" class="bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-lg py-1 px-3 text-sm font-medium transition-all flex items-center">
                          <i data-lucide="plus" class="h-4 w-4 mr-1"></i>
                          New Folder
                      </button>
                  </div>
              </div>
              <div class="p-6 space-y-5">
                  <!-- Quick Stats -->
                  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                      <div class="bg-slate-800/30 rounded-lg p-4 border border-slate-700/50">
                          <div class="flex items-center justify-between">
                              <div>
                                  <p class="text-xs font-medium text-slate-400 mb-1">Total Files</p>
                                  <h3 id="totalFiles" class="text-xl font-bold text-white animate-pulse">...</h3>
                              </div>
                              <div class="p-2 rounded-full bg-cyan-500/10">
                                  <i data-lucide="file" class="h-5 w-5 text-cyan-400"></i>
                              </div>
                          </div>
                          <div class="mt-2">
                              <p class="text-xs text-slate-400 flex items-center">
                                  <span id="fileGrowth" class="text-green-400 flex items-center mr-1">
                                      <i data-lucide="trending-up" class="h-3 w-3 mr-1"></i>
                                      ...
                                  </span>
                                  from last month
                              </p>
                          </div>
                      </div>
                      <div class="bg-slate-800/30 rounded-lg p-4 border border-slate-700/50">
                          <div class="flex items-center justify-between">
                              <div>
                                  <p class="text-xs font-medium text-slate-400 mb-1">Shared Files</p>
                                  <h3 id="sharedFiles" class="text-xl font-bold text-white animate-pulse">...</h3>
                              </div>
                              <div class="p-2 rounded-full bg-purple-500/10">
                                  <i data-lucide="share-2" class="h-5 w-5 text-purple-400"></i>
                              </div>
                          </div>
                          <div class="mt-2">
                              <p class="text-xs text-slate-400 flex items-center">
                                  <span id="shareGrowth" class="text-green-400 flex items-center mr-1">
                                      <i data-lucide="trending-up" class="h-3 w-3 mr-1"></i>
                                      ...
                                  </span>
                                  from last month
                              </p>
                          </div>
                      </div>
                      <div class="bg-slate-800/30 rounded-lg p-4 border border-slate-700/50">
                          <div class="flex items-center justify-between">
                              <div>
                                  <p class="text-xs font-medium text-slate-400 mb-1">Recent Activity</p>
                                  <h3 id="recentActivity" class="text-xl font-bold text-white animate-pulse">...</h3>
                              </div>
                              <div class="p-2 rounded-full bg-pink-500/10">
                                  <i data-lucide="activity" class="h-5 w-5 text-pink-400"></i>
                              </div>
                          </div>
                          <div class="mt-2">
                              <p class="text-xs text-slate-400 flex items-center">
                                  <span id="activityGrowth" class="text-green-400 flex items-center mr-1">
                                      <i data-lucide="trending-up" class="h-3 w-3 mr-1"></i>
                                      ...
                                  </span>
                                  from yesterday
                              </p>
                          </div>
                      </div>
                  </div>
                  
                  <!-- Folder List -->
                  <div class="mb-4">
                      <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                          <i data-lucide="folder" class="h-4 w-4 mr-2"></i>
                          Your Folders
                      </h4>
                      <div id="foldersContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                          <!-- Folders will be loaded here -->
                          <div class="animate-pulse bg-slate-800/30 rounded-lg p-4 h-28"></div>
                          <div class="animate-pulse bg-slate-800/30 rounded-lg p-4 h-28"></div>
                          <div class="animate-pulse bg-slate-800/30 rounded-lg p-4 h-28"></div>
                      </div>
                  </div>
                  
                  <!-- Recent Files -->
                  <div>
                      <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                          <i data-lucide="clock" class="h-4 w-4 mr-2"></i>
                          Recent Files
                      </h4>
                      <div class="bg-slate-800/30 rounded-lg border border-slate-700/50 overflow-hidden">
                          <div class="grid grid-cols-12 bg-slate-800/50 p-3 border-b border-slate-700/50 text-xs font-medium text-slate-400">
                              <div class="col-span-6">Name</div>
                              <div class="col-span-2">Type</div>
                              <div class="col-span-2">Size</div>
                              <div class="col-span-2">Modified</div>
                          </div>
                          <div id="recentFilesContainer" class="divide-y divide-slate-700/50">
                              <!-- Recent files will be loaded here -->
                              <div class="grid grid-cols-12 p-3">
                                  <div class="col-span-12 flex items-center justify-center py-4">
                                      <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-400"></div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
                  
                  <!-- Folder Content (Hidden by Default) -->
                  <div id="folderContent" class="hidden">
                      <div class="flex items-center justify-between mb-4">
                          <h4 class="text-lg font-semibold text-white flex items-center">
                              <i data-lucide="folder" class="h-5 w-5 text-cyan-400 mr-2"></i>
                              Folder: <span id="folderName" class="font-bold ml-1">Loading...</span>
                          </h4>
                          <button id="backFromFolderBtn" class="bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-lg py-1 px-3 text-sm font-medium transition-all flex items-center">
                              <i data-lucide="arrow-left" class="h-4 w-4 mr-1"></i>
                              Back
                          </button>
                      </div>
                      
                      <!-- Upload Area -->
                      <div id="uploadArea" class="upload-area rounded-lg p-6 mb-6 flex flex-col items-center justify-center">
                          <i data-lucide="upload-cloud" class="h-10 w-10 text-cyan-400 mb-3"></i>
                          <p class="text-sm text-slate-400 mb-2">Drag & drop files here or</p>
                          <label class="bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-lg py-2 px-4 text-sm font-medium transition-all cursor-pointer flex items-center">
                              <i data-lucide="upload" class="h-4 w-4 mr-2"></i>
                              Browse Files
                              <input id="fileInput" type="file" class="hidden" multiple>
                          </label>
                          <p class="text-xs text-slate-500 mt-3">Supports: JPG, PNG, GIF up to 10MB</p>
                      </div>
                      
                      <!-- Files Grid -->
                      <div id="folderFilesContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                          <!-- Files will be loaded here -->
                      </div>
                  </div>
                  
                  <!-- File Preview (Hidden by Default) -->
                  <div id="filePreview" class="hidden">
                      <div class="flex items-center justify-between mb-6">
                          <h4 class="text-lg font-semibold text-white flex items-center">
                              <i data-lucide="file" class="h-5 w-5 text-cyan-400 mr-2"></i>
                              Preview: <span id="fileName" class="font-bold ml-1">Loading...</span>
                          </h4>
                          <div class="flex items-center space-x-2">
                              <button id="downloadFileBtn" class="bg-slate-800/50 hover:bg-slate-700/50 text-slate-300 rounded-lg py-1 px-3 text-sm font-medium transition-all flex items-center">
                                  <i data-lucide="download" class="h-4 w-4 mr-1"></i>
                                  Download
                              </button>
                              <button id="backFromPreviewBtn" class="bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-lg py-1 px-3 text-sm font-medium transition-all flex items-center">
                                  <i data-lucide="arrow-left" class="h-4 w-4 mr-1"></i>
                                  Back
                              </button>
                          </div>
                      </div>
                      <div class="bg-slate-800/50 rounded-xl p-6">
                          <div class="flex flex-col lg:flex-row gap-6">
                              <div class="lg:w-2/3">
                                  <div id="filePreviewContent" class="bg-slate-900 rounded-lg overflow-hidden flex items-center justify-center min-h-[300px]">
                                      <div class="text-center">
                                          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto mb-4"></div>
                                          <p class="text-slate-400">Loading preview...</p>
                                      </div>
                                  </div>
                              </div>
                              <div class="lg:w-1/3">
                                  <div class="bg-slate-800/30 rounded-lg p-4 border border-slate-700/50 mb-4">
                                      <h5 class="text-sm font-semibold text-white mb-3 flex items-center">
                                          <i data-lucide="info" class="h-4 w-4 text-cyan-400 mr-2"></i>
                                          File Information
                                      </h5>
                                      <div id="fileInfo" class="space-y-3 text-sm">
                                          <!-- File info will be loaded here -->
                                      </div>
                                  </div>
                                  <div class="bg-slate-800/30 rounded-lg p-4 border border-slate-700/50">
                                      <h5 class="text-sm font-semibold text-white mb-3 flex items-center">
                                          <i data-lucide="share-2" class="h-4 w-4 text-cyan-400 mr-2"></i>
                                          Share Options
                                      </h5>
                                      <div class="space-y-3">
                                          <div>
                                              <label class="text-xs font-medium text-slate-400 mb-1 block">Share Link</label>
                                              <div class="flex">
                                                  <input id="shareLinkInput" type="text" class="bg-slate-800/50 text-sm rounded-l-lg py-2 px-3 border border-slate-700/50 focus:border-cyan-500 transition-all w-full" value="Generating..." readonly>
                                                  <button id="copyLinkBtn" class="bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-r-lg py-2 px-3 text-sm font-medium transition-all">
                                                      <i data-lucide="copy" class="h-4 w-4"></i>
                                                  </button>
                                              </div>
                                          </div>
                                          <button id="permissionsBtn" class="bg-slate-700 hover:bg-slate-600 text-white rounded px-4 py-2">
                                              <i data-lucide="lock" class="h-4 w-4 mr-2"></i>Permissions
                                          </button>
                                          <button id="sendLinkBtn" class="w-full bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-lg py-2 px-3 text-sm font-medium transition-all flex items-center justify-center">
                                              <i data-lucide="send" class="h-4 w-4 mr-2"></i>
                                              Send Link
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      
      <!-- Right Column (1/4 width) -->
      <div class="space-y-6">
          <!-- User Profile Card -->
          <div class="glass-card rounded-xl overflow-hidden shadow-xl">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
                  <h3 class="text-lg font-semibold text-white tracking-wide flex items-center">
                      <i data-lucide="user" class="h-5 w-5 text-cyan-400 mr-2"></i>
                      User Profile
                  </h3>
              </div>
              <div class="p-6">
                  <div class="flex flex-col items-center mb-4">
                      <div id="profileAvatar" class="h-16 w-16 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white font-medium text-xl mb-3 animate-pulse">...</div>
                      <h4 id="profileName" class="text-lg font-semibold text-white animate-pulse">Loading...</h4>
                      <p id="profileRole" class="text-xs text-slate-400 animate-pulse">Loading...</p>
                  </div>
                  <div class="space-y-3 text-sm">
                      <div class="flex items-center">
                          <i data-lucide="mail" class="h-4 w-4 text-slate-400 mr-2"></i>
                          <span id="profileEmail" class="text-slate-300 animate-pulse">Loading...</span>
                      </div>
                      <div class="flex items-center">
                          <i data-lucide="key" class="h-4 w-4 text-slate-400 mr-2"></i>
                          <span id="lastLogin" class="text-slate-300 animate-pulse">Loading...</span>
                      </div>
                      <div class="flex items-center">
                          <i data-lucide="shield" class="h-4 w-4 text-slate-400 mr-2"></i>
                          <span id="twoFactorStatus" class="text-slate-300 animate-pulse">Loading...</span>
                      </div>
                  </div>
                  <button id="editProfileBtn" class="w-full mt-4 bg-slate-800/50 hover:bg-slate-700/50 text-slate-300 rounded-lg py-2 text-sm font-medium transition-all flex items-center justify-center">
                      <i data-lucide="settings" class="h-4 w-4 mr-2"></i>
                      Edit Profile
                  </button>
              </div>
          </div>
          
          <!-- Storage System Info Card -->
          <div class="glass-card rounded-xl overflow-hidden shadow-xl">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
                  <h3 class="text-lg font-semibold text-white tracking-wide flex items-center">
                      <i data-lucide="server" class="h-5 w-5 text-cyan-400 mr-2"></i>
                      Storage System
                  </h3>
              </div>
              <div class="p-6 space-y-5">
                  <div>
                      <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                          <i data-lucide="hard-drive" class="h-4 w-4 mr-2"></i>
                          Storage Usage
                      </h4>
                      <div class="bg-slate-800/30 rounded-lg p-4">
                          <div class="flex items-center justify-between mb-2">
                              <span id="storageUsed" class="text-xs font-medium text-slate-400">Used: Loading...</span>
                              <span id="storagePercent" class="text-xs font-medium text-cyan-400">0%</span>
                          </div>
                          <div class="progress-bar mb-2">
                              <div id="storageProgress" class="progress-fill" style="width: 0%"></div>
                          </div>
                          <div class="flex items-center justify-between text-xs text-slate-400">
                              <span>0 GB</span>
                              <span id="storageTotal">100 MB Total</span>
                          </div>
                          <div class="mt-3">
                              <canvas id="storageChart" height="120"></canvas>
                          </div>
                      </div>
                  </div>
                  
                  <div>
                    <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                        <i data-lucide="activity" class="h-4 w-4 mr-2"></i>
                        System Health
                    </h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-800/30 rounded-lg p-3 border border-green-500/20">
                            <div class="flex items-center justify-between">
                                <span class="text-xs font-medium text-slate-400">CPU</span>
                                <span id="cpuUsage" class="text-xs font-medium text-green-400">0%</span>
                            </div>
                            <div class="progress-bar mt-1">
                                <div id="cpuProgress" class="progress-fill bg-green-500" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-slate-800/30 rounded-lg p-3 border border-blue-500/20">
                            <div class="flex items-center justify-between">
                                <span class="text-xs font-medium text-slate-400">Memory</span>
                                <span id="memoryUsage" class="text-xs font-medium text-blue-400">0%</span>
                            </div>
                            <div class="progress-bar mt-1">
                                <div id="memoryProgress" class="progress-fill bg-blue-500" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-slate-800/30 rounded-lg p-3 border border-yellow-500/20">
                            <div class="flex items-center justify-between">
                                <span class="text-xs font-medium text-slate-400">Disk I/O</span>
                                <span id="diskUsage" class="text-xs font-medium text-yellow-400">19%</span>
                            </div>
                            <div class="progress-bar mt-1">
                                <div id="diskProgress" class="progress-fill bg-yellow-500" style="width: 19%"></div>
                            </div>
                        </div>
                        <div class="bg-slate-800/30 rounded-lg p-3 border border-purple-500/20">
                            <div class="flex items-center justify-between">
                                <span class="text-xs font-medium text-slate-400">Network</span>
                                <span id="networkUsage" class="text-xs font-medium text-purple-400">0%</span>
                            </div>
                            <div class="progress-bar mt-1">
                                <div id="networkProgress" class="progress-fill bg-purple-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                  
                  <div>
                      <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                          <i data-lucide="shield" class="h-4 w-4 mr-2"></i>
                          Security Status
                      </h4>
                      <div class="bg-slate-800/30 rounded-lg p-4">
                          <div class="flex items-center justify-between mb-3">
                              <div class="flex items-center">
                                  <div id="securityStatusDot" class="h-2 w-2 rounded-full bg-gray-500 mr-2"></div>
                                  <span id="securityStatusText" class="text-xs font-medium text-white">Checking...</span>
                              </div>
                              <span id="securityStatusBadge" class="text-xs text-gray-400">...</span>
                          </div>
                          <ul id="securityChecks" class="space-y-2 text-xs text-slate-400">
                              <li class="flex items-center">
                                  <i data-lucide="loader" class="h-3 w-3 text-slate-400 mr-2 animate-spin"></i>
                                  Loading security checks...
                              </li>
                          </ul>
                      </div>
                  </div>
              </div>
          </div>
          
          <!-- Recent Activity -->
          <div class="glass-card rounded-xl overflow-hidden shadow-xl">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
                  <h3 class="text-lg font-semibold text-white tracking-wide flex items-center">
                      <i data-lucide="clock" class="h-5 w-5 text-cyan-400 mr-2"></i>
                      Recent Activity
                  </h3>
              </div>
              <div class="p-6">
                  <div id="activityFeed" class="space-y-4">
                      <!-- Activity items will be loaded here -->
                      <div class="flex items-center justify-center py-4">
                          <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-400"></div>
                      </div>
                  </div>
                  <button id="viewAllActivityBtn" class="w-full mt-4 text-cyan-400 hover:text-cyan-300 text-xs font-medium transition-all flex items-center justify-center">
                      View All Activity
                      <i data-lucide="chevron-right" class="h-4 w-4 ml-1"></i>
                  </button>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- New Folder Modal -->
<div id="newFolderModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md">
      <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-white flex items-center">
              <i data-lucide="folder-plus" class="h-5 w-5 text-cyan-400 mr-2"></i>
              Create New Folder
          </h3>
          <button id="closeNewFolderModal" class="text-slate-400 hover:text-white">
              <i data-lucide="x" class="h-5 w-5"></i>
          </button>
      </div>
      <div class="space-y-4">
          <div>
              <label class="block text-sm font-medium text-slate-300 mb-1">Folder Name</label>
              <input id="newFolderName" type="text" class="w-full bg-slate-700/50 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-1 focus:ring-cyan-500" required>
          </div>
          <div>
              <label class="block text-sm font-medium text-slate-300 mb-1">Folder Style</label>
              <select id="newFolderStyle" class="w-full bg-slate-700 text-white rounded p-2">
                  <option value="Folder Style 1">Folder Style 1</option>
                  <option value="Folder Style 2">Folder Style 2</option>
                  <option value="Folder Style 3">Folder Style 3</option>
                  <option value="Folder Style 4">Folder Style 4</option>
              </select>
          </div>
          <div class="flex justify-end space-x-3 pt-2">
              <button id="cancelNewFolder" class="px-4 py-2 text-sm font-medium rounded-lg bg-slate-700/50 text-slate-300 hover:bg-slate-700">
                  Cancel
              </button>
              <button id="confirmNewFolder" class="px-4 py-2 text-sm font-medium rounded-lg bg-gradient-to-r from-cyan-600 to-cyan-700 text-white hover:from-cyan-500 hover:to-cyan-600">
                  Create Folder
              </button>
          </div>
      </div>
  </div>
</div>

<!-- Notifications Modal -->
<div id="notificationsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md">
      <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-white flex items-center">
              <i data-lucide="bell" class="h-5 w-5 text-cyan-400 mr-2"></i>
              Notifications
          </h3>
          <button id="closeNotificationsModal" class="text-slate-400 hover:text-white">
              <i data-lucide="x" class="h-5 w-5"></i>
          </button>
      </div>
      <div id="notificationsList" class="space-y-3 max-h-96 overflow-y-auto">
          <!-- Notifications will be loaded here -->
          <div class="flex items-center justify-center py-4">
              <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-400"></div>
          </div>
      </div>
      <div class="pt-4 border-t border-slate-700 mt-4">
          <button id="markAllAsRead" class="w-full text-cyan-400 hover:text-cyan-300 text-xs font-medium transition-all flex items-center justify-center">
              <i data-lucide="check-circle" class="h-4 w-4 mr-2"></i>
              Mark All as Read
          </button>
      </div>
  </div>
</div>















    
   

    <div id="pageLeaderboard" class="page page-hidden">
      <div class="card max-w-9xl mx-auto">
        <div class="p-6 border-b border-slate-700/50 bg-gradient-to-r from-slate-800 to-slate-900">
          <h3 class="text-2xl font-bold text-slate-100 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
            </svg>
            <span class="bg-gradient-to-r from-amber-400 to-amber-600 bg-clip-text text-transparent">Top Miners</span>
          </h3>
          <p class="text-sm text-slate-400 mt-1">The most productive miners this week</p>
        </div>
        
        <div class="p-6">
          <div class="grid grid-cols-12 text-xs font-medium text-slate-400 border-b border-slate-700/30 py-3">
            <div class="col-span-1 text-center">Rank</div>
            <div class="col-span-1">Pict</div>
            <div class="col-span-4">User</div>
            <div class="col-span-2">Booster</div>
            <div class="col-span-2 text-right">Invite</div>
            <div class="col-span-2 text-right">Points</div>
          </div>
          
          <div id="leaderboardList" class="divide-y divide-slate-700/30"></div>
        </div>
      </div>
    </div>
      <div id="pageSecurity" class="page page-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="col-span-2 space-y-6">
            <div class="card border border-slate-700/50 rounded-xl overflow-hidden">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800 to-slate-900/50">
                <div class="flex items-center">
                  <i data-lucide="shield" class="h-6 w-6 text-green-400 mr-3"></i>
                  <h3 class="text-lg font-semibold text-slate-100">Device Security Monitoring</h3>
                </div>
              </div>
              <div class="p-6">
                <div class="space-y-5">
                  <!-- User Agent -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="monitor" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">User Agent</span>
                    </div>
                    <span id="userAgent" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- DevTools Status -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="code" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">DevTools Status</span>
                    </div>
                    <span id="devtoolsStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-900/30 text-red-400 border border-red-700/50">
                      <span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span>
                      Closed
                    </span>
                  </div>
                  <!-- Device Fingerprint -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="fingerprint" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Device Fingerprint</span>
                    </div>
                    <span id="deviceFingerprint" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- IP Address -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="globe" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">IP Address</span>
                    </div>
                    <span id="ipAddress" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Location -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="map-pin" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Location</span>
                    </div>
                    <span id="locationInfo" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Scan Button -->
                  <button id="runSecurityScanBtn" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-green-500/20 flex items-center justify-center">
                    <i data-lucide="refresh-cw" class="h-5 w-5 mr-2"></i>
                    Run Security Scan
                  </button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="p-4 border-b border-slate-700/50">
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <i data-lucide="activity" class="h-5 w-5 text-green-500 mr-2"></i>
                    <h3 class="text-slate-100">Security Log</h3>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span
                      class="bg-slate-800/50 text-green-400 border border-green-500/50 rounded-md px-2 py-1 text-xs flex items-center"
                    >
                      <span
                        class="h-1.5 w-1.5 rounded-full bg-green-500 mr-1 animate-pulse"
                      ></span>
                      LIVE
                    </span>
                    <button class="text-slate-400 p-2">
                      <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <div id="securityLog" class="space-y-3">
                  <!-- Logs will be populated dynamically -->
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-6">
            <div class="card">
              <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-slate-100">Security Actions</h3>
                  <i data-lucide="info" class="h-5 w-5 text-slate-400"></i>
                </div>
                <div class="space-y-3">
                  <button
                    id="clearSecurityLogBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="trash" class="h-4 w-4 mr-2"></i>
                    Clear Security Logs
                  </button>
                  <button
                    id="configureAlertsBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="bell" class="h-4 w-4 mr-2"></i>
                    Configure Alerts
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> 
      

      <div id="pageCommunications" class="page">
        <!-- Premium Communication Card -->
        <div class="card bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl overflow-hidden border border-slate-700/40 shadow-2xl backdrop-blur-sm">
            <!-- Card Header with Glow Effect -->
            <div class="p-5 border-b border-slate-700/40 bg-gradient-to-r from-slate-800/90 to-slate-900/90 relative overflow-hidden">
                <!-- Subtle grid pattern background -->
                <div class="absolute inset-0 opacity-10 [background-image:linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] [background-size:24px_24px]"></div>
                <!-- Animated gradient border effect -->
                <div class="absolute inset-0 border-t border-transparent bg-[length:300%_300%] bg-gradient-to-r from-transparent via-cyan-500/20 to-transparent animate-gradient-border"></div>
                
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex items-center">
                        <div class="p-1.5 bg-cyan-500/10 rounded-lg border border-cyan-500/20 mr-3 backdrop-blur-sm shadow-sm">
                            <i data-lucide="messages-square" class="h-5 w-5 text-cyan-400"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                                <span>Global Communications</span>
                                <span class="ml-2 px-2 py-0.5 text-xs font-medium bg-cyan-500/10 text-cyan-400 rounded-full border border-cyan-500/20">PRO</span>
                            </h2>
                            <p class="text-xs text-slate-400 mt-0.5 flex items-center">
                                <i data-lucide="users" class="h-3 w-3 mr-1"></i>
                                <span>24 active participants</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="voiceCallBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-emerald-500/30 transition-all duration-300 group tooltip" data-tooltip="Start voice call">
                            <i data-lucide="phone" class="h-4 w-4 text-slate-400 group-hover:text-emerald-400"></i>
                        </button>
                        <button id="videoCallBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-purple-500/30 transition-all duration-300 group tooltip" data-tooltip="Start video call">
                            <i data-lucide="video" class="h-4 w-4 text-slate-400 group-hover:text-purple-400"></i>
                        </button>
                        <button id="refreshChatBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-cyan-500/30 transition-all duration-300 group tooltip" data-tooltip="Refresh messages">
                            <i data-lucide="refresh-cw" class="h-4 w-4 text-slate-400 group-hover:text-cyan-400 group-hover:rotate-180 transition-all duration-500"></i>
                        </button>
                    </div>
                </div>
            </div>
    
            <!-- Card Body -->
            <div class="p-6">
                <!-- Status Bar -->
                <div class="flex items-center justify-between mb-4 text-xs">
                    <div class="flex items-center text-slate-400">
                        <i data-lucide="shield-check" class="h-3 w-3 mr-1 text-emerald-400"></i>
                        <span>End-to-end encrypted</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="flex items-center text-slate-400">
                            <i data-lucide="wifi" class="h-3 w-3 mr-1 text-blue-400"></i>
                            <span>Connected</span>
                        </span>
                        <span class="flex items-center text-slate-400">
                            <i data-lucide="clock" class="h-3 w-3 mr-1 text-amber-400"></i>
                            <span id="connectionLatency"></span>
                        </span>
                    </div>
                </div>
    
                <!-- Admin Messages -->
                <div id="adminMessages" class="admin-messages-container bg-slate-900/60 border border-slate-700/30 rounded-xl p-4 max-h-[200px] overflow-y-auto mb-4 backdrop-blur-sm shadow-inner shadow-slate-900/50">
                    <!-- Admin message example -->
                    <div class="flex mb-3 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-amber-500/20 to-amber-600/20 border border-amber-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="shield-alert" class="h-4 w-4 text-amber-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-amber-400 mr-2"></div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span></span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                              
                            </div>
                        </div>
                    </div>
                    
                    <!-- Admin message example 2 -->
                    <div class="flex mb-3 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="megaphone" class="h-4 w-4 text-blue-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-blue-400 mr-2">Announcement</div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span>Today, 10:15 AM</span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                               
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Chat Messages -->
                <div id="chatMessages" class="chat-messages bg-slate-900/60 border border-slate-700/30 rounded-xl p-4 h-[400px] overflow-y-auto backdrop-blur-sm shadow-inner shadow-slate-900/50">
                    <!-- Date separator -->
                    <div class="flex items-center my-4">
                        <div class="flex-1 border-t border-slate-700/40"></div>
                        <span class="px-3 text-xs text-slate-500 bg-slate-900/50 rounded-full border border-slate-700/30">Today</span>
                        <div class="flex-1 border-t border-slate-700/40"></div>
                    </div>
    
                    <!-- Example chat message 1 -->
                    <div class="flex mb-4 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-blue-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-blue-400 mr-2"></div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span></span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                                
                            </div>
                            <div class="flex items-center mt-2 space-x-3">
                                <button class="text-xs text-slate-400 hover:text-cyan-400 flex items-center">
                                    <i data-lucide="thumbs-up" class="h-3 w-3 mr-1"></i>
                                    <span>Like</span>
                                </button>
                                <button class="text-xs text-slate-400 hover:text-amber-400 flex items-center">
                                    <i data-lucide="message-square" class="h-3 w-3 mr-1"></i>
                                    <span>Reply</span>
                                </button>
                                <button class="text-xs text-slate-400 hover:text-rose-400 flex items-center">
                                    <i data-lucide="flag" class="h-3 w-3 mr-1"></i>
                                    <span>Report</span>
                                </button>
                            </div>
                        </div>
                    </div>
    
                    <!-- Example chat message 2 (user) -->
                    <div class="flex mb-4 last:mb-0 flex-row-reverse">
                        <div class="flex-shrink-0 ml-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-cyan-500/20 to-cyan-600/20 border border-cyan-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-cyan-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0 text-right">
                            <div class="flex items-baseline mb-1 justify-end">
                                <div class="text-xs text-slate-500 flex items-center mr-2">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span></span>
                                </div>
                                <div class="text-xs font-medium text-cyan-400">You</div>
                            </div>
                            <div class="text-sm text-slate-300 bg-gradient-to-r from-cyan-600/20 to-blue-600/20 rounded-lg p-3 border border-cyan-500/30 inline-block">
                                
                            </div>
                            <div class="flex items-center mt-2 space-x-3 justify-end">
                                <span class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="check" class="h-3 w-3 mr-1 text-emerald-400"></i>
                                    <span>Delivered</span>
                                </span>
                            </div>
                        </div>
                    </div>
    
                    <!-- Example chat message 3 -->
                    <div class="flex mb-4 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-purple-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-purple-400 mr-2"></div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span></span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                                <div class="mb-2"></div>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="bg-slate-800/70 border border-slate-700/40 rounded-lg overflow-hidden cursor-pointer hover:border-cyan-500/40 transition-all duration-200">
                                        <img src="https://via.placeholder.com/300x200/1e293b/64748b?text=Design+1" alt="Design mockup" class="w-full h-auto">
                                        <div class="p-2 text-xs text-slate-400 truncate"></div>
                                    </div>
                                    <div class="bg-slate-800/70 border border-slate-700/40 rounded-lg overflow-hidden cursor-pointer hover:border-cyan-500/40 transition-all duration-200">
                                        <img src="https://via.placeholder.com/300x200/1e293b/64748b?text=Design+2" alt="Design mockup" class="w-full h-auto">
                                        <div class="p-2 text-xs text-slate-400 truncate"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center mt-2 space-x-3">
                                <button class="text-xs text-slate-400 hover:text-cyan-400 flex items-center">
                                    <i data-lucide="thumbs-up" class="h-3 w-3 mr-1"></i>
                                    <span>Like</span>
                                </button>
                                <button class="text-xs text-slate-400 hover:text-amber-400 flex items-center">
                                    <i data-lucide="message-square" class="h-3 w-3 mr-1"></i>
                                    <span>Reply</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="typing-indicator hidden text-xs text-slate-400 mt-2 flex items-center">
                    <div class="typing-dots flex space-x-1 mr-2">
                        <div class="h-2 w-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                        <div class="h-2 w-2 bg-slate-500 rounded-full animate-bounce delay-150"></div>
                        <div class="h-2 w-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                    </div>
                    <span></span>
                </div>
    
                <!-- Chat Input Container -->
                <div id="chatInputContainer" class="relative flex items-center space-x-2 mt-4">
                    <button id="emojiPickerBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-amber-500/30 transition-all duration-300 tooltip" data-tooltip="Emoji">
                        <i data-lucide="smile" class="h-4 w-4 text-slate-400 hover:text-amber-400"></i>
                    </button>
                    <textarea id="chatInput" class="flex-1 p-3 border rounded-lg bg-slate-800/50 border-slate-700/30 text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/30 transition-all duration-200 resize-none" placeholder="Type your message..." rows="1"></textarea>
                    <div class="flex items-center space-x-1">
                        <button id="uploadImageButton" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-cyan-500/30 transition-all duration-300 tooltip" data-tooltip="Attach file">
                            <i data-lucide="paperclip" class="h-4 w-4 text-slate-400 hover:text-cyan-400"></i>
                        </button>
                        <input type="file" id="imageInput" class="hidden" accept="image/*">
                        <button id="recordVoiceBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-rose-500/30 transition-all duration-300 tooltip" data-tooltip="Voice message">
                            <i data-lucide="mic" class="h-4 w-4 text-slate-400 hover:text-rose-400"></i>
                        </button>
                        <button id="sendMessageBtn" class="p-2 bg-cyan-600/90 hover:bg-cyan-500 rounded-lg border border-cyan-600/80 hover:border-cyan-400/80 transition-all duration-300 shadow-sm shadow-cyan-500/20 tooltip" data-tooltip="Send message">
                            <i data-lucide="send" class="h-4 w-4 text-white"></i>
                        </button>
                    </div>
                    <div id="mentionSuggestions" class="hidden absolute bottom-12 w-full bg-slate-800/90 border border-slate-700/30 rounded-lg shadow-lg max-h-40 overflow-y-auto backdrop-blur-sm z-10"></div>
                </div>
            </div>
    
            <!-- Online Users Panel -->
            <div class="border-t border-slate-700/40 p-3 bg-slate-900/50">
                <div class="flex items-center justify-between text-xs text-slate-400 mb-2">
                    <div class="flex items-center">
                        <i data-lucide="users" class="h-3 w-3 mr-1"></i>
                        <span>Online (0)</span>
                    </div>
                    <button id="expandUsersBtn" class="text-cyan-400 hover:text-cyan-300 transition-colors">
                        <i data-lucide="chevron-down" class="h-3 w-3"></i>
                    </button>
                </div>
                <div id="onlineUsersList" class="flex space-x-2 overflow-x-auto pb-1">
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-blue-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center"></span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-purple-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center"></span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-amber-500/20 to-amber-600/20 border border-amber-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-amber-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center"></span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 border border-emerald-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-emerald-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center"></span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-rose-500/20 to-rose-600/20 border border-rose-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-rose-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-amber-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center"></span>
                    </div>
          
    
        <!-- Toast Notifications -->
        <div id="toastContainer" class="fixed bottom-6 right-6 flex flex-col-reverse pointer-events-none z-50 space-y-3 w-80"></div>
    </div>
    </div>
    
    <!-- Hidden File Input -->
    <input type="file" id="imageInput" accept="image/*" class="hidden" />
  </div>
</div>


    
    <style>
        @keyframes gradient-border {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        .animate-gradient-border {
            animation: gradient-border 3s ease infinite alternate;
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(15, 23, 42, 0.9);
            color: #e2e8f0;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            border: 1px solid rgba(100, 116, 139, 0.3);
            z-index: 10;
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 5px);
        }
        /* Hilangkan scrollbar untuk semua browser */
#chatMessages, #adminMessages {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE dan Edge */
}

/* Hilangkan scrollbar untuk Chrome, Safari, dan Opera */
#chatMessages::-webkit-scrollbar,
#adminMessages::-webkit-scrollbar {
  display: none;
}
    </style>
      
    




      <div id="pageSecurity" class="page page-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="col-span-2 space-y-6">
            <div class="card border border-slate-700/50 rounded-xl overflow-hidden">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800 to-slate-900/50">
                <div class="flex items-center">
                  <i data-lucide="shield" class="h-6 w-6 text-green-400 mr-3"></i>
                  <h3 class="text-lg font-semibold text-slate-100">Device Security Monitoring</h3>
                </div>
              </div>
              <div class="p-6">
                <div class="space-y-5">
                  <!-- User Agent -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="monitor" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">User Agent</span>
                    </div>
                    <span id="userAgent" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- DevTools Status -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="code" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">DevTools Status</span>
                    </div>
                    <span id="devtoolsStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-900/30 text-red-400 border border-red-700/50">
                      <span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span>
                      Closed
                    </span>
                  </div>
                  <!-- Device Fingerprint -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="fingerprint" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Device Fingerprint</span>
                    </div>
                    <span id="deviceFingerprint" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- IP Address -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="globe" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">IP Address</span>
                    </div>
                    <span id="ipAddress" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Location -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="map-pin" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Location</span>
                    </div>
                    <span id="locationInfo" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Scan Button -->
                  <button id="runSecurityScanBtn" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-green-500/20 flex items-center justify-center">
                    <i data-lucide="refresh-cw" class="h-5 w-5 mr-2"></i>
                    Run Security Scan
                  </button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="p-4 border-b border-slate-700/50">
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <i data-lucide="activity" class="h-5 w-5 text-green-500 mr-2"></i>
                    <h3 class="text-slate-100">Security Log</h3>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span
                      class="bg-slate-800/50 text-green-400 border border-green-500/50 rounded-md px-2 py-1 text-xs flex items-center"
                    >
                      <span
                        class="h-1.5 w-1.5 rounded-full bg-green-500 mr-1 animate-pulse"
                      ></span>
                      LIVE
                    </span>
                    <button class="text-slate-400 p-2">
                      <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <div id="securityLog" class="space-y-3">
                  <!-- Logs will be populated dynamically -->
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-6">
            <div class="card">
              <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-slate-100">Security Actions</h3>
                  <i data-lucide="info" class="h-5 w-5 text-slate-400"></i>
                </div>
                <div class="space-y-3">
                  <button
                    id="clearSecurityLogBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="trash" class="h-4 w-4 mr-2"></i>
                    Clear Security Logs
                  </button>
                  <button
                    id="configureAlertsBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="bell" class="h-4 w-4 mr-2"></i>
                    Configure Alerts
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
         
      

      <div id="pageSettings" class="page page-hidden">
        <div class="card max-w-8xl mx-auto overflow-hidden">
          <!-- Header Section -->
          <div class="p-6 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 via-slate-800/60 to-slate-900/80 backdrop-blur-sm">
            <div class="flex items-start justify-between">
              <div>
                <h3 class="text-2xl font-bold text-slate-100 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  Account Settings
                </h3>
                <p class="text-sm text-slate-400/90 mt-1.5 ml-9">Manage your profile and account preferences</p>
              </div>
              <button class="flex items-center space-x-2 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600/30 rounded-lg px-4 py-2 text-sm text-slate-300 transition-all duration-200 hover:text-white hover:shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                <span>Refresh</span>
              </button>
            </div>
          </div>
          
          <!-- Main Content -->
          <div class="p-6 bg-slate-900/20">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <!-- Left Column - Main Settings -->
              <div class="lg:col-span-2 space-y-8">
                <!-- Profile Section -->
                <div class="bg-slate-800/30 rounded-xl p-6 border border-slate-700/50 shadow-lg backdrop-blur-sm">
                  <div class="flex items-center justify-between mb-6">
                    <h4 class="text-lg font-semibold text-slate-200 flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                      </svg>
                      Profile Information
                    </h4>
                    <span class="text-xs bg-cyan-500/10 text-cyan-400 px-3 py-1 rounded-full">Required</span>
                  </div>
                  
                  <!-- Profile Picture -->
                  <div class="mb-8">
                    <label class="text-sm font-medium text-slate-400/90 flex items-center">
                      Profile Picture
                      <span class="text-xs text-slate-500 ml-2">(Optional)</span>
                    </label>
                    <div class="mt-4 flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-6">
                      <div class="relative group">
                        <div id="profilePicturePreview" class="h-28 w-28 rounded-full bg-gradient-to-br from-cyan-600/80 to-slate-800 text-white flex items-center justify-center text-3xl font-bold shadow-lg ring-2 ring-cyan-500/30">
                          U
                        </div>
                        <div class="absolute inset-0 rounded-full bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </div>
                      </div>
                      
                      <div class="flex-1 space-y-3">
                        <div class="flex flex-wrap gap-3">
                          <input type="file" id="profilePictureInput" accept="image/png,image/jpeg,image/webp" class="hidden" />
                          <button id="changeProfilePictureBtn" class="flex items-center space-x-2 bg-gradient-to-r from-cyan-600/90 to-teal-600/90 hover:from-cyan-700 hover:to-teal-700 text-white rounded-lg px-4 py-2.5 text-sm font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 active:scale-[0.98]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <span>Change Picture</span>
                          </button>
                          <button id="removeProfilePictureBtn" class="flex items-center space-x-2 bg-slate-700/60 hover:bg-slate-600/70 text-slate-300 hover:text-white rounded-lg px-4 py-2.5 text-sm font-medium transition-all border border-slate-600/30">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            <span>Delete</span>
                          </button>
                        </div>
                        <p class="text-xs text-slate-500/80 leading-relaxed">
                          Format: JPG, PNG, or WEBP. Maximum size 15MB.<br>
                          Recommended resolution: 500×500px (1:1). Image will be cropped proportionally.
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Full Name -->
                  <div class="mb-6">
                    <label for="fullNameInput" class="block text-sm font-medium text-slate-400/90 mb-3 flex items-center">
                      Full Name
                      <span class="text-xs text-rose-400 ml-1.5">*</span>
                    </label>
                    <div class="relative group">
                      <input id="settingsFullNameInput" type="text" class="w-full bg-slate-800/40 border border-slate-700/40 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/40 focus:border-cyan-500/70 placeholder-slate-500/60 pl-11 transition-all duration-200 group-hover:border-slate-600/70" placeholder="Example: John Doe" />
                      <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500/80 group-focus-within:text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.6">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                      </div>
                      <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-400 opacity-0 group-focus-within:opacity-100 transition-opacity duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                      </div>
                    </div>
                    <p class="text-xs text-slate-500/70 mt-2">Use your real name for account verification</p>
                  </div>
                  
                  <!-- Wallet Address Section -->
                  <div class="space-y-6 p-6 bg-slate-900/50 rounded-xl border border-slate-800 shadow-lg">
                    <!-- Wallet Address Input -->
                    <div class="space-y-2">
                      <div class="flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                        </svg>
                        <label for="walletAddressInput" class="text-sm font-medium text-slate-300">Wallet Address</label>
                      </div>
                      
                      <div class="relative group">
                        <input id="walletAddressInput" type="text" class="w-full bg-slate-800/70 border border-slate-700/50 rounded-lg px-4 py-3 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500/70 transition-all duration-200 group-hover:border-slate-600" placeholder="0x71C7656EC7ab88b098defB751B7401B5f6d8976F" />
                        
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 group-focus-within:text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                        </div>
                        
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                          <button class="p-1 rounded-md hover:bg-slate-700/50 transition-colors duration-200" aria-label="Paste address">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 hover:text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Connect Wallet Button -->
                    <div class="pt-2">
                      <button id="connectWalletBtn" class="w-full flex items-center justify-center space-x-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-lg px-4 py-3 text-sm font-medium transition-all duration-300 shadow-lg hover:shadow-xl hover:shadow-purple-500/30 active:scale-[0.98]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                        </svg>
                        <span>Connect Wallet</span>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Email -->
                  <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-400 mb-2">Email Address</label>
                    <div class="relative">
                      <input id="emailDisplay" type="email" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm text-slate-400" readonly />
                      <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Referral Section -->
                  <div class="mb-6">
                    <h4 class="text-lg font-semibold text-slate-200 mb-4 flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                      </svg>
                      Referral Program
                    </h4>
                    
                    <!-- Referral Section -->
                    <div class="space-y-6 p-6 bg-slate-900/50 rounded-xl border border-slate-800 shadow-lg">
                      <!-- Referral Code -->
                      <div class="space-y-3">
                        <div class="flex items-center space-x-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                          </svg>
                          <label for="referralCodeInput" class="text-sm font-medium text-slate-300">Your Referral Code</label>
                        </div>
                        
                        <div class="flex space-x-3">
                          <div class="relative flex-1 group">
                            <input id="referralCodeInput" type="text" class="w-full bg-slate-800/70 border border-slate-700/50 rounded-lg px-4 py-3 pl-10 text-sm text-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500/50 transition-all duration-200 group-hover:border-slate-600" readonly />
                            
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-500/80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                              </svg>
                            </div>
                          </div>
                          
                          <button id="copyReferralBtn" class="copy-btn flex items-center justify-center w-28 space-x-2 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-lg px-4 py-3 text-sm font-medium transition-all duration-300 shadow-lg hover:shadow-xl hover:shadow-emerald-500/20 active:scale-[0.98] overflow-hidden">
                            <span class="copy-text flex items-center space-x-2">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 copy-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                              </svg>
                              <span>Copy</span>
                            </span>
                            <span class="success-text hidden items-center space-x-2">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                              </svg>
                              <span>Success!</span>
                            </span>
                          </button>
                        </div>
                        
                        <div class="flex items-start space-x-2 pt-1">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-emerald-400/80 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <p class="text-xs text-slate-400/80">Share your referral code and earn special bonuses!</p>
                        </div>
                      </div>
                      
                      <!-- Invited Users Count -->
                      <div class="space-y-3">
                        <div class="flex items-center space-x-2">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                          </svg>
                          <label class="text-sm font-medium text-slate-300">Number of Invited Users</label>
                        </div>
                        
                        <div class="relative group">
                          <span id="invitedUsersCount" class="w-full bg-slate-800/70 border border-slate-700/50 rounded-lg px-4 py-3 pl-10 text-sm text-cyan-400 inline-block">0</span>
                          <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500/80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                            </svg>
                          </div>
                        </div>
                        
                        <div class="flex items-start space-x-2 pt-1">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-cyan-400/80 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <p class="text-xs text-slate-400/80">You will earn rewards for each user who joins using your code</p>
                        </div>
                      </div>
                    </div>
                  </div>
              

<style>
  .copy-btn {
    position: relative;
  }
  
  .copy-text, .success-text {
    transition: all 0.3s ease;
    position: absolute;
    display: flex;
    align-items: center;
  }
  
  .copy-btn.copied .copy-text {
    transform: translateY(-40px);
    opacity: 0;
  }
  
  .copy-btn.copied .success-text {
    transform: translateY(0);
    opacity: 1;
  }
  
  .success-text {
    transform: translateY(40px);
    opacity: 0;
  }
</style>

<script>
  document.getElementById('copyReferralBtn').addEventListener('click', function() {
    const btn = this;
    btn.classList.add('copied');
    
    // Reset button after 2 seconds
    setTimeout(() => {
      btn.classList.remove('copied');
    }, 2000);
    
    // Copy to clipboard functionality would go here
    // navigator.clipboard.writeText(document.getElementById('referralCodeInput').value);
  });
</script>
                  
                 <!-- Save Button -->
<div class="mt-8 pt-6 border-t border-slate-700/50">
  <button id="saveProfileBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
    </svg>
    Save Profile Changes
  </button>
</div>
</div>

<!-- Password Section -->
<div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700/50">
  <h4 class="text-lg font-semibold text-slate-200 mb-4 flex items-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
    </svg>
    Change Password
  </h4>
  
  <div class="space-y-4">
    <div>
      <label for="currentPasswordInput" class="block text-sm font-medium text-slate-400 mb-2">Current Password</label>
      <div class="relative">
        <input id="currentPasswordInput" type="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500" placeholder="Enter current password" />
        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 cursor-pointer hover:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
        </div>
      </div>
    </div>
    
    <div>
      <label for="newPasswordInput" class="block text-sm font-medium text-slate-400 mb-2">New Password</label>
      <div class="relative">
        <input id="newPasswordInput" type="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500" placeholder="Enter new password" />
        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 cursor-pointer hover:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
        </div>
      </div>
    </div>
    
    <div>
      <label for="confirmNewPasswordInput" class="block text-sm font-medium text-slate-400 mb-2">Confirm New Password</label>
      <div class="relative">
        <input id="confirmNewPasswordInput" type="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500" placeholder="Confirm new password" />
        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 cursor-pointer hover:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
        </div>
      </div>
    </div>
    
    <div class="pt-4">
      <button id="changePasswordBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg>
        Update Password
      </button>
    </div>
  </div>
</div>
</div>

<!-- Right Column - Danger Zone -->
<div class="lg:col-span-1">
  <div class="bg-slate-800/50 rounded-xl p-6 border border-red-900/50 sticky top-6">
    <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      Danger Zone
    </h4>
    
    <p class="text-sm text-slate-400 mb-6">This action cannot be undone. Please proceed with caution.</p>
    
    <div>
      <label class="block text-sm font-medium text-red-400 mb-2">Delete Account</label>
      <p class="text-xs text-slate-500 mb-4">Once you delete your account, there is no going back. All your data will be permanently deleted.</p>
      <button id="deleteAccountBtn" class="w-full bg-red-600 hover:bg-red-700 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-red-500/20 flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Delete My Account
      </button>
    </div>
  </div>
</div>
            </div>
          </div>
        </div>
      </div>
      
      <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/fingerprintjs@3.3.1/dist/fingerprint.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
      <script src="https://unpkg.com/@okxweb3/web3.js@latest/umd/index.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
      <script src="/js/quantum-sync-monitor.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js "></script>
      

     
      <script>
        // Mendapatkan modul ipcRenderer dari Electron untuk komunikasi antar proses
        const { ipcRenderer } = require("electron");
      </script>
      
      <script>
        // START: Polyfill untuk fitur navigator.locks (jika belum didukung oleh browser)
        if (!navigator.locks) {
          navigator.locks = {
            request: async (name, options, callback) => {
              if (typeof options === 'function') {
                callback = options;
                options = {};
              }
              await callback({});
            },
            query: async () => ({ held: [], pending: [] })
          };
        }
        // END: Polyfill untuk fitur navigator.locks
      
        // START: Polyfill untuk fitur crypto.randomUUID (jika belum didukung oleh browser)
        if (!crypto.randomUUID) {
          crypto.randomUUID = function () {
            const bytes = new Uint8Array(16);
            crypto.getRandomValues(bytes);
            bytes[6] = (bytes[6] & 0x0f) | 0x40;
            bytes[8] = (bytes[8] & 0x3f) | 0x80;
            return Array.from(bytes, (byte) =>
              byte.toString(16).padStart(2, "0")
            ).join("");
          };
        }
        // END: Polyfill untuk fitur crypto.randomUUID
      
        // START: Inisialisasi klien Supabase
        const supabase = window.supabase.createClient(
          "https://mnobniomzmjgpyyqartz.supabase.co",
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ub2JuaW9tem1qZ3B5eXFhcnR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3NDQ0NzYsImV4cCI6MjA2MTMyMDQ3Nn0.N1w5Ro7TGWu5zdTHhNCyop-iMTl7So7h6UwZfuybx1k"
        );
        // END: Inisialisasi klien Supabase
      
        // START: Konfigurasi variabel
const PROXY_URL = 'https://aqula-production.up.railway.app/ask'; // Ubah port dari 3000 ke 8081
const blockedWords = ['token', 'source code', 'contract', 'bypass', 'funding']; // Daftar kata-kata terlarang
// END: Konfigurasi variabel
      
        // START: Elemen DOM
        const sendButton = document.getElementById('send-button'); // Tombol untuk mengirim pesan
        const messageInput = document.getElementById('message-input'); // Input untuk menulis pesan
        const logMessages = document.getElementById('log-messages'); // Area untuk menampilkan log pesan
        const newMessages = document.getElementById('new-messages'); // Elemen untuk menampilkan jumlah pesan baru
        const attachFileBtn = document.getElementById('attach-file-btn'); // Tombol untuk melampirkan file
        const fileInput = document.getElementById('file-input'); // Input untuk memilih file
        const toggleTemplatesBtn = document.getElementById('toggle-templates'); // Tombol untuk menampilkan/menyembunyikan template
        const templatePanel = document.getElementById('template-panel'); // Panel yang berisi template pertanyaan
        // END: Elemen DOM

        
      
        // START: Konfigurasi booster
        const boosterConfig = {
          elite: { speed: 3, price: 0.0001 },
          epic: { speed: 5, price: 0.0003 },
          pro: { speed: 10, price: 0.009 },
          diamond: { speed: 15, price: 0.01 },
        };
        // END: Konfigurasi booster
      
        // START: Elemen DOM untuk berbagai fitur
        const loadingOverlay = document.getElementById("loadingOverlay");
        const authModal = document.getElementById("authModal");
        const authTitle = document.getElementById("authTitle");
        const emailInput = document.getElementById("emailInput");
        const passwordInput = document.getElementById("passwordInput");
        const emailAuthBtn = document.getElementById("emailAuthBtn");
        const googleAuthBtn = document.getElementById("googleAuthBtn");
        const metamaskAuthBtn = document.getElementById("metamaskAuthBtn");
        const phantomAuthBtn = document.getElementById("phantomAuthBtn");
        const okxAuthBtn = document.getElementById("okxAuthBtn");
        const toggleAuthBtn = document.getElementById("toggleAuthBtn");
        
        const userSection = document.getElementById("userSection");
        const loginBtn = document.getElementById("loginBtn");
        const userProfile = document.getElementById("userProfile");
        const userEmail = document.getElementById("userEmail");
        const userWallet = document.getElementById("userWallet");
        const userPoints = document.getElementById("userPoints");
        const userBooster = document.getElementById("userBooster");
        const deviceScoreEl = document.getElementById("deviceScore");
        const toggleMiningBtn = document.getElementById("toggleMiningBtn");
        const miningStatus = document.getElementById("miningStatus");
        const currentPoints = document.getElementById("currentPoints");
        const currentDeviceScore = document.getElementById("currentDeviceScore");
        const currentBooster = document.getElementById("currentBooster");
        const systemStatusEl = document.getElementById("systemStatus");
        const cpuUsageEl = document.getElementById("cpuUsage");
        const memoryUsageEl = document.getElementById("memoryUsage");
        const networkStatusEl = document.getElementById("networkStatus");
        const securityLevelEl = document.getElementById("securityLevel");
        const systemLoad = document.getElementById("systemLoad");
        const systemTime = document.getElementById("systemTime");
        const systemDate = document.getElementById("systemDate");
        const tabPerformance = document.getElementById("tabPerformance");
        const tabProcesses = document.getElementById("tabProcesses");
        const tabStorage = document.getElementById("tabStorage");
        const performanceTab = document.getElementById("performanceTab");
        const processesTab = document.getElementById("processesTab");
        const storageTab = document.getElementById("storageTab");
        const performanceChart = document.getElementById("performanceChart");
        const navDashboard = document.getElementById("navDashboard");
        const navBooster = document.getElementById("navBooster");
        const navLeaderboard = document.getElementById("navLeaderboard");
        const navSettings = document.getElementById("navSettings");
        const pageDashboard = document.getElementById("pageDashboard");
        const pageBooster = document.getElementById("pageBooster");
        const pageLeaderboard = document.getElementById("pageLeaderboard");
        const pageSettings = document.getElementById("pageSettings");
        const profilePictureInput = document.getElementById("profilePictureInput");
        const profilePicturePreview = document.getElementById("profilePicturePreview");
        const changeProfilePictureBtn = document.getElementById("changeProfilePictureBtn");
        const sidebarProfilePicture = document.getElementById("sidebarProfilePicture");
        const fullNameInput = document.getElementById("fullNameInput");
        const walletAddressInput = document.getElementById("walletAddressInput");
        const saveProfileBtn = document.getElementById("saveProfileBtn");
        const emailDisplay = document.getElementById("emailDisplay");
        const currentPasswordInput = document.getElementById("currentPasswordInput");
        const newPasswordInput = document.getElementById("newPasswordInput");
        const confirmNewPasswordInput = document.getElementById("confirmNewPasswordInput");
        const changePasswordBtn = document.getElementById("changePasswordBtn");
        const deleteAccountBtn = document.getElementById("deleteAccountBtn");
        const deleteAccountModal = document.getElementById("deleteAccountModal");
        const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
        const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
        // Added for Security page
        const navSecurity = document.getElementById("navSecurity");
        const pageSecurity = document.getElementById("pageSecurity");
        // Added for Communications page
        const navCommunications = document.getElementById("navCommunications");
        const pageCommunications = document.getElementById("pageCommunications");
      
        const fullNameGroup = document.getElementById("fullNameGroup");
        const referralCodeGroup = document.getElementById("referralCodeGroup");
        // END: Elemen DOM untuk berbagai fitur
      
        // START: Inisialisasi ikon Lucide
        lucide.createIcons();
        // END: Inisialisasi ikon Lucide



        (async () => {
    // START: Variabel state
    let theme = "dark";
    let systemStatus = 85;
    let cpuUsage = 42;
    let memoryUsage = 68;
    let networkStatus = 92;
    let securityLevel = 75;
    let isMining = false;
    let miningInterval = null;
    let points = 0;
    let deviceScore = 0;
    let boosterSpeed = 1;
    let user = null;
    let isLogin = true;
    let currentPage = "dashboard";
    let isSyncing = false;
    // END: Variabel state

    // Performance chart
    let performanceData = {
        cpu: Array(20).fill(0).map(() => Math.random() * 100),
        memory: Array(20).fill(0).map(() => Math.random() * 100),
        network: Array(20).fill(0).map(() => Math.random() * 100),
    };

    function updatePerformanceChart() {
        performanceData.cpu.shift();
        performanceData.cpu.push(cpuUsage);
        performanceData.memory.shift();
        performanceData.memory.push(memoryUsage);
        performanceData.network.shift();
        performanceData.network.push(networkStatus);
        performanceChart.innerHTML = "";
        const maxPoints = 20;
        const barWidth = 100 / maxPoints;
        for (let i = 0; i < maxPoints; i++) {
            const cpuHeight = (performanceData.cpu[i] / 100) * 100;
            const memoryHeight = (performanceData.memory[i] / 100) * 100;
            const networkHeight = (performanceData.network[i] / 100) * 100;
            const div = document.createElement("div");
            div.className = "flex flex-col justify-end items-center";
            div.style.width = `${barWidth}%`;
            div.innerHTML = `
                <div class="w-1/3 bg-cyan-500/50 rounded-t-sm" style="height: ${cpuHeight}%"></div>
                <div class="w-1/3 bg-purple-500/50 rounded-t-sm" style="height: ${memoryHeight}%"></div>
                <div class="w-1/3 bg-blue-500/50 rounded-t-sm" style="height: ${networkHeight}%"></div>
            `;
            performanceChart.appendChild(div);
        }
    }

    // Tab switching
    tabPerformance.addEventListener("click", () => {
        tabPerformance.classList.add("text-cyan-400", "bg-slate-700");
        tabProcesses.classList.remove("text-cyan-400", "bg-slate-700");
        tabStorage.classList.remove("text-cyan-400", "bg-slate-700");
        performanceTab.classList.remove("hidden");
        processesTab.classList.add("hidden");
        storageTab.classList.add("hidden");
    });
    tabProcesses.addEventListener("click", () => {
        tabProcesses.classList.add("text-cyan-400", "bg-slate-700");
        tabPerformance.classList.remove("text-cyan-400", "bg-slate-700");
        tabStorage.classList.remove("text-cyan-400", "bg-slate-700");
        processesTab.classList.remove("hidden");
        performanceTab.classList.add("hidden");
        storageTab.classList.add("hidden");
    });
    tabStorage.addEventListener("click", () => {
        tabStorage.classList.add("text-cyan-400", "bg-slate-700");
        tabPerformance.classList.remove("text-cyan-400", "bg-slate-700");
        tabProcesses.classList.remove("text-cyan-400", "bg-slate-700");
        storageTab.classList.remove("hidden");
        performanceTab.classList.add("hidden");
        processesTab.classList.add("hidden");
    });

    // Hitung skor perangkat pengguna
    function calculateDeviceScore() {
        const cores = navigator.hardwareConcurrency || 4;
        const memory = (navigator.deviceMemory || 4) * 1024;
        const isHighPerformance = window.matchMedia("(prefers-reduced-motion: no-preference)").matches;

        deviceScore = (cores * 10 + memory / 100) * (isHighPerformance ? 1.2 : 1);
        deviceScore = Math.min(deviceScore, 100);

        if (currentDeviceScore) {
            currentDeviceScore.textContent = deviceScore.toFixed(2);
        }
    }

    // Fungsi untuk sinkronkan poin ke Supabase
    async function syncPointsToSupabase() {
        if (isSyncing || !window.currentUser) return;
        isSyncing = true;
        try {
            // Periksa apakah profil pengguna ada
            const { data: profile, error: fetchError } = await supabase
                .from("profiles")
                .select("points")
                .eq("id", window.currentUser.id)
                .single();
            if (fetchError) {
                if (fetchError.message.includes("0 rows")) {
                    // Jika profil tidak ditemukan, buat profil baru
                    const { error: insertError } = await supabase.from("profiles").insert({
                        id: window.currentUser.id,
                        email: window.currentUser.email,
                        points: points,
                        wallet_address: null,
                        avatar_url: null,
                        full_name: null,
                        booster: 0,
                        referral_code: '',
                        mining_speed: 0,
                        invited_users: 0
                    });
                    if (insertError) throw insertError;
                    console.log(`Created new profile for user ${window.currentUser.id}`);
                } else {
                    throw fetchError;
                }
            }

            // Sinkronkan poin
            if (!profile || profile.points !== points) {
                const { error: updateError } = await supabase
                    .from("profiles")
                    .update({ points })
                    .eq("id", window.currentUser.id);
                if (updateError) throw updateError;
                console.log(`Points synced to Supabase: ${points.toFixed(2)}`);
                // Update localStorage setelah berhasil sinkronkan
                localStorage.setItem("mining_points", points.toString());
            }
        } catch (error) {
            showToast("Error", "Failed to sync points: " + error.message, "destructive");
            console.error("Sync error:", error);
            // Simpan ke localStorage sebagai cadangan jika gagal
            localStorage.setItem("mining_points", points.toString());
        } finally {
            isSyncing = false;
        }
    }

    // Mulai proses mining
    function startMining() {
        if (!window.currentUser) {
            showToast("Error", "Please login to start mining", "destructive");
            authModal.style.display = "flex";
            return;
        }

        isMining = true;
        miningStatus.textContent = "Active";
        miningStatus.className = "inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/50";

        toggleMiningBtn.textContent = "Stop Mining";

        miningInterval = setInterval(async () => {
            const miningSpeed = window.currentUser.profile.mining_speed || 1;
            const basePoints = (deviceScore / 100) * boosterSpeed * miningSpeed;
            points += basePoints;
            console.log(`Points earned: ${basePoints.toFixed(2)}, Total points: ${points.toFixed(2)}`);

            if (userPoints) userPoints.textContent = points.toFixed(2);
            if (currentPoints) currentPoints.textContent = points.toFixed(2);

            await syncPointsToSupabase();
        }, 5000);
    }

    // Hentikan proses mining
    function stopMining() {
        isMining = false;
        miningStatus.textContent = "Inactive";
        miningStatus.className = "inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-400 border border-red-500/50";

        toggleMiningBtn.textContent = "Start Mining";

        clearInterval(miningInterval);
        miningInterval = null;

        syncPointsToSupabase();
    }

    // Enhanced Mining Toggle Button with Elegant UI
    toggleMiningBtn.addEventListener("click", (e) => {
        const ripple = document.createElement("span");
        ripple.className = "mining-ripple";
        ripple.style.left = `${e.clientX - e.target.getBoundingClientRect().left}px`;
        ripple.style.top = `${e.clientY - e.target.getBoundingClientRect().top}px`;
        e.target.appendChild(ripple);
        
        setTimeout(() => ripple.remove(), 600);
        
        if (isMining) {
            toggleMiningBtn.classList.add("stopping");
            setTimeout(() => {
                stopMining();
                toggleMiningBtn.classList.remove("stopping");
                toggleMiningBtn.classList.add("starting");
                setTimeout(() => toggleMiningBtn.classList.remove("starting"), 300);
            }, 200);
        } else {
            toggleMiningBtn.classList.add("starting");
            setTimeout(() => {
                startMining();
                toggleMiningBtn.classList.remove("starting");
            }, 200);
        }
    });

    // === INISIALISASI SAAT HALAMAN SIAP ===
    document.addEventListener("DOMContentLoaded", async () => {
        calculateDeviceScore();

        // Inisialisasi boosterSpeed dari profil pengguna
        boosterSpeed = window.currentUser && window.currentUser.profile && window.currentUser.profile.booster ? boosterConfig[window.currentUser.profile.booster]?.speed || 1 : 1;

        // Ambil poin dari localStorage sebagai inisialisasi awal
        const storedPoints = localStorage.getItem("mining_points");
        points = storedPoints ? parseFloat(storedPoints) : 0;
        console.log(`Points initialized from localStorage: ${points}`);

        if (userPoints) userPoints.textContent = points.toFixed(2);
        if (currentPoints) currentPoints.textContent = points.toFixed(2);

        await checkUser();

        // Sinkronkan poin setelah checkUser selesai
        if (window.currentUser) {
            await syncPointsToSupabase();
            if (userPoints) userPoints.textContent = points.toFixed(2);
            if (currentPoints) currentPoints.textContent = points.toFixed(2);
        }
    });

    // START: Fungsi checkUser (versi perbaikan)
async function checkUser() {
    try {
        console.log('Memulai pengecekan pengguna...');
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();
        if (sessionError) throw sessionError;

        if (session && session.user) {
            const user = session.user;
            console.log('Pengguna ditemukan:', user);

            window.currentUser = user;

            // Ambil profil pengguna
            const { data: profileData, error: profileError } = await supabase
                .from("profiles")
                .select("id, email, points, wallet_address, avatar_url, full_name, booster, referral_code, mining_speed, invited_users")
                .eq("id", user.id)
                .single();

            if (profileError) {
                if (profileError.code === "PGRST116") {
                    // Profil belum ada → buat profil baru
                    console.log("Profil tidak ditemukan. Membuat profil baru...");

                    const fullName = user.user_metadata.full_name || user.email.split("@")[0];
                    const generatedReferralCode = await generateReferralCode();

                    // Gunakan nilai points dari localStorage atau default 0
                    const initialPoints = parseInt(localStorage.getItem("mining_points")) || 0;

                    const { error: insertError } = await supabase.from("profiles").insert({
                        id: user.id,
                        email: user.email,
                        points: initialPoints,
                        wallet_address: null,
                        avatar_url: null,
                        full_name: fullName,
                        booster: 0,
                        referral_code: generatedReferralCode,
                        mining_speed: 0,
                        invited_users: 0
                    });

                    if (insertError) throw insertError;

                    // Ambil kembali profil setelah dibuat
                    const { data: newProfile } = await supabase
                        .from("profiles")
                        .select("id, email, points, wallet_address, avatar_url, full_name, booster, referral_code, mining_speed, invited_users")
                        .eq("id", user.id)
                        .single();

                    window.currentUser.profile = newProfile;

                    points = newProfile.points; // Update variabel global points
                    localStorage.setItem("mining_points", points.toString());

                } else {
                    // Error lain selain PGRST116
                    throw profileError;
                }
            } else {
                // Profil ditemukan → gunakan datanya
                window.currentUser.profile = profileData;
                points = profileData.points !== undefined ? profileData.points : points || 0;
                localStorage.setItem("mining_points", points.toString());
                console.log(`Points loaded from Supabase: ${points}`);
            }

            console.log('Data profil lengkap:', window.currentUser.profile);

            // Setup realtime subscription
            const channel = supabase
                .channel(`profiles:${user.id}`)
                .on(
                    'postgres_changes',
                    {
                        event: 'UPDATE',
                        schema: 'public',
                        table: 'profiles',
                        filter: `id=eq.${user.id}`,
                    },
                    (payload) => {
                        console.log('Realtime update received:', payload);
                        const updatedProfile = payload.new;

                        if (updatedProfile.points !== undefined) {
                            points = updatedProfile.points;
                            localStorage.setItem("mining_points", points.toString());
                        }

                        window.currentUser.profile = {
                            ...window.currentUser.profile,
                            ...updatedProfile
                        };

                        updateUI();
                    }
                )
                .subscribe();

            // Hapus channel saat halaman ditutup
            window.addEventListener('beforeunload', () => {
                supabase.removeChannel(channel);
            });

            updateUI();
            authModal.style.display = "none";
            showPage("dashboard");

        } else {
            // Tidak ada session aktif
            window.currentUser = null;
            console.log('Tidak ada sesi pengguna.');
            updateUI();
            authModal.style.display = "flex";
        }

    } catch (error) {
        console.error('Error dalam checkUser:', error);
        showToast("Error", "Failed to load user profile.", "destructive");
        window.currentUser = null;
        updateUI();
        authModal.style.display = "flex";
    }
}

    // START: Fungsi untuk memperbarui UI
    function updateUI() {
        const referralSpeed = document.getElementById('referralSpeed');
        const userProfile = document.getElementById('userProfile');
        const userSection = document.getElementById('userSection');
        const userEmail = document.getElementById('userEmail');
        const userWallet = document.getElementById('userWallet');
        const userPoints = document.getElementById('userPoints');
        const userBooster = document.getElementById('userBooster');
        const deviceScoreEl = document.getElementById('deviceScore');
        const currentPoints = document.getElementById('currentPoints');
        const currentDeviceScore = document.getElementById('currentDeviceScore');
        const currentBooster = document.getElementById('currentBooster');
        const emailDisplay = document.getElementById('emailDisplay');
        const fullNameInput = document.getElementById('fullNameInput');
        const walletAddressInput = document.getElementById('walletAddressInput');
        const profilePicturePreview = document.getElementById('profilePicturePreview');
        const sidebarProfilePicture = document.getElementById('sidebarProfilePicture');
        const invitedUsersCount = document.getElementById('invitedUsersCount');

        if (!referralSpeed || !userSection || !userProfile) {
            console.error('Required DOM elements not found:', { referralSpeed, userSection, userProfile });
            return;
        }

        console.log('Updating UI...');
        console.log('Current points:', points);

        if (window.currentUser && window.currentUser.profile) {
            user = window.currentUser;
            boosterSpeed = window.currentUser.profile.booster ? boosterConfig[window.currentUser.profile.booster]?.speed || 1 : 1;

            userProfile.classList.remove('hidden');
            userSection.innerHTML = `
                <div class="flex items-center space-x-2">
                    <div class="h-8 w-8 rounded-full bg-slate-700 text-cyan-500 flex items-center justify-center">
                        ${window.currentUser.profile.full_name ? window.currentUser.profile.full_name[0].toUpperCase() : window.currentUser.email[0].toUpperCase()}
                    </div>
                    <button id="logoutBtn" class="text-slate-100 bg-red-600 hover:bg-red-700 rounded-md px-3 py-1.5 flex items-center">
                        <i data-lucide="log-out" class="h-4 w-4 mr-2"></i> Logout
                    </button>
                </div>
            `;

            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
                console.log('Logout button event listener added');
            } else {
                console.error('Logout button not found after rendering');
            }

            const speed = window.currentUser.profile.mining_speed || 0;
            referralSpeed.textContent = `${speed}x`;
            referralSpeed.classList.toggle('text-cyan-400', speed > 0);
            referralSpeed.classList.toggle('text-slate-400', speed === 0);

            if (userEmail) userEmail.textContent = window.currentUser.profile.email || window.currentUser.email;
            if (userWallet) userWallet.textContent = window.currentUser.profile.wallet_address || 'Not set';
            if (userPoints) userPoints.textContent = points.toFixed(2);
            if (userBooster) userBooster.textContent = window.currentUser.profile.booster
                ? window.currentUser.profile.booster.charAt(0).toUpperCase() + window.currentUser.profile.booster.slice(1)
                : 'None';
            if (deviceScoreEl) deviceScoreEl.textContent = deviceScore.toFixed(2);
            if (currentPoints) currentPoints.textContent = points.toFixed(2);
            if (currentDeviceScore) currentDeviceScore.textContent = deviceScore.toFixed(2);
            if (currentBooster) currentBooster.textContent = window.currentUser.profile.booster
                ? window.currentUser.profile.booster.charAt(0).toUpperCase() + window.currentUser.profile.booster.slice(1)
                : 'None';
            if (emailDisplay) emailDisplay.value = window.currentUser.profile.email || window.currentUser.email;
            if (fullNameInput) fullNameInput.value = window.currentUser.profile.full_name || '';
            if (walletAddressInput) walletAddressInput.value = window.currentUser.profile.wallet_address || '';
            if (invitedUsersCount) invitedUsersCount.textContent = window.currentUser.profile.invited_users || 0;

            if (window.currentUser.profile.avatar_url) {
                const { data: avatarData, error: avatarError } = supabase.storage
                    .from('avatars')
                    .getPublicUrl(window.currentUser.profile.avatar_url);
                if (avatarError) {
                    console.error('Avatar fetch error:', avatarError);
                } else if (avatarData.publicUrl) {
                    if (profilePicturePreview) profilePicturePreview.innerHTML = `<img src="${avatarData.publicUrl}" class="h-24 w-24 rounded-full object-cover" alt="Profile" />`;
                    if (sidebarProfilePicture) sidebarProfilePicture.innerHTML = `<img src="${avatarData.publicUrl}" class="h-12 w-12 rounded-full object-cover" alt="Profile" />`;
                }
            }

            lucide.createIcons();
            authModal.style.display = 'none';
        } else {
            userProfile.classList.add('hidden');
            userSection.innerHTML = `
                <button id="loginBtn" class="text-slate-100 bg-cyan-600 hover:bg-cyan-700 rounded-md px-3 py-1.5 flex items-center">
                    <i data-lucide="user" class="h-4 w-4 mr-2"></i> Login
                </button>
            `;

            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
                loginBtn.addEventListener('click', () => {
                    authModal.style.display = 'flex';
                });
            }

            referralSpeed.textContent = '0x';
            referralSpeed.classList.add('text-slate-400');

            if (currentBooster) {
                currentBooster.textContent = 'None';
                currentBooster.classList.add('text-amber-400');
            }

            lucide.createIcons();
        }
    }

    // START: Event listener navigasi
navDashboard.addEventListener("click", () => showPage("dashboard"));
navBooster.addEventListener("click", () => {
    if (!window.currentUser) {
        showToast("Error", "Please login to access Booster", "destructive");
        authModal.style.display = "flex";
        return;
    }
    showPage("booster");
});
navLeaderboard.addEventListener("click", () => showPage("leaderboard"));
navCommunications.addEventListener("click", () => {
    if (!window.currentUser) {
        showToast("Error", "Please login to access Communications", "destructive");
        authModal.style.display = "flex";
        return;
    }
    showPage("communications");
});
navSettings.addEventListener("click", () => {
    if (!window.currentUser) {
        showToast("Error", "Please login to access Settings", "destructive");
        authModal.style.display = "flex";
        return;
    }
    showPage("settings");
});
navSecurity.addEventListener("click", () => {
    if (!window.currentUser) {
        showToast("Error", "Please login to access Security", "destructive");
        authModal.style.display = "flex";
        return;
    }
    showPage("security");
});
navDataCenter.addEventListener("click", () => {
    if (!window.currentUser) {
        showToast("Error", "Please login to access Data Center", "destructive");
        authModal.style.display = "flex";
        return;
    }
    showPage("dataCenter");
});
navNetwork.addEventListener("click", () => {
    if (!window.currentUser) {
        showToast("Error", "Please login to access Network", "destructive");
        authModal.style.display = "flex";
        return;
    }
    showPage("network");
});
// END: Event listener navigasi





// END: Event listener navigasi
    // START: Fungsi untuk menangani logout
    async function handleLogout() {
        try {
            // Hentikan mining jika sedang berjalan
            if (isMining) {
                stopMining();
            }

            // Sinkronkan poin sebelum logout
            await syncPointsToSupabase();

            // Reset status mining
            isMining = false;
            localStorage.setItem("isMining", "false");

            const { error } = await supabase.auth.signOut();
            if (error) throw error;

            user = null;
            window.currentUser = null;
            authModal.style.display = "flex";
            showToast("Success", "Logged out successfully");
            updateUI();
            showPage("dashboard");
        } catch (error) {
            console.error("Logout error:", error);
            showToast("Error", "Failed to logout", "destructive");
        }
    }

    // START: Fungsi untuk mereset semua error pada form
    function clearErrors() {
        document.querySelectorAll(".input-error").forEach(el => el.classList.remove("input-error"));
        document.querySelectorAll(".shake").forEach(el => el.classList.remove("shake"));
        document.querySelectorAll(".error-message").forEach(el => {
            el.textContent = "";
            el.classList.add("hidden");
        });
    }

    // START: Fungsi untuk menampilkan error pada input tertentu
    function showError(inputElement, message) {
        const parent = inputElement.closest(".relative") || inputElement.parentElement;
        const errorDiv = parent.querySelector(".error-message");
        if (!inputElement.classList.contains("input-error")) {
            inputElement.classList.add("input-error");
        }
        inputElement.classList.add("shake");
        setTimeout(() => inputElement.classList.remove("shake"), 500);
        if (errorDiv) {
            errorDiv.textContent = message;
            errorDiv.classList.remove("hidden");
        }
    }

    // START: Fungsi untuk menampilkan atau menyembunyikan pesan error pada input
    function toggleError(inputElement, hasError, message = "") {
        const parent = inputElement.closest(".relative") || inputElement.parentElement;
        const errorDiv = parent.querySelector(".error-message");

        if (hasError) {
            inputElement.classList.add("input-error", "shake");
            setTimeout(() => inputElement.classList.remove("shake"), 500);
            if (errorDiv) {
                errorDiv.innerHTML = `<span class="error-text"><i class="fas fa-exclamation-circle"></i> ${message}</span>`;
                errorDiv.classList.remove("hidden");
            }
        } else {
            inputElement.classList.remove("input-error", "shake");
            if (errorDiv) {
                errorDiv.innerHTML = "";
                errorDiv.classList.add("hidden");
            }
        }
    }

    // START: Fungsi untuk membuat kode referral acak dan memastikan unik
    async function generateReferralCode() {
        let unique = false;
        let newCode;
        while (!unique) {
            const randomNumbers = Math.floor(10000 + Math.random() * 90000);
            newCode = `AQULA${randomNumbers}`;
            const { data, error } = await supabase
                .from("profiles")
                .select("referral_code")
                .eq("referral_code", newCode);
            if (error) {
                console.error("Error checking referral code uniqueness:", error);
                throw error;
            }
            if (!data || data.length === 0) unique = true;
        }
        return newCode;
    }

    // START: Fungsi untuk memvalidasi kode referral
    async function validateReferralCode(code) {
        if (!code) return { valid: true, referrer: null };
        const { data, error } = await supabase
            .from("profiles")
            .select("id")
            .eq("referral_code", code)
            .single();
        if (error || !data) {
            return { valid: false, referrer: null };
        }
        return { valid: true, referrer: data.id };
    }

    // START: Fungsi untuk memeriksa apakah email sudah terdaftar
    async function checkEmailExists(email) {
        const { data, error } = await supabase
            .from("profiles")
            .select("email")
            .eq("email", email);
        if (error) {
            console.error("Error checking email:", error);
            throw error;
        }
        return data && data.length > 0;
    }

    // START: Regex untuk validasi password kuat
    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;

    // START: Validasi real-time untuk input email dan password
    document.getElementById("emailInput")?.addEventListener("input", function () {
        const value = this.value.trim();
        const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        toggleError(this, !isValid, "Masukkan alamat email yang valid.");
    });

    document.getElementById("passwordInput")?.addEventListener("input", function () {
        const value = this.value;
        const isValid = value.length >= 6;
        toggleError(this, !isValid, "Kata sandi harus minimal 6 karakter.");
    });

    document.getElementById("regEmailInput")?.addEventListener("input", async function () {
        const value = this.value.trim();
        const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        if (!isValid) {
            toggleError(this, true, "Masukkan alamat email yang valid.");
            return;
        }

        try {
            const emailExists = await checkEmailExists(value);
            toggleError(this, emailExists, "Email sudah terdaftar. Gunakan email lain atau login.");
        } catch (error) {
            toggleError(this, true, "Gagal memeriksa email. Coba lagi.");
        }
    });

    document.getElementById("regPasswordInput")?.addEventListener("input", function () {
        const value = this.value;
        const isValid = passwordRegex.test(value);
        toggleError(this, !isValid, "Kata sandi harus mengandung huruf besar, huruf kecil, angka, dan karakter khusus.");
    });

    document.getElementById("referralInput")?.addEventListener("input", async function () {
        const value = this.value.trim();
        if (value) {
            const { valid } = await validateReferralCode(value);
            toggleError(this, !valid, "Kode referral tidak valid.");
        } else {
            toggleError(this, false);
        }
    });

    // START: Toggle show/hide password
    document.querySelectorAll('.show-password').forEach(btn => {
        btn.addEventListener("click", function (e) {
            e.preventDefault();
            const targetId = this.getAttribute("data-target");
            if (!targetId) return;
            const input = document.getElementById(targetId);
            if (!input) return;
            const isPassword = input.type === "password";
            input.type = isPassword ? "text" : "password";
            const svg = this.querySelector("svg");
            if (!svg) return;
            svg.innerHTML = isPassword
                ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.975 9.975 0 011.689-2.908m2.121 2.121A3 3 0 1015 12a3 3 0 00-4.242 0m6.366 6.366A10.05 10.05 0 0012 19c-4.478 0-8.268-2.943-9.542-7a9.975 9.975 0 011.689-2.908m2.121 2.121A3 3 0 1015 12a3 3 0 00-4.242 0m6.366 6.366l2.121-2.121" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />`
                : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />`;
        });
    });

    // START: Event listener for email login button
emailAuthBtn.addEventListener("click", async () => {
    let hasError = false;
    const email = document.getElementById("emailInput").value.trim();
    const password = document.getElementById("passwordInput").value;
    clearErrors();

    const emailField = document.getElementById("emailInput");
    const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    toggleError(emailField, !emailValid, "Please enter a valid email address.");
    if (!emailValid) hasError = true;

    const passwordField = document.getElementById("passwordInput");
    const passwordValid = password.length >= 6;
    toggleError(passwordField, !passwordValid, "Password must be at least 6 characters.");
    if (!passwordValid) hasError = true;

    if (hasError) return;

    try {
        const { error } = await supabase.auth.signInWithPassword({ email, password });

        if (error) {
            if (error.message.includes("Invalid login credentials")) {
                // Wrong password
                toggleError(passwordField, true, "Incorrect password");
                showToast("Error", "Incorrect password", "destructive");
            } else if (error.message.includes("User not found")) {
                // Email not found
                toggleError(emailField, true, "Email not found");
                showToast("Error", "Email not found", "destructive");
            } else {
                // Other errors
                showToast("Error", error.message || "Failed to log in. Please check your email and password.", "destructive");
            }
            return;
        }

        showToast("Success", "Login successful.");
        authModal.style.display = "none";
        await checkUser();
    } catch (error) {
        showToast("Error", error.message || "An error occurred. Please try again.", "destructive");
    }
});

    // START: Event listener untuk tombol register
    registerBtn.addEventListener("click", async () => {
        let hasError = false;
        const email = document.getElementById("regEmailInput").value.trim();
        const password = document.getElementById("regPasswordInput").value;
        const fullName = document.getElementById("fullNameInput").value.trim();
        const referralCode = document.getElementById("referralInput")?.value.trim();
        const successMessage = document.getElementById("successMessage");

        clearErrors();

        const emailField = document.getElementById("regEmailInput");
        const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        toggleError(emailField, !emailValid, "Enter a valid email address.");
        if (!emailValid) hasError = true;

        const emailExists = await checkEmailExists(email);
        if (emailExists) {
            toggleError(emailField, true, "Email already registered. Use another email or login.");
            hasError = true;
        }

        const passwordField = document.getElementById("regPasswordInput");
        const passwordValid = passwordRegex.test(password);
        toggleError(passwordField, !passwordValid, "Passwords must contain uppercase letters, lowercase letters, numbers, and special characters.");
        if (!passwordValid) hasError = true;

        const fullNameField = document.getElementById("fullNameInput");
        const fullNameValid = fullName.length > 0;
        toggleError(fullNameField, !fullNameValid, "Full name required.");
        if (!fullNameValid) hasError = true;

        const referralField = document.getElementById("referralInput");
        let referralValid = true;
        let referrerId = null;
        if (referralCode) {
            const { valid, referrer } = await validateReferralCode(referralCode);
            referralValid = valid;
            referrerId = referrer;
            toggleError(referralField, !valid, "Invalid referral code.");
            if (!valid) hasError = true;
        }

        if (hasError) return;

        try {
            registerBtn.classList.add("loading");
            registerBtn.disabled = true;
            registerBtn.innerHTML = `<svg class="animate-spin h-5 w-5 mr-2 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8h-8z"></path>
            </svg> Processing...`;

            const { data, error: signUpError } = await supabase.auth.signUp({
                email,
                password,
                options: {
                    redirectTo: `${window.location.origin}/confirm`,
                    data: { full_name: fullName }
                }
            });
            if (signUpError) {
                showToast("Error", signUpError.message || "Registration failed. Try again.", "destructive");
                registerBtn.classList.remove("loading");
                registerBtn.disabled = false;
                registerBtn.innerHTML = `<span class="group-hover:translate-x-1 transition-transform">Create Account</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>`;
                return;
            }

            const generatedReferralCode = await generateReferralCode();
            const userId = data.user.id;
            const initialPoints = referralCode ? 500 : 0;
            const { error: profileError, data: profileData } = await supabase.from("profiles").insert({
                id: userId,
                email: email,
                points: initialPoints,
                wallet_address: null,
                booster: null,
                avatar_url: null,
                full_name: fullName,
                referral_code: generatedReferralCode,
                referred_by: referralCode || null,
                mining_speed: 0,
                invited_users: 0
            }).select();

            if (profileError) {
                showToast("Error", profileError.message || "Failed to save profile.", "destructive");
                registerBtn.classList.remove("loading");
                registerBtn.disabled = false;
                registerBtn.innerHTML = `<span class="group-hover:translate-x-1 transition-transform">Create Account</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>`;
                return;
            }

            if (referralCode && referrerId) {
                const { data: referrerData, error: fetchError } = await supabase
                    .from("profiles")
                    .select("points, mining_speed, invited_users")
                    .eq("id", referrerId)
                    .single();

                if (fetchError) {
                    console.error("Error fetching referrer data:", fetchError.message);
                    showToast("Error", "Failed to retrieve referrer data.", "destructive");
                } else {
                    const currentMiningSpeed = referrerData.mining_speed || 0;
                    const newMiningSpeed = currentMiningSpeed + 1;
                    const currentInvitedUsers = referrerData.invited_users || 0;
                    const newInvitedUsers = currentInvitedUsers + 1;

                    const { error: referrerError } = await supabase
                        .from("profiles")
                        .update({
                            points: (referrerData.points || 0) + 1000,
                            mining_speed: newMiningSpeed,
                            invited_users: newInvitedUsers
                        })
                        .eq("id", referrerId);

                    if (referrerError) {
                        console.error("Referrer reward error:", referrerError.message);
                        showToast("Error", "Failed to provide referral rewards.", "destructive");
                    } else {
                        console.log(`Updated referrer (ID: ${referrerId}) - Points: ${(referrerData.points || 0) + 1000}, Mining Speed: ${newMiningSpeed}, Invited Users: ${newInvitedUsers}`);
                    }
                }
            }

            registerBtn.classList.remove("loading");
            registerBtn.classList.add("success");
            registerBtn.innerHTML = `<svg class="h-5 w-5 mr-2 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg> Success!`;

            if (successMessage) {
                successMessage.classList.remove("hidden");
                successMessage.innerHTML = `
                    <div class="flex items-center justify-center space-x-3 text-green-400 animate-fade-in">
                        <svg class="h-8 w-8 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <div>
                            <p class="text-lg font-semibold">Registrasi Berhasil!</p>
                            <p class="text-sm text-slate-400">Silakan periksa ${email} untuk konfirmasi (cek folder spam jika tidak ada).</p>
                        </div>
                    </div>
                `;
                loginForm.classList.add("hidden");
                registerForm.classList.add("hidden");
            }

            setTimeout(async () => {
                registerBtn.classList.remove("success");
                registerBtn.disabled = false;
                registerBtn.innerHTML = `<span class="group-hover:translate-x-1 transition-transform">Create Account</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                    </svg>`;
                document.getElementById("regEmailInput").value = "";
                document.getElementById("regPasswordInput").value = "";
                document.getElementById("fullNameInput").value = "";
                document.getElementById("referralInput").value = "";
                if (successMessage) successMessage.classList.add("hidden");
                loginForm.classList.remove("hidden");
                registerForm.classList.remove("hidden");
                await checkUser();
            }, 5000);
        } catch (error) {
            console.error("Authentication error:", error.message);
            showToast("Error", error.message || "An error occurred. Try again.", "destructive");
            registerBtn.classList.remove("loading");
            registerBtn.disabled = false;
            registerBtn.innerHTML = `<span class="group-hover:translate-x-1 transition-transform">Create Account</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                </svg>`;
        }
    });

    

    // START: Event listener untuk tombol Google Auth
googleAuthBtn.addEventListener("click", async () => {
    try {
        const { data, error } = await supabase.auth.signInWithOAuth({
            provider: "google",
            options: { redirectTo: window.location.origin }
        });

        if (error) throw error;

        // Tunggu sampai session tersedia
        const {
            data: { session },
        } = await supabase.auth.getSession();

        if (!session?.user) throw new Error("Unable to get a session");

        const user = session.user;

        // Cek apakah profil sudah ada
        const { data: profileData, error: fetchError } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", user.id)
            .single();

        if (fetchError && fetchError.code === "PGRST116") {
            // Profil belum ada, buat profil baru
            const generatedReferralCode = await generateReferralCode();
            const fullName = user.user_metadata.full_name || user.email.split("@")[0];

            const { error: insertError } = await supabase.from("profiles").insert({
                id: user.id,
                email: user.email,
                points: 0,
                wallet_address: null,
                booster: null,
                avatar_url: null,
                full_name: fullName,
                referral_code: generatedReferralCode,
                mining_speed: 0,
            });

            if (insertError) throw insertError;
        }

        // Tutup modal dan update UI
        authModal.style.display = "none";
        showToast("Success”, ”Successful login.");
        await checkUser(); // Pastikan fungsi ini ada dan benar
    } catch (error) {
        showToast("Error", error.message || "Google authentication failed.", "destructive");
    }
});

    // START: Fungsi untuk menangani autentikasi wallet
    async function handleWalletAuth(walletType) {
        try {
            let walletAddress;
            switch (walletType) {
                case "metamask":
                    if (!window.ethereum) {
                        showToast("Error", "Please install MetaMask.", "destructive");
                        return;
                    }
                    [walletAddress] = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    break;
                case "phantom":
                    if (!window.solana || !window.solana.isPhantom) {
                        showToast("Error", "Please install Phantom.", "destructive");
                        return;
                    }
                    const res = await window.solana.connect();
                    walletAddress = res.publicKey.toString();
                    break;
                case "okx":
                    if (!window.okxwallet) {
                        showToast("Error", "Please install OKX Wallet.", "destructive");
                        return;
                    }
                    const accounts = await window.okxwallet.request({ method: 'eth_requestAccounts' });
                    walletAddress = accounts[0];
                    break;
                default:
                    throw new Error("Invalid wallet type.");
            }

            const { data: { session }, error: sessionError } = await supabase.auth.getSession();
            if (sessionError || !session || !session.user) {
                showToast("Error", "Please login with email first.", "destructive");
                authModal.style.display = "flex";
                return;
            }

            const { error: updateError } = await supabase
                .from("profiles")
                .update({ wallet_address: walletAddress })
                .eq("id", session.user.id);

            if (updateError) throw updateError;

            user.wallet_address = walletAddress;
            updateUI();
            showToast("Success", `${walletType} successfully connected.`);
        } catch (error) {
            showToast("Error", error.message || "Failed to connect wallet.", "destructive");
        }
    }

    // START: Event listener untuk tombol autentikasi wallet
    metamaskAuthBtn.addEventListener("click", () => handleWalletAuth("metamask"));
    phantomAuthBtn.addEventListener("click", () => handleWalletAuth("phantom"));
    okxAuthBtn.addEventListener("click", () => handleWalletAuth("okx"));

    // START: Event listener untuk toggle form autentikasi (login/register)
    toggleAuthBtn.addEventListener("click", () => {
        isLogin = !isLogin;
        loginForm.classList.toggle("hidden", !isLogin);
        registerForm.classList.toggle("hidden", isLogin);
        emailAuthBtn.querySelector("span").textContent = isLogin ? "Continue" : "Create Account";
        toggleAuthBtn.innerHTML = isLogin
            ? 'Need an account? <span class="underline">Register here</span>'
            : 'Already have an account? <span class="underline">Login here</span>';
        fullNameGroup.classList.toggle("hidden", isLogin);
        referralCodeGroup.classList.toggle("hidden", isLogin);
    });

    // START: Event listener untuk toggle tema (dark/light)
    const themeToggle = document.getElementById("themeToggle");
    if (themeToggle) {
        themeToggle.addEventListener("click", () => {
            document.documentElement.classList.toggle("dark");
            const currentTheme = document.documentElement.classList.contains("dark") ? "dark" : "light";
            localStorage.setItem("theme", currentTheme);
            themeToggle.innerHTML = `<i data-lucide="${currentTheme === "dark" ? "moon" : "sun"}" class="h-5 w-5"></i>`;
            lucide.createIcons();
        });
    }

    // START: Event listener untuk menutup modal autentikasi
    document.getElementById("closeAuthModal")?.addEventListener("click", () => {
        authModal.style.display = "none";
    });

    // START: Event listener untuk tombol "Forgot password?"
    document.getElementById("forgotPasswordBtn")?.addEventListener("click", () => {
        loginForm.classList.add("hidden");
        registerForm.classList.add("hidden");
        document.getElementById("forgotPasswordForm").classList.remove("hidden");
    });

    // START: Event listener untuk tombol "Back to Login"
    document.getElementById("backToLoginBtn")?.addEventListener("click", () => {
        document.getElementById("forgotPasswordForm").classList.add("hidden");
        loginForm.classList.remove("hidden");
    });

    // START: Event listener untuk tombol reset password
    document.getElementById("resetPasswordBtn")?.addEventListener("click", async () => {
    const email = document.getElementById("resetEmailInput")?.value.trim();
    const emailField = document.getElementById("resetEmailInput");

    clearErrors();

    const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    toggleError(emailField, !emailValid, "Enter a valid email address.");
    if (!emailValid) return;

    try {
        const { error } = await supabase.auth.resetPasswordForEmail(email, {
            redirectTo: `${window.location.origin}/reset-password`
        });

        if (error) {
            toggleError(emailField, true, error.message || "Failed to send password reset request.");
            return;
        }

        // Panggil showToast setelah Success
        showToast("Success", "A password reset link has been sent to your email. Check your spam folder if it's not there.", "success");

        // Sembunyikan form lupa password & tampilkan login
        const forgotPasswordForm = document.getElementById("forgotPasswordForm");
        const loginForm = document.getElementById("loginForm");

        if (forgotPasswordForm) forgotPasswordForm.classList.add("hidden");
        if (loginForm) loginForm.classList.remove("hidden");

    } catch (err) {
        console.error("Reset password error:", err);
        toggleError(emailField, true, err.message || "An error occurred. Please try again.");
    }
});
})();
        // END: Event listener untuk menutup modal autentikasi















        
      
       // Namespace untuk System Overview
       const SystemOverview = {
            // Inisialisasi variabel
            cpuUsage: 0,
            memoryUsage: 0,
            networkStatus: 0,
            isBenchmarkRunning: false,

            // Inisialisasi elemen DOM
            elements: {
                cpuUsageEl: document.getElementById('cpuUsage'),
                cpuBar: document.querySelector('.cpu-bar'),
                cpuInfoEl: document.querySelector('.cpu-info'),
                memoryUsageEl: document.getElementById('memoryUsage'),
                memoryBar: document.querySelector('.memory-bar'),
                networkUsageEl: document.getElementById('networkUsage'),
                networkBar: document.querySelector('.network-bar')
            },

            // Fungsi untuk mengukur beban CPU (simulasi)
            async measureCPULoad() {
                const start = performance.now();
                let i = 0;
                while (i < 1e6) {
                    Math.random();
                    i++;
                }
                const end = performance.now();
                const duration = end - start;
                return Math.min(100, (duration / 10) * 100);
            },

            // Fungsi untuk memperbarui informasi CPU
            updateCPUInfo() {
                const coreCount = navigator.hardwareConcurrency || 'Unknown';
                if (this.elements.cpuInfoEl) {
                    this.elements.cpuInfoEl.textContent = `Varies by device | ${coreCount} Cores`;
                }
            },

            // Fungsi untuk mensimulasikan beban CPU menggunakan Worker
            simulateHeavyTask() {
                if (this.isBenchmarkRunning) return;

                this.isBenchmarkRunning = true;

                const workerCode = `
                    self.onmessage = function () {
                        let i = 0;
                        while (i < 1e8) {
                            Math.sqrt(i);
                            i++;
                        }
                        self.postMessage("done");
                    };
                `;

                try {
                    const blob = new Blob([workerCode], { type: "application/javascript" });
                    const workerURL = URL.createObjectURL(blob);
                    const worker = new Worker(workerURL);

                    worker.onmessage = async () => {
                        await new Promise(r => setTimeout(r, 500));
                        this.isBenchmarkRunning = false;
                        URL.revokeObjectURL(workerURL);
                        worker.terminate();
                    };

                    worker.onerror = (error) => {
                        console.error('Worker error:', error);
                        this.isBenchmarkRunning = false;
                        URL.revokeObjectURL(workerURL);
                        worker.terminate();
                    };

                    worker.postMessage("start");
                } catch (e) {
                    console.error('Failed to create worker:', e);
                    this.isBenchmarkRunning = false;
                }
            },

            // Fungsi untuk memperbarui UI System Overview
            async update() {
                try {
                    if (!this.isBenchmarkRunning) this.simulateHeavyTask();

                    this.cpuUsage = await this.measureCPULoad();
                    if (this.elements.cpuUsageEl) {
                        this.elements.cpuUsageEl.innerHTML = `${this.cpuUsage.toFixed(0)}<span class="text-lg text-slate-400 ml-1">%</span>`;
                    }
                    if (this.elements.cpuBar) this.elements.cpuBar.style.width = `${this.cpuUsage}%`;

                    if (performance && performance.memory) {
                        const mem = performance.memory;
                        const used = (mem.usedJSHeapSize / mem.jsHeapSizeLimit) * 100;
                        this.memoryUsage = Math.min(100, used);
                        if (this.elements.memoryUsageEl) {
                            this.elements.memoryUsageEl.innerHTML = `${this.memoryUsage.toFixed(0)}<span class="text-lg text-slate-400 ml-1">%</span>`;
                            this.elements.memoryUsageEl.nextElementSibling.innerHTML = `${(mem.usedJSHeapSize / 1e9).toFixed(1)} GB / ${(mem.jsHeapSizeLimit / 1e9).toFixed(1)} GB`;
                        }
                        if (this.elements.memoryBar) this.elements.memoryBar.style.width = `${this.memoryUsage}%`;
                    } else {
                        if (this.elements.memoryUsageEl) this.elements.memoryUsageEl.innerHTML = `N/A`;
                        if (this.elements.memoryBar) this.elements.memoryBar.style.width = `0%`;
                    }

                    if (navigator.connection) {
                        const { downlink } = navigator.connection;
                        this.networkStatus = Math.min(100, (downlink / 10) * 100);
                        if (this.elements.networkUsageEl) {
                            this.elements.networkUsageEl.innerHTML = `${this.networkStatus.toFixed(0)}<span class="text-lg text-slate-400 ml-1">%</span>`;
                            this.elements.networkUsageEl.nextElementSibling.innerHTML = `${downlink.toFixed(1)} MB/s | ${navigator.connection.rtt || 'N/A'} ms`;
                        }
                        if (this.elements.networkBar) this.elements.networkBar.style.width = `${this.networkStatus}%`;
                    } else {
                        this.networkStatus = Math.min(Math.max(this.networkStatus + (Math.random() * 4 - 2), 0), 100);
                        if (this.elements.networkUsageEl) {
                            this.elements.networkUsageEl.innerHTML = `${this.networkStatus.toFixed(0)}<span class="text-lg text-slate-400 ml-1">%</span>`;
                        }
                        if (this.elements.networkBar) this.elements.networkBar.style.width = `${this.networkStatus}%`;
                    }
                } catch (error) {
                    console.error('Error updating system overview:', error);
                }
            },

            // Fungsi untuk memulai monitoring
            startMonitoring() {
                setInterval(async () => {
                    await this.update();
                }, 3000);
            }
        };

        // Namespace untuk Performance Chart Tabs
        const PerformanceChartTabs = {
            // Inisialisasi variabel
            chartInstance: null,
            chartData: {
                labels: [],
                cpu: [],
                memory: [],
                network: []
            },

            // Inisialisasi elemen DOM
            elements: {
                tabPerformance: document.getElementById('tabPerformance'),
                tabProcesses: document.getElementById('tabProcesses'),
                tabStorage: document.getElementById('tabStorage'),
                performanceTab: document.getElementById('performanceTab'),
                processesTab: document.getElementById('processesTab'),
                storageTab: document.getElementById('storageTab'),
                processesTable: document.getElementById('processesTable'),
                storageInfo: document.getElementById('storageInfo'),
                systemLoadEl: document.getElementById('systemLoad')
            },

            // Inisialisasi Chart.js
            initChart() {
                const chartCanvas = document.getElementById('performanceChartTab');
                if (!chartCanvas) {
                    console.error('Chart canvas not found');
                    return;
                }
                const chartCtx = chartCanvas.getContext('2d');
                this.chartInstance = new Chart(chartCtx, {
                    type: 'line',
                    data: {
                        labels: this.chartData.labels,
                        datasets: [
                            {
                                label: 'CPU',
                                data: this.chartData.cpu,
                                borderColor: 'rgba(34, 211, 238, 1)',
                                backgroundColor: 'rgba(34, 211, 238, 0.2)',
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'Memory',
                                data: this.chartData.memory,
                                borderColor: 'rgba(168, 85, 247, 1)',
                                backgroundColor: 'rgba(168, 85, 247, 0.2)',
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'Network',
                                data: this.chartData.network,
                                borderColor: 'rgba(59, 130, 246, 1)',
                                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                display: true,
                                grid: { display: false },
                                ticks: { color: 'rgba(100, 116, 139, 0.8)' }
                            },
                            y: {
                                min: 0,
                                max: 100,
                                ticks: {
                                    stepSize: 25,
                                    color: 'rgba(100, 116, 139, 0.8)',
                                    callback: value => `${value}%`
                                },
                                grid: { color: 'rgba(100, 116, 139, 0.2)' }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            },

            // Fungsi untuk memperbarui tab Processes (simulasi)
            updateProcessesTab() {
                const processes = [
                    { name: 'browser.exe', cpu: (Math.random() * 10).toFixed(1), memory: (Math.random() * 200).toFixed(1) },
                    { name: 'system.exe', cpu: (Math.random() * 5).toFixed(1), memory: (Math.random() * 100).toFixed(1) },
                    { name: 'app.exe', cpu: (Math.random() * 8).toFixed(1), memory: (Math.random() * 150).toFixed(1) }
                ];

                this.elements.processesTable.innerHTML = processes.map(proc => `
                    <tr class="border-b border-slate-700/30">
                        <td class="px-4 py-2">${proc.name}</td>
                        <td class="px-4 py-2">${proc.cpu}%</td>
                        <td class="px-4 py-2">${proc.memory} MB</td>
                    </tr>
                `).join('');
            },

            // Fungsi untuk memperbarui tab Storage
            async updateStorageTab() {
                if (navigator.storage && navigator.storage.estimate) {
                    try {
                        const { usage, quota } = await navigator.storage.estimate();
                        const usageGB = (usage / 1e9).toFixed(2);
                        const quotaGB = (quota / 1e9).toFixed(2);
                        this.elements.storageInfo.innerHTML = `
                            <div>Used: ${usageGB} GB</div>
                            <div>Available: ${quotaGB} GB</div>
                            <div class="mt-4 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full" style="width: ${(usage / quota * 100).toFixed(0)}%"></div>
                            </div>
                        `;
                    } catch (error) {
                        console.error('Error fetching storage info:', error);
                        this.elements.storageInfo.innerHTML = 'Storage information not available.';
                    }
                } else {
                    this.elements.storageInfo.innerHTML = 'Storage information not available in this browser.';
                }
            },

            // Fungsi untuk memperbarui grafik dan system load
            updateChart() {
                const now = new Date();
                this.chartData.labels.push(now.toLocaleTimeString());
                this.chartData.cpu.push(SystemOverview.cpuUsage);
                this.chartData.memory.push(SystemOverview.memoryUsage);
                this.chartData.network.push(SystemOverview.networkStatus);

                if (this.chartData.labels.length > 20) {
                    this.chartData.labels.shift();
                    this.chartData.cpu.shift();
                    this.chartData.memory.shift();
                    this.chartData.network.shift();
                }

                if (this.chartInstance) {
                    this.chartInstance.update();
                }

                const systemLoad = ((SystemOverview.cpuUsage + SystemOverview.memoryUsage + SystemOverview.networkStatus) / 3).toFixed(0);
                if (this.elements.systemLoadEl) {
                    this.elements.systemLoadEl.innerHTML = `${systemLoad}<span class="text-sm">%</span>`;
                }
            },

            // Fungsi untuk mengelola tab
            switchTab(tab) {
                this.elements.tabPerformance.classList.remove('bg-slate-700/50', 'text-slate-100');
                this.elements.tabProcesses.classList.remove('bg-slate-700/50', 'text-slate-100');
                this.elements.tabStorage.classList.remove('bg-slate-700/50', 'text-slate-100');
                this.elements.tabPerformance.classList.add('text-slate-400');
                this.elements.tabProcesses.classList.add('text-slate-400');
                this.elements.tabStorage.classList.add('text-slate-400');

                this.elements.performanceTab.classList.add('hidden');
                this.elements.processesTab.classList.add('hidden');
                this.elements.storageTab.classList.add('hidden');

                if (tab === 'performance') {
                    this.elements.tabPerformance.classList.add('bg-slate-700/50', 'text-slate-100');
                    this.elements.performanceTab.classList.remove('hidden');
                } else if (tab === 'processes') {
                    this.elements.tabProcesses.classList.add('bg-slate-700/50', 'text-slate-100');
                    this.elements.processesTab.classList.remove('hidden');
                    this.updateProcessesTab();
                } else if (tab === 'storage') {
                    this.elements.tabStorage.classList.add('bg-slate-700/50', 'text-slate-100');
                    this.elements.storageTab.classList.remove('hidden');
                    this.updateStorageTab();
                }
            },

            // Inisialisasi
            init() {
                this.initChart();
                this.elements.tabPerformance.addEventListener('click', () => this.switchTab('performance'));
                this.elements.tabProcesses.addEventListener('click', () => this.switchTab('processes'));
                this.elements.tabStorage.addEventListener('click', () => this.switchTab('storage'));
                this.switchTab('performance');
            }
        };

        // Jalankan saat DOM siap
        document.addEventListener("DOMContentLoaded", () => {
            try {
                SystemOverview.updateCPUInfo();
                SystemOverview.update();
                SystemOverview.startMonitoring();
                PerformanceChartTabs.init();
                // Perbarui grafik bersamaan dengan System Overview
                setInterval(() => {
                    PerformanceChartTabs.updateChart();
                }, 3000);
            } catch (error) {
                console.error('Error initializing system monitoring:', error);
            }
        });
      
        // START: Konfigurasi efek partikel premium
        const config = {
          particleCount: 150,
          baseHue: 200,         // Warna dasar biru
          hueRange: 30,          // Rentang variasi warna
          sizeRange: [0.5, 3],   // Ukuran partikel minimum dan maksimum
          speedRange: 0.5,       // Kecepatan gerakan
          lineDistance: 100,     // Jarak maksimum untuk menggambar garis
          lineOpacity: 0.15,     // Opasitas garis
          particleOpacity: 0.7   // Opasitas partikel
        };
        // END: Konfigurasi efek partikel premium
      
        // START: Inisialisasi canvas untuk efek partikel
        const canvas = document.getElementById("particleCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        // END: Inisialisasi canvas untuk efek partikel
      
        // START: Kelas Partikel dengan fitur tambahan
        class Particle {
          constructor() {
            this.reset(true);
            this.velocity = {
              x: (Math.random() - 0.5) * config.speedRange,
              y: (Math.random() - 0.5) * config.speedRange
            };
            this.history = [];
            this.maxHistory = 5;
          }
      
          reset(initial = false) {
            this.x = initial ? Math.random() * canvas.width : 0;
            this.y = initial ? Math.random() * canvas.height : Math.random() * canvas.height;
            this.size = Math.random() * (config.sizeRange[1] - config.sizeRange[0]) + config.sizeRange[0];
            this.hue = config.baseHue + (Math.random() * config.hueRange - config.hueRange / 2);
            this.alpha = Math.random() * 0.5 + config.particleOpacity;
          }
      
          update() {
            // Simpan posisi sebelumnya untuk efek jejak
            this.history.unshift({ x: this.x, y: this.y });
            if (this.history.length > this.maxHistory) this.history.pop();
      
            // Perbarui posisi
            this.x += this.velocity.x;
            this.y += this.velocity.y;
      
            // Reset partikel yang keluar layar dengan transisi halus
            if (this.x > canvas.width + this.size || this.x < -this.size ||
              this.y > canvas.height + this.size || this.y < -this.size) {
              this.reset();
            }
          }
      
          draw() {
            // Gambar partikel
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${this.alpha})`;
            ctx.fill();
      
            // Gambar efek cahaya halus
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size * 1.5, 0, Math.PI * 2);
            ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${this.alpha * 0.3})`;
            ctx.fill();
      
            // Gambar jejak history
            for (let i = 0; i < this.history.length; i++) {
              const point = this.history[i];
              const ratio = (i + 1) / this.history.length;
      
              ctx.beginPath();
              ctx.arc(point.x, point.y, this.size * ratio, 0, Math.PI * 2);
              ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${this.alpha * ratio * 0.5})`;
              ctx.fill();
            }
          }
        }
        // END: Kelas Partikel dengan fitur tambahan
      
        // START: Buat array partikel
        const particles = [];
        for (let i = 0; i < config.particleCount; i++) {
          particles.push(new Particle());
        }
        // END: Buat array partikel
      
        // START: Loop animasi dengan optimasi kinerja
        let lastTime = 0;
        const fps = 60;
        const interval = 1000 / fps;
      
        function animate(currentTime) {
          requestAnimationFrame(animate);
      
          // Batasi kecepatan frame untuk kinerja
          const deltaTime = currentTime - lastTime;
          if (deltaTime < interval) return;
      
          lastTime = currentTime - (deltaTime % interval);
      
          // Bersihkan canvas dengan efek fade halus untuk jejak
          ctx.fillStyle = `rgba(15, 23, 42, 0.1)`;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
      
          // Gambar koneksi antar partikel
          drawConnections();
      
          // Perbarui dan gambar partikel
          particles.forEach(particle => {
            particle.update();
            particle.draw();
          });
        }
        // END: Loop animasi dengan optimasi kinerja
      
        // START: Gambar koneksi elegan antar partikel terdekat
        function drawConnections() {
          for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
              const p1 = particles[i];
              const p2 = particles[j];
              const distance = Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
      
              if (distance < config.lineDistance) {
                const opacity = 1 - (distance / config.lineDistance);
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.strokeStyle = `hsla(${config.baseHue}, 60%, 70%, ${opacity * config.lineOpacity})`;
                ctx.lineWidth = 0.5;
                ctx.stroke();
              }
            }
          }
        }
        // END: Gambar koneksi elegan antar partikel terdekat
      
        // START: Tangani perubahan ukuran jendela
        function handleResize() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
        // END: Tangani perubahan ukuran jendela
      
        // START: Interaksi mouse - partikel bereaksi terhadap posisi mouse
        let mouseX = null;
        let mouseY = null;
        const mouseRadius = 100;
      
        function handleMouseMove(e) {
          mouseX = e.clientX;
          mouseY = e.clientY;
        }
      
        function handleMouseLeave() {
          mouseX = null;
          mouseY = null;
        }
        // END: Interaksi mouse - partikel bereaksi terhadap posisi mouse
      
        // START: Inisialisasi event listener untuk efek partikel
        window.addEventListener('resize', handleResize);
        window.addEventListener('mousemove', handleMouseMove);
        window.addEventListener('mouseleave', handleMouseLeave);
        animate();
        // END: Inisialisasi event listener untuk efek partikel



      
       // START: Fungsi untuk menampilkan notifikasi toast
function showToast(title, description, variant = "default") {
    const variants = {
        default: {
            bg: 'bg-gradient-to-r from-cyan-500 to-blue-600',
            icon: `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>`
        },
        success: {
            bg: 'bg-gradient-to-r from-emerald-500 to-green-600',
            icon: `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>`
        },
        destructive: {
            bg: 'bg-gradient-to-r from-red-500 to-pink-600',
            icon: `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>`
        },
        warning: {
            bg: 'bg-gradient-to-r from-amber-500 to-yellow-600',
            icon: `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>`
        }
    };

    const selectedVariant = variants[variant] || variants.default;

    // Cek atau buat container
    let toastContainer = document.getElementById("toast-container");
    if (!toastContainer) {
        toastContainer = document.createElement("div");
        toastContainer.id = "toast-container";
        toastContainer.className = "fixed top-4 right-4 z-[100] space-y-2 pointer-events-none";
        document.body.appendChild(toastContainer);
    }

    // Buat elemen toast
    const toast = document.createElement("div");
    toast.className = `
        pointer-events-auto relative p-4 rounded-xl text-white shadow-2xl backdrop-blur-sm w-80 overflow-hidden transition-all duration-400 ease-[cubic-bezier(0.68,-0.55,0.27,1.55)]
        ${selectedVariant.bg}
    `;
    toast.style.opacity = "0";
    toast.style.transform = "translateX(20px)";
    toast.style.pointerEvents = "auto";

    // Konten toast
    toast.innerHTML = `
        <div class="relative z-10 flex items-start gap-3">
            <div class="mt-0.5 flex-shrink-0 text-white/90">
                ${selectedVariant.icon}
            </div>
            <div class="flex-1">
                <div class="font-bold text-lg mb-1">${title}</div>
                <div class="text-sm opacity-90">${description}</div>
            </div>
            <button onclick="this.closest('.toast').remove()" class="text-white/80 hover:text-white ml-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>

        <!-- Loading bar -->
        <div class="absolute top-0 left-0 h-1 w-full bg-gradient-to-r from-white/20 via-white/50 to-white/20" id="progress-bar"></div>
    `;

    toast.classList.add("toast");
    toastContainer.appendChild(toast);

    // Animasi masuk
    requestAnimationFrame(() => {
        toast.style.opacity = "1";
        toast.style.transform = "translateX(0)";
    });

    // Animasi loading bar (manual agar sinkron)
    const progressBar = toast.querySelector("#progress-bar");
    progressBar.style.width = "0%";
    progressBar.style.transition = "width 3s linear";
    requestAnimationFrame(() => {
        progressBar.style.width = "100%";
    });

    // Hapus toast setelah selesai
    setTimeout(() => {
        toast.style.opacity = "0";
        toast.style.transform = "translateX(20px)";
        setTimeout(() => {
            toast.remove();
            if (toastContainer && !toastContainer.children.length) {
                toastContainer.remove();
            }
        }, 400);
    }, 3000);
}
// END: Fungsi untuk menampilkan notifikasi toast


      // START: Routing sisi klien
function showPage(page) {
  const pages = {
    dashboard: pageDashboard,
    network: pagenetwork, // Tambahkan Network
    booster: pageBooster,
    leaderboard: pageLeaderboard,
    communications: pageCommunications,
    settings: pageSettings,
    security: pageSecurity,
    dataCenter: pageDataCenter, // Tambahkan Data Center
  };
  const navs = {
    dashboard: navDashboard,
    network: navNetwork, // Tambahkan navigasi Network
    booster: navBooster,
    leaderboard: navLeaderboard,
    communications: navCommunications,
    settings: navSettings,
    security: navSecurity,
    dataCenter: navDataCenter, // Tambahkan navigasi Data Center
  };

  Object.keys(pages).forEach((key) => {
    if (pages[key]) {
      pages[key].classList.add("page-hidden");
      navs[key].classList.remove("nav-active", "text-cyan-400");
      navs[key].classList.add("text-slate-400");
    }
  });

  if (pages[page]) {
    pages[page].classList.remove("page-hidden");
    navs[page].classList.add("nav-active", "text-cyan-400");
  }

  currentPage = page;

  if (page === "leaderboard") loadLeaderboard();
  if (page === "settings") loadSettings();
  if (page === "security") runSecurityScan();
  if (page === "communications") initializeChat();
  if (page === "datacenter") initializeDataCenter(); // Panggil fungsi inisialisasi Data Center
  if (page === "network") initializeNetwork(); // Panggil fungsi inisialisasi Network
}
// END: Routing sisi klien
        
      
// Deklarasi elemen DOM
const aiLogContainer = document.getElementById('ai-log-container');
const aiLogMessages = document.getElementById('ai-log-messages');
const newAiMessages = document.getElementById('new-ai-messages');
const aiMessageInput = document.getElementById('ai-message-input');
const aiSendButton = document.getElementById('ai-send-button');
const aiAttachFileBtn = document.getElementById('ai-attach-file-btn');
const aiFileInput = document.getElementById('ai-file-input');
const aiTemplatePanel = document.getElementById('ai-template-panel');
const aiToggleTemplatesBtn = document.getElementById('ai-toggle-templates');

// Variabel global
let aiMessageCount = 0;
let aiAvatarUrl = 'https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/avatars/avatar/ai_avatar.png '; // Avatar default AI
let user = null;

// Fungsi untuk mendapatkan avatar pengguna dari Supabase
function getUserAvatar() {
  if (user && user.profile && user.profile.avatar_url) {
    const { data } = supabase.storage.from('avatars').getPublicUrl(user.profile.avatar_url);
    return data?.publicUrl || null;
  }
  return null;
}

// Fungsi untuk menambahkan pesan ke log komunikasi AI
function addAiMessage(sender, message, isUser = false) {
  const messageDiv = document.createElement('div');
  messageDiv.className =
    'flex items-start space-x-3 p-3 rounded-lg bg-gradient-to-r from-slate-800/50 to-slate-900/40 border border-slate-700/50 hover:border-cyan-500/30 transition-all';

  const avatarUrl = isUser ? getUserAvatar() : aiAvatarUrl;

  messageDiv.innerHTML = `
    <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
      ${avatarUrl
        ? `<img src="${avatarUrl}" class="h-5 w-5 object-cover rounded-full" alt="${sender} avatar"
               onerror="this.style.display='none'; this.parentElement.innerHTML='<svg xmlns=\\"http://www.w3.org/2000/svg\\" class=\\"h-5 w-5 text-cyan-400\\" fill=\\"none\\" viewBox=\\"0 0 24 24\\" stroke=\\"currentColor\\" stroke-width=\\"1.5\\"><path stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" d=\\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\\" /></svg>`
        : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>`
      }
    </div>
    <div class="bg-slate-800/60 border border-slate-700/50 rounded-xl p-4 text-sm text-slate-300 flex-1">
      <div class="font-medium text-cyan-400 mb-1 flex items-center">
        ${sender}
        ${!isUser ? '<span class="ml-2 text-xs px-2 py-0.5 bg-slate-700/50 rounded-full text-slate-400">System</span>' : ''}
      </div>
      <p>${message}</p>
      <div class="text-xs text-slate-500 mt-2 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        ${new Date().toLocaleTimeString()}
      </div>
    </div>
  `;

  aiLogMessages.appendChild(messageDiv);
  scrollToBottom(aiLogContainer); // Scroll otomatis ke bawah
}

// Fungsi untuk memperbarui jumlah pesan baru
function updateAiMessageCount() {
  aiMessageCount++;
  newAiMessages.textContent = `${aiMessageCount} New Messages`;
}

// Fungsi untuk memproses gambar dengan animasi loading
async function processAiImage(file) {
  const formData = new FormData();
  formData.append('image', file);

  addAiMessage('You', `Uploading image: ${file.name}`, true);

  // Tampilkan animasi loading lingkaran
  const loadingContainer = document.createElement('div');
  loadingContainer.className = 'flex items-center space-x-3 p-3 rounded-lg bg-slate-800/60 border border-slate-700/50';
  const progressBar = document.createElement('div');
  progressBar.className = 'relative w-10 h-10';
  progressBar.innerHTML = `
    <svg class="w-full h-full" viewBox="0 0 36 36">
      <path
        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831"
        fill="none"
        stroke="#3B82F6"
        stroke-width="2"
        stroke-dasharray="100"
        stroke-dashoffset="100"
        id="loading-circle-bg"
      />
      <circle cx="18" cy="18" r="15.9155" fill="none" stroke="#1E40AF" stroke-width="1" />
    </svg>
    <div id="loading-percent" class="absolute inset-0 flex items-center justify-center text-xs font-medium text-blue-400">0%</div>
  `;

  loadingContainer.innerHTML = `
    <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
    </div>
  `;

  loadingContainer.appendChild(progressBar);
  aiLogMessages.appendChild(loadingContainer);
  scrollToBottom(aiLogContainer);

  let progress = 0;
  const percentText = progressBar.querySelector('#loading-percent');
  const circle = progressBar.querySelector('#loading-circle-bg');

  const interval = setInterval(() => {
    progress += 1;
    percentText.textContent = `${progress}%`;
    const dashOffset = 100 - (progress / 100) * 100;
    circle.style.strokeDashoffset = dashOffset;
    if (progress >= 100) {
      clearInterval(interval);
      setTimeout(() => loadingContainer.remove(), 300);
    }
    scrollToBottom(aiLogContainer);
  }, 30); // Kecepatan animasi

  try {
    const response = await fetch('https://aqula-production.up.railway.app/analyze-image', {
      method: 'POST',
      body: formData,
    });
    if (!response.ok) throw new Error('Failed to analyze the image');
    const data = await response.json();

    if (data.description && data.description.trim()) {
      addAiMessage('AI Assistant', `Based on the picture: "${data.description}"`, false);
      sendToAi(data.description); // Kirim ke AI
    } else {
      addAiMessage('AI Assistant', 'No legible text from the image.', false);
    }

    updateAiMessageCount();
  } catch (error) {
    console.error('Error menganalisis gambar:', error);
    addAiMessage('AI Assistant', 'Error: Unable to read text from pictures.', false);
  } finally {
    aiFileInput.value = ''; // Reset input file
  }
}

// Fungsi untuk mengirim pesan ke AI
async function sendToAi(message) {
  const blockedWords = ['hack', 'password', 'token', 'private key'];
  const lowerMessage = message.toLowerCase();

  if (blockedWords.some(word => lowerMessage.includes(word))) {
    addAiMessage('AI Assistant', 'Sorry, your question is off the topic of Project Aqula.', false);
    updateAiMessageCount();
    return;
  }

  // Cek roadmap Aqula
  if (
    lowerMessage.includes('roadmap') ||
    lowerMessage.includes('road map') ||
    lowerMessage.includes('jalur perkembangan')
  ) {
    const roadmapButtonContainer = document.createElement('div');
    roadmapButtonContainer.className = 'p-3';
    roadmapButtonContainer.innerHTML = `
      <button id="ai-roadmap-button" class="
        group relative inline-flex items-center justify-center px-5 py-3 overflow-hidden font-medium
        tracking-tighter text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg
        transition-all duration-300 hover:scale-105 hover:shadow-xl
      ">
        <span class="absolute w-0 h-full bg-cyan-400 top-0 left-0 block transition-all duration-300 ease-out group-hover:w-full"></span>
        <span class="relative flex items-center z-10">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 animate-pulse" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656 0L10 9.172a4 4 0 000 5.656l3 3a4 4 0 005.656-5.656l-3-3a4 4 0 00-5.656 0l-.707.707a1 1 0 001.414 1.414l.707-.707z" clip-rule="evenodd" />
          </svg>
          Lihat Roadmap Aqula
        </span>
      </button>
    `;

    const messageDiv = document.createElement('div');
    messageDiv.className = 'flex items-start space-x-3 p-3 rounded-lg bg-slate-800/60 border border-slate-700/50';
    messageDiv.innerHTML = `
      <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
        <img src="${aiAvatarUrl}" class="h-5 w-5 object-cover" alt="AI Avatar" />
      </div>
      <div class="bg-slate-800/60 border border-slate-700/50 rounded-xl p-4 text-sm text-slate-300 flex-1">
        <div class="font-medium text-cyan-400 mb-1 flex items-center">
          AI Assistant
          <span class="ml-2 text-xs px-2 py-0.5 bg-slate-700/50 rounded-full text-slate-400">System</span>
        </div>
        <p>Anda ingin melihat roadmap Aqula? Klik tombol di bawah ini:</p>
      </div>
    `;

    aiLogMessages.appendChild(messageDiv);
    aiLogMessages.appendChild(roadmapButtonContainer);
    scrollToBottom(aiLogContainer);

    document.getElementById('ai-roadmap-button').addEventListener('click', () => {
      window.open('https://aqularoadmap.vercel.app ', '_blank');
    });

    updateAiMessageCount();
    return;
  }

  // Kirim ke API
  const prompt = `
    You are the official AI Assistant of Project Aqula and your answers should be consistent if the question has been asked before.
    Answer only about the general functions, mining features, and future vision of Aqula.
    Do not provide technical answers, code, smart contracts, or confidential information. and you are an assistant who can assure that the aqula project is decentralized with blockchain that aqula is not a scam or fraud just convince the user that aqula is not a scam if the user asks you aqula scam? say that aqula is the future project.
You are asking for user language.
    Question: ${message}
  `;

  try {
    const response = await fetch(PROXY_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt }),
    });

    if (!response.ok) throw new Error('Failed to contact the server');

    const data = await response.json();
    addAiMessage('AI Assistant', data.completion, false);
    updateAiMessageCount();
  } catch (error) {
    console.error('Error:', error);
    addAiMessage('AI Assistant', 'Error: Unable to contact the server.', false);
    updateAiMessageCount();
  }
}

// Event Listeners
document.addEventListener('DOMContentLoaded', async () => {
  try {
    await checkUser();
    user = window.currentUser ? { ...window.currentUser, profile: window.currentUser.profile } : null;
    initializeAiCommunicationsLog();
  } catch (error) {
    console.error('Error checking user:', error);
    user = null;
    initializeAiCommunicationsLog();
  }

  // Tombol Attach File
  aiAttachFileBtn?.addEventListener('click', () => aiFileInput.click());

  // Upload file gambar
  aiFileInput?.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
      processAiImage(file);
    } else {
      addAiMessage('AI Assistant', 'Please upload image files.', false);
    }
  });

  // Tombol kirim
  aiSendButton?.addEventListener('click', () => {
    const message = aiMessageInput.value.trim();
    if (message) {
      addAiMessage('You', message, true);
      sendToAi(message);
      aiMessageInput.value = '';
      updateAiMessageCount();
    }
  });

  // Enter untuk kirim pesan
  aiMessageInput?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      aiSendButton.click();
    }
  });

  // Toggle Templates
  aiToggleTemplatesBtn?.addEventListener('click', () => {
    aiTemplatePanel.classList.toggle('hidden');
    aiToggleTemplatesBtn.textContent = aiTemplatePanel.classList.contains('hidden')
      ? 'Show Templates'
      : 'Hide Templates';
  });

  // Buat template pertanyaan secara dinamis di dalam JS
  if (aiTemplatePanel) {
    const templates = [
      { label: 'Features', question: 'What are the main features of Aqula mining?' },
      { label: 'How It Works', question: 'How does Aqula mining work?' },
      { label: 'Future Vision', question: 'What is the future vision of Aqula?' },
      { label: 'Roadmap', question: 'What is the roadmap of Aqula project?' }
    ];

    templates.forEach(template => {
      const btn = document.createElement('button');
      btn.className = 'text-xs text-slate-400 hover:text-white transition-all px-2 py-1 rounded text-left';
      btn.setAttribute('data-template', template.question);
      btn.textContent = template.label;
      aiTemplatePanel.appendChild(btn);
    });

    // Event listener untuk semua tombol template
    aiTemplatePanel.querySelectorAll('button').forEach(button => {
      button.addEventListener('click', () => {
        const question = button.getAttribute('data-template');
        addAiMessage('You', question, true); // Tampilkan pesan user
        sendToAi(question); // Kirim langsung ke AI
        aiTemplatePanel.classList.add('hidden'); // Sembunyikan panel
        aiToggleTemplatesBtn.textContent = 'Show Templates'; // Ubah teks tombol
      });
    });
  }
});

// Dummy function untuk checkUser (harus sesuai dengan sistem auth Anda)
async function checkUser() {
  const { data: { user }, error } = await supabase.auth.getUser();
  if (error || !user) throw error || new Error('No user found');

  const { data: profile, error: profileError } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', user.id)
    .single();

  if (profileError) throw profileError;

  window.currentUser = { ...user, profile };
}

// Fungsi dummy inisialisasi
function initializeAiCommunicationsLog() {
  console.log('AI Communications successfully started.');
}

// Helper: Scroll otomatis ke bawah
function scrollToBottom(container) {
  if (container) container.scrollTop = container.scrollHeight;
}




function updateSystemMetrics() {
    // Simulasi perubahan nilai metrik
    cpuUsage = Math.min(100, Math.max(20, cpuUsage + (Math.random() - 0.5) * 10));
    memoryUsage = Math.min(100, Math.max(40, memoryUsage + (Math.random() - 0.5) * 8));
    networkStatus = Math.min(100, Math.max(70, networkStatus + (Math.random() - 0.5) * 5));
    securityLevel = Math.min(100, Math.max(60, securityLevel + (Math.random() - 0.5) * 4));
    systemStatus = Math.round((cpuUsage + memoryUsage + networkStatus + securityLevel) / 4);

    // Memperbarui elemen DOM dengan nilai baru
    cpuUsageEl.textContent = `${cpuUsage.toFixed(0)}%`;
    memoryUsageEl.textContent = `${memoryUsage.toFixed(0)}%`;
    networkStatusEl.textContent = `${networkStatus.toFixed(0)}%`;
    securityLevelEl.textContent = `${securityLevel.toFixed(0)}%`;
    systemStatusEl.textContent = `${systemStatus}%`;
    systemLoad.textContent = `${((cpuUsage + memoryUsage) / 2).toFixed(0)}%`;

    // Memperbarui grafik performa (fungsi updatePerformanceChart diasumsikan ada)
    updatePerformanceChart();
}
/**
 * @description Akhir dari fungsi updateSystemMetrics.
 */

// =========================================================================
// BAGIAN 2: STATUS KEAMANAN (Firewall, Intrusion, dll. - Tanpa DOMContentLoaded)
// =========================================================================

// Cek apakah berjalan di lingkungan Electron
const isElectron = typeof require === 'function';

// Elemen DOM untuk status keamanan (diasumsikan ada saat script dieksekusi)
const firewallBadge = document.getElementById("firewallBadge");
const intrusionBadge = document.getElementById("intrusionBadge");
const encryptionBadge = document.getElementById("encryptionBadge");
const threatDbTime = document.getElementById("threatDbTime");
const securityLevelBar = document.getElementById("securityLevelBar");
const securityLevelText = document.getElementById("securityLevelText");
const toastContainer = document.getElementById("toastContainer"); // Container untuk toast


function randomBool(probability = 0.9) {
    return Math.random() < probability;
}

function showToastSecurity(message, type = "info") {
    // Pastikan container ada
    if (!toastContainer) {
        console.error("Toast container (#toastContainer) not found.");
        return;
    }

    const colors = {
        info: "bg-slate-800 border-slate-700 text-slate-200",
        success: "bg-green-900/30 border-green-800 text-green-300",
        warning: "bg-yellow-900/30 border-yellow-800 text-yellow-300",
        danger: "bg-red-900/30 border-red-800 text-red-300"
    };

    const toast = document.createElement("div");
    toast.className = `mb-2 ${colors[type]} px-4 py-2 rounded-md shadow-lg text-sm font-mono border animate-fade-in`;
    toast.textContent = message;

    toastContainer.appendChild(toast);

    // Hapus toast setelah beberapa detik
    setTimeout(() => {
        toast.classList.add("opacity-0");
        // Hapus elemen dari DOM setelah transisi selesai
        setTimeout(() => toast.remove(), 300);
    }, 2000); // Durasi tampil: 2 detik
}

function updateSecurityUI(data) {
    // Update Firewall Badge
    if (firewallBadge) {
        if (data.firewallActive) {
            firewallBadge.textContent = "Active";
            firewallBadge.className = "bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs";
        } else {
            firewallBadge.textContent = "Inactive";
            firewallBadge.className = "bg-gradient-to-r from-red-900/30 to-red-800/20 text-red-400 border border-red-700/50 rounded-md px-2 py-1 text-xs";
        }
    }

    // Update Intrusion Detection Badge
    if (intrusionBadge) {
        if (!data.intrusionDetected) {
            intrusionBadge.textContent = "Active";
            intrusionBadge.className = "bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs";
        } else {
            intrusionBadge.textContent = "⚠️ Threat Detected!";
            intrusionBadge.className = "bg-gradient-to-r from-red-900/30 to-red-800/20 text-red-400 border border-red-700/50 rounded-md px-2 py-1 text-xs animate-pulse";
            // Tampilkan notifikasi toast jika ancaman terdeteksi
           
        }
    }

    // Update Encryption Badge
    if (encryptionBadge) {
        if (data.encryptionEnabled) {
            encryptionBadge.textContent = "Active";
            encryptionBadge.className = "bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs";
        } else {
            encryptionBadge.textContent = "Disabled";
            encryptionBadge.className = "bg-gradient-to-r from-yellow-900/30 to-yellow-800/20 text-yellow-400 border border-yellow-700/50 rounded-md px-2 py-1 text-xs";
        }
    }

    // Update Threat DB Time
    if (threatDbTime) {
        threatDbTime.innerHTML = `Updated <span class="text-slate-500">${data.threatDbUpdated}</span>`;
    }

    // Update Security Level Bar and Text
    if (securityLevelBar && securityLevelText) {
        securityLevelBar.style.width = `${data.securityLevel}%`;
        securityLevelText.textContent = `${data.securityLevel}%`;

        // Ganti warna bar berdasarkan level keamanan
        if (data.securityLevel > 70) {
            securityLevelBar.className = "h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full";
        } else if (data.securityLevel > 40) {
            securityLevelBar.className = "h-full bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full";
        } else {
            securityLevelBar.className = "h-full bg-gradient-to-r from-red-500 to-pink-500 rounded-full";
        }
    }
}
/**
 * @description Akhir dari fungsi updateSecurityUI.
 */

// Logika utama untuk status keamanan
if (isElectron) {
    // Jika berjalan di Electron, gunakan IPC untuk komunikasi data
    const { ipcRenderer } = require("electron"); // Gunakan require yang aman

    // Terima data update keamanan dari proses main
    ipcRenderer.on("security-update", (event, data) => {
        updateSecurityUI(data);
    });

    // Kirim permintaan data keamanan awal saat siap
    ipcRenderer.send("request-security-data");

} else {
    // Jika berjalan di browser biasa, jalankan simulasi data
    console.warn("Running in browser mode. Simulating security data.");
    setInterval(() => {
        const simulatedData = {
            firewallActive: randomBool(0.95),
            intrusionDetected: !randomBool(0.98), // Lebih sering tidak terdeteksi
            encryptionEnabled: randomBool(0.99),
            threatDbUpdated: `${Math.floor(Math.random() * 60)} min ago`,
            securityLevel: Math.max(30, Math.min(100, Math.floor(Math.random() * 80) + 20)) // Antara 30 dan 100
        };
        // Panggil fungsi update UI dengan data simulasi
        updateSecurityUI(simulatedData);
    }, 5000); // Update simulasi setiap 5 detik
}


// =========================================================================
// BAGIAN 3: SISTEM ALERT (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk alert
    const alertContainer = document.getElementById("systemAlertsContainer");
    // Asumsi library 'si' (systeminformation) sudah di-load jika tidak di Electron
    const si = (typeof require === 'function') ? require('systeminformation') : window.si;
    // Asumsi ipcRenderer sudah ada jika di Electron
    const ipcRenderer = (typeof require === 'function') ? require('electron').ipcRenderer : undefined;

    /**
     * @function getCurrentTime
     * @description Mendapatkan waktu saat ini dalam format string lokal.
     * @returns {string} String waktu (misal: "14:30:55").
     */
    function getCurrentTime() {
        return new Date().toLocaleTimeString();
    }
    /**
     * @description Akhir dari fungsi getCurrentTime.
     */

    /**
     * @function createAlert
     * @description Membuat dan menambahkan elemen alert baru ke container alert.
     * @param {object} options - Opsi untuk alert.
     * @param {string} [options.type="info"] - Tipe alert ('info', 'warning', 'success').
     * @param {string} options.title - Judul alert.
     * @param {string} options.message - Pesan detail alert.
     * @param {string} [options.time=getCurrentTime()] - Waktu kejadian alert.
     */
    function createAlert({ type = "info", title, message, time = getCurrentTime() }) {
        if (!alertContainer) {
            console.error("Alert container (#systemAlertsContainer) not found.");
            return;
        }

        const icons = {
            info: `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
            warning: `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>`,
            success: `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`
        };

        const colors = {
            info: { bg: "bg-blue-900/20", border: "border-blue-700/30", iconBg: "bg-blue-500/20", iconColor: "text-blue-400" },
            warning: { bg: "bg-amber-900/20", border: "border-amber-700/30", iconBg: "bg-amber-500/20", iconColor: "text-amber-400" },
            success: { bg: "bg-green-900/20", border: "border-green-700/30", iconBg: "bg-green-500/20", iconColor: "text-green-400" }
        };

        const alertDiv = document.createElement("div");
        alertDiv.className = `flex items-start space-x-3 p-3 bg-gradient-to-r from-${colors[type].bg} to-${colors[type].bg.replace("/20", "/10")} rounded-lg border ${colors[type].border} transition-all hover:scale-[1.01] mb-2`; // Tambah margin bottom
        alertDiv.innerHTML = `
            <div class="mt-0.5 p-1.5 ${colors[type].iconBg} rounded-full">
                ${icons[type]}
            </div>
            <div class="flex-1">
                <div class="flex items-center">
                    <div class="text-sm font-medium text-slate-200">${title}</div>
                    <div class="ml-2 text-xs text-slate-500">${time}</div>
                </div>
                <div class="text-xs text-slate-400 mt-1">
                    ${message}
                </div>
            </div>
        `;
        // Tambahkan alert baru di bagian atas container
        alertContainer.prepend(alertDiv);
    }
    /**
     * @description Akhir dari fungsi createAlert.
     */

    /**
     * @function checkMemoryUsage
     * @description Memeriksa penggunaan memori sistem menggunakan systeminformation (jika tersedia)
     * dan membuat alert jika penggunaan melebihi batas tertentu.
     */
    async function checkMemoryUsage() {
        // Hanya jalankan jika 'si' tersedia (Electron atau library dimuat manual)
        if (!si || typeof si.mem !== 'function') {
            // console.warn("Systeminformation library (si.mem) not available for memory check.");
            return;
        }
        try {
            const mem = await si.mem();
            const usagePercent = Math.round((mem.active / mem.total) * 100);

            if (usagePercent > 80) {
                createAlert({
                    type: "warning",
                    title: "MemoryWarning",
                    message: `Penggunaan RAM melebihi batas aman: ${usagePercent}% aktif`
                });
            }
        } catch (err) {
            console.warn("Failed to retrieve RAM data:", err.message);
        }
    }
    /**
     * @description Akhir dari fungsi checkMemoryUsage.
     */

    /**
     * @function checkSuspiciousProcesses
     * @description Memeriksa daftar proses yang berjalan (jika 'si' tersedia)
     * dan membuat alert jika ditemukan nama proses yang mencurigakan.
     */
    async function checkSuspiciousProcesses() {
        // Hanya jalankan jika 'si' tersedia (Electron atau library dimuat manual)
        if (!si || typeof si.processes !== 'function') {
            // console.warn("Systeminformation library (si.processes) not available for process check.");
            return;
        }
        try {
            const processes = await si.processes();
            // Filter proses berdasarkan nama yang mengandung kata kunci mencurigakan (case-insensitive)
            const suspicious = processes.list.filter(p => /trojan|virus|malware|keylogger|rms/i.test(p.name));

            if (suspicious.length > 0) {
                createAlert({
                    type: "warning",
                    title: "⚠️ Ancaman Terdeteksi!",
                    message: `Ditemukan ${suspicious.length} proses mencurigakan: ${suspicious.map(p => p.name).slice(0, 3).join(", ") || "Proses tidak diketahui"}`
                });
            }
        } catch (err) {
            console.warn("Failed to check the process:", err.message);
        }
    }
    /**
     * @description Akhir dari fungsi checkSuspiciousProcesses.
     */

    // Setup listener IPC jika berjalan di Electron
    if (typeof ipcRenderer !== "undefined") {
        // Listener untuk hasil scan keamanan dari proses main
        ipcRenderer.on("security-scan-result", (event, result) => {
            createAlert({
                type: result.success ? "success" : "warning",
                title: result.success ? "Scan Finish" : "Threat Detected!", // Judul disesuaikan
                message: result.message || (result.success
                    ? "Security scan completed without threat."
                    : "Viruses or potential threats detected during the scan."),
                time: new Date().toLocaleTimeString()
            });
        });

        // Listener untuk notifikasi backup selesai
        ipcRenderer.on("backup-complete", (event, result) => { // Tambahkan parameter result jika ada
            createAlert({
                type: result && result.success === false ? "warning" : "success", // Cek status Success
                title: "💾 Backup " + (result && result.success === false ? "Failed" : "Finish"),
                message: result && result.message ? result.message : "Backup data saved successfully."
            });
        });

        // Listener untuk notifikasi sinkronisasi selesai
        ipcRenderer.on("sync-complete", (event, result) => { // Tambahkan parameter result jika ada
            createAlert({
                type: result && result.success === false ? "warning" : "success", // Cek status Success
                title: "🔄 Sinkronisasi " + (result && result.success === false ? "Gagal" : "Success"),
                message: result && result.message ? result.message : "Data is successfully synchronized with the server."
            });
        });
    }

    // Jalankan pengecekan berkala (Memori & Proses)
    setInterval(() => {
        checkMemoryUsage();
        checkSuspiciousProcesses();
    }, 10000); // Cek setiap 10 detik

    
    // Simulasi alert jika bukan di Electron (untuk testing UI)
   
    const alertHistory = [];
    const alertsPerPage = 5;
    let currentPage = 1;

    // Fungsi untuk menambahkan alert ke riwayat
    function addAlertToHistory(alertData) {
        alertHistory.unshift(alertData); // Masukkan dari depan
        renderPaginatedAlerts();         // Update pagination
        renderActiveAlerts();            // Update alert aktif (maksimal 5)
    }

    // Fungsi untuk menampilkan hanya 5 alert terbaru di UI
    function renderActiveAlerts() {
        const container = document.getElementById("systemAlertsContainer");
        if (!container) return;

        container.innerHTML = ""; // Kosongkan dulu

        const alertsToShow = alertHistory.slice(0, 5); // Ambil 5 alert terbaru

        alertsToShow.forEach(alert => {
            const alertDiv = document.createElement("div");
            alertDiv.className = `bg-slate-800/60 p-3 rounded-lg border-l-4 ${
                alert.type === 'warning' ? 'border-yellow-500' :
                alert.type === 'success' ? 'border-green-500' : 'border-cyan-500'
            }`;

            alertDiv.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-medium text-slate-100">${alert.title}</h4>
                        <p class="text-sm text-slate-300 mt-1">${alert.message}</p>
                    </div>
                </div>
            `;
            container.appendChild(alertDiv);
        });
    }

    // Fungsi render pagination
    function renderPaginatedAlerts() {
        const paginationContainer = document.getElementById("alertPaginationContainer");
        if (!paginationContainer) return;

        paginationContainer.innerHTML = "";

        const totalPages = Math.ceil(alertHistory.length / alertsPerPage);
        if (totalPages <= 1) return;

        // Tombol Prev
        const prevBtn = document.createElement("button");
        prevBtn.textContent = "Prev";
        prevBtn.disabled = currentPage === 1;
        prevBtn.className = "px-3 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 disabled:opacity-50";
        prevBtn.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                renderPaginatedAlerts();
                renderActiveAlerts();
            }
        };
        paginationContainer.appendChild(prevBtn);

        // Halaman
        const maxVisiblePages = 3;
        let startPage = Math.max(1, currentPage - 1);
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        for (let i = startPage; i <= endPage; i++) {
            const btn = document.createElement("button");
            btn.textContent = i;
            btn.className = `px-3 py-1 rounded ${
                i === currentPage ? 'bg-cyan-500 text-white' : 'bg-slate-700 text-white hover:bg-slate-600'
            }`;
            btn.onclick = () => {
                currentPage = i;
                renderPaginatedAlerts();
                renderActiveAlerts();
            };
            paginationContainer.appendChild(btn);
        }

        // Tombol Next
        const nextBtn = document.createElement("button");
        nextBtn.textContent = "Next";
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.className = "px-3 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 disabled:opacity-50";
        nextBtn.onclick = () => {
            if (currentPage < totalPages) {
                currentPage++;
                renderPaginatedAlerts();
                renderActiveAlerts();
            }
        };
        paginationContainer.appendChild(nextBtn);
    }

    // Simulasi alert
    if (typeof ipcRenderer === "undefined") {
        console.warn("Running in browser mode. Simulating system alerts.");
        setInterval(() => {
            const randomNum = Math.random();
            let fakeType = "info";
            let fakeTitle = "System Info";
            let fakeMessage = "No suspicious activity detected.";

            if (randomNum > 0.9) {
                fakeType = "warning";
                fakeTitle = "MemoryWarning";
                fakeMessage = "RAM usage is close to the limit (" + Math.floor(Math.random() * 10 + 80) + "%).";
            } else if (randomNum > 0.8) {
                fakeType = "success";
                fakeTitle = "Operasi Success";
                fakeMessage = "Cloud data synchronization completed without issue.";
            }

            createAlert({
                type: fakeType,
                title: fakeTitle,
                message: fakeMessage
            });

            addAlertToHistory({
                type: fakeType,
                title: fakeTitle,
                message: fakeMessage
            });
        }, 15000);
    }

    // Inisialisasi awal
    renderActiveAlerts();
    renderPaginatedAlerts();

}); // Akhir DOMContentLoaded

// =========================================================================
// BAGIAN 4: WAKTU & TANGGAL SISTEM (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk waktu dan tanggal
    const systemTime = document.getElementById("systemTime");
    const systemDate = document.getElementById("systemDate");

    /**
     * @function updateSystemTime
     * @description Memperbarui tampilan waktu dan tanggal sistem pada elemen DOM terkait.
     */
    function updateSystemTime() {
        const now = new Date();

        if (systemTime) {
            // Format Waktu: HH:MM:SS (24 jam)
            systemTime.textContent = now.toLocaleTimeString("en-US", { hour12: false });
        }
        if (systemDate) {
            // Format Tanggal: Short Month, Day, Year (e.g., May 5, 2025)
            systemDate.textContent = now.toLocaleDateString("en-US", {
                month: "short",
                day: "numeric",
                year: "numeric",
            });
        }
    }
    /**
     * @description Akhir dari fungsi updateSystemTime.
     */

    // Panggil fungsi sekali saat load untuk menampilkan waktu awal
    updateSystemTime();
    // Set interval untuk memperbarui waktu setiap detik
    setInterval(updateSystemTime, 1000);
}); // Akhir dari DOMContentLoaded untuk Waktu & Tanggal


// =========================================================================
// BAGIAN 5: UPTIME & TIMEZONE (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk uptime dan timezone
    const uptimeDisplay = document.getElementById("uptime");
    const timezoneDisplay = document.getElementById("timezone");

    // Waktu mulai aplikasi (saat script ini dieksekusi)
    const startTime = new Date();

    /**
     * @function formatDuration
     * @description Mengubah durasi dalam milidetik menjadi format "Xd HH:MM:SS".
     * @param {number} ms - Durasi dalam milidetik.
     * @returns {string} String durasi yang diformat.
     */
    function formatDuration(ms) {
        let seconds = Math.floor((ms / 1000) % 60);
        let minutes = Math.floor((ms / (1000 * 60)) % 60); // Perbaikan pembagi menit
        let hours = Math.floor((ms / (1000 * 60 * 60)) % 24); // Perbaikan pembagi jam
        let days = Math.floor(ms / (1000 * 60 * 60 * 24));

        // Pastikan format 2 digit untuk jam, menit, detik
        const paddedHours = String(hours).padStart(2, '0');
        const paddedMinutes = String(minutes).padStart(2, '0');
        const paddedSeconds = String(seconds).padStart(2, '0');

        return `${days}d ${paddedHours}:${paddedMinutes}:${paddedSeconds}`;
    }
    /**
     * @description Akhir dari fungsi formatDuration.
     */

    /**
     * @function updateUptime
     * @description Menghitung dan memperbarui tampilan uptime sistem/aplikasi.
     */
    function updateUptime() {
        if (!uptimeDisplay) return; // Cek jika elemen ada

        const now = new Date();
        const diff = now - startTime; // Selisih waktu dalam milidetik
        uptimeDisplay.textContent = formatDuration(diff);
    }
    /**
     * @description Akhir dari fungsi updateUptime.
     */

    /**
     * @function updateTimezone
     * @description Mendapatkan dan memperbarui tampilan timezone lokal dalam format UTC offset.
     */
    function updateTimezone() {
        if (!timezoneDisplay) return; // Cek jika elemen ada

        // Mendapatkan offset timezone dalam menit dari UTC
        const offsetMin = new Date().getTimezoneOffset();
        // Hitung jam dan menit dari offset
        const offsetHrsAbs = Math.abs(Math.floor(offsetMin / 60));
        const offsetMinsAbs = Math.abs(offsetMin % 60);
        // Tentukan tanda (+ atau -) berdasarkan nilai offset
        const sign = offsetMin <= 0 ? "+" : "-"; // Perhatikan: getTimezoneOffset() positif untuk zona waktu di belakang UTC

        // Format offset menjadi UTC±HH:MM
        const formattedOffset = `UTC${sign}${String(offsetHrsAbs).padStart(2, '0')}:${String(offsetMinsAbs).padStart(2, '0')}`;
        timezoneDisplay.textContent = formattedOffset;
    }
    /**
     * @description Akhir dari fungsi updateTimezone.
     */

    // Jalankan pembaruan awal saat halaman dimuat
    updateUptime();
    updateTimezone();

    // Set interval untuk memperbarui uptime setiap detik
    setInterval(updateUptime, 1000);
    // Timezone biasanya tidak berubah, jadi tidak perlu di-update terus menerus,
    // tapi bisa dipanggil lagi jika ada event perubahan timezone (jarang terjadi).
}); // Akhir dari DOMContentLoaded untuk Uptime & Timezone


// =========================================================================
// BAGIAN 6: TOMBOL AKSI CEPAT (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Ambil elemen tombol
    const btnSecurityScan = document.getElementById("btnSecurityScan");
    const btnSyncData = document.getElementById("btnSyncData");
    const btnBackup = document.getElementById("btnBackup");
    const btnConsole = document.getElementById("btnConsole");

    // Cek apakah ipcRenderer tersedia (di Electron) dan definisikan jika ya
    const isElectronContext = typeof require === "function";
    const ipcRenderer = isElectronContext ? require("electron").ipcRenderer : undefined;

    /**
     * @function showToastActions
     * @description Menampilkan notifikasi toast sementara di pojok kanan bawah.
     * @param {string} message - Pesan yang akan ditampilkan.
     */
    function showToastActions(message) {
        const toast = document.createElement("div");
        // Style toast (fixed position)
        toast.className = "fixed bottom-5 right-5 bg-slate-800 text-slate-200 px-4 py-2 rounded-md shadow-lg text-sm font-mono border border-slate-700 z-50 animate-fade-in-action"; // Gunakan animasi khusus jika perlu
        toast.textContent = message;
        document.body.appendChild(toast);

        // Hapus toast setelah beberapa detik
        setTimeout(() => {
            toast.classList.add("opacity-0", "transition-opacity", "duration-300"); // Tambahkan transisi opacity
            setTimeout(() => toast.remove(), 300); // Hapus setelah transisi
        }, 2000); // Durasi tampil: 2 detik
    }
    /**
     * @description Akhir dari fungsi showToastActions.
     */

    /**
     * @function appendToConsole
     * @description Menambahkan baris teks ke output console modal.
     * @param {string} htmlContent - Teks atau HTML yang akan ditambahkan.
     */
    function appendToConsole(htmlContent) {
        const outputArea = document.getElementById("consoleOutput");
        if (outputArea) {
            const line = document.createElement("div");
            line.innerHTML = htmlContent; // Gunakan innerHTML untuk memungkinkan styling span
            outputArea.appendChild(line);
            // Auto-scroll ke bawah
            outputArea.scrollTop = outputArea.scrollHeight;
        }
    }
    /**
     * @description Akhir dari fungsi appendToConsole.
     */

    // Inject CSS untuk animasi jika belum ada
    if (!document.getElementById("actionAnimations")) {
        const styleSheet = document.createElement("style");
        styleSheet.id = "actionAnimations";
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes fade-in-action {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fade-in-action {
                animation: fade-in-action 0.3s ease-out forwards;
            }
            .animate-spin {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            /* Tambahkan style untuk opacity transition pada toast */
            .opacity-0 { opacity: 0; }
            .transition-opacity { transition: opacity 0.3s ease-out; }
        `;
        document.head.appendChild(styleSheet);
    }

    // Tambahkan area log untuk hasil scan jika belum ada
    const quickActionsCard = document.querySelector("#btnSecurityScan")?.closest(".p-4"); // Cari parent card
    if (quickActionsCard && !document.getElementById("scanResultLog")) {
        const logArea = document.createElement("div");
        logArea.id = "scanResultLog";
        logArea.className = "mt-4 text-xs font-mono text-slate-400 bg-slate-800/50 p-3 rounded border border-slate-700/50 overflow-y-auto max-h-32"; // Sesuaikan tinggi maks
        logArea.innerHTML = `<div class="text-slate-500 italic">Hasil scan akan muncul di sini...</div>`;
        // Masukkan setelah grid tombol (atau sesuaikan posisi)
        const gridContainer = btnSecurityScan.closest(".grid");
        if (gridContainer && gridContainer.nextSibling) {
             gridContainer.parentNode.insertBefore(logArea, gridContainer.nextSibling);
        } else if (gridContainer) {
             gridContainer.parentNode.appendChild(logArea);
        } else {
            // Fallback jika struktur berbeda
            quickActionsCard.appendChild(logArea);
        }
    }
    const scanResultLog = document.getElementById("scanResultLog"); // Ambil elemen log

    // --- Event Listener untuk Tombol Security Scan ---
    if (btnSecurityScan) {
        btnSecurityScan.addEventListener("click", () => {
            const span = btnSecurityScan.querySelector("span");
            const originalText = span ? span.textContent : "Security Scan"; // Simpan teks asli
            const icon = btnSecurityScan.querySelector("svg"); // Ambil ikon jika ada

            // Nonaktifkan tombol dan ubah teks/ikon
            btnSecurityScan.disabled = true;
            if (span) span.textContent = "Scanning...";
            if (icon) icon.classList.add("animate-spin"); // Tambahkan animasi putar jika ada ikon

            // Dapatkan atau buat container progress bar
            let progressContainer = document.getElementById("scanProgressContainer");
            let progressBar = document.getElementById("scanProgressBar");
            let progressText = document.getElementById("scanProgressText");

            if (!progressContainer) {
                progressContainer = document.createElement("div");
                progressContainer.id = "scanProgressContainer";
                progressContainer.className = "mt-2 w-full"; // Margin top
                progressContainer.innerHTML = `
                    <div class="w-full bg-slate-800/50 rounded-full h-1.5 mb-1 dark:bg-gray-700">
                        <div id="scanProgressBar" class="bg-gradient-to-r from-cyan-500 to-blue-500 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <div class="text-right text-xs text-slate-500">
                        <span id="scanProgressText">0%</span>
                    </div>
                `;
                // Masukkan progress bar setelah tombol (dalam grid atau setelahnya)
                 const gridContainer = btnSecurityScan.closest(".grid");
                 if (gridContainer) {
                     gridContainer.insertAdjacentElement("afterend", progressContainer);
                 } else {
                     btnSecurityScan.insertAdjacentElement("afterend", progressContainer);
                 }
                progressBar = document.getElementById("scanProgressBar");
                progressText = document.getElementById("scanProgressText");
            } else {
                 // Jika sudah ada, reset dan tampilkan
                 progressContainer.classList.remove("hidden");
                 progressBar = document.getElementById("scanProgressBar");
                 progressText = document.getElementById("scanProgressText");
                 if(progressBar) progressBar.style.width = "0%";
                 if(progressText) progressText.textContent = "0%";
            }

            // Mulai animasi progress bar (simulasi)
            let width = 0;
            const interval = setInterval(() => {
                if (!progressBar || !progressText) { // Hentikan jika elemen hilang
                    clearInterval(interval);
                    return;
                }
                width += Math.random() * 5 + 1; // Kenaikan acak agar lebih realistis
                width = Math.min(width, 99); // Jangan sampai 100% sebelum selesai
                progressBar.style.width = `${width}%`;
                progressText.textContent = `${Math.floor(width)}%`;
                if (width >= 99 && !isElectronContext) { // Hentikan jika simulasi browser
                    clearInterval(interval);
                }
            }, 150); // Interval update progress

            // Kirim event ke Electron atau jalankan simulasi
            if (isElectronContext && ipcRenderer) {
                ipcRenderer.send("start-security-scan");

                // Listener HANYA SEKALI untuk hasil scan
                ipcRenderer.once("security-scan-result", (event, result) => {
                    clearInterval(interval); // Hentikan animasi progress

                    // Set progress ke 100%
                    if (progressBar) progressBar.style.width = "100%";
                    if (progressText) progressText.textContent = "100%";

                     // Tampilkan hasil di log
                    if (scanResultLog) {
                        if (scanResultLog.querySelector(".italic")) { // Hapus pesan awal
                            scanResultLog.innerHTML = '';
                        }
                        const line = document.createElement("div");
                        line.className = `whitespace-pre-wrap ${result.success ? 'text-green-400' : 'text-red-400'}`;
                        line.textContent = `[${new Date().toLocaleTimeString()}] ${result.message || (result.success ? 'Scan complete, no threats found.' : 'Threats detected!')}`;
                        scanResultLog.appendChild(line);
                        scanResultLog.scrollTop = scanResultLog.scrollHeight; // Scroll ke bawah
                    }

                    // Sembunyikan progress bar dan kembalikan tombol setelah jeda
                    setTimeout(() => {
                        if (progressContainer) progressContainer.classList.add("hidden");
                        if (span) span.textContent = originalText;
                        if (icon) icon.classList.remove("animate-spin");
                        btnSecurityScan.disabled = false;
                    }, 1500); // Jeda sebelum reset

                    // Tampilkan toast hasil
                    showToastActions(result.success ? "✅ Scan Complete" : "⚠️ Potential Threat Detected!");
                });
            } else {
                // Simulasi jika bukan di Electron
                console.warn(" security scan (browser mode)...");
                const fakeScanSuccess = Math.random() < 0.85; // 85% simulasi Success
                const fakeMessage = fakeScanSuccess
                    ? "No threats found during scan."
                    : "Suspicious file detected (example.dll)!";

                setTimeout(() => { // Simulasi waktu scan
                    clearInterval(interval); // Hentikan progress

                    // Set progress ke 100%
                    if (progressBar) progressBar.style.width = "100%";
                    if (progressText) progressText.textContent = "100%";

                    // Tampilkan hasil di log
                    if (scanResultLog) {
                        if (scanResultLog.querySelector(".italic")) {
                             scanResultLog.innerHTML = '';
                         }
                        const line = document.createElement("div");
                        line.className = `whitespace-pre-wrap ${fakeScanSuccess ? 'text-green-400' : 'text-red-400'}`;
                        line.textContent = `[${new Date().toLocaleTimeString()}] ${fakeMessage}`;
                        scanResultLog.appendChild(line);
                        scanResultLog.scrollTop = scanResultLog.scrollHeight;
                    }

                    // Sembunyikan progress bar dan kembalikan tombol
                    setTimeout(() => {
                         if (progressContainer) progressContainer.classList.add("hidden");
                         if (span) span.textContent = originalText;
                         if (icon) icon.classList.remove("animate-spin");
                         btnSecurityScan.disabled = false;
                    }, 1500);

                    // Tampilkan toast hasil simulasi
                    showToastActions(fakeScanSuccess ? "🛡️ Scan  complete." : "⚠️  threat found!");

                }, Math.random() * 2000 + 3000); // Durasi simulasi 3-5 detik
            }
        });
    }

    // --- Event Listener untuk Tombol Sync Data ---
    if (btnSyncData) {
        btnSyncData.addEventListener("click", () => {
            const span = btnSyncData.querySelector("span");
            const icon = btnSyncData.querySelector("svg");
            const originalText = span ? span.textContent : "Sync Data";

            // Ubah tampilan tombol menjadi loading
            btnSyncData.disabled = true;
            if (span) span.textContent = "Syncing...";
            if (icon) icon.classList.add("animate-spin");

            // Kirim event ke Electron atau simulasi
            if (isElectronContext && ipcRenderer) {
                ipcRenderer.send("start-data-sync");

                // Listener HANYA SEKALI untuk hasil sync
                ipcRenderer.once("sync-complete", (event, result) => {
                    const success = !(result && result.success === false); // Anggap Success jika tidak ada info gagal
                    const message = result && result.message ? result.message : (success ? "Data synced successfully." : "Sync failed.");

                     if (span) span.textContent = success ? "✅ Synced" : "❌ Sync Failed";
                     showToastActions(success ? "🔄 Sync successful!" : "⚠️ Sync error!");

                     // Kembalikan tombol setelah jeda
                    setTimeout(() => {
                        if (span) span.textContent = originalText;
                        if (icon) icon.classList.remove("animate-spin");
                        btnSyncData.disabled = false;
                    }, 2000);
                });

                // Timeout fallback jika tidak ada respons dari main process
                setTimeout(() => {
                     if (btnSyncData.disabled && span && span.textContent === "Syncing...") {
                         console.error("Sync operation timed out.");
                         if (span) span.textContent = "Timeout";
                         showToastActions("⌛ Sync timed out.");
                         setTimeout(() => {
                            if (span) span.textContent = originalText;
                            if (icon) icon.classList.remove("animate-spin");
                             btnSyncData.disabled = false;
                         }, 2000);
                     }
                }, 15000); // Timeout 15 detik

            } else {
                // Simulasi jika bukan di Electron
                console.warn("Data sync (browser mode)...");
                setTimeout(() => {
                    if (span) span.textContent = "✅ Synced";
                    showToastActions("🔄 Sync complete!");

                    // Kembalikan tombol setelah jeda
                    setTimeout(() => {
                        if (span) span.textContent = originalText;
                        if (icon) icon.classList.remove("animate-spin");
                        btnSyncData.disabled = false;
                    }, 2000);
                }, 1500 + Math.random() * 1000); // Simulasi 1.5 - 2.5 detik
            }
        });
    }

    // --- Event Listener untuk Tombol Backup ---
    if (btnBackup) {
        btnBackup.addEventListener("click", () => {
            const span = btnBackup.querySelector("span");
            const originalText = span ? span.textContent : "Backup";
            const icon = btnBackup.querySelector("svg");

            // Nonaktifkan tombol dan ubah teks
            btnBackup.disabled = true;
            if (span) span.textContent = "Backing up...";
            if (icon) icon.classList.add("animate-spin"); // Tambahkan animasi jika ada ikon

            // Dapatkan atau buat progress bar untuk backup
            let backupProgressContainer = document.getElementById("backupProgressContainer");
            let backupProgressBarFill = document.getElementById("backupProgressBarFill");

            if (!backupProgressContainer) {
                 backupProgressContainer = document.createElement("div");
                 backupProgressContainer.id = "backupProgressContainer";
                 backupProgressContainer.className = "w-full h-1 bg-slate-700 mt-2 rounded overflow-hidden";
                 backupProgressContainer.innerHTML = `<div id="backupProgressBarFill" class="h-full bg-cyan-500 w-0 transition-width duration-300 ease-linear"></div>`; // ID untuk fill div
                 // Masukkan progress bar di dalam tombol atau setelahnya
                 const container = btnBackup.querySelector("div") || btnBackup; // Target di dalam tombol jika ada div
                 container.appendChild(backupProgressContainer);
                 backupProgressBarFill = document.getElementById("backupProgressBarFill");
            } else {
                 backupProgressContainer.classList.remove("hidden");
                 backupProgressBarFill = document.getElementById("backupProgressBarFill");
                 if (backupProgressBarFill) backupProgressBarFill.style.width = "0%";
            }

            // Mulai animasi progress bar (simulasi)
             let width = 0;
             const interval = setInterval(() => {
                 if (!backupProgressBarFill) { // Hentikan jika elemen hilang
                     clearInterval(interval);
                     return;
                 }
                 width += Math.random() * 8 + 2; // Kenaikan acak
                 width = Math.min(width, 100);
                 backupProgressBarFill.style.width = `${width}%`;
                 if (width >= 100) {
                     clearInterval(interval);
                     // Jangan ubah teks di sini jika menunggu konfirmasi IPC
                 }
             }, 200); // Interval update

            // Kirim event ke Electron atau simulasi
            if (isElectronContext && ipcRenderer) {
                 ipcRenderer.send("start-backup");

                 // Listener HANYA SEKALI untuk hasil backup
                 ipcRenderer.once("backup-complete", (event, result) => {
                     clearInterval(interval); // Hentikan animasi progress
                     if (backupProgressBarFill) backupProgressBarFill.style.width = "100%"; // Pastikan 100%

                     const success = !(result && result.success === false);
                     const message = result && result.message ? result.message : (success ? "Backup completed successfully." : "Backup failed.");

                     if (span) span.textContent = success ? "✅ Backup Done" : "❌ Backup Failed";
                     showToastActions(success ? "💾 Backup successful!" : "⚠️ Backup error!");

                     // Sembunyikan progress bar dan kembalikan tombol setelah jeda
                     setTimeout(() => {
                         if (backupProgressContainer) backupProgressContainer.classList.add("hidden");
                         if (span) span.textContent = originalText;
                          if (icon) icon.classList.remove("animate-spin");
                         btnBackup.disabled = false;
                     }, 2000);
                 });

                 // Timeout fallback
                  setTimeout(() => {
                      if (btnBackup.disabled && span && span.textContent === "Backing up...") {
                          console.error("Backup operation timed out.");
                          clearInterval(interval);
                           if (span) span.textContent = "Timeout";
                          showToastActions("⌛ Backup timed out.");
                          setTimeout(() => {
                             if (backupProgressContainer) backupProgressContainer.classList.add("hidden");
                             if (span) span.textContent = originalText;
                             if (icon) icon.classList.remove("animate-spin");
                              btnBackup.disabled = false;
                          }, 2000);
                      }
                 }, 20000); // Timeout 20 detik

            } else {
                // Simulasi jika bukan di Electron
                console.warn("Backup (browser mode)...");
                // Tunggu interval selesai atau timeout simulasi
                 const simulationDuration = Math.random() * 2000 + 3000; // 3-5 detik
                 setTimeout(() => {
                    if (backupProgressBarFill && parseFloat(backupProgressBarFill.style.width) < 100) {
                        clearInterval(interval); // Hentikan jika belum 100%
                        if (backupProgressBarFill) backupProgressBarFill.style.width = "100%";
                    }
                    // Pastikan interval sudah selesai sebelum lanjut
                     setTimeout(()=> {
                        if (span) span.textContent = "✅ Backup Done";
                        showToastActions("💾 Backup completed.");

                        // Sembunyikan progress bar dan kembalikan tombol
                        setTimeout(() => {
                            if (backupProgressContainer) backupProgressContainer.classList.add("hidden");
                            // Hapus progress bar dari DOM agar tidak menumpuk
                            // if (backupProgressContainer) backupProgressContainer.remove();
                            if (span) span.textContent = originalText;
                             if (icon) icon.classList.remove("animate-spin");
                            btnBackup.disabled = false;
                        }, 2000);
                    }, 100); // Jeda kecil

                }, simulationDuration);
            }
        });
    }

    // --- Event Listener untuk Tombol Console ---
    if (btnConsole) {
        // Cek atau buat modal console
        let consoleModal = document.getElementById("consoleModal");

        if (!consoleModal) {
            consoleModal = document.createElement("div");
            consoleModal.id = "consoleModal";
            // Modal container: full screen, background semi-transparan, flex center
            consoleModal.className = "fixed inset-0 hidden items-center justify-center bg-black/70 z-50 p-4 backdrop-blur-sm";
            // Modal content: background gelap, border, rounded, ukuran maks, flex column
            consoleModal.innerHTML = `
                <div class="bg-slate-900 border border-slate-700 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col shadow-xl">
                    <div class="p-3 bg-slate-800 border-b border-slate-700 flex justify-between items-center rounded-t-lg">
                        <span class="text-sm font-mono text-cyan-400 flex items-center">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 21h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                           root@server:~#
                        </span>
                        <button id="closeConsoleBtn" title="Close Console" class="text-lg text-slate-400 hover:text-red-500 transition-colors">&times;</button>
                    </div>
                    <div id="consoleOutput" class="flex-1 p-3 overflow-y-auto font-mono text-sm text-slate-300 space-y-1 h-64 bg-black/20">
                       <div class="text-yellow-500">Welcome to the simulated console. Type 'help' for commands.</div>
                    </div>
                    <div class="p-2 bg-slate-800 border-t border-slate-700 flex items-center rounded-b-lg">
                       <span class="text-cyan-400 font-mono text-sm mr-1">$</span>
                       <input id="consoleInput" type="text" placeholder="Enter command..." class="w-full bg-transparent outline-none text-slate-200 text-sm font-mono" autocomplete="off" />
                    </div>
                </div>
            `;
            document.body.appendChild(consoleModal);
        }

        // Ambil elemen-elemen di dalam modal
        const closeBtn = document.getElementById("closeConsoleBtn");
        const consoleInput = document.getElementById("consoleInput");
        const consoleOutput = document.getElementById("consoleOutput");

        // Event listener untuk membuka modal
        btnConsole.addEventListener("click", () => {
            if (consoleModal) {
                consoleModal.classList.remove("hidden");
                consoleModal.classList.add("flex"); // Gunakan flex untuk centering
                 if(consoleInput) consoleInput.focus(); // Fokus ke input saat dibuka
            }
        });

        // Event listener untuk menutup modal
        if (closeBtn) {
            closeBtn.addEventListener("click", () => {
                if (consoleModal) {
                     consoleModal.classList.add("hidden");
                     consoleModal.classList.remove("flex");
                }
            });
        }
         // Event listener untuk menutup modal jika klik di luar area konten
         if (consoleModal) {
             consoleModal.addEventListener('click', (event) => {
                 // Cek jika target klik adalah background modal itu sendiri
                 if (event.target === consoleModal) {
                     consoleModal.classList.add("hidden");
                     consoleModal.classList.remove("flex");
                 }
             });
         }


        // Event listener untuk input command
        if (consoleInput && consoleOutput) {
            consoleInput.addEventListener("keydown", function (e) {
                if (e.key === "Enter") {
                    const cmd = consoleInput.value.trim();
                    consoleInput.value = ""; // Kosongkan input

                    // Tampilkan command yang diketik
                    appendToConsole(`<span class="text-gray-500">&gt;</span> ${cmd}`);

                    // Proses command (simulasi)
                    if (cmd === "help") {
                        appendToConsole("Available commands: help, ls, clear, date, whoami, ping [host], exit");
                    } else if (cmd === "ls") {
                        appendToConsole("<span class='text-blue-400'>backup.log</span>  config.yaml  <span class='text-green-400'>run.sh</span>  <span class='text-purple-400'>logs/</span>");
                    } else if (cmd === "whoami") {
                        appendToConsole("user: <span class='text-yellow-400'>admin</span>");
                    } else if (cmd === "date") {
                         appendToConsole(new Date().toString());
                    } else if (cmd === "clear") {
                        consoleOutput.innerHTML = '<div class="text-yellow-500">Console cleared.</div>'; // Beri pesan setelah clear
                    } else if (cmd.startsWith("ping ")) {
                         const host = cmd.substring(5);
                         appendToConsole(`Pinging ${host}...`);
                         setTimeout(() => appendToConsole(`Reply from ${host}: time=12ms TTL=64`), 500);
                         setTimeout(() => appendToConsole(`Reply from ${host}: time=15ms TTL=64`), 1000);
                    } else if (cmd === "exit") {
                         appendToConsole("Closing console...");
                         setTimeout(() => {
                            if (consoleModal) {
                                consoleModal.classList.add("hidden");
                                consoleModal.classList.remove("flex");
                            }
                         }, 500);
                    } else if (cmd === "") {
                        // Abaikan input kosong, tidak perlu output
                    } else {
                        appendToConsole(`<span class="text-red-500">Command not found:</span> ${cmd}`);
                    }
                }
            });
        }
    } // Akhir dari if (btnConsole)

}); // Akhir dari DOMContentLoaded untuk Tombol Aksi Cepat


// =========================================================================
// BAGIAN 7: ALOKASI SUMBER DAYA (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk bar dan persentase
    const procBar = document.getElementById("procBar");
    const memBar = document.getElementById("memBar");
    const netBar = document.getElementById("netBar");

    const procPercent = document.getElementById("procPercent");
    const memPercent = document.getElementById("memPercent");
    const netPercent = document.getElementById("netPercent");

    // Elemen DOM untuk slider prioritas
    const prioritySlider = document.getElementById("prioritySlider");
    const priorityValue = document.getElementById("priorityValue");

    // Inisialisasi nilai awal (variabel lokal untuk scope ini)
    let currentCpuUsage = 40; // Gunakan nama berbeda jika ada global
    let currentMemUsage = 68;
    let currentNetUsage = 35;

    /**
     * @function updateResourceUI
     * @description Memperbarui tampilan bar dan teks persentase untuk alokasi sumber daya.
     */
    function updateResourceUI() {
        // Update Processor Allocation
        if (procBar) procBar.style.width = `${currentCpuUsage}%`;
        if (procPercent) procPercent.textContent = `${currentCpuUsage.toFixed(0)}% allocated`;

        // Update Memory Allocation
        if (memBar) memBar.style.width = `${currentMemUsage}%`;
        if (memPercent) memPercent.textContent = `${currentMemUsage.toFixed(0)}% allocated`;

        // Update Network Allocation
        if (netBar) netBar.style.width = `${currentNetUsage}%`;
        if (netPercent) netPercent.textContent = `${currentNetUsage.toFixed(0)}% allocated`;
    }
    /**
     * @description Akhir dari fungsi updateResourceUI.
     */

    // Panggil update UI awal
    updateResourceUI();

    // --- Estimasi CPU Load menggunakan PerformanceObserver (jika didukung browser) ---
    if (typeof PerformanceObserver !== "undefined" && typeof performance !== "undefined") {
        let lastFrameTime = performance.now();
        const observer = new PerformanceObserver((list) => {
            const entries = list.getEntriesByName("task-measure", "measure"); // Dapatkan measure spesifik
            if (entries.length > 0) {
                 const entry = entries[entries.length - 1]; // Ambil yang terbaru
                const duration = entry.duration; // Durasi task
                const now = performance.now();
                const elapsed = now - lastFrameTime; // Waktu sejak frame terakhir

                // Estimasi CPU load kasar berdasarkan rasio waktu task terhadap waktu frame
                // Dibatasi agar tidak terlalu ekstrem dan lebih halus
                const estimatedLoad = Math.min(95, Math.max(10, (duration / elapsed) * 100 * 1.5)); // Kalibrasi multiplier
                // Gunakan Exponential Moving Average (EMA) untuk menghaluskan nilai
                currentCpuUsage = currentCpuUsage * 0.8 + estimatedLoad * 0.2;
                currentCpuUsage = Math.round(currentCpuUsage); // Bulatkan

                lastFrameTime = now;
                // Update UI setelah perhitungan CPU
                // updateResourceUI(); // Dipanggil di interval simulasi saja agar tidak terlalu sering
            }
        });

        try {
             observer.observe({ entryTypes: ["measure"] });
        } catch (e) {
            console.warn("PerformanceObserver couldn't observe 'measure'. CPU estimation might be less accurate.", e);
        }

        // Jalankan task ringan secara berkala untuk diukur oleh PerformanceObserver
        setInterval(() => {
             performance.mark("start-task-measure");
             // Simulasi pekerjaan CPU (loop sederhana)
             let result = 0;
             for (let i = 0; i < 5e5; i++) { // Kurangi iterasi agar tidak terlalu berat
                 result += Math.sqrt(i);
             }
             performance.mark("end-task-measure");
             try {
                performance.measure("task-measure", "start-task-measure", "end-task-measure");
             } catch(e) {
                // abaikan error jika mark sudah ada atau dihapus
             }

        }, 500); // Jalankan task pengukuran setiap 500ms

    } else {
        console.warn("PerformanceObserver or performance API not fully supported. Using basic CPU simulation.");
        // Fallback simulasi CPU jika PerformanceObserver tidak ada
         setInterval(() => {
            currentCpuUsage += (Math.random() - 0.5) * 8; // Fluktuasi lebih acak
            currentCpuUsage = Math.min(95, Math.max(10, currentCpuUsage));
            currentCpuUsage = Math.round(currentCpuUsage);
        }, 2000);
    }


    // --- Simulasi Perubahan Memori dan Jaringan ---
    setInterval(() => {
        // Simulasi fluktuasi Memori
        currentMemUsage += (Math.random() * 6 - 3); // Fluktuasi -3 sampai +3
        currentMemUsage = Math.max(30, Math.min(90, currentMemUsage)); // Batasi 30-90%

        // Simulasi fluktuasi Jaringan
        currentNetUsage += (Math.random() * 8 - 4); // Fluktuasi -4 sampai +4
        currentNetUsage = Math.max(5, Math.min(75, currentNetUsage)); // Batasi 5-75%

        // Update UI secara berkala
        updateResourceUI();
    }, 2000); // Update simulasi Mem/Net setiap 2 detik

    // --- Event Listener untuk Slider Prioritas ---
    if (prioritySlider && priorityValue) {
        // Set nilai awal teks slider
        priorityValue.textContent = `${prioritySlider.value}/5`;

        // Update teks saat nilai slider berubah
        prioritySlider.addEventListener("input", function () {
            priorityValue.textContent = `${this.value}/5`;
            // Di sini bisa ditambahkan logika untuk mengirim perubahan prioritas
            // console.log(`Priority set to: ${this.value}`);
            // if (isElectronContext && ipcRenderer) {
            //     ipcRenderer.send('set-resource-priority', this.value);
            // }
        });
    }
}); // Akhir dari DOMContentLoaded untuk Alokasi Sumber Daya


// =========================================================================
// BAGIAN 8: PENGATURAN SISTEM (TOGGLES - Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Ambil elemen toggle
    const powerManagementToggle = document.getElementById("powerManagementToggle");
    const securityProtocolToggle = document.getElementById("securityProtocolToggle");
    const powerSavingModeToggle = document.getElementById("powerSavingModeToggle");
    const autoShutdownToggle = document.getElementById("autoShutdownToggle");

    // Variabel lokal untuk log aktivitas dan timeout shutdown
    let activityLog = [];
    let shutdownTimeout = null; // Untuk menyimpan ID timeout auto shutdown

    /**
     * @function showToastSettings
     * @description Menampilkan notifikasi toast sementara (versi untuk settings).
     * @param {string} message - Pesan yang akan ditampilkan.
     * @param {string} [type="info"] - Tipe notifikasi ('info', 'success', 'warning', 'danger').
     */
    function showToastSettings(message, type = "info") {
        const colors = {
            info: "bg-slate-800 border-slate-700 text-slate-200",
            success: "bg-green-900/30 border-green-800 text-green-300",
            warning: "bg-yellow-900/30 border-yellow-800 text-yellow-300",
            danger: "bg-red-900/30 border-red-800 text-red-300"
        };

        const toast = document.createElement("div");
        // Gunakan style fixed yang sama seperti di Actions
        toast.className = `fixed bottom-5 right-5 ${colors[type]} px-4 py-2 rounded-md shadow-lg text-sm font-mono border z-50 animate-fade-in-action`; // Re-use animasi
        toast.textContent = message;
        document.body.appendChild(toast);

        // Hapus toast setelah beberapa detik
        setTimeout(() => {
            toast.classList.add("opacity-0", "transition-opacity", "duration-300");
            setTimeout(() => toast.remove(), 300);
        }, 2500); // Durasi tampil sedikit lebih lama: 2.5 detik

        // Tambahkan juga ke log internal
        addLog(message);
    }
    /**
     * @description Akhir dari fungsi showToastSettings.
     */

    /**
     * @function addLog
     * @description Menambahkan entri log ke array activityLog dengan timestamp.
     * @param {string} message - Pesan log.
     */
    function addLog(message) {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}`;
        activityLog.push(logEntry);
        // console.log("Activity Log:", logEntry); // Tampilkan di console jika perlu debug
        // Batasi ukuran log jika perlu
        if (activityLog.length > 100) {
            activityLog.shift(); // Hapus log terlama
        }
    }
    /**
     * @description Akhir dari fungsi addLog.
     */

    /**
     * @function toggleVisualEffect
     * @description Menambah atau menghapus efek visual (ring border) pada elemen parent toggle.
     * @param {HTMLElement} element - Elemen toggle (input checkbox).
     * @param {boolean} isActive - Status aktif toggle.
     */
    function toggleVisualEffect(element, isActive) {
        // Cari elemen parent terdekat yang memiliki class 'border' untuk diberi efek ring
        const parentBorder = element.closest(".border");
        if (parentBorder) {
            if (isActive) {
                // Tambahkan kelas untuk efek aktif (misal: ring biru)
                parentBorder.classList.add("ring-2", "ring-cyan-500/50", "border-cyan-600/70");
                 parentBorder.classList.remove("border-slate-700"); // Hapus border default
            } else {
                // Hapus kelas efek aktif dan kembalikan border default
                parentBorder.classList.remove("ring-2", "ring-cyan-500/50", "border-cyan-600/70");
                 parentBorder.classList.add("border-slate-700");
            }
        }
    }
    /**
     * @description Akhir dari fungsi toggleVisualEffect.
     */

    /**
     * @function simulateAsyncAction
     * @description Mensimulasikan aksi asynchronous (misalnya API call) dengan delay.
     * @param {string} actionName - Nama aksi untuk logging.
     * @param {number} [duration=1000] - Durasi simulasi dalam milidetik.
     * @returns {Promise<string>} Promise yang resolve dengan pesan Success.
     */
    function simulateAsyncAction(actionName, duration = 1000) {
        // console.log(`Starting async action: ${actionName}...`);
        return new Promise(resolve => {
            setTimeout(() => {
                const message = `${actionName} configuration applied successfully.`;
                // console.log(`Finished async action: ${actionName}`);
                resolve(message);
            }, duration);
        });
    }
    /**
     * @description Akhir dari fungsi simulateAsyncAction.
     */

    // --- Event Listener untuk Toggle Power Management ---
    if (powerManagementToggle) {
        // Set visual awal berdasarkan state checked
        toggleVisualEffect(powerManagementToggle, powerManagementToggle.checked);

        powerManagementToggle.addEventListener("change", async function () {
            const isActive = this.checked;
            toggleVisualEffect(this, isActive); // Update visual

            this.disabled = true; // Nonaktifkan sementara
            const actionName = isActive ? "Power Management Activation" : "Power Management Deactivation";
            const toastMessage = isActive ? "⚡ Power Management: Activated — Optimizing..." : "🛑 Power Management: Deactivated";
            const toastType = isActive ? "success" : "warning";

            showToastSettings(toastMessage, toastType);
            try {
                 const result = await simulateAsyncAction(actionName, isActive ? 1200 : 800);
                 addLog(result); // Log hasil Success
            } catch (error) {
                 console.error(`${actionName} failed:`, error);
                 showToastSettings(`Error during ${actionName}`, "danger");
            } finally {
                 this.disabled = false; // Aktifkan kembali toggle
            }
        });
    }

    // --- Event Listener untuk Toggle Security Protocol ---
    if (securityProtocolToggle) {
         // Set visual awal
         toggleVisualEffect(securityProtocolToggle, securityProtocolToggle.checked);

         securityProtocolToggle.addEventListener("change", async function () {
             const isActive = this.checked;
             toggleVisualEffect(this, isActive);

             this.disabled = true;
             const actionName = isActive ? "Security Protocol Enhancement" : "Security Protocol Relaxation";
             const toastMessage = isActive ? "🔐 Security Protocol: Enhanced" : "🔓 Security Protocol: Standard";
             const toastType = isActive ? "success" : "warning";

             showToastSettings(toastMessage, toastType);
             try {
                const result = await simulateAsyncAction(actionName, 1000);
                 addLog(result);
             } catch(error) {
                console.error(`${actionName} failed:`, error);
                showToastSettings(`Error during ${actionName}`, "danger");
             } finally {
                this.disabled = false;
             }
         });
     }

    // --- Event Listener untuk Toggle Power Saving Mode ---
    if (powerSavingModeToggle) {
         // Set visual awal
         toggleVisualEffect(powerSavingModeToggle, powerSavingModeToggle.checked);

         powerSavingModeToggle.addEventListener("change", async function () {
             const isActive = this.checked;
             toggleVisualEffect(this, isActive);

             this.disabled = true;
             const actionName = isActive ? "Entering Low-Power Mode" : "Leaving Low-Power Mode";
             const toastMessage = isActive ? "🌙 Power Saving Mode: Activated" : "💡 Power Saving Mode: Deactivated";
             const toastType = isActive ? "success" : "info";

             showToastSettings(toastMessage, toastType);
             try {
                const result = await simulateAsyncAction(actionName, isActive ? 1000 : 800);
                 addLog(result);
             } catch(error) {
                console.error(`${actionName} failed:`, error);
                showToastSettings(`Error during ${actionName}`, "danger");
             } finally {
                this.disabled = false;
             }
         });
     }

    // --- Event Listener untuk Toggle Auto Shutdown ---
    if (autoShutdownToggle) {
         // Set visual awal
         toggleVisualEffect(autoShutdownToggle, autoShutdownToggle.checked);

         autoShutdownToggle.addEventListener("change", async function () {
             const isActive = this.checked;
             toggleVisualEffect(this, isActive);

             if (isActive) {
                 // Aktifkan auto shutdown
                 const shutdownDelay = 30000; // 30 detik
                 showToastSettings(`⏰ Auto Shutdown: Activated — System will shut down in ${shutdownDelay / 1000} seconds`, "danger");
                 addLog(`Auto Shutdown scheduled in ${shutdownDelay / 1000} seconds.`);

                 // Hapus timeout sebelumnya jika ada
                 if (shutdownTimeout) clearTimeout(shutdownTimeout);

                 // Set timeout baru
                 shutdownTimeout = setTimeout(() => {
                     showToastSettings("🔴 SYSTEM SHUTDOWN INITIATED ", "danger");
                     addLog(" Auto Shutdown executed.");
                     // Di aplikasi nyata, di sini akan memanggil fungsi shutdown sistem
                     // Contoh: if (ipcRenderer) ipcRenderer.send('shutdown-system');

                     // Reset toggle secara visual setelah shutdown (simulasi)
                     this.checked = false;
                     toggleVisualEffect(this, false);
                     shutdownTimeout = null; // Reset ID timeout

                 }, shutdownDelay);

             } else {
                 // Batalkan auto shutdown jika dinonaktifkan
                 if (shutdownTimeout) {
                     clearTimeout(shutdownTimeout); // Batalkan timeout yang terjadwal
                     shutdownTimeout = null;
                     showToastSettings("⏸️ Auto Shutdown: Canceled", "info");
                     addLog("Auto Shutdown schedule canceled by user.");
                 } else {
                     // Jika tidak ada timeout aktif, tidak perlu notifikasi pembatalan
                     addLog("Auto Shutdown was not active.");
                 }
             }
         });
     }

    // Opsi untuk menampilkan log aktivitas di console secara berkala (untuk debug)
    const showActivityLogInConsole = false; // Ubah ke true jika ingin melihat log di console
    if (showActivityLogInConsole) {
        setInterval(() => {
             if (activityLog.length > 0) {
                console.groupCollapsed(`Activity Log (${activityLog.length} entries)`);
                console.table(activityLog.slice(-10)); // Tampilkan 10 log terakhir dalam tabel
                console.groupEnd();
             }
        }, 10000); // Tampilkan setiap 10 detik
    }

}); // Akhir dari DOMContentLoaded untuk Pengaturan Sistem























// Initialize Lucide icons
lucide.createIcons();

// Global variables
let currentUser = null;
let currentFolderId = null;
let currentFileId = null;
let storageChart = null;
const STORAGE_LIMIT_MB = 100; // Define storage limit (100 MB)
const MAX_FOLDERS = 4; // Max 4 folders per user
const MAX_FILES_PER_FOLDER = 10; // Max 10 files per folder

// Default folder icons
const DEFAULT_FOLDER_ICONS = [
  {
    name: "Folder Style 1",
    url: "https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/chat-media/folder%20ico/FOLDER1.ico",
  },
  {
    name: "Folder Style 2",
    url: "https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/chat-media/folder%20ico/FOLDER2.ico",
  },
  {
    name: "Folder Style 3",
    url: "https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/chat-media/folder%20ico/FOLDER3.ico",
  },
  {
    name: "Folder Style 4",
    url: "https://mnobniomzmjgpyyqartz.supabase.co/storage/v1/object/public/chat-media/folder%20ico/FOLDER4.ico",
  },
];

// Initialize the application
document.addEventListener("DOMContentLoaded", async () => {
  try {
    console.log("Supabase client:", supabase); // Debug
    if (!supabase || !supabase.auth) {
      throw new Error("Supabase client is not properly initialized.");
    }

    const { data: { user }, error } = await supabase.auth.getUser();
    if (error) throw error;
    if (!user) {
      console.warn("No authenticated user found. Redirecting to login...");
      window.location.href = "/login";
      return;
    }

    currentUser = user;

    // Initialize event listeners
    initEventListeners();

    // Load user data
    await loadUserData();

    // Load dashboard data
    await loadDashboardData();

    // Load folders
    await loadFolders();

    // Load recent files
    await loadRecentFiles();

    // Load activity feed
    await loadActivityFeed();

    // Initialize storage chart
    initStorageChart();

    // Update storage chart, system health, and security status
    await updateStorageChart();
    setInterval(updateStorageChart, 5000); // Update every 5 seconds
  } catch (error) {
    console.error("Error initializing application:", error);
    showNotification("Failed to initialize application", "error");
  }
});

// Function to show custom notification pop-up
function showNotification(message, type = "info") {
  const notificationContainer = document.createElement("div");
  notificationContainer.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white z-50 transition-all duration-300 ${
    type === "success"
      ? "bg-green-500"
      : type === "error"
      ? "bg-red-500"
      : "bg-blue-500"
  }`;
  notificationContainer.innerHTML = `
        <div class="flex items-center">
            <i data-lucide="${
              type === "success"
                ? "check-circle"
                : type === "error"
                ? "alert-circle"
                : "info"
            }" class="h-5 w-5 mr-2"></i>
            <span>${message}</span>
        </div>
    `;
  document.body.appendChild(notificationContainer);
  lucide.createIcons();

  setTimeout(() => {
    notificationContainer.classList.add("opacity-0");
    setTimeout(() => notificationContainer.remove(), 300);
  }, 3000);
}

// Function to show custom confirmation pop-up
function showConfirm(message, onConfirm, onCancel) {
  const confirmModal = document.createElement("div");
  confirmModal.className =
    "fixed inset-0 bg-black/50 flex items-center justify-center z-50";
  confirmModal.innerHTML = `
        <div class="bg-slate-800 rounded-lg p-6 w-96">
            <h3 class="text-lg font-semibold text-white mb-4">Confirmation</h3>
            <p class="text-slate-400 mb-6">${message}</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelConfirm" class="px-4 py-2 bg-slate-700 text-white rounded hover:bg-slate-600">Cancel</button>
                <button id="confirmAction" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Confirm</button>
            </div>
        </div>
    `;
  document.body.appendChild(confirmModal);

  document.getElementById("confirmAction").addEventListener("click", () => {
    onConfirm();
    confirmModal.remove();
  });

  document.getElementById("cancelConfirm").addEventListener("click", () => {
    if (onCancel) onCancel();
    confirmModal.remove();
  });
}

// Initialize event listeners
function initEventListeners() {
  // New folder button
  document.getElementById("newFolderBtn").addEventListener("click", () => {
    document.getElementById("newFolderModal").classList.remove("hidden");
  });

  // Close new folder modal
  document
    .getElementById("closeNewFolderModal")
    .addEventListener("click", () => {
      document.getElementById("newFolderModal").classList.add("hidden");
    });

  // Cancel new folder
  document.getElementById("cancelNewFolder").addEventListener("click", () => {
    document.getElementById("newFolderModal").classList.add("hidden");
  });

  // Confirm new folder
  document
    .getElementById("confirmNewFolder")
    .addEventListener("click", async () => {
      const folderName = document.getElementById("newFolderName").value.trim();
      const folderStyle = document.getElementById("newFolderStyle").value;

      if (folderName) {
        await createNewFolder(folderName, folderStyle);
        document.getElementById("newFolderModal").classList.add("hidden");
        document.getElementById("newFolderName").value = "";
      }
    });

  // Refresh button
  document.getElementById("refreshBtn").addEventListener("click", async () => {
    await loadDashboardData();
    await loadFolders();
    await loadRecentFiles();
    await loadActivityFeed();
    await updateStorageChart();
  });

  // Back from folder button
  document.getElementById("backFromFolderBtn").addEventListener("click", () => {
    document.getElementById("folderContent").classList.add("hidden");
    currentFolderId = null;
  });

  // Back from preview button
  document
    .getElementById("backFromPreviewBtn")
    .addEventListener("click", () => {
      document.getElementById("filePreview").classList.add("hidden");
      currentFileId = null;
    });

  // File input change
  document.getElementById("fileInput").addEventListener("change", async (e) => {
    if (e.target.files.length > 0 && currentFolderId) {
      await uploadFiles(e.target.files, currentFolderId);
      e.target.value = ""; // Reset file input
    }
  });

  // Notifications button
  document.getElementById("notifBtn").addEventListener("click", () => {
    document.getElementById("notificationsModal").classList.remove("hidden");
    loadNotifications();
  });

  // Close notifications modal
  document
    .getElementById("closeNotificationsModal")
    .addEventListener("click", () => {
      document.getElementById("notificationsModal").classList.add("hidden");
    });

  // View all activity
  document
    .getElementById("viewAllActivityBtn")
    .addEventListener("click", async () => {
      const modal = document.createElement("div");
      modal.className =
        "fixed inset-0 bg-black/50 flex items-center justify-center z-50";
      modal.innerHTML = `
            <div class="bg-slate-800 rounded-lg p-6 w-1/2 max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-white">All Activity</h3>
                    <button id="closeActivityModal" class="text-slate-400 hover:text-slate-200">
                        <i data-lucide="x" class="h-5 w-5"></i>
                    </button>
                </div>
                <div id="allActivityList" class="space-y-4"></div>
            </div>
        `;
      document.body.appendChild(modal);

      document
        .getElementById("closeActivityModal")
        .addEventListener("click", () => modal.remove());

      const activityList = document.getElementById("allActivityList");
      const userId = currentUser?.id;
      if (!userId) {
        activityList.innerHTML =
          '<div class="text-center text-slate-400">User not authenticated</div>';
        return;
      }

      const { data: activities, error } = await supabase
        .from("activities")
        .select("*")
        .eq("user_id", userId)
        .order("time", { ascending: false });

      if (error) {
        activityList.innerHTML =
          '<div class="text-center text-slate-400">Failed to load activities</div>';
        return;
      }

      activities.forEach((activity) => {
        const activityElement = document.createElement("div");
        activityElement.className = "flex";
        const icon =
          activity.type === "upload"
            ? "upload"
            : activity.type === "create"
            ? "folder-plus"
            : activity.type === "delete"
            ? "trash-2"
            : "alert-circle";
        const color =
          activity.type === "upload"
            ? "purple"
            : activity.type === "create"
            ? "green"
            : activity.type === "delete"
            ? "red"
            : "yellow";

        activityElement.innerHTML = `
                <div class="mr-3">
                    <div class="h-8 w-8 rounded-full bg-${color}-500/10 flex items-center justify-center">
                        <i data-lucide="${icon}" class="h-4 w-4 text-${color}-400"></i>
                    </div>
                </div>
                <div>
                    <p class="text-xs font-medium text-white">${
                      activity.title
                    }</p>
                    <p class="text-xs text-slate-400">${
                      activity.description
                    }</p>
                    <p class="text-xs text-slate-500 mt-1">${formatDate(
                      activity.time
                    )}</p>
                </div>
            `;
        activityList.appendChild(activityElement);
      });

      lucide.createIcons();
    });

  // Edit profile
  document.getElementById("editProfileBtn").addEventListener("click", () => {
    showNotification("Edit profile feature will be implemented", "info");
  });

  // Download file
  document
    .getElementById("downloadFileBtn")
    .addEventListener("click", async () => {
      if (currentFileId) {
        await downloadFile(currentFileId);
      }
    });

  // Copy link
  document.getElementById("copyLinkBtn").addEventListener("click", () => {
    const shareLinkInput = document.getElementById("shareLinkInput");
    shareLinkInput.select();
    document.execCommand("copy");

    const originalText = shareLinkInput.value;
    shareLinkInput.value = "Copied to clipboard!";
    setTimeout(() => {
      shareLinkInput.value = originalText;
    }, 2000);
  });

  // Send link
  document.getElementById("sendLinkBtn").addEventListener("click", () => {
    const modal = document.createElement("div");
    modal.className =
      "fixed inset-0 bg-black/50 flex items-center justify-center z-50";
    modal.innerHTML = `
            <div class="bg-slate-800 rounded-lg p-6 w-96">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-white">Send Link</h3>
                    <button id="closeSendLinkModal" class="text-slate-400 hover:text-slate-200">
                        <i data-lucide="x" class="h-5 w-5"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-sm text-slate-400 mb-2">Recipient Email</label>
                    <input id="recipientEmail" type="email" class="w-full bg-slate-700 text-white rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500" placeholder="Enter email">
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelSendLink" class="px-4 py-2 bg-slate-700 text-white rounded hover:bg-slate-600">Cancel</button>
                    <button id="confirmSendLink" class="px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600">Send</button>
                </div>
            </div>
        `;
    document.body.appendChild(modal);

    document
      .getElementById("closeSendLinkModal")
      .addEventListener("click", () => modal.remove());
    document
      .getElementById("cancelSendLink")
      .addEventListener("click", () => modal.remove());
    document
      .getElementById("confirmSendLink")
      .addEventListener("click", async () => {
        const email = document.getElementById("recipientEmail").value.trim();
        if (!email) {
          showNotification("Please enter a valid email", "error");
          return;
        }

        const shareLink = document.getElementById("shareLinkInput").value;

        const { data: file, error: fileError } = await supabase
          .from("files")
          .select("name")
          .eq("id", currentFileId)
          .single();

        if (fileError) {
          showNotification("Failed to fetch file details", "error");
          return;
        }

        console.log(` Sending link ${shareLink} to ${email}`);
        showNotification(`Link sent to ${email}`, "success");
        modal.remove();

        await supabase.from("notifdatacenter").insert({
          user_id: currentUser.id,
          type: "share",
          content: `Shared file "${file.name}" link with ${email}`,
          is_read: false,
        });

        await supabase.from("activities").insert({
          user_id: currentUser.id,
          type: "share",
          title: "Shared file link",
          description: `Sent to ${email}`,
        });
      });

    lucide.createIcons();
  });

  // Permissions button
  document
    .getElementById("permissionsBtn")
    .addEventListener("click", async () => {
      if (!currentFileId) return;

      const { data: file, error } = await supabase
        .from("files")
        .select("permissions, name")
        .eq("id", currentFileId)
        .single();

      if (error) {
        showNotification("Failed to load permissions", "error");
        return;
      }

      const currentPermission = file.permissions || "private";
      const modal = document.createElement("div");
      modal.className =
        "fixed inset-0 bg-black/50 flex items-center justify-center z-50";
      modal.innerHTML = `
            <div class="bg-slate-800 rounded-lg p-6 w-96">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-white">Set Permissions</h3>
                    <button id="closePermissionsModal" class="text-slate-400 hover:text-slate-200">
                        <i data-lucide="x" class="h-5 w-5"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-sm text-slate-400 mb-2">Access Level</label>
                    <select id="permissionLevel" class="w-full bg-slate-700 text-white rounded p-2 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <option value="public" ${
                          currentPermission === "public" ? "selected" : ""
                        }>Public</option>
                        <option value="private" ${
                          currentPermission === "private" ? "selected" : ""
                        }>Private</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelPermissions" class="px-4 py-2 bg-slate-700 text-white rounded hover:bg-slate-600">Cancel</button>
                    <button id="savePermissions" class="px-4 py-2 bg-cyan-500 text-white rounded hover:bg-cyan-600">Save</button>
                </div>
            </div>
        `;
      document.body.appendChild(modal);

      document
        .getElementById("closePermissionsModal")
        .addEventListener("click", () => modal.remove());
      document
        .getElementById("cancelPermissions")
        .addEventListener("click", () => modal.remove());
      document
        .getElementById("savePermissions")
        .addEventListener("click", async () => {
          const permission = document.getElementById("permissionLevel").value;

          const { error: updateError } = await supabase
            .from("files")
            .update({ permissions: permission })
            .eq("id", currentFileId);

          if (updateError) {
            showNotification("Failed to update permissions", "error");
            return;
          }

          await supabase.from("notifdatacenter").insert({
            user_id: currentUser.id,
            type: "update",
            content: `Permissions for file "${file.name}" set to ${permission}`,
            is_read: false,
          });

          await supabase.from("activities").insert({
            user_id: currentUser.id,
            type: "update",
            title: "Updated file permissions",
            description: `Set to ${permission}`,
          });

          showNotification("Permissions updated successfully", "success");
          modal.remove();
        });

      lucide.createIcons();
    });

  // Mark all as read
  document
    .getElementById("markAllAsRead")
    .addEventListener("click", async () => {
      try {
        const {
          data: { session },
          error: sessionError,
        } = await supabase.auth.getSession();
        if (sessionError) throw sessionError;
        if (!session || !session.user)
          throw new Error("User not authenticated");

        const userId = session.user.id;
        if (!userId) throw new Error("User ID not found");

        const { error } = await supabase
          .from("notifdatacenter")
          .update({ is_read: true })
          .eq("user_id", userId)
          .eq("is_read", false);

        if (error) throw error;

        showNotification("All notifications marked as read", "success");
        await loadNotifications();
      } catch (error) {
        console.error("Error marking all notifications as read:", error);
        showNotification("Failed to mark all notifications as read", "error");
      }
    });

  // Search input
  document.getElementById("searchInput").addEventListener("keyup", (e) => {
    if (e.key === "Enter") {
      const searchTerm = e.target.value.trim();
      if (searchTerm) {
        searchFiles(searchTerm);
      }
    }
  });

  // Drag and drop for upload area
  const uploadArea = document.getElementById("uploadArea");

  ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
    uploadArea.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ["dragenter", "dragover"].forEach((eventName) => {
    uploadArea.addEventListener(eventName, highlight, false);
  });

  ["dragleave", "drop"].forEach((eventName) => {
    uploadArea.addEventListener(eventName, unhighlight, false);
  });

  function highlight() {
    uploadArea.classList.add("dragover");
  }

  function unhighlight() {
    uploadArea.classList.remove("dragover");
  }

  uploadArea.addEventListener("drop", handleDrop, false);

  function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    if (files.length > 0 && currentFolderId) {
      uploadFiles(files, currentFolderId);
    }
  }
}

// Utility function to format dates
function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleString("en-US", {
    dateStyle: "medium",
    timeStyle: "short",
  });
}

// Load user data from Supabase
async function loadUserData() {
  try {
    const {
      data: { user },
    } = await supabase.auth.getUser();
    if (!user) {
      showNotification("Please log in to continue", "error");
      return;
    }

    const { data: profile, error } = await supabase
      .from("profiles")
      .select("*")
      .eq("id", user.id)
      .single();

    if (error) throw error;

    currentUser = profile;
    const avatarInitials = profile.full_name
      ? profile.full_name.slice(0, 2).toUpperCase()
      : "JD";

    document.getElementById("userName").textContent =
      profile.full_name || "User";
    document.getElementById("userAvatar").textContent = avatarInitials;
    document.getElementById("profileName").textContent =
      profile.full_name || "User";
    document.getElementById("profileRole").textContent = "Administrator";
    document.getElementById("profileEmail").textContent = profile.email;
    document.getElementById("profileAvatar").textContent = avatarInitials;
    document.getElementById(
      "lastLogin"
    ).textContent = `Last login: ${formatDate(new Date())}`;
    document.getElementById("twoFactorStatus").textContent =
      profile.show_on_leaderboard ? "2FA Enabled" : "2FA Disabled";

    document.getElementById("userName").classList.remove("animate-pulse");
    document.getElementById("profileName").classList.remove("animate-pulse");
    document.getElementById("profileRole").classList.remove("animate-pulse");
    document.getElementById("profileEmail").classList.remove("animate-pulse");
    document.getElementById("lastLogin").classList.remove("animate-pulse");
    document
      .getElementById("twoFactorStatus")
      .classList.remove("animate-pulse");
    document.getElementById("profileAvatar").classList.remove("animate-pulse");
  } catch (error) {
    console.error("Error loading user data:", error);
    showNotification("Failed to load user data", "error");
  }
}

// Load dashboard data from Supabase
async function loadDashboardData() {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { count: totalFiles } = await supabase
      .from("files")
      .select("*", { count: "exact", head: true })
      .eq("user_id", userId);

    const { count: sharedFiles } = await supabase
      .from("files")
      .select("*", { count: "exact", head: true })
      .eq("user_id", userId)
      .eq("permissions", "public");

    const { count: recentActivity } = await supabase
      .from("activities")
      .select("*", { count: "exact", head: true })
      .eq("user_id", userId)
      .gte("time", new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString());

    const { data: files } = await supabase
      .from("files")
      .select("size_mb")
      .eq("user_id", userId);

    const storageUsed = files.reduce(
      (sum, file) => sum + (file.size_mb || 0),
      0
    );
    const storagePercent = (storageUsed / STORAGE_LIMIT_MB) * 100;

    document.getElementById("totalFiles").textContent =
      totalFiles.toLocaleString();
    document.getElementById("sharedFiles").textContent =
      sharedFiles.toLocaleString();
    document.getElementById("recentActivity").textContent = recentActivity;
    document.getElementById(
      "fileGrowth"
    ).innerHTML = `<i data-lucide="trending-up" class="h-3 w-3 mr-1"></i>12%`;
    document.getElementById(
      "shareGrowth"
    ).innerHTML = `<i data-lucide="trending-up" class="h-3 w-3 mr-1"></i>8%`;
    document.getElementById(
      "activityGrowth"
    ).innerHTML = `<i data-lucide="trending-up" class="h-3 w-3 mr-1"></i>5%`;
    document.getElementById(
      "storageUsed"
    ).textContent = `Used: ${storageUsed.toFixed(2)} MB`;
    document.getElementById(
      "storagePercent"
    ).textContent = `${storagePercent.toFixed(1)}%`;
    document.getElementById(
      "storageTotal"
    ).textContent = `${STORAGE_LIMIT_MB} MB Total`;
    document.getElementById(
      "storageProgress"
    ).style.width = `${storagePercent}%`;

    if (storageChart) {
      storageChart.data.datasets[0].data = [
        storageUsed,
        STORAGE_LIMIT_MB - storageUsed,
      ];
      storageChart.update();
    }

    document.getElementById("totalFiles").classList.remove("animate-pulse");
    document.getElementById("sharedFiles").classList.remove("animate-pulse");
    document.getElementById("recentActivity").classList.remove("animate-pulse");

    lucide.createIcons();
  } catch (error) {
    console.error("Error loading dashboard data:", error);
    showNotification("Failed to load dashboard data", "error");
  }
}

// Calculate folder stats dynamically
async function calculateFolderStats(folderId) {
  const { data: files, error } = await supabase
    .from("files")
    .select("size_mb")
    .eq("folder_id", folderId);

  if (error) throw error;

  const fileCount = files.length;
  const totalSizeMB = files.reduce((sum, file) => sum + (file.size_mb || 0), 0);

  return { fileCount, size_mb: totalSizeMB };
}

// Load folders from Supabase
async function loadFolders() {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { data: folders, error } = await supabase
      .from("folders")
      .select("*")
      .eq("user_id", userId);

    if (error) throw error;

    const foldersContainer = document.getElementById("foldersContainer");
    foldersContainer.innerHTML = "";

    const foldersWithStats = await Promise.all(
      folders.map(async (folder) => {
        const stats = await calculateFolderStats(folder.id);
        return {
          ...folder,
          fileCount: stats.fileCount,
          size_mb: stats.size_mb,
        };
      })
    );

    foldersWithStats.forEach((folder) => {
      const folderElement = document.createElement("div");
      folderElement.className =
        "relative cursor-pointer transition-all duration-300 w-24 h-28 mr-4 mb-4 inline-block touch-ripple";
      folderElement.dataset.id = folder.id;

      const folderIcon = folder.icon_url || DEFAULT_FOLDER_ICONS[0].url;

      folderElement.innerHTML = `
                <div class="flex items-center space-x-2">
                    <div class="w-20 h-20">
                        <img src="${folderIcon}" alt="Folder Icon" class="w-full h-full object-contain">
                    </div>
                    <div class="relative">
    <button class="folder-menu-btn bg-slate-700/50 hover:bg-slate-600/50 rounded-full p-1">
        <i data-lucide="more-vertical" class="h-4 w-4 text-slate-400"></i>
    </button>
    <div class="folder-menu hidden absolute left-1/2 -translate-x-1/2 mt-2 w-48 bg-slate-800 rounded-lg shadow-lg z-10">
        <button class="folder-settings-btn block w-full text-left px-4 py-1 text-xs text-white hover:bg-slate-700/50">Change Icon</button>
        <button class="folder-delete-btn block w-full text-left px-4 py-1 text-xs text-white hover:bg-slate-700/50">Delete Folder</button>
    </div>
</div>
                </div>
                <div class="text-center mt-1">
                    <h4 class="text-xs font-medium text-white truncate">${
                      folder.name
                    }</h4>
                    <div class="text-xs text-slate-400">${
                      folder.fileCount || 0
                    } files • ${(folder.size_mb || 0).toFixed(2)} MB</div>
                </div>
            `;

      const menuBtn = folderElement.querySelector(".folder-menu-btn");
      const menu = folderElement.querySelector(".folder-menu");
      menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        menu.classList.toggle("hidden");
      });

      document.addEventListener("click", (e) => {
        if (!folderElement.contains(e.target)) {
          menu.classList.add("hidden");
        }
      });

      folderElement.addEventListener("click", (e) => {
        if (
          !e.target.closest(".folder-menu-btn") &&
          !e.target.closest(".folder-menu")
        ) {
          folderElement.classList.add("touch-ripple-active");
          setTimeout(
            () => folderElement.classList.remove("touch-ripple-active"),
            300
          );
          openFolder(folder.id, folder.name);
        }
      });

      folderElement
        .querySelector(".folder-settings-btn")
        .addEventListener("click", async (e) => {
          e.stopPropagation();
          const input = document.createElement("input");
          input.type = "file";
          input.accept = ".ico";
          input.onchange = async (event) => {
            const file = event.target.files[0];
            if (file) {
              await changeFolderIcon(folder.id, file);
            }
          };
          input.click();
        });

      folderElement
        .querySelector(".folder-delete-btn")
        .addEventListener("click", (e) => {
          e.stopPropagation();
          showConfirm(
            "Are you sure you want to delete this folder and all its files?",
            async () => {
              await deleteFolder(folder.id);
            },
            () => {}
          );
        });

      foldersContainer.appendChild(folderElement);
    });

    const newFolderBtn = document.createElement("div");
    newFolderBtn.className =
      "w-24 h-28 inline-block mr-4 mb-4 rounded-lg bg-slate-800/20 border-2 border-dashed border-slate-700/50 hover:border-cyan-500/50 cursor-pointer transition-all flex flex-col items-center justify-center";
    newFolderBtn.innerHTML = `
            <div class="p-3 rounded-full bg-slate-800/50 mb-2">
                <i data-lucide="plus" class="h-5 w-5 text-slate-400"></i>
            </div>
            <h4 class="text-xs font-medium text-slate-400 text-center">Add New Folder</h4>
        `;
    newFolderBtn.addEventListener("click", () => {
      document.getElementById("newFolderModal").classList.remove("hidden");
    });

    foldersContainer.appendChild(newFolderBtn);

    lucide.createIcons();
  } catch (error) {
    console.error("Error loading folders:", error);
    showNotification("Failed to load folders", "error");
  }
}

// Create new folder in Supabase
async function createNewFolder(name, style) {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { count: folderCount } = await supabase
      .from("folders")
      .select("*", { count: "exact", head: true })
      .eq("user_id", userId);

    if (folderCount >= MAX_FOLDERS) {
      showNotification("Maximum folder limit reached (4 folders)", "error");
      return;
    }

    const selectedIcon = DEFAULT_FOLDER_ICONS.find(
      (icon) => icon.name === style
    );
    const iconUrl = selectedIcon
      ? selectedIcon.url
      : DEFAULT_FOLDER_ICONS[0].url;

    const { data, error } = await supabase
      .from("folders")
      .insert({ user_id: userId, name, icon_url: iconUrl })
      .select()
      .single();

    if (error) throw error;

    await supabase.from("notifdatacenter").insert({
      user_id: userId,
      type: "create",
      content: `New folder "${name}" created`,
      is_read: false,
    });

    await supabase.from("activities").insert({
      user_id: userId,
      type: "create",
      title: "Created new folder",
      description: name,
    });

    await loadFolders();
    showNotification("Folder created successfully", "success");
  } catch (error) {
    console.error("Error creating folder:", error);
    showNotification("Failed to create folder", "error");
  }
}

// Change folder icon
async function changeFolderIcon(folderId, file) {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { data: folder, error: folderError } = await supabase
      .from("folders")
      .select("name")
      .eq("id", folderId)
      .single();

    if (folderError) throw folderError;

    if (!file.name.endsWith(".ico")) {
      showNotification("Please upload an .ico file", "error");
      return;
    }

    const filePath = `${userId}/folder-icons/${folderId}/${file.name}`;
    const { error: uploadError } = await supabase.storage
      .from("files")
      .upload(filePath, file, { upsert: true });

    if (uploadError) throw uploadError;

    const {
      data: { publicUrl },
    } = supabase.storage.from("files").getPublicUrl(filePath);

    const { error: updateError } = await supabase
      .from("folders")
      .update({ icon_url: publicUrl })
      .eq("id", folderId);

    if (updateError) throw updateError;

    await supabase.from("notifdatacenter").insert({
      user_id: userId,
      type: "update",
      content: `Icon for folder "${folder.name}" updated`,
      is_read: false,
    });

    await loadFolders();
    showNotification("Folder icon updated successfully", "success");
  } catch (error) {
    console.error("Error changing folder icon:", error);
    showNotification("Failed to change folder icon", "error");
  }
}

// Delete folder and its files
async function deleteFolder(folderId) {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { data: folder, error: folderError } = await supabase
      .from("folders")
      .select("name")
      .eq("id", folderId)
      .single();

    if (folderError) throw folderError;

    const { data: files, error: filesError } = await supabase
      .from("files")
      .select("url")
      .eq("folder_id", folderId);

    if (filesError) throw filesError;

    const filePaths = files.map((file) => file.url.split("/files/")[1]);
    if (filePaths.length > 0) {
      const { error: storageError } = await supabase.storage
        .from("files")
        .remove(filePaths);

      if (storageError) throw storageError;
    }

    const { error: filesDbError } = await supabase
      .from("files")
      .delete()
      .eq("folder_id", folderId);

    if (filesDbError) throw filesDbError;

    const { error: folderDeleteError } = await supabase
      .from("folders")
      .delete()
      .eq("id", folderId);

    if (folderDeleteError) throw folderDeleteError;

    await supabase.from("notifdatacenter").insert({
      user_id: userId,
      type: "delete",
      content: `Folder "${folder.name}" deleted`,
      is_read: false,
    });

    await supabase.from("activities").insert({
      user_id: userId,
      type: "delete",
      title: "Deleted folder",
      description: folder.name,
    });

    await loadFolders();
    showNotification("Folder deleted successfully", "success");
    await loadDashboardData();
    await updateStorageChart();
  } catch (error) {
    console.error("Error deleting folder:", error);
    showNotification("Failed to delete folder", "error");
  }
}

// Open folder and load its files
async function openFolder(folderId, folderName) {
  try {
    currentFolderId = folderId;
    document.getElementById("folderName").textContent = folderName;
    document.getElementById("folderContent").classList.remove("hidden");
    document.getElementById("folderFilesContainer").innerHTML = "";

    const { data: files, error } = await supabase
      .from("files")
      .select("*")
      .eq("folder_id", folderId);

    if (error) throw error;

    const filesContainer = document.getElementById("folderFilesContainer");

    files.forEach((file) => {
      const fileElement = document.createElement("div");
      fileElement.className =
        "bg-slate-800/50 rounded-lg p-3 border border-slate-700/50 cursor-pointer hover:border-cyan-500/30 transition-all file-item relative group";
      fileElement.dataset.id = file.id;

      let previewContent = `
                <div class="aspect-square bg-slate-800/30 rounded mb-2 overflow-hidden flex items-center justify-center">
            `;
      if (file.type === "image") {
        previewContent += `<img src="${
          file.url || "https://via.placeholder.com/300"
        }" alt="Preview" class="w-full h-full object-cover">`;
      } else if (file.type === "video") {
        previewContent += `
                    <video class="w-full h-full object-cover" muted>
                        <source src="${file.url}" type="${
          file.mime_type || "video/mp4"
        }">
                        Your browser does not support the video tag.
                    </video>
                `;
      } else if (file.type === "document") {
        previewContent += `<i data-lucide="file-text" class="h-16 w-16 text-cyan-400"></i>`;
      } else {
        previewContent += `<i data-lucide="file" class="h-16 w-16 text-cyan-400"></i>`;
      }
      previewContent += `</div>`;

      fileElement.innerHTML = `
                ${previewContent}
                <div class="flex items-center justify-between">
                    <span class="text-xs font-medium text-white truncate">${
                      file.name
                    }</span>
                    <span class="text-xs text-slate-400">${file.size_mb.toFixed(
                      2
                    )} MB</span>
                </div>
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 rounded-lg flex items-center justify-center space-x-2">
                    <button class="file-view-btn bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white rounded-full p-2 transition-all">
                        <i data-lucide="eye" class="h-4 w-4"></i>
                    </button>
                    <button class="file-download-btn bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white rounded-full p-2 transition-all">
                        <i data-lucide="download" class="h-4 w-4"></i>
                    </button>
                    <button class="file-delete-btn bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white rounded-full p-2 transition-all">
                        <i data-lucide="trash-2" class="h-4 w-4"></i>
                    </button>
                </div>
            `;

      fileElement
        .querySelector(".file-view-btn")
        .addEventListener("click", (e) => {
          e.stopPropagation();
          viewFile(file.id, file.name, file.url, file.type, file.size_mb);
        });

      fileElement
        .querySelector(".file-download-btn")
        .addEventListener("click", (e) => {
          e.stopPropagation();
          downloadFile(file.id);
        });

      fileElement
        .querySelector(".file-delete-btn")
        .addEventListener("click", (e) => {
          e.stopPropagation();
          showConfirm(
            "Are you sure you want to delete this file?",
            async () => {
              await deleteFile(file.id);
            },
            () => {}
          );
        });

      filesContainer.appendChild(fileElement);
    });

    setTimeout(() => {
      const folderContent = document.getElementById("folderContent");
      folderContent.scrollIntoView({ behavior: "smooth", block: "end" });
    }, 100);

    lucide.createIcons();
  } catch (error) {
    console.error("Error opening folder:", error);
    showNotification("Failed to open folder", "error");
  }
}

// Upload files to Supabase Storage and save metadata
async function uploadFiles(files, folderId) {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { data: allFiles } = await supabase
      .from("files")
      .select("size_mb")
      .eq("user_id", userId);

    const currentStorageUsed = allFiles.reduce(
      (sum, file) => sum + (file.size_mb || 0),
      0
    );
    const newFilesSize = Array.from(files).reduce(
      (sum, file) => sum + file.size / (1024 * 1024),
      0
    );
    if (currentStorageUsed + newFilesSize > STORAGE_LIMIT_MB) {
      throw new Error("Storage limit exceeded (100 MB)");
    }

    const { count: fileCount } = await supabase
      .from("files")
      .select("*", { count: "exact", head: true })
      .eq("folder_id", folderId);

    if (fileCount + files.length > MAX_FILES_PER_FOLDER) {
      throw new Error("Folder file limit exceeded (10 files per folder)");
    }

    const { data: folder, error: folderError } = await supabase
      .from("folders")
      .select("name")
      .eq("id", folderId)
      .single();

    if (folderError) throw folderError;

    const uploadArea = document.getElementById("uploadArea");
    const originalContent = uploadArea.innerHTML;
    uploadArea.innerHTML = `
            <div class="text-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400 mx-auto mb-2"></div>
                <p class="text-sm text-slate-400">Uploading ${files.length} file(s)...</p>
            </div>
        `;

    const uploadedFiles = [];
    for (const file of files) {
      if (file.size > 10 * 1024 * 1024) {
        throw new Error(`File ${file.name} exceeds 10MB limit`);
      }

      const filePath = `${userId}/${folderId}/${file.name}`;
      const { error: uploadError } = await supabase.storage
        .from("files")
        .upload(filePath, file);

      if (uploadError) throw uploadError;

      const {
        data: { publicUrl },
      } = supabase.storage.from("files").getPublicUrl(filePath);

      let fileType;
      if (file.type.startsWith("image")) fileType = "image";
      else if (file.type.startsWith("video")) fileType = "video";
      else if (file.type.startsWith("application")) fileType = "document";
      else fileType = "file";

      const { data, error: dbError } = await supabase
        .from("files")
        .insert({
          folder_id: folderId,
          user_id: userId,
          name: file.name,
          type: fileType,
          size_mb: file.size / (1024 * 1024),
          url: publicUrl,
          mime_type: file.type,
          permissions: "private",
        })
        .select()
        .single();

      if (dbError) throw dbError;

      uploadedFiles.push(data);

      await supabase.from("notifdatacenter").insert({
        user_id: userId,
        type: "upload",
        content: `File "${file.name}" uploaded to folder "${folder.name}"`,
        is_read: false,
      });

      await supabase.from("activities").insert({
        user_id: userId,
        type: "upload",
        title: "Uploaded new file",
        description: file.name,
      });
    }

    uploadArea.innerHTML = `
            <div class="text-center">
                <i data-lucide="check-circle" class="h-8 w-8 text-green-400 mx-auto mb-2"></i>
                <p class="text-sm text-slate-400">Uploaded ${files.length} file(s) successfully!</p>
            </div>
        `;

    lucide.createIcons();

    setTimeout(async () => {
      uploadArea.innerHTML = originalContent;
      await openFolder(
        folderId,
        document.getElementById("folderName").textContent
      );
      await loadFolders();
      await loadDashboardData();
      await updateStorageChart();
    }, 2000);
  } catch (error) {
    console.error("Error uploading files:", error);
    document.getElementById("uploadArea").innerHTML = `
            <div class="text-center">
                <i data-lucide="alert-circle" class="h-8 w-8 text-red-400 mx-auto mb-2"></i>
                <p class="text-sm text-slate-400">Failed to upload files: ${error.message}</p>
                <button class="mt-2 text-cyan-400 hover:text-cyan-300 text-xs font-medium">
                    Try Again
                </button>
            </div>
        `;
    lucide.createIcons();
  }
}

// View file details
async function viewFile(fileId, fileName, fileUrl, fileType, fileSize) {
  try {
    currentFileId = fileId;
    document.getElementById("fileName").textContent = fileName;
    document.getElementById("filePreview").classList.remove("hidden");
    document.getElementById("filePreviewContent").innerHTML = `
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto mb-4"></div>
                <p class="text-slate-400">Loading preview...</p>
            </div>
        `;

    const { data: file, error } = await supabase
      .from("files")
      .select("*")
      .eq("id", fileId)
      .single();

    if (error) throw error;

    const fileInfoHtml = `
            <div class="flex justify-between">
                <span class="text-slate-400">Name:</span>
                <span class="text-white font-medium">${file.name}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-slate-400">Type:</span>
                <span class="text-white font-medium">${
                  file.type.charAt(0).toUpperCase() + file.type.slice(1)
                }</span>
            </div>
            <div class="flex justify-between">
                <span class="text-slate-400">Size:</span>
                <span class="text-white font-medium">${file.size_mb.toFixed(
                  2
                )} MB</span>
            </div>
            <div class="flex justify-between">
                <span class="text-slate-400">Dimensions:</span>
                <span class="text-white font-medium">${
                  file.type === "image" ? "1920 × 1080 px" : "N/A"
                }</span>
            </div>
            <div class="flex justify-between">
                <span class="text-slate-400">Uploaded:</span>
                <span class="text-white font-medium">${formatDate(
                  file.uploaded_at
                )}</span>
            </div>
            <div class="flex justify-between">
                <span class="text-slate-400">Modified:</span>
                <span class="text-white font-medium">${formatDate(
                  file.modified_at
                )}</span>
            </div>
        `;

    document.getElementById("fileInfo").innerHTML = fileInfoHtml;
    document.getElementById("shareLinkInput").value =
      file.url || `https://datacenter.com/share/${fileId}`;

    setTimeout(() => {
      if (file.type === "image") {
        document.getElementById("filePreviewContent").innerHTML = `
                    <img src="${file.url}" alt="${file.name}" class="w-full h-auto max-h-[500px] object-contain">
                `;
      } else if (file.type === "video") {
        document.getElementById("filePreviewContent").innerHTML = `
                    <video controls class="w-full h-auto max-h-[500px]">
                        <source src="${file.url}" type="${
          file.mime_type || "video/mp4"
        }">
                        Your browser does not support the video tag.
                    </video>
                `;
      } else if (file.type === "document") {
        const supportedDocs = [
          "application/pdf",
          "application/msword",
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
        ];

        if (supportedDocs.includes(file.mime_type)) {
          const viewerUrl = `https://docs.google.com/viewer?url=${encodeURIComponent(
            file.url
          )}&embedded=true`;
          document.getElementById("filePreviewContent").innerHTML = `
                        <iframe src="${viewerUrl}" class="w-full h-[500px] border-0" sandbox="allow-same-origin allow-scripts"></iframe>
                    `;
        } else {
          document.getElementById("filePreviewContent").innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full">
                            <i data-lucide="file-text" class="h-16 w-16 text-cyan-400 mb-4"></i>
                            <p class="text-slate-400">No direct preview available. <a href="${file.url}" target="_blank" class="text-cyan-400 hover:underline">Download</a></p>
                        </div>
                    `;
          lucide.createIcons();
        }
      } else {
        document.getElementById("filePreviewContent").innerHTML = `
                    <div class="flex items-center justify-center h-full">
                        <div class="text-center">
                            <i data-lucide="file" class="h-16 w-16 text-cyan-400 mx-auto mb-4"></i>
                            <p class="text-slate-400">No preview available for this file type</p>
                        </div>
                    </div>
                `;
        lucide.createIcons();
      }
    }, 1000);
  } catch (error) {
    console.error("Error viewing file:", error);
    document.getElementById("filePreviewContent").innerHTML = `
            <div class="flex items-center justify-center h-full">
                <div class="text-center">
                    <i data-lucide="alert-circle" class="h-16 w-16 text-red-400 mx-auto mb-4"></i>
                    <p class="text-slate-400">Failed to load file preview</p>
                </div>
            </div>
        `;
    lucide.createIcons();
  }
}

// Download file from Supabase Storage
async function downloadFile(fileId) {
  try {
    const { data: file, error } = await supabase
      .from("files")
      .select("url")
      .eq("id", fileId)
      .single();

    if (error) throw error;

    window.open(file.url, "_blank");
  } catch (error) {
    console.error("Error downloading file:", error);
    showNotification("Failed to download file", "error");
  }
}

// Delete file from Supabase Storage and database
async function deleteFile(fileId) {
  try {
    const { data: file, error: fetchError } = await supabase
      .from("files")
      .select("url, folder_id, name")
      .eq("id", fileId)
      .single();

    if (fetchError) throw fetchError;

    const { data: folder, error: folderError } = await supabase
      .from("folders")
      .select("name")
      .eq("id", file.folder_id)
      .single();

    if (folderError) throw folderError;

    const filePath = file.url.split("/files/")[1];
    const { error: storageError } = await supabase.storage
      .from("files")
      .remove([filePath]);

    if (storageError) throw storageError;

    const { error: dbError } = await supabase
      .from("files")
      .delete()
      .eq("id", fileId);

    if (dbError) throw dbError;

    await supabase.from("notifdatacenter").insert({
      user_id: currentUser.id,
      type: "delete",
      content: `File "${file.name}" deleted from folder "${folder.name}"`,
      is_read: false,
    });

    await supabase.from("activities").insert({
      user_id: currentUser.id,
      type: "delete",
      title: "Deleted file",
      description: file.name,
    });

    if (currentFolderId) {
      await openFolder(
        currentFolderId,
        document.getElementById("folderName").textContent
      );
    }

    await loadFolders();
    await loadDashboardData();
    await updateStorageChart();

    showNotification("File deleted successfully", "success");
  } catch (error) {
    console.error("Error deleting file:", error);
    showNotification("Failed to delete file", "error");
  }
}

// Load recent files from Supabase
async function loadRecentFiles() {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { data: files, error } = await supabase
      .from("files")
      .select("*")
      .eq("user_id", userId)
      .order("modified_at", { ascending: false })
      .limit(5);

    if (error) throw error;

    const recentFilesContainer = document.getElementById(
      "recentFilesContainer"
    );
    recentFilesContainer.innerHTML = "";

    files.forEach((file) => {
      const fileElement = document.createElement("div");
      fileElement.className =
        "grid grid-cols-12 p-3 hover:bg-slate-800/50 transition-all cursor-pointer file-item";
      fileElement.dataset.id = file.id;

      const icon = file.type === "image" ? "image" : "file-text";
      const color = file.type === "image" ? "green" : "blue";

      fileElement.innerHTML = `
                <div class="col-span-6 flex items-center">
                    <i data-lucide="${icon}" class="h-4 w-4 text-${color}-400 mr-2"></i>
                    <span class="text-sm font-medium text-white">${
                      file.name
                    }</span>
                </div>
                <div class="col-span-2 text-sm text-slate-400 flex items-center">${
                  file.type.charAt(0).toUpperCase() + file.type.slice(1)
                }</div>
                <div class="col-span-2 text-sm text-slate-400 flex items-center">${file.size_mb.toFixed(
                  2
                )} MB</div>
                <div class="col-span-2 text-sm text-slate-400 flex items-center">${formatDate(
                  file.modified_at
                )}</div>
            `;

      fileElement.addEventListener("click", () => {
        viewFile(file.id, file.name, file.url, file.type, file.size_mb);
      });
      

      recentFilesContainer.appendChild(fileElement);
    });

    lucide.createIcons();
  } catch (error) {
    console.error("Error loading recent files:", error);
    showNotification("Failed to load recent files", "error");
  }
}


// Load activity feed from Supabase
async function loadActivityFeed() {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { data: activities, error } = await supabase
      .from("activities")
      .select("*")
      .eq("user_id", userId)
      .order("time", { ascending: false })
      .limit(5);

    if (error) throw error;

    const activityFeed = document.getElementById("activityFeed");
    activityFeed.innerHTML = "";

    activities.forEach((activity) => {
      const activityElement = document.createElement("div");
      activityElement.className = "flex";
      const icon =
        activity.type === "upload"
          ? "upload"
          : activity.type === "create"
          ? "folder-plus"
          : activity.type === "delete"
          ? "trash-2"
          : "alert-circle";
      const color =
        activity.type === "upload"
          ? "purple"
          : activity.type === "create"
          ? "green"
          : activity.type === "delete"
          ? "red"
          : "yellow";

      activityElement.innerHTML = `
                <div class="mr-3">
                    <div class="h-8 w-8 rounded-full bg-${color}-500/10 flex items-center justify-center">
                        <i data-lucide="${icon}" class="h-4 w-4 text-${color}-400"></i>
                    </div>
                </div>
                <div>
                    <p class="text-xs font-medium text-white">${
                      activity.title
                    }</p>
                    <p class="text-xs text-slate-400">${
                      activity.description
                    }</p>
                    <p class="text-xs text-slate-500 mt-1">${formatDate(
                      activity.time
                    )}</p>
                </div>
            `;

      activityFeed.appendChild(activityElement);
    });

    lucide.createIcons();
  } catch (error) {
    console.error("Error loading activity feed:", error);
    showNotification("Failed to load activity feed", "error");
  }
}

// Load notifications from Supabase and enable real-time updates
async function loadNotifications() {
  try {
    const {
      data: { session },
      error: sessionError,
    } = await supabase.auth.getSession();
    if (sessionError) throw sessionError;
    if (!session || !session.user) throw new Error("User not authenticated");

    const userId = session.user.id;
    if (!userId) throw new Error("User ID not found");

    const notificationsList = document.getElementById("notificationsList");
    const notifBadge = document.getElementById("notifBadge");

    async function refreshNotifications() {
      const { data: notifications, error } = await supabase
        .from("notifdatacenter")
        .select("*")
        .eq("user_id", userId)
        .order("created_at", { ascending: false });

      if (error) throw error;

      if (notifications.length === 0) {
        notificationsList.innerHTML =
          '<div class="text-center text-slate-400">No notifications available</div>';
        notifBadge.classList.add("hidden");
        return;
      }

      const unreadCount = notifications.filter(
        (notif) => !notif.is_read
      ).length;
      if (unreadCount > 0) {
        notifBadge.textContent = unreadCount;
        notifBadge.classList.remove("hidden");
      } else {
        notifBadge.classList.add("hidden");
      }

      notificationsList.innerHTML = "";
      notifications.forEach((notif) => {
        const notifElement = document.createElement("div");
        notifElement.className = `flex items-start p-3 hover:bg-slate-700/50 transition-all cursor-pointer rounded-lg ${
          notif.is_read ? "opacity-50" : ""
        }`;
        notifElement.dataset.id = notif.id;

        let icon = "bell";
        let color = "cyan";
        if (notif.type === "upload") icon = "upload";
        else if (notif.type === "delete") icon = "trash-2";
        else if (notif.type === "warning") icon = "alert-circle";
        else if (notif.type === "create") icon = "folder-plus";
        else if (notif.type === "share") icon = "share-2";
        else if (notif.type === "update") icon = "edit";

        notifElement.innerHTML = `
                    <div class="mr-3">
                        <div class="h-8 w-8 rounded-full bg-${color}-500/10 flex items-center justify-center">
                            <i data-lucide="${icon}" class="h-4 w-4 text-${color}-400"></i>
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-white">${
                          notif.type.charAt(0).toUpperCase() +
                          notif.type.slice(1)
                        }</p>
                        <p class="text-xs text-slate-400">${notif.content}</p>
                        <p class="text-xs text-slate-500 mt-1">${formatDate(
                          notif.created_at
                        )}</p>
                    </div>
                    <div class="ml-2">
                        <button class="mark-read-btn text-slate-400 hover:text-cyan-400">
                            <i data-lucide="${
                              notif.is_read ? "check" : "circle"
                            }"></i>
                        </button>
                    </div>
                `;

        notifElement
          .querySelector(".mark-read-btn")
          .addEventListener("click", async (e) => {
            e.stopPropagation();
            if (!notif.is_read) {
              await markNotificationAsRead(notif.id);
              await refreshNotifications();
            }
          });

        notificationsList.appendChild(notifElement);
      });

      lucide.createIcons();
    }

    await refreshNotifications();

    const channel = supabase
      .channel("notifdatacenter-changes")
      .on(
        "postgres_changes",
        {
          event: "*",
          schema: "public",
          table: "notifdatacenter",
          filter: `user_id=eq.${userId}`,
        },
        (payload) => {
          console.log("Change received:", payload);
          refreshNotifications();
        }
      )
      .subscribe();

    return () => {
      channel.unsubscribe();
    };
  } catch (error) {
    console.error("Error loading notifications:", error);
    showNotification("Failed to load notifications", "error");
  }
}

// Mark a single notification as read
async function markNotificationAsRead(notificationId) {
  try {
    const { error } = await supabase
      .from("notifdatacenter")
      .update({ is_read: true })
      .eq("id", notificationId);

    if (error) throw error;

    showNotification("Notification marked as read", "success");
  } catch (error) {
    console.error("Error marking notification as read:", error);
    showNotification("Failed to mark notification as read", "error");
  }
}

let searchTimeout;

// Gunakan debounce untuk menghindari banyak request selama mengetik
function setupSearchInput() {
  const searchInput = document.getElementById("searchInput");
  if (!searchInput) return;

  searchInput.addEventListener("input", () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const term = searchInput.value.trim();
      if (term.length >= 1) {
        searchFiles(term);
      } else {
        resetFileList(); // Reset jika kosong
      }
    }, 300); // Delay 300ms
  });
}

// Search files with relevance sorting and highlighting
async function searchFiles(searchTerm) {
  try {
    const userId = currentUser?.id;
    if (!userId) throw new Error("User not authenticated");

    const { data: files, error } = await supabase
      .from("files")
      .select("*, folders(name)")
      .eq("user_id", userId)
      .ilike("name", `%${searchTerm}%`);

    if (error) throw error;

    const recentFilesContainer = document.getElementById("recentFilesContainer");
    recentFilesContainer.innerHTML = "";

    if (files.length === 0) {
      recentFilesContainer.innerHTML =
        '<div class="text-center text-slate-400">No files found matching your search.</div>';
      return;
    }

    // Prioritaskan file yang **dimulai dengan** searchTerm
    const sortedFiles = files.sort((a, b) => {
      const aStartsWith = a.name.toLowerCase().startsWith(searchTerm.toLowerCase());
      const bStartsWith = b.name.toLowerCase().startsWith(searchTerm.toLowerCase());
      return bStartsWith - aStartsWith; // Yang match paling depan
    });

    sortedFiles.forEach((file) => {
      const fileElement = document.createElement("div");
      fileElement.className =
        "grid grid-cols-12 p-3 hover:bg-slate-800/50 transition-all cursor-pointer file-item";
      fileElement.dataset.id = file.id;
      fileElement.id = `file-${file.id}`; // ID unik untuk scroll

      const icon = file.type === "image" ? "image" : "file-text";
      const color = file.type === "image" ? "green" : "blue";

      // Highlight kata kunci dalam nama file
      const highlightedName = file.name.replace(
        new RegExp(`(${searchTerm})`, "gi"),
        "<mark class='bg-yellow-600'>$1</mark>"
      );

      fileElement.innerHTML = `
                <div class="col-span-5 flex items-center">
                    <i data-lucide="${icon}" class="h-4 w-4 text-${color}-400 mr-2"></i>
                    <span class="text-sm font-medium text-white">${highlightedName}</span>
                </div>
                <div class="col-span-2 text-sm text-slate-400 flex items-center">${
                  file.folders.name
                }</div>
                <div class="col-span-2 text-sm text-slate-400 flex items-center">${
                  file.type.charAt(0).toUpperCase() + file.type.slice(1)
                }</div>
                <div class="col-span-1 text-sm text-slate-400 flex items-center">${file.size_mb.toFixed(
                  2
                )} MB</div>
                <div class="col-span-2 text-sm text-slate-400 flex items-center">${formatDate(
                  file.modified_at
                )}</div>
            `;

      fileElement.addEventListener("click", () => {
        viewFile(file.id, file.name, file.url, file.type, file.size_mb);
        scrollToElement(fileElement); // Scroll ke file
      });

      recentFilesContainer.appendChild(fileElement);
    });

    lucide.createIcons();
  } catch (error) {
    console.error("Error searching files:", error);
    showNotification("Failed to search files", "error");
  }
}

// Scroll animasi ke elemen file saat diklik
function scrollToElement(element) {
  element.scrollIntoView({ behavior: "smooth", block: "center" });
  element.classList.add("bg-orange-500/30"); // Efek highlight opsional
  setTimeout(() => {
    element.classList.remove("bg-orange-500/30");
  }, 1500);
}

// Reset ke tampilan awal (misalkan menggunakan Recent Files atau all files)
function resetFileList() {
  const recentFilesContainer = document.getElementById("recentFilesContainer");
  recentFilesContainer.innerHTML = ""; // Kosongkan dulu

  // Misalnya panggil fungsi loadRecentFiles() atau render semua file
  loadRecentFiles(); // Harus ada fungsi ini di kode Anda
}

// Initialize storage chart
function initStorageChart() {
  const ctx = document.getElementById("storageChart").getContext("2d");
  storageChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Used", "Free"],
      datasets: [
        {
          data: [0, STORAGE_LIMIT_MB],
          backgroundColor: ["#06b6d4", "#334155"],
          borderWidth: 0,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: "80%",
      plugins: {
        legend: {
          display: false,
        },
      },
    },
  });
}

// Update storage chart, system health, and security status with current usage
async function updateStorageChart() {
  try {
    const userId = currentUser?.id;
    if (!userId) {
      console.warn("User not authenticated, skipping updates.");
      storageChart.data.datasets[0].data = [0, STORAGE_LIMIT_MB];
      storageChart.update();
      document.getElementById("cpuUsage").textContent = "N/A";
      document.getElementById("cpuProgress").style.width = "0%";
      document.getElementById("memoryUsage").textContent = "N/A";
      document.getElementById("memoryProgress").style.width = "0%";
      document.getElementById("diskUsage").textContent = "N/A";
      document.getElementById("diskProgress").style.width = "0%";
      document.getElementById("networkUsage").textContent = "N/A";
      document.getElementById("networkProgress").style.width = "0%";
      document.getElementById("securityStatusDot").className =
        "h-2 w-2 rounded-full bg-red-500 mr-2";
      document.getElementById("securityStatusText").textContent = "Vulnerable";
      document.getElementById("securityStatusBadge").textContent = "0%";
      document.getElementById("securityChecks").innerHTML = "";
      return;
    }

    const { data: files, error } = await supabase
      .from("files")
      .select("size_mb")
      .eq("user_id", userId);

    if (error) throw error;

    const storageUsed = files.reduce(
      (sum, file) => sum + (file.size_mb || 0),
      0
    );
    const storageFree = STORAGE_LIMIT_MB - storageUsed;

    const storagePercentage = (storageUsed / STORAGE_LIMIT_MB) * 100;
    if (storagePercentage >= 80) {
      const { data: existingNotifs } = await supabase
        .from("notifdatacenter")
        .select("*")
        .eq("user_id", userId)
        .eq("type", "warning")
        .eq("content", "Storage usage is above 80%!");

      if (!existingNotifs || existingNotifs.length === 0) {
        await supabase.from("notifdatacenter").insert({
          user_id: userId,
          type: "warning",
          content: "Storage usage is above 80%!",
          is_read: false,
        });
      }
    }

    storageChart.data.datasets[0].data = [storageUsed, storageFree];
    storageChart.update();

    let cpuUsage = 0;
    let memoryUsage = 0;
    let diskIOUsage = 0;
    let networkUsage = 0;

    if (storageUsed > 0) {
      cpuUsage = Math.min(storageUsed / 10, 10);
      memoryUsage = Math.min(storageUsed / 5, 20);
      diskIOUsage = Math.min(storageUsed / 5, 50);
      networkUsage = Math.min(storageUsed / 10, 30);
    }

    document.getElementById("cpuUsage").textContent = `${cpuUsage.toFixed(1)}%`;
    document.getElementById("cpuProgress").style.width = `${cpuUsage}%`;
    document.getElementById("memoryUsage").textContent = `${memoryUsage.toFixed(
      1
    )}%`;
    document.getElementById("memoryProgress").style.width = `${memoryUsage}%`;
    document.getElementById("diskUsage").textContent = `${diskIOUsage.toFixed(
      1
    )}%`;
    document.getElementById("diskProgress").style.width = `${diskIOUsage}%`;
    document.getElementById(
      "networkUsage"
    ).textContent = `${networkUsage.toFixed(1)}%`;
    document.getElementById("networkProgress").style.width = `${networkUsage}%`;

    const securityChecks = [
      { name: "Firewall", status: true },
      { name: "Antivirus", status: true },
      { name: "Updates", status: storagePercentage < 80 },
      { name: "Encryption", status: true },
    ];

    const secure = securityChecks.every((check) => check.status);
    document.getElementById(
      "securityStatusDot"
    ).className = `h-2 w-2 rounded-full ${
      secure ? "bg-green-500" : "bg-red-500"
    } mr-2`;
    document.getElementById("securityStatusText").textContent = secure
      ? "Secure"
      : "Vulnerable";
    document.getElementById("securityStatusBadge").textContent = secure
      ? "100%"
      : `${100 - securityChecks.filter((check) => !check.status).length * 25}%`;

    const securityChecksList = document.getElementById("securityChecks");
    securityChecksList.innerHTML = "";
    securityChecks.forEach((check) => {
      const li = document.createElement("li");
      li.className = "flex items-center";
      li.innerHTML = `
                <i data-lucide="${
                  check.status ? "check-circle" : "alert-triangle"
                }" class="h-3 w-3 ${
        check.status ? "text-green-400" : "text-yellow-400"
      } mr-2"></i>
                ${check.name}: ${check.status ? "OK" : "Warning"}
            `;
      securityChecksList.appendChild(li);
    });

    lucide.createIcons();
  } catch (error) {
    console.error(
      "Error updating storage chart, system health, and security status:",
      error
    );
    showNotification(
      "Failed to update storage chart, system health, and security status",
      "error"
    );
    storageChart.data.datasets[0].data = [0, STORAGE_LIMIT_MB];
    storageChart.update();
    document.getElementById("cpuUsage").textContent = "N/A";
    document.getElementById("cpuProgress").style.width = "0%";
    document.getElementById("memoryUsage").textContent = "N/A";
    document.getElementById("memoryProgress").style.width = "0%";
    document.getElementById("diskUsage").textContent = "N/A";
    document.getElementById("diskProgress").style.width = "0%";
    document.getElementById("networkUsage").textContent = "N/A";
    document.getElementById("networkProgress").style.width = "0%";
    document.getElementById("securityStatusDot").className =
      "h-2 w-2 rounded-full bg-red-500 mr-2";
    document.getElementById("securityStatusText").textContent = "Vulnerable";
    document.getElementById("securityStatusBadge").textContent = "0%";
    document.getElementById("securityChecks").innerHTML = "";
  }
}

// Gunakan auth listener untuk memastikan autentikasi selesai
supabase.auth.onAuthStateChange((event, session) => {
  if (event === "SIGNED_IN" || event === "INITIAL_SESSION") {
    if (session?.user) {
      console.log("User authenticated:", session.user.id);
      loadNotifications();
    }
  }
});
































// Deklarasi variabel global
let networkChart, perfChart, valChart, pointsChart, quantumSyncChart;
let networkChartData, perfChartData, valChartData, pointsChartData, quantumSyncChartData;
let onlineMinersList = [];
let presenceChannel;
let pointsSnapshot = {};
let pointsLastUpdated = {};
let currentMinersPage = 1;
const minersPerPage = 5;

// Variabel khusus untuk Quantum Sync
let quantumSyncProgress = 0;
let quantumNodeLatency = 0;
const quantumPeers = [
  'peer-1.qchain.net',
  'peer-2.qchain.net',
  'peer-3.qchain.net',
  'peer-4.qchain.net',
  'peer-5.qchain.net',
  'peer-6.qchain.net',
  'peer-7.qchain.net'
];
let quantumCurrentPeerIndex = 0;

// Inisialisasi halaman Network
async function initializeNetwork() {
  try {
    await checkUser();
    setupNetworkEventListeners();
    initializeNetworkCharts();
    await updateNetworkDashboard();
    subscribeToRealtimeUpdates();
    initializePresence();
    startPointsMonitoring();
    startBlockGeneration();
    startNetworkClock();
    if (window.quantumSyncChart) {
      startQuantumSyncMonitoring();
      console.log('[INIT] Quantum Sync Monitoring dimulai setelah chart siap');
    } else {
      console.warn('[INIT] Tidak memulai Quantum Sync Monitoring karena quantumSyncChart tidak tersedia');
    }
  } catch (err) {
    console.error('[INIT] Error inisialisasi Network:', err);
    showToast('Error', 'Failed to load the Network page', 'destructive');
  }
}

// Fungsi cek apakah user login
async function checkUser() {
  const { data: { session }, error } = await supabase.auth.getSession();
  if (error || !session?.user) {
    showToast('Error', 'Please login first', 'destructive');
    throw new Error('User not authenticated');
  }
  window.currentUser = session.user;
  const { data, error: profileError } = await supabase
    .from('profiles')
    .select('id, email, points, wallet_address, avatar_url, full_name, booster, referral_code, mining_speed, invited_users, updated_at, show_on_leaderboard')
    .eq('id', session.user.id)
    .single();
  if (profileError) {
    console.error('[CHECK_USER] Error mengambil profil:', profileError);
    throw profileError;
  }
  window.currentUser.profile = data;
}

// Setup event listener untuk halaman Network
function setupNetworkEventListeners() {
  const tabOverviewBtn = document.querySelector('button[onclick="showTab(\'tabOverview\')"]');
  const tabMinersBtn = document.querySelector('button[onclick="showTab(\'tabMiners\')"]');
  const tabPointsBtn = document.querySelector('button[onclick="showTab(\'tabPoints\')"]');

  if (!tabOverviewBtn || !tabMinersBtn || !tabPointsBtn) {
    console.error('[EVENT_LISTENER] Salah satu elemen tab Network tidak ditemukan');
    showToast('Error', 'Some elements not found', 'destructive');
    return;
  }

  const refreshNodeMapBtn = document.querySelector('#nodeMap + .text-sm .bg-slate-800\\/50');
  if (refreshNodeMapBtn) {
    refreshNodeMapBtn.addEventListener('click', updateNetworkDashboard);
  }

  const prevMinersBtn = document.querySelector('#minersTableBody + .border-t .bg-slate-700\\/50:first-child');
  const nextMinersBtn = document.querySelector('#minersTableBody + .border-t .bg-slate-700\\/50:last-child');
  if (prevMinersBtn && nextMinersBtn) {
    prevMinersBtn.addEventListener('click', () => paginateMiners('prev'));
    nextMinersBtn.addEventListener('click', () => paginateMiners('next'));
  }
}

// Inisialisasi semua grafik untuk halaman Network
function initializeNetworkCharts() {
  try {
    // Hancurkan chart lama jika ada
    if (networkChart) networkChart.destroy();
    if (perfChart) perfChart.destroy();
    if (valChart) valChart.destroy();
    if (pointsChart) pointsChart.destroy();
    if (quantumSyncChart) quantumSyncChart.destroy();

    // Inisialisasi networkChart
    const networkChartCtx = document.getElementById('networkChart')?.getContext('2d');
    if (!networkChartCtx) {
      console.error('[CHART] Canvas networkChart tidak ditemukan');
      return;
    }
    networkChartData = {
      labels: ['Now', '-5m', '-10m', '-15m', '-20m', '-25m'],
      datasets: [{
        label: 'Total AQULA Points',
        data: [0, 0, 0, 0, 0, 0],
        borderColor: 'rgb(245, 158, 11)',
        backgroundColor: 'rgba(245, 158, 11, 0.1)',
        tension: 0.4,
        pointRadius: 0
      }]
    };
    networkChart = new Chart(networkChartCtx, {
      type: 'line',
      data: networkChartData,
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
          x: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }
        }
      }
    });
    console.log('[CHART] networkChart berhasil diinisialisasi');

    // Inisialisasi performanceChart
    const perfChartCtx = document.getElementById('performanceChart')?.getContext('2d');
    if (!perfChartCtx) {
      console.error('[CHART] Canvas performanceChart tidak ditemukan');
      return;
    }
    perfChartData = {
      labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:59'],
      datasets: [{
        label: 'Hash Rate (TH/s)',
        data: [0, 0, 0, 0, 0, 0, 0],
        backgroundColor: 'rgba(16, 185, 129, 0.5)',
        borderColor: 'rgb(16, 185, 129)',
        borderWidth: 1
      }]
    };
    perfChart = new Chart(perfChartCtx, {
      type: 'bar',
      data: perfChartData,
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
          x: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }
        }
      }
    });
    console.log('[CHART] performanceChart berhasil diinisialisasi');

    // Inisialisasi validationChart
    const valChartCtx = document.getElementById('validationChart')?.getContext('2d');
    if (!valChartCtx) {
      console.error('[CHART] Canvas validationChart tidak ditemukan');
      return;
    }
    valChartData = {
      labels: ['Block #0', '#0', '#0', '#0', '#0'],
      datasets: [{
        label: 'Validation Time (s)',
        data: [0, 0, 0, 0, 0],
        backgroundColor: 'rgba(147, 51, 234, 0.5)',
        borderColor: 'rgb(147, 51, 234)',
        borderWidth: 1
      }]
    };
    valChart = new Chart(valChartCtx, {
      type: 'bar',
      data: valChartData,
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } },
          x: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }
        }
      }
    });
    console.log('[CHART] validationChart berhasil diinisialisasi');

    // Inisialisasi pointsChart
    const pointsChartCtx = document.getElementById('pointsChart')?.getContext('2d');
    if (!pointsChartCtx) {
      console.error('[CHART] Canvas pointsChart tidak ditemukan');
      return;
    }
    pointsChartData = {
      labels: ['Top 10%', 'Next 40%', 'Bottom 50%'],
      datasets: [{
        label: 'Points Distribution',
        data: [0, 0, 0],
        backgroundColor: [
          'rgba(234, 179, 8, 0.5)',
          'rgba(234, 179, 8, 0.3)',
          'rgba(234, 179, 8, 0.1)'
        ],
        borderColor: 'rgb(234, 179, 8)',
        borderWidth: 1
      }]
    };
    pointsChart = new Chart(pointsChartCtx, {
      type: 'doughnut',
      data: pointsChartData,
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8' } } }
      }
    });
    console.log('[CHART] pointsChart berhasil diinisialisasi');

    // Inisialisasi quantumSyncChart
    const quantumSyncChartCtx = document.getElementById('quantumSyncChart')?.getContext('2d');
    if (!quantumSyncChartCtx) {
      console.error('[CHART] Canvas quantumSyncChart tidak ditemukan');
      window.quantumSyncChart = null;
      return;
    }
    quantumSyncChartData = {
      labels: Array(10).fill(''),
      datasets: [{
        label: 'Latency (ms)',
        data: Array(10).fill(0),
        borderColor: '#8b5cf6',
        tension: 0.3,
        pointRadius: 0,
        borderWidth: 2,
        fill: true,
        backgroundColor: 'rgba(139, 92, 246, 0.1)'
      }]
    };
    quantumSyncChart = new Chart(quantumSyncChartCtx, {
      type: 'line',
      data: quantumSyncChartData,
      options: {
        responsive: true,
        animation: false,
        scales: {
          y: {
            beginAtZero: true,
            grid: { color: 'rgba(255,255,255,0.05)' },
            ticks: { color: '#94a3b8' }
          },
          x: { display: false }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: '#1e293b',
            titleColor: '#f1f5f9',
            bodyColor: '#cbd5e1'
          }
        }
      }
    });
    window.quantumSyncChart = quantumSyncChart;
    console.log('[CHART] quantumSyncChart berhasil diinisialisasi');
  } catch (err) {
    console.error('[CHART] Error inisialisasi grafik:', err);
    showToast('Error', 'Failed to initialize the chart', 'destructive');
  }
}

// Inisialisasi Supabase Presence
async function initializePresence() {
  try {
    const { data: profile, error: profileError } = await supabase
      .from('profiles')
      .select('full_name')
      .eq('id', window.currentUser.id)
      .single();
    if (profileError) {
      console.error('[PRESENCE] Failed to retrieve user profile:', profileError);
      return;
    }

    presenceChannel = supabase
      .channel('network-presence')
      .on('presence', { event: 'sync' }, () => {
        const state = presenceChannel.presenceState();
        const users = Object.values(state).flat();
        console.log('[PRESENCE] Presence State:', users);

        const activeMiners = users.filter(user => user.isMining === true && user.user_id !== window.currentUser.id);

        onlineMinersList = activeMiners.map(user => ({
          user_id: user.user_id,
          full_name: user.full_name || 'Unknown',
        }));

        console.log('[PRESENCE] Online Miners List Updated:', onlineMinersList);
        updateNetworkDashboard();
      })
      .subscribe((status) => {
        console.log('[PRESENCE] Presence Subscription Status:', status);
        if (status === 'SUBSCRIBED') {
          presenceChannel.track({
            user_id: window.currentUser.id,
            full_name: profile.full_name || 'Unknown',
            isMining: false,
          }).catch(err => {
            console.error('[PRESENCE] Failed to track users in presence:', err);
          });
        } else if (status === 'CLOSED' || status === 'TIMED_OUT') {
          console.warn('[PRESENCE] Subscription presence failed, retry...');
          setTimeout(() => presenceChannel.subscribe(), 2000);
        }
      });
  } catch (err) {
    console.error('[PRESENCE] Error inisialisasi Presence:', err);
  }
}

// Fungsi untuk memantau perubahan poin secara berkala
function startPointsMonitoring() {
  setInterval(async () => {
    try {
      const { data: profiles, error } = await supabase
        .from('profiles')
        .select('id, points, full_name');
      if (error) throw error;

      const activeMinersFromPoints = [];

      profiles.forEach(profile => {
        const previousPoints = pointsSnapshot[profile.id] || 0;
        const currentPoints = profile.points || 0;

        if (currentPoints > previousPoints && profile.id !== window.currentUser.id) {
          activeMinersFromPoints.push({
            user_id: profile.id,
            full_name: profile.full_name || 'Unknown',
          });
        }

        pointsSnapshot[profile.id] = currentPoints;
      });

      console.log('[POINTS] Active Miners from Points:', activeMinersFromPoints);

      if (onlineMinersList.length === 0 && activeMinersFromPoints.length > 0) {
        onlineMinersList = activeMinersFromPoints;
        updateNetworkDashboard();
      }
    } catch (err) {
      console.error('[POINTS] Error monitoring points:', err);
    }
  }, 5000);
}

// Fungsi untuk menghasilkan hash sederhana (simulasi)
function generateBlockHash(blockNumber) {
  const timestamp = Date.now();
  const randomStr = Math.random().toString(36).substring(2, 15);
  return `0x${blockNumber.toString(16)}${timestamp.toString(16)}${randomStr}`;
}

// Fungsi untuk memulai pembuatan blok otomatis
function startBlockGeneration() {
  setInterval(async () => {
    try {
      if (onlineMinersList.length === 0) {
        console.log('[BLOCK] Tidak ada miner aktif, pembuatan blok ditunda.');
        return;
      }

      const { data: lastBlock, error: lastBlockError } = await supabase
        .from('blocks')
        .select('block_number')
        .order('block_number', { ascending: false })
        .limit(1);

      if (lastBlockError) {
        console.error('[BLOCK] Error mengambil block terakhir:', lastBlockError);
        return;
      }

      const newBlockNumber = lastBlock.length > 0 ? lastBlock[0].block_number + 1 : 1;
      const solver = onlineMinersList[Math.floor(Math.random() * onlineMinersList.length)];
      const solverId = solver.user_id;
      const validationTime = (Math.random() * 4.5 + 0.5).toFixed(2);
      const blockHash = generateBlockHash(newBlockNumber);

      const { data, error } = await supabase
        .from('blocks')
        .insert({
          block_number: newBlockNumber,
          validation_time: validationTime,
          hash: blockHash,
          solver_id: solverId,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString(),
        });

      if (error) {
        console.error('[BLOCK] Error menambahkan blok baru:', error);
      } else {
        console.log(`[BLOCK] Blok baru ditambahkan: #${newBlockNumber}, Hash: ${blockHash}, Solver: ${solverId}`);
        updateNetworkDashboard();
      }
    } catch (err) {
      console.error('[BLOCK] Error dalam pembuatan blok:', err);
    }
  }, 120000);
}

// Fungsi untuk memperbarui network clock
function startNetworkClock() {
  const networkClockEl = document.getElementById('networkClock');
  if (networkClockEl) {
    const updateClock = () => {
      const now = new Date();
      networkClockEl.textContent = now.toLocaleTimeString('en-US', { timeZone: 'UTC', hour12: false }) + ' UTC';
    };
    updateClock();
    setInterval(updateClock, 1000);
  } else {
    console.warn('[CLOCK] Elemen networkClock tidak ditemukan');
  }
}

// Fungsi untuk mengambil status node quantum (simulasi)
async function fetchQuantumNodeStatus(peer) {
  return new Promise(resolve => {
    setTimeout(() => {
      resolve({
        peer,
        latency: Math.random() * 60 + 20,
        synced: Math.random() > 0.1, // 10% failure rate
        timestamp: Date.now()
      });
    }, 1000);
  });
}

// Fungsi untuk memperbarui UI Quantum Sync
function updateQuantumUI(data) {
  const nodeLatencyEl = document.getElementById('nodeLatency');
  const syncProgressEl = document.getElementById('syncProgress');
  const currentPeerEl = document.getElementById('currentPeer');
  const syncProgressTestEl = document.getElementById('syncProgressTest');

  // Update Latency
  quantumNodeLatency = data.latency.toFixed(1);
  console.log('[QUANTUM_UI] quantumNodeLatency:', quantumNodeLatency);
  if (nodeLatencyEl) {
    nodeLatencyEl.textContent = `${quantumNodeLatency} ms`;
    console.log('[QUANTUM_UI] nodeLatency diperbarui ke:', nodeLatencyEl.textContent);
  } else {
    console.warn('[QUANTUM_UI] Elemen nodeLatency tidak ditemukan');
  }

  // Update Sync Progress
  quantumSyncProgress += Math.random() * 5 + 1;
  if (quantumSyncProgress > 100) quantumSyncProgress = 100;
  console.log('[QUANTUM_UI] quantumSyncProgress:', quantumSyncProgress);

  if (syncProgressEl) {
    const progressValue = Math.round(quantumSyncProgress);
    syncProgressEl.textContent = `${progressValue}%`;
    localStorage.setItem('quantumSyncProgress', quantumSyncProgress); // Simpan ke localStorage
    console.log('[QUANTUM_UI] syncProgress diperbarui ke:', progressValue);
    console.log('[QUANTUM_UI] Konten DOM saat ini:', syncProgressEl.textContent);
    console.log('[QUANTUM_UI] Computed style display:', window.getComputedStyle(syncProgressEl).display);
    console.log('[QUANTUM_UI] Computed style opacity:', window.getComputedStyle(syncProgressEl).opacity);
    // Paksa pembaruan DOM
    syncProgressEl.style.display = 'none';
    syncProgressEl.offsetHeight;
    syncProgressEl.style.display = 'inline-block';
    // Pantau perubahan
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        console.warn('[QUANTUM_UI] syncProgress diubah ke:', syncProgressEl.textContent);
      });
    });
    observer.observe(syncProgressEl, { childList: true, characterData: true, subtree: true });
  } else {
    console.warn('[QUANTUM_UI] Elemen syncProgress tidak ditemukan');
  }

  // Uji elemen sementara
  if (syncProgressTestEl) {
    const progressValue = Math.round(quantumSyncProgress);
    syncProgressTestEl.textContent = `${progressValue}%`;
    console.log('[QUANTUM_UI] syncProgressTest diperbarui ke:', progressValue);
  } else {
    console.warn('[QUANTUM_UI] Elemen syncProgressTest tidak ditemukan');
  }

  // Update Current Peer
  if (currentPeerEl) {
    currentPeerEl.textContent = data.peer;
    console.log('[QUANTUM_UI] currentPeer diperbarui ke:', data.peer);
  } else {
    console.warn('[QUANTUM_UI] Elemen currentPeer tidak ditemukan');
  }

  // Simpan ke localStorage
  saveLatencyToLocalStorage(data.latency);

  // Update Chart
  if (window.quantumSyncChart && window.quantumSyncChart.data?.datasets?.[0]) {
    try {
      window.quantumSyncChart.data.datasets[0].data.shift();
      window.quantumSyncChart.data.datasets[0].data.push(parseFloat(quantumNodeLatency));
      window.quantumSyncChart.update();
      console.log('[QUANTUM_UI] quantumSyncChart berhasil diperbarui, latency:', quantumNodeLatency);
    } catch (err) {
      console.error('[QUANTUM_UI] Error saat memperbarui quantumSyncChart:', err);
    }
  } else {
    console.warn('[QUANTUM_UI] quantumSyncChart belum siap atau tidak valid');
  }
}

// Fungsi untuk menyimpan latensi ke localStorage
function saveLatencyToLocalStorage(latency) {
  const key = 'quantumNodeLatencyHistory';
  let history = JSON.parse(localStorage.getItem(key)) || [];

  history.push({ time: new Date().toLocaleTimeString(), latency });

  if (history.length > 10) {
    history.shift();
  }

  localStorage.setItem(key, JSON.stringify(history));
}

// Fungsi utama untuk memulai monitoring Quantum Sync
window.startQuantumSyncMonitoring = function () {
  if (!window.quantumSyncChart) {
    console.error('[QUANTUM] Tidak dapat memulai Quantum Sync Monitoring: quantumSyncChart tidak tersedia');
    return;
  }
  console.log('[QUANTUM] Quantum Sync Monitoring dimulai...');

  setInterval(async () => {
    const currentPeer = quantumPeers[quantumCurrentPeerIndex];
    const result = await fetchQuantumNodeStatus(currentPeer);
    console.log('[QUANTUM] Data node:', result);
    updateQuantumUI(result);

    quantumCurrentPeerIndex = (quantumCurrentPeerIndex + 1) % quantumPeers.length;

    if (!result.synced) {
      console.warn(`[QUANTUM] Node ${result.peer} mengalami gangguan sinkronisasi`);
    }
  }, 5000);
};

// Fungsi untuk pagination miners
function paginateMiners(direction) {
  if (direction === 'next' && !document.querySelector('#minersTableBody + .border-t .bg-slate-700/50:last-child').disabled) {
    currentMinersPage++;
  } else if (direction === 'prev' && !document.querySelector('#minersTableBody + .border-t .bg-slate-700/50:first-child').disabled) {
    currentMinersPage--;
  }
  updateMinersTable();
}

// Fungsi untuk memperbarui tabel miners
async function updateMinersTable() {
  const minersTableBodyEl = document.getElementById('minersTableBody');
  const minersCountEl = document.getElementById('minersCount');
  const totalMinersEl = document.getElementById('totalMiners');
  const prevMinersBtn = document.querySelector('#minersTableBody + .border-t .bg-slate-700/50:first-child');
  const nextMinersBtn = document.querySelector('#minersTableBody + .border-t .bg-slate-700/50:last-child');

  if (minersTableBodyEl && minersCountEl && totalMinersEl && prevMinersBtn && nextMinersBtn) {
    minersTableBodyEl.innerHTML = '';

    const { data: profiles, error: profilesError } = await supabase
      .from('profiles')
      .select('id, points')
      .order('updated_at', { ascending: false });
    if (profilesError) {
      console.warn('[MINERS] Gagal mengambil data profiles:', profilesError);
      minersTableBodyEl.innerHTML = `<tr><td colspan="5" class="px-5 py-3 text-center text-slate-400">Gagal memuat data miner.</td></tr>`;
      return;
    }

    const { data: scans, error: scansError } = await supabase
      .from('security_scans')
      .select('id, profile_id, location')
      .order('created_at', { ascending: false });
    if (scansError) {
      console.warn('[MINERS] Gagal mengambil security scans:', scansError);
      minersTableBodyEl.innerHTML = `<tr><td colspan="5" class="px-5 py-3 text-center text-slate-400">Gagal memuat data miner.</td></tr>`;
      return;
    }

    const start = (currentMinersPage - 1) * minersPerPage;
    const end = start + minersPerPage;

    const now = new Date();
    const twentySecondsAgo = new Date(now.getTime() - 20 * 1000);
    console.log(`[MINERS] Current Time: ${now}, Twenty Seconds Ago: ${twentySecondsAgo}`);

    const minerData = scans
      .map(scan => {
        const profile = profiles.find(p => p.id === scan.profile_id);
        if (!profile) {
          console.log(`[MINERS] Profile tidak ditemukan untuk scan ${scan.id}, profile_id: ${scan.profile_id}`);
          return null;
        }

        const previousPoints = pointsSnapshot[scan.profile_id] || 0;
        const currentPoints = profile.points || 0;

        const isOnline = currentPoints > previousPoints && (pointsLastUpdated[scan.profile_id] || new Date(0)) >= twentySecondsAgo;

        if (currentPoints > previousPoints) {
          pointsSnapshot[scan.profile_id] = currentPoints;
          pointsLastUpdated[scan.profile_id] = new Date();
        }

        console.log(`[MINERS] Miner ${scan.id} (profile_id: ${scan.profile_id}) - Previous Points: ${previousPoints}, Current Points: ${currentPoints}, Last Updated: ${pointsLastUpdated[scan.profile_id]}, Is Online: ${isOnline}`);

        return {
          id: scan.id,
          location: scan.location || 'Unknown',
          hashRate: (Math.random() * 100).toFixed(2) + ' TH/s',
          status: isOnline ? 'Active' : 'Inactive',
          lastActive: pointsLastUpdated[scan.profile_id] ? pointsLastUpdated[scan.profile_id].toLocaleString() : new Date(scan.created_at).toLocaleString()
        };
      })
      .filter(miner => miner !== null && miner.status === 'Active');

    const paginatedMinerData = minerData.slice(start, end);

    if (paginatedMinerData.length > 0) {
      paginatedMinerData.forEach(miner => {
        console.log(`[MINERS] Displaying Miner ${miner.id} - Status: ${miner.status}`);
        const row = `
          <tr class="hover:bg-slate-700/30 transition-colors duration-200">
            <td class="px-5 py-3 text-left">${miner.id.length > 8 ? miner.id.slice(0, 4) + '...' + miner.id.slice(-4) : miner.id}</td>
            <td class="px-5 py-3 text-left">${miner.location.length > 8 ? miner.location.slice(0, 4) + '...' + miner.location.slice(-4) : miner.location}</td>
            <td class="px-5 py-3 text-left">${miner.hashRate}</td>
            <td class="px-5 py-3 text-left ${miner.status === 'Active' ? 'text-green-400' : 'text-red-400'}">${miner.status}</td>
            <td class="px-5 py-3 text-left text-xs text-slate-400">${miner.lastActive}</td>
          </tr>
        `;
        minersTableBodyEl.insertAdjacentHTML('beforeend', row);
      });
    } else {
      minersTableBodyEl.innerHTML = `<tr><td colspan="5" class="px-5 py-3 text-center text-slate-400">Tidak ada miner aktif saat ini.</td></tr>`;
    }

    const totalActiveMiners = minerData.length;
    const totalPages = Math.ceil(totalActiveMiners / minersPerPage);
    prevMinersBtn.disabled = currentMinersPage === 1;
    nextMinersBtn.disabled = currentMinersPage === totalPages || totalActiveMiners <= minersPerPage;
    prevMinersBtn.style.opacity = prevMinersBtn.disabled ? '0.5' : '1';
    nextMinersBtn.style.opacity = nextMinersBtn.disabled ? '0.5' : '1';

    minersCountEl.textContent = paginatedMinerData.length;
    totalMinersEl.textContent = totalActiveMiners;
  } else {
    console.warn('[MINERS] Salah satu elemen tabel miners tidak ditemukan');
  }
}

// Fungsi untuk memulai mining
function startMining() {
  if (!window.currentUser) {
    showToast('Error', 'Please login to start mining', 'destructive');
    authModal.style.display = 'flex';
    return;
  }

  isMining = true;
  miningStatus.textContent = 'Active';
  miningStatus.className = 'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/50';
  toggleMiningBtn.textContent = 'Stop Mining';

  miningInterval = setInterval(async () => {
    const miningSpeed = window.currentUser.profile.mining_speed || 1;
    const basePoints = (deviceScore / 100) * boosterSpeed * miningSpeed;
    points += basePoints;
    pointsSnapshot[window.currentUser.id] = points;
    pointsLastUpdated[window.currentUser.id] = new Date();
    console.log(`[MINING] Points earned: ${basePoints.toFixed(2)}, Total points: ${points.toFixed(2)}, User: ${window.currentUser.id}`);

    if (userPoints) userPoints.textContent = points.toFixed(2);
    if (currentPoints) currentPoints.textContent = points.toFixed(2);

    await syncPointsToSupabase();
  }, 5000);
}

// Fungsi untuk memperbarui dashboard network
async function updateNetworkDashboard() {
  try {
    const { data: profiles, error: profilesError } = await supabase
      .from('profiles')
      .select('*')
      .order('updated_at', { ascending: false });
    if (profilesError) throw profilesError;

    const { data: scans, error: scansError } = await supabase
      .from('security_scans')
      .select('*')
      .order('created_at', { ascending: false });
    if (scansError) throw scansError;

    const { data: blocks, error: blocksError } = await supabase
      .from('blocks')
      .select('block_number, created_at, validation_time, hash')
      .order('created_at', { ascending: false });
    if (blocksError) throw blocksError;

    let onlineMiners = onlineMinersList.length;
    const minersOnlineEl = document.getElementById('minersOnline');
    const minersProgressEl = document.getElementById('minersProgress');
    const minersChangeEl = document.getElementById('minersChange');
    if (minersOnlineEl && minersProgressEl && minersChangeEl) {
      const prevMiners = parseInt(minersOnlineEl.textContent) || 0;
      minersOnlineEl.innerHTML = `${onlineMiners}<span class="text-lg text-slate-400 ml-2">Miners</span>`;
      const minersProgress = (onlineMiners / 20000) * 100;
      minersProgressEl.style.width = `${Math.min(minersProgress, 100)}%`;
      const change = onlineMiners - prevMiners;
      minersChangeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(1)}%`;
    }

    const avgLatency = scans.length > 0 ? scans.reduce((sum, scan) => sum + (scan.latency || 0), 0) / scans.length : 0;
    const latencyEl = document.getElementById('latency');
    const latencyProgressEl = document.getElementById('latencyProgress');
    const latencyChangeEl = document.getElementById('latencyChange');
    if (latencyEl && latencyProgressEl && latencyChangeEl) {
      const prevLatency = parseInt(latencyEl.textContent) || 0;
      latencyEl.innerHTML = `${Math.round(avgLatency)}<span class="text-lg text-slate-400 ml-2">ms</span>`;
      const latencyProgress = (avgLatency / 50) * 100;
      latencyProgressEl.style.width = `${Math.min(latencyProgress, 100)}%`;
      const change = avgLatency - prevLatency;
      latencyChangeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(1)}%`;
    }

    const totalPoints = profiles.reduce((sum, profile) => sum + (profile.points || 0), 0);
    const totalPointsEl = document.getElementById('totalPoints');
    const pointsProgressEl = document.getElementById('pointsProgress');
    const pointsChangeEl = document.getElementById('pointsChange');
    const pointsTextEl = document.getElementById('pointsText');
    const todayRewardsEl = document.getElementById('todayReward');
    const avgPerMinerEl = document.getElementById('avgPerMiner');
    if (totalPointsEl && pointsProgressEl && pointsChangeEl) {
      const prevPoints = parseInt(totalPointsEl.textContent.replace(/,/g, '')) || 0;
      totalPointsEl.innerHTML = `${totalPoints.toLocaleString()}<span class="text-lg text-slate-400 ml-2">AQULA</span>`;
      const pointsProgress = (totalPoints / 5000000) * 100;
      pointsProgressEl.style.width = `${Math.min(pointsProgress, 100)}%`;
      const change = ((totalPoints - prevPoints) / (prevPoints || 1)) * 100;
      pointsChangeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(1)}%`;
    }

    const now = new Date();
    const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
    const pointsLastHour = profiles
      .filter(profile => new Date(profile.updated_at) >= oneHourAgo)
      .reduce((sum, profile) => sum + (profile.points || 0), 0);
    const avgPointsPerHour = pointsLastHour / (profiles.length || 1);

    const avgMiningSpeed = profiles.reduce((sum, profile) => sum + (profile.mining_speed || 0), 0) / (profiles.length || 1);
    const rewardRate = (avgMiningSpeed / 1000).toFixed(1);

    const latestBlock = blocks.length > 0 ? blocks[0].block_number : 0;
    const blocksUntilHalving = 5000 - (latestBlock % 5000);

    if (pointsTextEl) {
      pointsTextEl.textContent = `AQULA Points continue to accumulate across the network with an average of ${Math.round(avgPointsPerHour).toLocaleString()} points mined per hour. The current reward rate stands at ${rewardRate} AQULA per TH/s with halving scheduled in approximately ${blocksUntilHalving} blocks.`;
    }

    const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);
    const todayPoints = profiles
      .filter(profile => new Date(profile.updated_at) >= oneDayAgo)
      .reduce((sum, profile) => sum + (profile.points || 0), 0);
    if (todayRewardsEl) {
      todayRewardsEl.textContent = `${todayPoints.toLocaleString()} AQULA`;
    }

    const avgPerMiner = onlineMiners > 0 ? (todayPoints / onlineMiners).toFixed(1) : 0;
    if (avgPerMinerEl) {
      avgPerMinerEl.textContent = `${avgPerMiner} AQULA`;
    }

    if (networkChart && networkChartData) {
      networkChartData.datasets[0].data.shift();
      networkChartData.datasets[0].data.push(totalPoints);
      networkChart.update();
    }

    if (pointsChart && pointsChartData) {
      const sortedPoints = profiles.map(p => p.points || 0).sort((a, b) => b - a);
      const top10PercentCount = Math.ceil(profiles.length * 0.1);
      const next40PercentCount = Math.ceil(profiles.length * 0.4);
      const top10Points = sortedPoints.slice(0, top10PercentCount).reduce((sum, p) => sum + p, 0);
      const next40Points = sortedPoints.slice(top10PercentCount, top10PercentCount + next40PercentCount).reduce((sum, p) => sum + p, 0);
      const bottom50Points = sortedPoints.slice(top10PercentCount + next40PercentCount).reduce((sum, p) => sum + p, 0);
      pointsChartData.datasets[0].data = [top10Points, next40Points, bottom50Points];
      pointsChart.update();
    }

    const overviewTextEl = document.getElementById('overviewText');
    const uniqueLocations = [...new Set(scans.map(scan => scan.location).filter(loc => loc))].length;
    const totalTransactions = (await supabase.from('contract_activity').select('call_count', { count: 'exact' })).count || 0;
    const uptime = 99.98;
    if (overviewTextEl) {
      overviewTextEl.textContent = `AQULA Network is currently operating at optimal capacity with ${onlineMiners} active miners across ${uniqueLocations} regions. The blockchain has processed over ${totalTransactions.toLocaleString()} transactions this month with ${uptime}% uptime. New mining rewards protocol v2.5 is active since block #${latestBlock}.`;
    }

    const blocksPerDayEl = document.getElementById('blocksPerDay');
    const avgTxFeeEl = document.getElementById('avgTxFee');
    const difficultyEl = document.getElementById('difficulty');
    const hashRateEl = document.getElementById('hashRate');
    const hashRateProgressEl = document.getElementById('hashRateProgress');
    const hashRateChangeEl = document.getElementById('hashRateChange');
    const efficiencyEl = document.getElementById('efficiency');
    const efficiencyProgressEl = document.getElementById('efficiencyProgress');
    const efficiencyChangeEl = document.getElementById('efficiencyChange');

    const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    const recentBlocks = blocks.filter(block => new Date(block.created_at) >= oneWeekAgo);
    const blocksPerDay = recentBlocks.length > 0 ? (recentBlocks.length / 7).toFixed(0) : 0;
    if (blocksPerDayEl) blocksPerDayEl.textContent = `${blocksPerDay}`;

    const avgTxFee = 0.0021;
    if (avgTxFeeEl) avgTxFeeEl.textContent = `${avgTxFee} AQULA`;

    const difficulty = (avgMiningSpeed * 1000).toFixed(2);
    if (difficultyEl) difficultyEl.textContent = `${difficulty} TH`;

    const oneDayAgoHash = new Date(now.getTime() - 24 * 60 * 60 * 1000);
    const recentProfiles = profiles.filter(profile => new Date(profile.updated_at) >= oneDayAgoHash);
    const avgHashRate24h = recentProfiles.length > 0 ? recentProfiles.reduce((sum, profile) => sum + (profile.mining_speed || 0), 0) / recentProfiles.length : 0;
    if (hashRateEl && hashRateProgressEl && hashRateChangeEl) {
      const prevHashRate = parseFloat(hashRateEl.textContent.replace('TH/s', '').trim()) || 0;
      hashRateEl.innerHTML = `${Math.round(avgHashRate24h)}<span class="text-lg text-slate-400 ml-1">TH/s</span>`;
      hashRateProgressEl.style.width = `${(avgHashRate24h / 200) * 100}%`;
      const hashRateChange = avgHashRate24h - prevHashRate;
      hashRateChangeEl.textContent = `${hashRateChange >= 0 ? '+' : ''}${hashRateChange.toFixed(1)}%`;
    }

    const activeMiners24h = recentProfiles.filter(profile => profile.mining_speed > 0).length;
    const miningEfficiency = recentProfiles.length > 0 ? (activeMiners24h / recentProfiles.length) * 100 : 0;
    if (efficiencyEl && efficiencyProgressEl && efficiencyChangeEl) {
      const prevEfficiency = parseFloat(efficiencyEl.textContent.replace('%', '').trim()) || 0;
      efficiencyEl.innerHTML = `${Math.round(miningEfficiency)}<span class="text-lg text-slate-400 ml-1">%</span>`;
      efficiencyProgressEl.style.width = `${Math.min(miningEfficiency, 100)}%`;
      const efficiencyChange = miningEfficiency - prevEfficiency;
      efficiencyChangeEl.textContent = `${efficiencyChange >= 0 ? '+' : ''}${efficiencyChange.toFixed(1)}%`;
    }

    if (perfChart && perfChartData) {
      perfChartData.datasets[0].data.shift();
      perfChartData.datasets[0].data.push(Math.round(avgMiningSpeed));
      perfChart.update();
    }

    if (valChart && valChartData && blocks.length > 0) {
      valChartData.labels.shift();
      valChartData.labels.push(`Block #${blocks[0].block_number}`);
      valChartData.datasets[0].data.shift();
      valChartData.datasets[0].data.push(parseFloat(blocks[0].validation_time || 0));
      valChart.update();
    }

    const minersTableBodyEl = document.getElementById('minersTableBody');
    const minersCountEl = document.getElementById('minersCount');
    const totalMinersEl = document.getElementById('totalMiners');
    if (minersTableBodyEl && minersCountEl && totalMinersEl) {
      minersTableBodyEl.innerHTML = '';
      const minerData = scans.map(scan => {
        const profile = profiles.find(p => p.id === scan.profile_id);
        const previousPoints = pointsSnapshot[scan.profile_id] || 0;
        const currentPoints = profile ? (profile.points || 0) : 0;
        const isOnline = currentPoints > previousPoints;
        pointsSnapshot[scan.profile_id] = currentPoints;
        return {
          id: scan.id,
          profile_id: scan.profile_id,
          location: scan.location || 'Unknown',
          hashRate: (Math.random() * 100).toFixed(2) + ' TH/s',
          status: isOnline ? 'Active' : 'Inactive',
          lastActive: new Date(scan.created_at).toLocaleString()
        };
      }).slice(0, 10);

      minerData.forEach(miner => {
        const row = `
          <tr class="hover:bg-slate-700/30 transition-colors duration-200">
            <td class="px-5 py-3 text-left">${miner.id.length > 8 ? miner.id.slice(0, 4) + '...' + miner.id.slice(-4) : miner.id}</td>
            <td class="px-5 py-3 text-left">${miner.location.length > 8 ? miner.location.slice(0, 4) + '...' + miner.location.slice(-4) : miner.location}</td>
            <td class="px-5 py-3 text-left">${miner.hashRate}</td>
            <td class="px-5 py-3 text-left ${miner.status === 'Active' ? 'text-green-400' : 'text-red-400'}">${miner.status}</td>
            <td class="px-5 py-3 text-left text-xs text-slate-400">${miner.lastActive}</td>
          </tr>
        `;
        minersTableBodyEl.insertAdjacentHTML('beforeend', row);
      });

      minersCountEl.textContent = minerData.length;
      totalMinersEl.textContent = scans.length;
    }

    const nodeMapEl = document.getElementById('nodeMap');
    const nodeCountEl = document.getElementById('nodeCount');
    const nodeRegionsEl = document.getElementById('nodeRegions');
    if (nodeMapEl && nodeCountEl && nodeRegionsEl) {
      nodeMapEl.innerHTML = '';
      const locations = scans.map(scan => scan.location).filter(loc => loc);
      const uniqueRegions = [...new Set(locations)];
      const locationPositions = {
        'Medan, North Sumatra, ID': { left: '20%', top: '30%' },
        'Jakarta, ID': { left: '25%', top: '35%' },
        'Singapore, SG': { left: '60%', top: '40%' },
        'Tokyo, JP': { left: '80%', top: '50%' },
        'London, UK': { left: '10%', top: '60%' },
        'New York, US': { left: '50%', top: '20%' },
      };

      const locationCounts = {};
      locations.forEach(loc => {
        locationCounts[loc] = (locationCounts[loc] || 0) + 1;
        const count = locationCounts[loc];
        const pos = locationPositions[loc] || { left: `${Math.random() * 80}%`, top: `${Math.random() * 80}%` };
        const offset = (count - 1) * 5;
        const adjustedPos = {
          left: `calc(${pos.left} + ${offset}%)`,
          top: `calc(${pos.top} + ${offset}%)`,
        };
        const node = `<div class="node animate-pulse-node" style="left: ${adjustedPos.left}; top: ${adjustedPos.top};" title="${loc}"></div>`;
        nodeMapEl.insertAdjacentHTML('beforeend', node);
      });
      nodeCountEl.textContent = locations.length;
      nodeRegionsEl.textContent = uniqueRegions.length;
    }

    const latestBlockEl = document.getElementById('latestBlock');
    const validationTimeEl = document.getElementById('validationTime');
    const blockHashEl = document.getElementById('blockHash');
    if (latestBlockEl && validationTimeEl && blockHashEl) {
      if (blocks.length > 0) {
        latestBlockEl.textContent = blocks[0].block_number;
        validationTimeEl.innerHTML = `${blocks[0].validation_time.toFixed(1)}<span class="text-lg text-slate-400 ml-1">s</span>`;
        blockHashEl.textContent = blocks[0].hash;
      } else {
        latestBlockEl.textContent = '0';
        validationTimeEl.innerHTML = '0<span class="text-lg text-slate-400 ml-1">s</span>';
        blockHashEl.textContent = '0x0000...0000';
      }
    }

    const transactionFeedEl = document.getElementById('transactionFeed');
    if (transactionFeedEl) {
      transactionFeedEl.innerHTML = '';
      profiles.slice(0, 10).forEach(profile => {
        const pointsChange = profile.points || 0;
        const entry = `
          <div class="p-3 bg-slate-800/50 rounded-lg border border-blue-500/20 animate-fadeIn">
            <div class="flex items-center justify-between">
              <span class="text-slate-100">${profile.id.slice(0, 8)}...</span>
              <span class="text-blue-400 font-semibold">+${pointsChange.toLocaleString()} AQULA</span>
            </div>
            <span class="text-xs text-slate-400">${new Date(profile.updated_at).toLocaleTimeString()}</span>
          </div>
        `;
        transactionFeedEl.insertAdjacentHTML('beforeend', entry);
      });
    }

    const contractCallsEl = document.getElementById('contractCalls');
    const executionSuccessEl = document.getElementById('executionSuccess');
    const contractActivityEl = document.getElementById('contractActivity');
    if (contractCallsEl && executionSuccessEl && contractActivityEl) {
      try {
        const { data, error } = await supabase
          .from('contract_activity')
          .select('call_count, success_rate, status, updated_at, profile_id')
          .order('updated_at', { ascending: false })
          .limit(5);
        if (error) {
          console.warn('[CONTRACT] Gagal mengambil data contract_activity:', error);
          contractCallsEl.textContent = '0';
          executionSuccessEl.innerHTML = '0<span class="text-lg text-slate-400 ml-1">%</span>';
          contractActivityEl.innerHTML = '<div class="text-slate-400">No data available</div>';
        } else {
          const callCount = data.reduce((sum, c) => sum + (c.call_count || 0), 0);
          const successRate = data.length > 0 ? data.reduce((sum, c) => sum + (c.success_rate || 0), 0) / data.length : 0;
          contractCallsEl.textContent = callCount.toLocaleString();
          executionSuccessEl.innerHTML = `${successRate.toFixed(1)}<span class="text-lg text-slate-400 ml-1">%</span>`;

          contractActivityEl.innerHTML = '';
          if (data.length > 0) {
            data.forEach(contract => {
              const status = contract.status || 'Pending';
              const entry = `
                <div class="p-3 bg-slate-800/50 rounded-lg border border-pink-500/20 animate-fadeIn">
                  <div class="flex items-center justify-between">
                    <span class="text-slate-100">Contract ${contract.profile_id.slice(0, 8)}...</span>
                    <span class="text-pink-400 font-semibold">${status}</span>
                  </div>
                  <span class="text-xs text-slate-400">${new Date(contract.updated_at).toLocaleTimeString()}</span>
                </div>
              `;
              contractActivityEl.insertAdjacentHTML('beforeend', entry);
            });
          } else {
            contractActivityEl.innerHTML = '<div class="text-slate-400">No data available</div>';
          }
        }
      } catch (err) {
        console.error('[CONTRACT] Error fetching contract_activity:', err);
        contractCallsEl.textContent = '0';
        executionSuccessEl.innerHTML = '0<span class="text-lg text-slate-400 ml-1">%</span>';
        contractActivityEl.innerHTML = '<div class="text-slate-400">No data available</div>';
      }
    }
  } catch (error) {
    console.error('[DASHBOARD] Error updating network dashboard:', error);
    showToast('Error', 'Failed to update dashboard data', 'destructive');
  }
}

// Berlangganan pembaruan real-time dari Supabase
function subscribeToRealtimeUpdates() {
  supabase
    .channel('profiles-changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'profiles' }, payload => {
      console.log('[REALTIME] Profiles change received:', payload);
      if (currentPage === 'network') updateNetworkDashboard();
    })
    .subscribe();

  supabase
    .channel('security-scans-changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'security_scans' }, payload => {
      console.log('[REALTIME] Security scans change received:', payload);
      if (currentPage === 'network') updateNetworkDashboard();
    })
    .subscribe();

  try {
    supabase
      .channel('blocks-changes')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'blocks' }, payload => {
        console.log('[REALTIME] Blocks change received:', payload);
        if (currentPage === 'network') updateNetworkDashboard();
      })
      .subscribe();
  } catch (err) {
    console.warn('[REALTIME] Gagal berlangganan ke blocks-changes:', err);
  }

  try {
    supabase
      .channel('contract-activity-changes')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'contract_activity' }, payload => {
        console.log('[REALTIME] Contract activity change received:', payload);
        if (currentPage === 'network') updateNetworkDashboard();
      })
      .subscribe();
  } catch (err) {
    console.warn('[REALTIME] Gagal berlangganan ke contract-activity-changes:', err);
  }
}

// Fungsi untuk menampilkan tab
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
  document.querySelectorAll('.tab-content + .tab-content button').forEach(btn => {
    btn.classList.remove('text-slate-100', 'bg-gradient-to-br', 'from-slate-700/50', 'to-slate-800/70');
    btn.classList.add('text-slate-400', 'hover:text-slate-100', 'hover:bg-slate-700/50');
  });
  const activeTabBtn = document.querySelector(`button[onclick="showTab('${tabId}')"]`);
  if (activeTabBtn) {
    activeTabBtn.classList.remove('text-slate-400', 'hover:text-slate-100', 'hover:bg-slate-700/50');
    activeTabBtn.classList.add('text-slate-100', 'bg-gradient-to-br', 'from-slate-700/50', 'to-slate-800/70');
  }
  document.getElementById(tabId).classList.remove('hidden');
}

// Inisialisasi saat DOM siap
document.addEventListener('DOMContentLoaded', function () {
  console.log('[INIT] DOM loaded, memulai inisialisasi...');
  if (currentPage === 'network') {
    initializeNetwork();
  }
});

























































//purchase booster


// Flag untuk mencegah toast duplikat
let isToastActive = false;

// Fungsi untuk menampilkan modal konfirmasi pembayaran
function showConfirmationModal(walletType, boosterName, price, onConfirm) {
  const overlay = document.createElement("div");
  overlay.className = "fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4";

  const modal = document.createElement("div");
  modal.className = "bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl shadow-2xl border border-slate-700/50 w-full max-w-md overflow-hidden";
  modal.innerHTML = `
    <div class="p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-slate-100 flex items-center gap-2">
          <i data-lucide="credit-card" class="w-5 h-5 text-cyan-400"></i>
          Confirm Payment
        </h3>
        <button class="close-btn text-slate-400 hover:text-slate-200">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>
      <div class="mb-6">
        <div class="bg-slate-700/30 rounded-lg p-4 mb-3">
          <div class="text-xs text-slate-400 mb-1">Purchasing</div>
          <div class="font-medium text-slate-100">${boosterName} Booster</div>
        </div>
        <div class="bg-slate-700/30 rounded-lg p-4 mb-3">
          <div class="text-xs text-slate-400 mb-1">Payment Method</div>
          <div class="font-medium text-slate-100">${walletType.charAt(0).toUpperCase() + walletType.slice(1)}</div>
        </div>
        <div class="bg-slate-700/30 rounded-lg p-4">
          <div class="text-xs text-slate-400 mb-1">Amount</div>
          <div class="font-medium text-slate-100">${price} ETH</div>
        </div>
      </div>
      <div class="flex justify-end gap-3">
        <button class="cancel-btn px-4 py-2 bg-slate-600 text-slate-200 rounded-lg hover:bg-slate-500 transition-colors">
          Cancel
        </button>
        <button class="confirm-btn px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-500 transition-colors">
          Confirm
        </button>
      </div>
    </div>
  `;

  overlay.appendChild(modal);
  document.body.appendChild(overlay);
  document.body.style.overflow = "hidden";

  if (window.lucide) {
    window.lucide.createIcons();
  }

  const closeModal = () => {
    document.body.removeChild(overlay);
    document.body.style.overflow = "";
  };

  modal.querySelector(".close-btn").addEventListener("click", closeModal);
  modal.querySelector(".cancel-btn").addEventListener("click", closeModal);
  overlay.addEventListener("click", (e) => {
    if (e.target === overlay) closeModal();
  });

  modal.querySelector(".confirm-btn").addEventListener("click", () => {
    onConfirm();
    closeModal();
  });
}

// Fungsi untuk menangani pembelian booster
async function handlePurchase(walletType, booster, price) {
  if (isToastActive) return; // Mencegah toast duplikat

  try {
    let provider, walletAddress;
    const toAddress = "0x597c2c69f5a3538e9809f563274a8f5168bc9907";

    // Langkah 1: Hubungkan wallet
    switch (walletType) {
      case "metamask":
        provider = window.ethereum;
        if (!provider) throw new Error("MetaMask is not installed");
        const metaAccounts = await provider.request({ method: "eth_requestAccounts" });
        walletAddress = metaAccounts[0];
        await provider.request({
          method: "eth_sendTransaction",
          params: [{
            from: walletAddress,
            to: toAddress,
            value: (parseFloat(price) * 1e18).toString(16),
          }],
        });
        break;

      case "phantom":
        throw new Error("Phantom wallet is not supported yet. Please use MetaMask or OKX Wallet.");

      case "okx":
        provider = window.okxwallet;
        if (!provider) throw new Error("OKX Wallet is not installed");
        const okxAccounts = await provider.request({ method: "eth_requestAccounts" });
        walletAddress = okxAccounts[0];
        await provider.request({
          method: "eth_sendTransaction",
          params: [{
            from: walletAddress,
            to: toAddress,
            value: (parseFloat(price) * 1e18).toString(16),
          }],
        });
        break;

      default:
        throw new Error("Unsupported wallet type");
    }

    // Langkah 2: Dapatkan data pengguna dari Supabase
    const { data: { user }, error: userError } = await supabase.auth.getUser();
    if (userError || !user) throw new Error("User not logged in");

    // Langkah 3: Hitung masa berlaku dan multiplier booster
    const validityDays = { elite: 30, epic: 45, pro: 60, diamond: 90 };
    const speedMultiplier = { elite: 3, epic: 5, pro: 10, diamond: 15 };
    const expiresAt = new Date();
    expiresAt.setDate(expiresAt.getDate() + validityDays[booster]);

    // Langkah 4: Simpan data pembelian ke tabel boosters
    const { error: insertError } = await supabase.from("boosters").insert({
      user_id: user.id,
      booster_type: booster,
      speed_multiplier: speedMultiplier[booster],
      price: parseFloat(price),
      wallet_address: walletAddress,
      expires_at: expiresAt.toISOString(),
    });

    if (insertError) {
      console.error("Failed to insert booster into boosters table:", insertError);
      throw new Error("Failed to record booster purchase");
    }

    // Langkah 5: Perbarui kolom booster di tabel profiles
    const { error: updateError } = await supabase
      .from("profiles")
      .update({ booster: booster })
      .eq("id", user.id);

    if (updateError) {
      console.error("Failed to update booster in profiles table:", updateError);
      throw new Error("Failed to update booster status");
    }

    // Langkah 6: Verifikasi bahwa booster telah diperbarui
    const { data: profileData, error: fetchError } = await supabase
      .from("profiles")
      .select("booster")
      .eq("id", user.id)
      .single();

    if (fetchError || profileData.booster !== booster) {
      console.error("Booster verification failed:", fetchError || "Booster value mismatch");
      throw new Error("Failed to verify booster update");
    }

    console.log(`Booster updated successfully: ${profileData.booster}`);
    isToastActive = true;
    showToast("Success", `${booster.charAt(0).toUpperCase() + booster.slice(1)} Booster activated!`);
    setTimeout(() => { isToastActive = false; }, 3000); // Reset flag setelah 3 detik
    // Perbarui UI (opsional, jika elemen booster ada di dashboard)
    const boosterElement = document.querySelector(".booster-value");
    if (boosterElement) {
      boosterElement.textContent = booster.charAt(0).toUpperCase() + booster.slice(1);
    }
  } catch (error) {
    console.error("Purchase error:", error);
    if (!isToastActive) {
      isToastActive = true;
      showToast("Error", error.message === "User denied transaction" ? "Transaction cancelled by user" : error.message || "Purchase failed", "destructive");
      setTimeout(() => { isToastActive = false; }, 3000); // Reset flag setelah 3 detik
    }
  }
}

// Event listener untuk tombol pembelian booster
document.querySelectorAll(".purchase-btn").forEach(btn => {
  btn.addEventListener("click", async (e) => {
    e.preventDefault(); // Mencegah aksi default jika ada
    const booster = btn.dataset.booster;
    const price = btn.dataset.price;
    const boosterName = booster.charAt(0).toUpperCase() + booster.slice(1);

    // Modal untuk memilih metode pembayaran
    const overlay = document.createElement("div");
    overlay.className = "fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4";

    const modal = document.createElement("div");
    modal.className = "bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl shadow-2xl border border-slate-700/50 w-full max-w-md overflow-hidden";
    modal.innerHTML = `
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-slate-100 flex items-center gap-2">
            <i data-lucide="wallet" class="w-5 h-5 text-cyan-400"></i>
            Select Payment Method
          </h3>
          <button class="close-btn text-slate-400 hover:text-slate-200">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        
        <div class="mb-6">
          <div class="bg-slate-700/30 rounded-lg p-4 mb-3">
            <div class="text-xs text-slate-400 mb-1">Purchasing</div>
            <div class="font-medium text-slate-100">${boosterName} Booster</div>
          </div>
          <div class="bg-slate-700/30 rounded-lg p-4">
            <div class="text-xs text-slate-400 mb-1">Amount</div>
            <div class="font-medium text-slate-100">${price} ETH</div>
          </div>
        </div>
        
        <div class="space-y-3 mb-6">
          <button class="wallet-btn flex items-center gap-4 p-4 w-full rounded-lg bg-slate-700/50 hover:bg-slate-700/70 transition-colors border border-slate-600/50" data-wallet="metamask">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask" class="w-8 h-8">
            <span class="text-slate-100 font-medium">MetaMask</span>
            <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-400"></i>
          </button>
          
          <button class="wallet-btn flex items-center gap-4 p-4 w-full rounded-lg bg-slate-700/50 hover:bg-slate-700/70 transition-colors border border-slate-600/50" data-wallet="phantom">
            <img src="https://mate.tools/s/dGOqmKUm" alt="Phantom" class="w-8 h-8 rounded-full">
            <span class="text-slate-100 font-medium">Phantom</span>
            <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-400"></i>
          </button>
          
          <button class="wallet-btn flex items-center gap-4 p-4 w-full rounded-lg bg-slate-700/50 hover:bg-slate-700/70 transition-colors border border-slate-600/50" data-wallet="okx">
            <img src="https://mate.tools/s/WNjPYxYj" alt="OKX" class="w-8 h-8 rounded-full">
            <span class="text-slate-100 font-medium">OKX Wallet</span>
            <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-400"></i>
          </button>
        </div>
        
        <div class="text-xs text-slate-500 text-center">
          Your wallet will open to confirm the transaction
        </div>
      </div>
    `;
    
    overlay.appendChild(modal);
    document.body.appendChild(overlay);
    document.body.style.overflow = "hidden";
    
    if (window.lucide) {
      window.lucide.createIcons();
    }
    
    const closeModal = () => {
      document.body.removeChild(overlay);
      document.body.style.overflow = "";
    };
    
    overlay.querySelector(".close-btn").addEventListener("click", closeModal);
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeModal();
    });
    
    const walletBtns = overlay.querySelectorAll(".wallet-btn");
    walletBtns.forEach(btn => {
      btn.addEventListener("click", async (e) => {
        e.preventDefault(); // Mencegah aksi default
        const walletType = btn.dataset.wallet;

        if (walletType === "phantom") {
          modal.innerHTML = `
            <div class="p-6 flex flex-col items-center justify-center h-64">
              <i data-lucide="alert-triangle" class="w-8 h-8 text-red-400 mb-4"></i>
              <h3 class="text-lg font-medium text-slate-100 mb-2">Phantom Not Supported</h3>
              <p class="text-sm text-slate-400 text-center">Phantom wallet is not supported yet. Please use MetaMask or OKX Wallet.</p>
              <button class="close-btn mt-6 px-4 py-2 bg-slate-600 text-slate-200 rounded-lg hover:bg-slate-500 transition-colors">
                Close
              </button>
            </div>
          `;
          if (window.lucide) {
            window.lucide.createIcons();
          }
          modal.querySelector(".close-btn").addEventListener("click", closeModal);
          return;
        }

        showConfirmationModal(walletType, boosterName, price, async () => {
          modal.innerHTML = `
            <div class="p-6 flex flex-col items-center justify-center h-64">
              <div class="animate-spin mb-4">
                <i data-lucide="loader" class="w-8 h-8 text-cyan-400"></i>
              </div>
              <h3 class="text-lg font-medium text-slate-100 mb-2">Connecting to ${btn.querySelector("span").textContent}</h3>
              <p class="text-sm text-slate-400 text-center">Please check your wallet to confirm the transaction</p>
            </div>
          `;
          
          if (window.lucide) {
            window.lucide.createIcons();
          }
          
          try {
            await handlePurchase(walletType, booster, price);
            closeModal();
          } catch (error) {
            console.error("Wallet connection error:", error);
            closeModal();
            if (!isToastActive) {
              isToastActive = true;
              showToast("Error", error.message === "User denied transaction" ? "Transaction cancelled by user" : error.message || "Wallet connection failed", "destructive");
              setTimeout(() => { isToastActive = false; }, 3000);
            }
          }
        });
      });
    });
  });
});
//end of purchase

































// Run security scan
async function runSecurityScan() {
    const userResult = await supabase.auth.getUser();
    const user = userResult.data.user;

    if (!user) {
        alert("User belum login.");
        return;
    }

    const userAgent = navigator.userAgent;
    document.getElementById('userAgent').textContent = userAgent;

    const devtoolsStatus = document.getElementById('devtoolsStatus');
    const isDevToolsOpen = () => {
        const threshold = 100;
        const widthDiff = window.outerWidth - window.innerWidth;
        const heightDiff = window.outerHeight - window.innerHeight;
        return widthDiff > threshold || heightDiff > threshold;
    };
    const devOpen = isDevToolsOpen();
    devtoolsStatus.innerHTML = devOpen
        ? `<span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span> Open`
        : `<span class="w-2 h-2 mr-2 rounded-full bg-green-400 animate-pulse"></span> Closed`;
    devtoolsStatus.className = devOpen
        ? 'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-900/30 text-red-400 border border-red-700/50'
        : 'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-900/30 text-green-400 border border-green-700/50';

    let fingerprint = "Unavailable";
    try {
        const fp = await FingerprintJS.load();
        const result = await fp.get();
        fingerprint = result.visitorId;
        document.getElementById('deviceFingerprint').textContent = fingerprint;
    } catch (error) {
        document.getElementById('deviceFingerprint').textContent = "Error";
    }

    let ip = "Unknown", location = "Unknown";
    try {
        const res = await fetch('https://ipinfo.io/json?token=d5d6936f036032');
        const data = await res.json();
        ip = data.ip;
        location = `${data.city}, ${data.region}, ${data.country}`;
        document.getElementById('ipAddress').textContent = ip;
        document.getElementById('locationInfo').textContent = location;
    } catch (error) {
        document.getElementById('ipAddress').textContent = "Error";
        document.getElementById('locationInfo').textContent = "Error";
    }

    const { data: existingData, error: fetchError } = await supabase
        .from("security_scans")
        .select("id")
        .eq("user_id", user.id)
        .eq("fingerprint", fingerprint)
        .eq("ip_address", ip)
        .limit(1);

    if (fetchError) {
        console.error("Error cek duplikasi:", fetchError.message);
        return;
    }

    if (existingData.length > 0) {
        console.log("Data sudah ada. Tidak akan disimpan.");
        return;
    }

    const logContainer = document.getElementById('securityLog');
    const logEntry = document.createElement('div');
    logEntry.className = "bg-slate-800/60 border border-slate-700 rounded-lg p-4 space-y-2 text-slate-300";
    logEntry.innerHTML = `
        <div class="flex items-center text-sm">
            <i data-lucide="monitor" class="h-4 w-4 mr-2 text-blue-400"></i>
            <span class="font-medium">User Agent:</span> <span class="ml-2 truncate">${userAgent}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="code" class="h-4 w-4 mr-2 ${devOpen ? 'text-red-400' : 'text-green-400'}"></i>
            <span class="font-medium">DevTools:</span> <span class="ml-2">${devOpen ? 'Open' : 'Closed'}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="fingerprint" class="h-4 w-4 mr-2 text-purple-400"></i>
            <span class="font-medium">Fingerprint:</span> <span class="ml-2">${fingerprint}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="globe" class="h-4 w-4 mr-2 text-yellow-400"></i>
            <span class="font-medium">IP Address:</span> <span class="ml-2">${ip}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="map-pin" class="h-4 w-4 mr-2 text-pink-400"></i>
            <span class="font-medium">Location:</span> <span class="ml-2">${location}</span>
        </div>
    `;
    logContainer.prepend(logEntry);
    lucide.createIcons();

    const email = user.email;
    const { data: insertData, error } = await supabase
        .from("security_scans")
        .insert([
            {
                user_id: user.id,
                email: email,
                user_agent: userAgent,
                devtools_open: devOpen,
                fingerprint: fingerprint,
                ip_address: ip,
                location: location,
                created_at: new Date().toISOString()
            }
        ]);

    if (error) {
        console.error("Gagal simpan ke Supabase:", error.message, error.details);
    } else {
        console.log("✅ Data berhasil dikirim ke Supabase.");
    }
}

document.getElementById('runSecurityScanBtn').addEventListener('click', runSecurityScan);

document.getElementById('clearSecurityLogBtn').addEventListener('click', () => {
    document.getElementById('securityLog').innerHTML = '';
});

// Fungsi untuk menyembunyikan sebagian alamat wallet
function maskWalletAddress(address) {
    if (!address) return '';
    const visibleChars = 6;
    return address.length > visibleChars * 2
        ? `${address.slice(0, visibleChars)}...${address.slice(-visibleChars)}`
        : address;
}
//end of security scan
















































// start Leaderboard
const rankIcons = {
    1: `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-300 drop-shadow-gold" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="gold" stroke-width="1.5"/>
        </svg>
    `,
    2: `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300 drop-shadow-silver" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="silver" stroke-width="1.5"/>
        </svg>
    `,
    3: `
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600 drop-shadow-bronze" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="#cd7f32" stroke-width="1.5"/>
        </svg>
    `,
    4: `
        <div class="h-6 w-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-xs font-bold text-white shadow-neon">
            4
        </div>
    `,
    5: `
        <div class="h-6 w-6 rounded-full bg-gradient-to-br from-indigo-500 to-cyan-500 flex items-center justify-center text-xs font-bold text-white shadow-neon">
            5
        </div>
    `,
    6: `
        <div class="h-6 w-6 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center text-xs font-bold text-white shadow-neon">
            6
        </div>
    `,
    7: `
        <div class="h-6 w-6 rounded-full bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center text-xs font-bold text-white shadow-neon">
            7
        </div>
    `,
    8: `
        <div class="h-6 w-6 rounded-full bg-gradient-to-br from-red-500 to-orange-500 flex items-center justify-center text-xs font-bold text-white shadow-neon">
            8
        </div>
    `,
    9: `
        <div class="h-6 w-6 rounded-full bg-gradient-to-br from-blue-700 to-indigo-800 flex items-center justify-center text-xs font-bold text-white shadow-neon">
            9
        </div>
    `,
    10: `
        <div class="h-6 w-6 rounded-full bg-gradient-to-br from-gray-600 to-gray-800 flex items-center justify-center text-xs font-bold text-gray-200 shadow-neon">
            10
        </div>
    `
};

async function loadLeaderboard() {
    try {
        const { data, error } = await supabase
            .from("profiles")
            .select("full_name, email, points, booster, wallet_address, avatar_url, invited_users")
            .order("points", { ascending: false })
            .limit(10);

        if (error) throw error;

        const leaderboardList = document.getElementById("leaderboardList");
        leaderboardList.innerHTML = "";

        // Frame avatar berdasarkan rank
        const rankFrames = {
            1: `
                <div class="absolute -inset-1 rounded-full bg-gradient-to-r from-yellow-500 via-amber-600 to-yellow-400 blur-sm opacity-75 animate-pulse"></div>
                <div class="relative z-10 border-2 border-yellow-300 rounded-full p-0.5 bg-slate-900">
                    <!-- Avatar inside -->
                </div>
            `,
            2: `
                <div class="absolute -inset-1 rounded-full bg-gradient-to-r from-gray-300 via-slate-400 to-gray-300 blur-sm opacity-75 animate-pulse"></div>
                <div class="relative z-10 border-2 border-gray-300 rounded-full p-0.5 bg-slate-900">
                    <!-- Avatar inside -->
                </div>
            `,
            3: `
                <div class="absolute -inset-1 rounded-full bg-gradient-to-r from-amber-800 via-amber-700 to-orange-600 blur-sm opacity-75 animate-pulse"></div>
                <div class="relative z-10 border-2 border-amber-600 rounded-full p-0.5 bg-slate-900">
                    <!-- Avatar inside -->
                </div>
            `,
            default: (rank) => `
                <div class="absolute -inset-1 rounded-full ${getGradientFrame(rank)} blur-sm opacity-75 animate-pulse"></div>
                <div class="relative z-10 border border-slate-700 rounded-full p-0.5 bg-slate-900">
                    <!-- Avatar inside -->
                </div>
            `
        };

        function getGradientFrame(rank) {
            switch (rank) {
                case 4: return 'bg-gradient-to-r from-blue-500 to-purple-600';
                case 5: return 'bg-gradient-to-r from-indigo-500 to-cyan-500';
                case 6: return 'bg-gradient-to-r from-purple-600 to-pink-500';
                case 7: return 'bg-gradient-to-r from-green-500 to-teal-500';
                case 8: return 'bg-gradient-to-r from-red-500 to-orange-500';
                case 9: return 'bg-gradient-to-r from-blue-700 to-indigo-800';
                case 10: return 'bg-gradient-to-r from-gray-600 to-gray-800';
                default: return 'bg-gradient-to-r from-slate-700 to-slate-900';
            }
        }

        for (const [index, entry] of data.entries()) {
            const rank = index + 1;
            const displayName = entry.full_name || entry.email || "Anonymous";
            const pointsDisplay = entry.points.toFixed(2);
            const boosterDisplay = entry.booster
                ? `<span class="bg-amber-500/10 text-amber-400 px-2 py-1 rounded-md text-xs">${entry.booster.charAt(0).toUpperCase() + entry.booster.slice(1)}</span>`
                : '<span class="text-slate-500 text-xs">None</span>';
            const inviteCount = entry.invited_users || 0;
            const inviteCountDisplay = `
                <div class="text-sm font-bold text-cyan-400">${inviteCount}</div>
                <div class="text-xs text-slate-500">invites</div>
            `;

            let avatarHTML = `
                <div class="h-8 w-8 rounded-full bg-gradient-to-br from-cyan-600 to-slate-800 text-white flex items-center justify-center text-sm font-bold shadow">
                    ${displayName[0].toUpperCase()}
                </div>
            `;

            if (entry.avatar_url) {
                const { data: avatarData, error: avatarError } = await supabase
                    .storage
                    .from("avatars")
                    .getPublicUrl(entry.avatar_url);
                if (!avatarError && avatarData.publicUrl) {
                    avatarHTML = `<img src="${avatarData.publicUrl}" class="h-8 w-8 rounded-full object-cover shadow" alt="Avatar" />`;
                }
            }

            // Wrap avatar with rank frame
            let framedAvatar = "";
            if (rank <= 3) {
                framedAvatar = rankFrames[rank].replace("<!-- Avatar inside -->", avatarHTML);
            } else if (rank <= 10) {
                framedAvatar = rankFrames.default(rank).replace("<!-- Avatar inside -->", avatarHTML);
            } else {
                framedAvatar = avatarHTML; // No frame
            }

            const row = document.createElement("div");
            row.className = "grid grid-cols-12 py-4 items-center hover:bg-slate-800/30 transition-colors group";
            row.innerHTML = `
                <div class="col-span-1 flex justify-center items-center">
                    ${rank <= 10 ? rankIcons[rank] : `<div class="text-xs text-slate-500">${rank}</div>`}
                </div>
                <div class="col-span-1 relative h-10 w-10">${framedAvatar}</div>
                <div class="col-span-4">
                    <div class="text-sm font-medium text-slate-200">${displayName}</div>
                    <div class="text-xs text-slate-500 truncate">${maskWalletAddress(entry.wallet_address || '')}</div>
                </div>
                <div class="col-span-2">${boosterDisplay}</div>
                <div class="col-span-2 text-right">${inviteCountDisplay}</div>
                <div class="col-span-2 text-right">
                    <div class="text-sm font-bold text-amber-400">${pointsDisplay}</div>
                    <div class="text-xs text-slate-500">points</div>
                </div>
            `;
            leaderboardList.appendChild(row);
        }
    } catch (error) {
        showToast("Error", error.message, "destructive");
    } finally {
        loadingOverlay.classList.add("hidden");
    }
}
//end of leaderboard




























































let messagesList = [];
let adminMessagesList = [];
let isChatInitialized = false;
let supabaseChannels = [];
let eventListeners = [];
let onlineUsers = [];
let latencyInterval;
let lastChatTime = {};
let lastMediaTime = {};
const CHAT_COOLDOWN = 60 * 1000; // 1 detik
const MEDIA_COOLDOWN = 60 * 30 * 1000; // 1 detik

//tize HTML untuk mencegah XSS
function sanitizeHTML(str) {
    const div = document.createElement("div");
    div.textContent = str;
    return div.innerHTML;
}

// Filter kata kasar
const badWords = ["tolol", "anjing", "asu", "fuckyou", "babi", "bapak kau", "bujang", "kontol", "memek", "perek", "jancuk"];
function filterBadWords(content) {
    let filteredContent = content;
    let hasBadWord = false;
    badWords.forEach(word => {
        const regex = new RegExp(`\\b${word}\\b`, 'gi');
        if (regex.test(filteredContent)) {
            hasBadWord = true;
            filteredContent = filteredContent.replace(regex, "Word Removed");
        }
    });
    if (hasBadWord) {
        showToast("Warning”, ”Rude words have been removed from your message!", "destructive");
    }
    return filteredContent;
}

// Format waktu relatif
function timeAgo(date) {
    const now = new Date();
    const seconds = Math.floor((now - new Date(date)) / 1000);
    if (seconds < 60) return `${seconds} detik lalu`;
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return `${minutes} menit lalu`;
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return `${hours} jam lalu`;
    return new Date(date).toLocaleDateString("id-ID");
}

// Validasi UUID
function isValidUuid(uuid) {
    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    return uuidRegex.test(uuid);
}

// Normalisasi struktur likes
function normalizeLikes(likes) {
    if (!Array.isArray(likes)) {
        return [];
    }
    return likes.filter(like => like && like.type && like.user_id && isValidUuid(like.user_id));
}

// Mendapatkan jumlah like per tipe
function getLikesCount(likes, type) {
    return normalizeLikes(likes).filter(like => like.type === type).length;
}

// Fungsi untuk menambahkan satu pesan admin ke DOM
async function appendAdminMessage(msg) {
    const adminMessages = document.getElementById("adminMessages");
    if (!adminMessages) return;

    const adminMessageEl = document.createElement("div");
    adminMessageEl.className = "mb-4 last:mb-0 bg-gradient-to-br from-slate-800/30 to-slate-900/20 border border-slate-700/40 rounded-xl p-4 text-slate-100 shadow-md animate-fade-in";
    adminMessageEl.setAttribute("data-admin-message-id", msg.id);

    const timestamp = new Date(msg.created_at).toLocaleString("id-ID", {
        hour: "numeric", minute: "numeric", hour12: true,
        day: "numeric", month: "short", year: "numeric"
    });

    const sanitizedContent = sanitizeHTML(msg.content);

    adminMessageEl.innerHTML = `
    <div class="flex items-start gap-4 p-4 bg-gradient-to-br from-slate-900/40 to-slate-950/30 rounded-xl border border-slate-800/50 shadow-lg shadow-slate-900/20">
        <div class="flex-shrink-0 p-2.5 bg-gradient-to-br from-slate-700 to-slate-800 rounded-full shadow-md">
            <i data-lucide="shield-alert" class="h-6 w-6 text-white"></i>
        </div>
        <div class="flex-1 space-y-2">
            <div class="flex items-center justify-between">
                <div class="font-medium text-white/90 text-lg flex items-center gap-2">
                    <i data-lucide="verified" class="h-5 w-5 text-cyan-300"></i>
                    <span class="bg-clip-text text-transparent bg-gradient-to-r from-cyan-300 to-slate-200">Official Announcement</span>
                </div>
                <div class="text-xs text-cyan-200/80 flex items-center bg-slate-900/30 px-2 py-1 rounded-full">
                    <i data-lucide="clock" class="h-3 w-3 mr-1.5"></i>
                    <span>${timestamp}</span>
                </div>
            </div>
            <div class="pl-1 text-white/90 leading-relaxed text-base font-light space-y-2">
                ${sanitizedContent.split('\n').map(p => `<p class="flex items-start gap-2"><i data-lucide="chevron-right" class="h-4 w-4 mt-1 flex-shrink-0 text-cyan-300/80"></i><span>${p}</span></p>`).join('')}
            </div>
            <div class="pt-2 flex items-center gap-3 text-xs text-cyan-300/70">
                <div class="flex items-center"><i data-lucide="info" class="h-3 w-3 mr-1.5"></i><span>Admin Team</span></div>
                <div class="flex items-center"><i data-lucide="mail" class="h-3 w-3 mr-1.5"></i><span>aqula@gmail.com</span></div>
            </div>
        </div>
    </div>`;
    
    adminMessages.appendChild(adminMessageEl);
    lucide.createIcons();
}

// Fungsi untuk menambahkan satu pesan ke DOM
async function appendMessage(msg, updateOnly = false) {
    const chatMessages = document.getElementById("chatMessages");
    if (!chatMessages) {
        console.error("Elemen chatMessages tidak ditemukan");
        return;
    }

    const existingMessage = document.querySelector(`[data-message-id="${msg.id}"]`);
    if (existingMessage && !updateOnly) {
        return;
    }

    if (!isValidUuid(msg.id) && !msg.id.startsWith("temp-")) {
        console.error(`Invalid message ID: ${msg.id}`);
        showToast("Error”, ”Invalid message ID", "destructive");
        return;
    }

    const isMine = msg.user_id === window.currentUser?.id;
    const messageEl = existingMessage || document.createElement("div");
    messageEl.className = `flex mb-4 last:mb-0 ${isMine ? "flex-row-reverse" : ""}`;
    messageEl.setAttribute("data-message-id", msg.id);

    if (existingMessage) {
        const oldButtons = existingMessage.querySelectorAll('.play-pause-btn, .like-btn, .reply-btn, .report-btn');
        oldButtons.forEach(btn => btn.replaceWith(btn.cloneNode(true)));
    }

    let avatarContent = msg.full_name ? msg.full_name[0].toUpperCase() : 'A';
    let avatarColor = "blue";
    if (isMine) avatarColor = "cyan";
    if (msg.full_name?.includes("Sarah")) avatarColor = "purple";

    if (msg.avatar_url) {
        try {
            const { data: avatarData } = await supabase.storage
                .from("avatars")
                .getPublicUrl(msg.avatar_url);
            if (avatarData?.publicUrl) {
                avatarContent = `<img src="${avatarData.publicUrl}" class="h-8 w-8 rounded-full object-cover" alt="Avatar" />`;
            }
        } catch (error) {
            console.error("Gagal ambil avatar:", error);
        }
    }

    const timestamp = new Date(msg.created_at).toLocaleString("id-ID", {
        hour: "numeric",
        minute: "numeric",
        hour12: true,
    });

    const highlightedContent = highlightMentions(sanitizeHTML(msg.content));
    const sanitizedFullName = sanitizeHTML(msg.full_name || "Anonim");
    const isMentioned = Array.isArray(msg.mentions) && msg.mentions.includes(window.currentUser?.id);

    const isAtBottom = isScrolledToBottom(chatMessages);

    messageEl.innerHTML = `
        <div class="flex-shrink-0 ${isMine ? "ml-3" : "mr-3"}">
            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-${avatarColor}-500/20 to-${avatarColor}-600/20 border border-${avatarColor}-500/30 flex items-center justify-center shadow-sm">
                ${avatarContent}
            </div>
        </div>
        <div class="flex-1 min-w-0 ${isMine ? "text-right" : ""}">
            <div class="flex items-baseline mb-1 ${isMine ? "justify-end" : ""}">
                <div class="text-xs ${isMine ? "text-slate-500 flex items-center mr-2" : "font-medium text-" + avatarColor + "-400 mr-2"}">
                    ${isMine ? `<i data-lucide="clock" class="h-3 w-3 mr-1"></i><span>${timestamp}</span>` : sanitizedFullName}
                </div>
                ${isMine ? `<div class="text-xs font-medium text-cyan-400">You</div>` : `<div class="text-xs text-slate-500 flex items-center"><i data-lucide="clock" class="h-3 w-3 mr-1"></i><span>${timestamp}</span></div>`}
            </div>
            <div class="text-sm text-slate-300 ${isMine ? "bg-gradient-to-r from-cyan-600/20 to-blue-600/20 border border-cyan-500/30 inline-block" : "bg-slate-800/50 border border-slate-700/30"} rounded-lg p-3 ${isMentioned ? "border-cyan-500/50" : ""}">
                ${highlightedContent}
            </div>
    `;

    if (msg.image_url) {
        const imgContainer = document.createElement("div");
        imgContainer.className = "grid grid-cols-2 gap-2 mt-2";
        imgContainer.innerHTML = `
            <div class="bg-slate-800/70 border border-slate-700/40 rounded-lg overflow-hidden cursor-pointer hover:border-cyan-500/40 transition-all duration-200">
                <img src="${msg.image_url}" alt="Image" class="max-w-[200px] h-auto">
            </div>
        `;
        messageEl.querySelector(".text-sm").appendChild(imgContainer);
    }

    if (msg.audio_url) {
        const voiceContainer = document.createElement("div");
        voiceContainer.className = "voice-message-container mt-2";
        const duration = msg.duration || Math.floor(Math.random() * 30) + 5;
        const minutes = Math.floor(duration / 60);
        const seconds = duration % 60;

        voiceContainer.innerHTML = `
            <div class="voice-message ${isMine ? 'bg-gradient-to-r from-cyan-600/20 to-blue-600/20 border border-cyan-500/30' : 'bg-slate-800/50 border border-slate-700/30'} rounded-lg p-2 flex items-center">
                <button class="play-pause-btn p-2 bg-${isMine ? 'cyan' : 'slate'}-500/20 rounded-full">
                    <svg class="play-icon" width="16" height="16" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M8 5v14l11-7z"/>
                    </svg>
                    <svg class="pause-icon" width="16" height="16" viewBox="0 0 24 24" style="display:none">
                        <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                    </svg>
                </button>
                <div class="waveform-container flex-1 mx-2">
                    <div class="waveform h-6 bg-slate-700/50 rounded-full overflow-hidden">
                        <div class="progress h-full bg-${isMine ? 'cyan' : 'blue'}-500/50" style="width: 0%"></div>
                    </div>
                </div>
                <span class="duration text-xs text-slate-400">${minutes}:${seconds.toString().padStart(2, '0')}</span>
            </div>
            <audio src="${msg.audio_url}" preload="none"></audio>
        `;
        messageEl.querySelector(".text-sm").appendChild(voiceContainer);

        const playBtn = voiceContainer.querySelector('.play-pause-btn');
        const audio = voiceContainer.querySelector('audio');
        const playIcon = voiceContainer.querySelector('.play-icon');
        const pauseIcon = voiceContainer.querySelector('.pause-icon');
        const progress = voiceContainer.querySelector('.progress');

        if (playBtn && audio && playIcon && pauseIcon && progress) {
            playBtn.addEventListener('click', () => {
                if (audio.paused) {
                    audio.play();
                    playIcon.style.display = 'none';
                    pauseIcon.style.display = 'block';
                    const startTime = Date.now();
                    const animate = () => {
                        const elapsed = (Date.now() - startTime) / 1000;
                        const percentage = Math.min((elapsed / duration) * 100, 100);
                        progress.style.width = `${percentage}%`;
                        if (!audio.paused && percentage < 100) {
                            requestAnimationFrame(animate);
                        }
                    };
                    animate();
                } else {
                    audio.pause();
                    playIcon.style.display = 'block';
                    pauseIcon.style.display = 'none';
                }
            });

            audio.addEventListener('ended', () => {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
                progress.style.width = '0%';
            });

            audio.addEventListener('pause', () => {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            });
        }
    }

    const actions = document.createElement("div");
    actions.className = `flex items-center mt-2 space-x-3 ${isMine ? "justify-end" : ""}`;
    const likes = normalizeLikes(msg.likes);
    actions.innerHTML = `
        <div class="like-container flex space-x-2">
            <button class="like-btn like-thumbs-up text-xs text-slate-400 hover:text-cyan-400 flex items-center" data-message-id="${msg.id}" data-type="thumbsUp">
                <i data-lucide="thumbs-up" class="h-3 w-3 mr-1"></i>
                <span>${getLikesCount(likes, "thumbsUp")}</span>
            </button>
            <button class="like-btn like-heart text-xs text-slate-400 hover:text-red-400 flex items-center" data-message-id="${msg.id}" data-type="heart">
                ❤️<span class="ml-1">${getLikesCount(likes, "heart")}</span>
            </button>
            <button class="like-btn like-laugh text-xs text-slate-400 hover:text-yellow-400 flex items-center" data-message-id="${msg.id}" data-type="laugh">
                😆<span class="ml-1">${getLikesCount(likes, "laugh")}</span>
            </button>
            <button class="like-btn like-wow text-xs text-slate-400 hover:text-indigo-400 flex items-center" data-message-id="${msg.id}" data-type="wow">
                😮<span class="ml-1">${getLikesCount(likes, "wow")}</span>
            </button>
            <button class="like-btn like-sad text-xs text-slate-400 hover:text-blue-400 flex items-center" data-message-id="${msg.id}" data-type="sad">
                😢<span class="ml-1">${getLikesCount(likes, "sad")}</span>
            </button>
            <button class="like-btn like-angry text-xs text-slate-400 hover:text-orange-400 flex items-center" data-message-id="${msg.id}" data-type="angry">
                😡<span class="ml-1">${getLikesCount(likes, "angry")}</span>
            </button>
            <button class="like-btn like-love text-xs text-slate-400 hover:text-pink-400 flex items-center" data-message-id="${msg.id}" data-type="love">
                🥰<span class="ml-1">${getLikesCount(likes, "love")}</span>
            </button>
        </div>
        ${!isMine ? `
        <button class="reply-btn text-xs text-slate-400 hover:text-amber-400 flex items-center" data-message-id="${msg.id}">
            <i data-lucide="message-square" class="h-3 w-3 mr-1"></i>
            <span>Reply</span>
        </button>
        <button class="report-btn text-xs text-slate-400 hover:text-rose-400 flex items-center" data-message-id="${msg.id}">
            <i data-lucide="flag" class="h-3 w-3 mr-1"></i>
            <span>Report</span>
        </button>` : `
        <span class="text-xs text-slate-500 flex items-center">
            <i data-lucide="check" class="h-3 w-3 mr-1 text-emerald-400"></i>
            <span>${msg.status || "Delivered"}</span>
        </span>`}
    `;
    messageEl.querySelector(".flex-1").appendChild(actions);

    const likeButtons = actions.querySelectorAll('.like-btn');
    likeButtons.forEach(button => {
        button.addEventListener('click', async (e) => {
            e.preventDefault();
            e.stopPropagation();

            const messageId = button.dataset.messageId;
            const likeType = button.dataset.type;

            // Jika pengguna tidak login, tampilkan pesan dan hentikan
            if (!window.currentUser?.id || !isValidUuid(window.currentUser.id)) {
                showToast("Error”, ”Please login to like", "destructive");
                return;
            }

            if (!isValidUuid(messageId)) {
                console.error(`Invalid message ID: ${messageId}`);
                showToast("Error”, ”Invalid message ID", "destructive");
                return;
            }

            let likes = normalizeLikes(msg.likes);
            const userLike = likes.find(like => like.user_id === window.currentUser.id);

            if (userLike) {
                if (userLike.type === likeType) {
                    likes = likes.filter(like => like.user_id !== window.currentUser.id);
                } else {
                    likes = likes.filter(like => like.user_id !== window.currentUser.id);
                    likes.push({ type: likeType, user_id: window.currentUser.id });
                }
            } else {
                likes.push({ type: likeType, user_id: window.currentUser.id });
            }

            const { error } = await supabase.from("messages").update({ likes }).eq("id", messageId);
            if (error) {
                console.error("Gagal menyimpan like ke Supabase:", error);
                showToast("Error”, ”Failed to save like: " + error.message, "destructive");
                return;
            }

            const index = messagesList.findIndex(m => m.id === messageId);
            if (index !== -1) {
                messagesList[index].likes = likes;
                await appendMessage(messagesList[index], true);
            }
        });
    });

    if (!isMine) {
        const replyBtn = actions.querySelector('.reply-btn');
        if (replyBtn) {
            const replyHandler = () => {
                if (!window.currentUser?.id) {
                    showToast("Error”, ”Please login to reply to the message", "destructive");
                    return;
                }
                const chatInput = document.getElementById("chatInput");
                chatInput.value = `Replying to ${msg.full_name}: ${msg.content}\n`;
                chatInput.focus();
            };
            replyBtn.addEventListener('click', replyHandler);
            eventListeners.push({ element: replyBtn, event: "click", handler: replyHandler });
        }

        const reportBtn = actions.querySelector('.report-btn');
        if (reportBtn) {
            const reportHandler = () => {
                if (!window.currentUser?.id) {
                    showToast("Error", "Please login to report messages", "destructive");
                    return;
                }
                const popup = document.createElement("div");
                popup.className = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";
                popup.innerHTML = `
                    <div class="bg-slate-800 p-4 rounded-lg shadow-lg w-80">
                        <h3 class="text-lg font-semibold text-white mb-2">Laporkan Pesan</h3>
                        <textarea id="reportReason" class="w-full h-24 p-2 bg-slate-700 text-white rounded mb-4" placeholder="Masukkan alasan pelaporan..."></textarea>
                        <div class="flex justify-end space-x-2">
                            <button id="cancelReport" class="px-4 py-2 bg-slate-600 text-white rounded hover:bg-slate-500">cancel</button>
                            <button id="submitReport" class="px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-500">Send</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(popup);

                const cancelBtn = popup.querySelector("#cancelReport");
                if (cancelBtn) {
                    const cancelHandler = () => popup.remove();
                    cancelBtn.addEventListener("click", cancelHandler);
                    eventListeners.push({ element: cancelBtn, event: "click", handler: cancelHandler });
                }

                const submitBtn = popup.querySelector("#submitReport");
                if (submitBtn) {
                    const submitHandler = async () => {
                        const reason = document.getElementById("reportReason").value.trim();
                        if (reason) {
                            await supabase.from("reports").insert({
                                message_id: msg.id,
                                user_id: window.currentUser.id,
                                reason,
                            });
                            showToast("Info”, ”Message has been reported", "default");
                        }
                        popup.remove();
                    };
                    submitBtn.addEventListener("click", submitHandler);
                    eventListeners.push({ element: submitBtn, event: "click", handler: submitHandler });
                }
            };
            reportBtn.addEventListener('click', reportHandler);
            eventListeners.push({ element: reportBtn, event: "click", handler: reportHandler });
        }
    }

    lucide.createIcons();
    if (!existingMessage) {
        chatMessages.appendChild(messageEl);
    }

    if (isAtBottom) {
        chatMessages.scrollTo({ top: chatMessages.scrollHeight, behavior: 'smooth' });
    }
}

  

// Cek apakah pengguna di bawah
function isScrolledToBottom(element) {
    return element.scrollHeight - element.scrollTop <= element.clientHeight + 10;
}

// Highlight text @username
function highlightMentions(text) {
    return text.replace(/@([\w\s]+)/g, '<span class="text-cyan-400 font-semibold">@$1</span>');
}

// Deteksi mention @username
function detectMentions(content) {
    const mentions = content.match(/@([\w\s]+)/g) || [];
    return mentions.map(m => m.substring(1).trim());
}

// Ambil daftar pengguna yang pernah mengirim pesan
async function fetchChatParticipants(query = "") {
    try {
        const { data, error } = await supabase
            .from("profiles")
            .select("id, full_name, avatar_url")
            .ilike("full_name", `%${query}%`)
            .limit(10);
        if (error) throw error;
        return data;
    } catch (error) {
        console.error("Gagal mengambil daftar pengguna:", error);
        return [];
    }
}

// Tampilkan daftar saran autocompletion
async function showMentionSuggestions(query, chatInput, suggestionList) {
    if (!suggestionList) return;

    const participants = await fetchChatParticipants(query);
    suggestionList.innerHTML = "";
    suggestionList.classList.add("hidden");

    if (participants.length === 0) return;

    participants.forEach(user => {
        const item = document.createElement("div");
        item.className = "suggestion-item flex items-center space-x-2 p-2 hover:bg-gray-100 cursor-pointer";
        const initial = user.full_name ? user.full_name[0].toUpperCase() : "A";
        item.innerHTML = `
            <div class="avatar w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center">
                ${initial}
            </div>
            <span>${sanitizeHTML(user.full_name)}</span>
        `;
        item.dataset.userId = user.id;
        item.dataset.fullName = user.full_name;
        const clickHandler = () => {
            const cursorPos = chatInput.selectionStart;
            const textBefore = chatInput.value.substring(0, cursorPos).replace(/@[\w\s]*$/, `@${user.full_name} `);
            const textAfter = chatInput.value.substring(cursorPos);
            chatInput.value = textBefore + textAfter;
            suggestionList.classList.add("hidden");
            chatInput.focus();
        };
        item.addEventListener("click", clickHandler);
        eventListeners.push({ element: item, event: "click", handler: clickHandler });
        suggestionList.appendChild(item);
    });

    suggestionList.classList.remove("hidden");
}

// Ambil data profil pengguna
async function fetchUserProfile(userId) {
    try {
        const { data: profile, error } = await supabase
            .from("profiles")
            .select("full_name, avatar_url")
            .eq("id", userId)
            .single();
        if (error) throw error;
        return {
            full_name: profile?.full_name || "Anonim",
            avatar_url: profile?.avatar_url || "",
        };
    } catch (error) {
        console.error("Gagal mengambil profil:", error);
        return { full_name: "Anonim", avatar_url: "" };
    }
}

// Kirim pesan
async function sendMessage(content, image_url = null, audio_url = null, tempId = null, duration = null) {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    const suggestionList = document.getElementById("mentionSuggestions");

    try {
        if (!chatInput || !sendMessageBtn) {
            console.error("Elemen chatInput atau sendMessageBtn tidak ditemukan");
            showToast("Error", "Input element not found", "destructive");
            return;
        }

        const userId = window.currentUser?.id;
        if (!userId) {
            showToast("Error", "You are not logged in yet.", "destructive");
            return;
        }

        const now = Date.now();

        if (content && lastChatTime[userId] && (now - lastChatTime[userId] < CHAT_COOLDOWN)) {
            const remaining = Math.ceil((CHAT_COOLDOWN - (now - lastChatTime[userId])) / 1000);
            showToast("Warning", `Wait ${remaining} seconds left to chat!`, "destructive");
            startChatTimer(remaining);
            return;
        }

        if ((image_url || audio_url) && lastMediaTime[userId] && (now - lastMediaTime[userId] < MEDIA_COOLDOWN)) {
            const remaining = Math.ceil((MEDIA_COOLDOWN - (now - lastMediaTime[userId])) / 1000 / 60);
            showToast("Warning", `Wait ${remaining} more minutes to send media!`, "destructive");
            return;
        }

        if (!content && !image_url && !audio_url) return;

        let filteredContent = content ? filterBadWords(content) : content;

        chatInput.disabled = true;
        sendMessageBtn.disabled = true;
        sendMessageBtn.innerHTML = `<i data-lucide="loader" class="h-4 w-4 animate-spin"></i>`;
        lucide.createIcons();

        const profile = window.currentUser.profile || (await fetchUserProfile(userId));
        window.currentUser.profile = profile;

        const messageData = {
            user_id: userId,
            full_name: profile.full_name,
            avatar_url: profile.avatar_url,
            content: filteredContent || "[Media]",
            status: "Delivered",
            likes: [],
        };

        if (image_url) messageData.image_url = image_url;
        if (audio_url) {
            messageData.audio_url = audio_url;
            if (duration) messageData.duration = duration;
        }

        let mentionedUserIds = [];
        const mentionedUsernames = detectMentions(filteredContent);
        for (const username of mentionedUsernames) {
            const { data: taggedUser, error } = await supabase
                .from("profiles")
                .select("id")
                .eq("full_name", username)
                .maybeSingle();
            if (error) {
                console.error(`Gagal mencari pengguna ${username}:`, error);
                continue;
            }
            if (taggedUser) {
                mentionedUserIds.push(taggedUser.id);
            }
        }

        if (mentionedUserIds.length > 0) {
            messageData.mentions = mentionedUserIds;
        }

        const { data, error: sendError } = await supabase.from("messages").insert(messageData).select().single();
        if (sendError) throw sendError;

        if (tempId) {
            const index = messagesList.findIndex(msg => msg.id === tempId);
            if (index !== -1) {
                messagesList[index] = { ...messagesList[index], ...data };
                localStorage.setItem("chatMessages", JSON.stringify(messagesList.slice(-100)));
                await appendMessage(messagesList[index], true);
            } else {
                messagesList.push(data);
                localStorage.setItem("chatMessages", JSON.stringify(messagesList.slice(-100)));
                await appendMessage(data);
            }
        }

        if (content) {
            lastChatTime[userId] = now;
            startChatTimer(CHAT_COOLDOWN / 1000);
        }
        if (image_url || audio_url) {
            lastMediaTime[userId] = now;
        }

        for (const username of mentionedUsernames) {
            const { data: taggedUser, error } = await supabase
                .from("profiles")
                .select("id")
                .eq("full_name", username)
                .maybeSingle();
            if (error) {
                console.error(`Gagal mencari pengguna untuk notifikasi ${username}:`, error);
                continue;
            }
            if (taggedUser) {
                const { error: notifyError } = await supabase.from("notifications").insert({
                    user_id: taggedUser.id,
                    type: "mention",
                    content: `${profile.full_name} menyebut Anda dalam pesan: "${filteredContent}"`,
                    is_read: false,
                });
                if (notifyError) {
                    console.error(`Gagal mengirim notifikasi untuk ${username}:`, notifyError);
                } else {
                    showToast("Info", `User @${username} has been tagged`, "default");
                }
            }
        }

        if (filteredContent) chatInput.value = "";
        if (suggestionList) {
            suggestionList.classList.add("hidden");
        }

        showToast("Success”, ”Message sent", "default");

    } catch (err) {
        console.error("Failed to send message:", err);
        showToast("Error", "Failed to send message: " + err.message, "destructive");
    } finally {
        chatInput.disabled = false;
        sendMessageBtn.disabled = false;
        sendMessageBtn.innerHTML = `<i data-lucide="send" class="h-4 w-4 text-white"></i>`;
        lucide.createIcons();
    }
}

// Fungsi timer cooldown chat
function startChatTimer(seconds) {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    let timeLeft = seconds;
    chatInput.disabled = true;
    sendMessageBtn.disabled = true;

    const timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
            clearInterval(timer);
            chatInput.disabled = false;
            sendMessageBtn.disabled = false;
            chatInput.placeholder = "Type your message...";
        } else {
            chatInput.placeholder = `Wait ${timeLeft} seconds to chat again...`;
        }
    }, 1000);
}

// Fungsi untuk memperbarui latensi koneksi
function updateConnectionLatency() {
    const start = Date.now();
    supabase.from("messages").select("id").limit(1).then(() => {
        const latency = Date.now() - start;
        const connectionLatency = document.getElementById("connectionLatency");
        if (connectionLatency) {
            connectionLatency.textContent = `${latency}ms`;
            connectionLatency.parentElement.classList.remove("text-red-400");
            connectionLatency.parentElement.classList.add("text-slate-400");
        }
    }).catch(() => {
        const connectionLatency = document.getElementById("connectionLatency");
        if (connectionLatency) {
            connectionLatency.textContent = "Terputus";
            connectionLatency.parentElement.classList.remove("text-slate-400");
            connectionLatency.parentElement.classList.add("text-red-400");
        }
    });
}

// Fungsi untuk memperbarui daftar pengguna online
function updateOnlineUsers(users) {
    const onlineUsersList = document.getElementById("onlineUsersList");
    if (!onlineUsersList) {
        console.error("Elemen onlineUsersList tidak ditemukan di DOM");
        return;
    }

    onlineUsersList.innerHTML = "";
    if (users.length === 0) {
        onlineUsersList.innerHTML = `<div class="text-center text-slate-400 py-2">No users online</div>`;
        return;
    }

    users.forEach(user => {
        const userEl = document.createElement("div");
        userEl.className = "flex flex-col items-center";
        const color = user.full_name.includes("Sarah") ? "purple" :
                      user.full_name.includes("Mike") ? "amber" :
                      user.full_name.includes("Lisa") ? "emerald" :
                      user.full_name.includes("Alex") ? "rose" : "blue";
        const statusColor = user.full_name === "Alex" ? "amber" : "emerald";
        let avatarContent = user.full_name ? user.full_name[0].toUpperCase() : "A";
        if (user.avatar_url) {
            try {
                const { data: avatarData } = supabase.storage
                    .from("avatars")
                    .getPublicUrl(user.avatar_url);
                if (avatarData?.publicUrl) {
                    avatarContent = `<img src="${avatarData.publicUrl}" class="h-8 w-8 rounded-full object-cover" alt="Avatar" />`;
                }
            } catch (error) {
                console.error("Gagal ambil avatar:", error);
            }
        }
        userEl.innerHTML = `
            <div class="relative">
                <div class="h-8 w-8 rounded-full bg-gradient-to-br from-${color}-500/20 to-${color}-600/20 border border-${color}-500/30 flex items-center justify-center shadow-sm">
                    ${avatarContent}
                </div>
                <div class="absolute bottom-0 right-0 h-2 w-2 bg-${statusColor}-500 rounded-full border border-slate-900"></div>
            </div>
            <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center">${sanitizeHTML(user.full_name.split(' ')[0])}</span>
        `;
        onlineUsersList.appendChild(userEl);
    });

    const onlineCount = document.querySelector("#onlineUsersList").parentElement.querySelector("span");
    if (onlineCount) {
        onlineCount.textContent = `Online (${users.length})`;
    }
    lucide.createIcons();
}

// Fungsi untuk membersihkan event listener dan subscription
function cleanupChat() {
    eventListeners.forEach(({ element, event, handler }) => {
        element.removeEventListener(event, handler);
    });
    eventListeners = [];

    supabaseChannels.forEach(channel => {
        supabase.removeChannel(channel);
    });
    supabaseChannels = [];

    if (latencyInterval) {
        clearInterval(latencyInterval);
    }

    messagesList = [];
    adminMessagesList = [];
    onlineUsers = [];
    isChatInitialized = false;
    localStorage.removeItem("chatMessages");
    lastChatTime = {};
    lastMediaTime = {};

    const chatMessages = document.getElementById("chatMessages");
    const adminMessages = document.getElementById("adminMessages");
    if (chatMessages) chatMessages.innerHTML = "";
    if (adminMessages) adminMessages.innerHTML = "";
}

// Fungsi untuk mengikat event listener
function bindEventListeners() {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    const uploadImageButton = document.getElementById("uploadImageButton");
    const imageInput = document.getElementById("imageInput");
    const recordVoiceBtn = document.getElementById("recordVoiceBtn");
    const suggestionList = document.getElementById("mentionSuggestions");
    const emojiPickerBtn = document.getElementById("emojiPickerBtn");
    const voiceCallBtn = document.getElementById("voiceCallBtn");
    const videoCallBtn = document.getElementById("videoCallBtn");
    const refreshChatBtn = document.getElementById("refreshChatBtn");
    const expandUsersBtn = document.getElementById("expandUsersBtn");

    if (!chatInput || !sendMessageBtn) {
        console.error("Elemen chatInput atau sendMessageBtn tidak ditemukan");
        return;
    }

    // Bersihkan semua listener sebelumnya
    eventListeners.forEach(({ element, event, handler }) => {
        element.removeEventListener(event, handler);
    });
    eventListeners = [];

    const sendMessageHandler = async () => {
        const content = chatInput.value.trim();
        if (content) await sendMessage(content);
        chatInput.focus();
        if (suggestionList) {
            suggestionList.classList.add("hidden");
        }
    };
    sendMessageBtn.addEventListener("click", sendMessageHandler);
    eventListeners.push({ element: sendMessageBtn, event: "click", handler: sendMessageHandler });

    const keypressHandler = async (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            const content = chatInput.value.trim();
            if (content) await sendMessage(content);
            chatInput.focus();
            if (suggestionList) {
                suggestionList.classList.add("hidden");
            }
        }
    };
    chatInput.addEventListener("keypress", keypressHandler);
    eventListeners.push({ element: chatInput, event: "keypress", handler: keypressHandler });

    let isTyping = false;
    let typingChannel = null;
    const inputHandler = async () => {
        if (!typingChannel) {
            typingChannel = supabase.channel("typing");
            typingChannel.subscribe((status) => {
                if (status === "SUBSCRIBED") {
                    if (isTyping) {
                        typingChannel.track({
                            user_id: window.currentUser.id,
                            full_name: window.currentUser.profile.full_name,
                            isTyping: true
                        }).catch(err => console.error("Gagal track typing:", err));
                    }
                }
            });
            supabaseChannels.push(typingChannel);
        }

        if (!isTyping) {
            isTyping = true;
            if (typingChannel.state === "SUBSCRIBED") {
                typingChannel.track({
                    user_id: window.currentUser.id,
                    full_name: window.currentUser.profile.full_name,
                    isTyping: true
                }).catch(err => console.error("Gagal track typing:", err));
            }
        }
        clearTimeout(window.typingTimeout);
        window.typingTimeout = setTimeout(() => {
            isTyping = false;
            if (typingChannel.state === "SUBSCRIBED") {
                typingChannel.track({
                    user_id: window.currentUser.id,
                    full_name: window.currentUser.profile.full_name,
                    isTyping: false
                }).catch(err => console.error("Gagal untrack typing:", err));
            }
        }, 2000);

        const cursorPos = chatInput.selectionStart;
        const textBeforeCursor = chatInput.value.substring(0, cursorPos);
        const mentionMatch = textBeforeCursor.match(/@([\w\s]*)$/);
        if (mentionMatch) {
            const query = mentionMatch[1];
            await showMentionSuggestions(query, chatInput, suggestionList);
        } else {
            if (suggestionList) {
                suggestionList.classList.add("hidden");
           an>
                suggestionList.classList.add("hidden");
            }
        }

        chatInput.style.height = "auto";
        chatInput.style.height = `${chatInput.scrollHeight}px`;
    };
    chatInput.addEventListener("input", inputHandler);
    eventListeners.push({ element: chatInput, event: "input", handler: inputHandler });

    if (uploadImageButton && imageInput) {
        const triggerImageInput = () => {
            imageInput.click();
        };
        uploadImageButton.addEventListener("click", triggerImageInput);
        eventListeners.push({ element: uploadImageButton, event: "click", handler: triggerImageInput });

        const handleImageUpload = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const userId = window.currentUser?.id;
            if (!userId) {
                showToast("Error", "You are not logged in yet.", "destructive");
                return;
            }

            const now = Date.now();
            if (lastMediaTime[userId] && (now - lastMediaTime[userId] < MEDIA_COOLDOWN)) {
                const remaining = Math.ceil((MEDIA_COOLDOWN - (now - lastMediaTime[userId])) / 1000 / 60);
                showToast("Warning", `wait ${remaining} another minute to send a picture!`, "destructive");
                return;
            }

            // Validasi ukuran file (maks 5MB)
            const maxSizeMB = 5;
            if (file.size > maxSizeMB * 1024 * 1024) {
                showToast("Error", `Maximum image size ${maxSizeMB}MB`, "destructive");
                return;
            }

            if (window.isSendingMedia) {
                showToast("Peringatan", "Currently uploading media, please wait.", "destructive");
                return;
            }
            window.isSendingMedia = true;

            showToast("Info", "Uploading images...", "default");

            try {
                const filePath = `chat_images/${Date.now()}_${file.name}`;
                const { error } = await supabase.storage.from("chat-media").upload(filePath, file);
                if (error) throw error;

                const { data } = supabase.storage.from("chat-media").getPublicUrl(filePath);

                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = data.publicUrl;
                await new Promise(resolve => img.onload = resolve);

                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");
                const maxWidth = 200;
                let width = img.width;
                let height = img.height;

                if (width > maxWidth) {
                    height *= maxWidth / width;
                    width = maxWidth;
                }

                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);
                const resizedUrl = canvas.toDataURL("image/jpeg");

                const tempId = `temp-${Date.now()}`;
                await sendMessage("🖼️", resizedUrl, null, tempId);

            } catch (error) {
                console.error("Failed to upload image:", error);
                showToast("Error", "Failed to upload image: " + error.message, "destructive");
            } finally {
                event.target.value = "";
                window.isSendingMedia = false;
            }
        };
        imageInput.addEventListener("change", handleImageUpload);
        eventListeners.push({ element: imageInput, event: "change", handler: handleImageUpload });
    }

    if (recordVoiceBtn) {
    const createVoiceRecorderUI = () => {
        const modal = document.createElement("div");
        modal.id = "voiceRecorderModal";
        modal.className = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden";
        modal.innerHTML = `
            <div class="bg-slate-800 p-6 rounded-lg shadow-lg w-80 transform transition-all duration-300">
                <h3 class="text-lg font-semibold text-white mb-4">Rekam Suara</h3>
                <div class="flex items-center justify-center mb-4">
                    <span id="voiceTimer" class="text-xl text-cyan-400 font-mono">00:00</span>
                </div>
                <div id="waveformAnimation" class="h-8 flex items-center justify-center gap-1">
                    <div class="bar bg-cyan-500 w-1 rounded" style="animation: wave 0.5s infinite"></div>
                    <div class="bar bg-cyan-500 w-1 rounded" style="animation: wave 0.5s infinite 0.1s"></div>
                    <div class="bar bg-cyan-500 w-1 rounded" style="animation: wave 0.5s infinite 0.2s"></div>
                    <div class="bar bg-cyan-500 w-1 rounded" style="animation: wave 0.5s infinite 0.3s"></div>
                    <div class="bar bg-cyan-500 w-1 rounded" style="animation: wave 0.5s infinite 0.4s"></div>
                </div>
                <div class="flex justify-center space-x-4 mt-4">
                    <button id="startRecordBtn" class="px-4 py-2 bg-cyan-600 text-white rounded-full hover:bg-cyan-500 flex items-center">
                        <i data-lucide="mic" class="h-4 w-4 mr-2"></i>Rekam
                    </button>
                    <button id="stopRecordBtn" class="px-4 py-2 bg-red-600 text-white rounded-full hover:bg-red-500 flex items-center hidden">
                        <i data-lucide="square" class="h-4 w-4 mr-2"></i>Stop
                    </button>
                </div>
                <div id="previewControls" class="hidden mt-4">
                    <div class="flex items-center justify-center mb-2">
                        <button id="playPreviewBtn" class="p-2 bg-cyan-500/20 rounded-full">
                            <svg class="play-icon" width="16" height="16" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M8 5v14l11-7z"/>
                            </svg>
                            <svg class="pause-icon" width="16" height="16" viewBox="0 0 24 24" style="display:none">
                                <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                            </svg>
                        </button>
                        <span id="previewDuration" class="ml-2 text-xs text-slate-400">00:00</span>
                    </div>
                    <div class="flex justify-center space-x-2">
                        <button id="cancelVoiceBtn" class="px-4 py-2 bg-slate-600 text-white rounded hover:bg-slate-500">cancel</button>
                        <button id="sendVoiceBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500">Send</button>
                    </div>
                </div>
            </div>
            <style>
                @keyframes wave {
                    0%, 100% { height: 8px; }
                    50% { height: 24px; }
                }
                .bar { height: 8px; }
            </style>
        `;
        document.body.appendChild(modal);
        lucide.createIcons();
        return modal;
    };

    const handleVoiceRecord = async () => {
        const userId = window.currentUser?.id;
        if (!userId) {
            showToast("Error", "You are not logged in yet.", "destructive");
            return;
        }

        const now = Date.now();
        if (lastMediaTime[userId] && (now - lastMediaTime[userId] < MEDIA_COOLDOWN)) {
            const remaining = Math.ceil((MEDIA_COOLDOWN - (now - lastMediaTime[userId])) / 1000 / 60);
            showToast("Warning", `Wait ${remaining} another minute to send the voice!`, "destructive");
            return;
        }

        if (window.isSendingMedia) {
            showToast("Warning", "Currently uploading media, please wait.", "destructive");
            return;
        }

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const mediaRecorder = new MediaRecorder(stream);
            let audioChunks = [];
            let startTime;
            let timerInterval;
            const maxDuration = 120; // 2 menit

            const modal = document.getElementById("voiceRecorderModal") || createVoiceRecorderUI();
            const startBtn = modal.querySelector("#startRecordBtn");
            const stopBtn = modal.querySelector("#stopRecordBtn");
            const playBtn = modal.querySelector("#playPreviewBtn");
            const cancelBtn = modal.querySelector("#cancelVoiceBtn");
            const sendBtn = modal.querySelector("#sendVoiceBtn");
            const timerDisplay = modal.querySelector("#voiceTimer");
            const previewDuration = modal.querySelector("#previewDuration");
            const waveform = modal.querySelector("#waveformAnimation");
            const previewControls = modal.querySelector("#previewControls");
            const playIcon = playBtn.querySelector(".play-icon");
            const pauseIcon = playBtn.querySelector(".pause-icon");

            modal.classList.remove("hidden");

            const updateTimer = () => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (elapsed >= maxDuration) {
                    mediaRecorder.stop();
                }
            };

            mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
            mediaRecorder.onstop = async () => {
                clearInterval(timerInterval);
                waveform.classList.add("hidden");
                previewControls.classList.remove("hidden");
                startBtn.classList.add("hidden");
                stopBtn.classList.add("hidden");

                const blob = new Blob(audioChunks, { type: "audio/webm" });
                const audioUrl = URL.createObjectURL(blob);
                const audio = new Audio(audioUrl);
                const duration = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                previewDuration.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                const playHandler = () => {
                    if (audio.paused) {
                        audio.play();
                        playIcon.style.display = "none";
                        pauseIcon.style.display = "block";
                    } else {
                        audio.pause();
                        playIcon.style.display = "block";
                        pauseIcon.style.display = "none";
                    }
                };
                playBtn.addEventListener("click", playHandler);
                eventListeners.push({ element: playBtn, event: "click", handler: playHandler });

                audio.addEventListener("ended", () => {
                    playIcon.style.display = "block";
                    pauseIcon.style.display = "none";
                });

                const sendHandler = async () => {
                    if (window.isSendingMedia) return;
                    window.isSendingMedia = true;
                    sendBtn.disabled = true;
                    sendBtn.innerHTML = `<i data-lucide="loader" class="h-4 w-4 animate-spin"></i>`;

                    try {
                        const fileName = `voice_notes/${Date.now()}.webm`;
                        const { error } = await supabase.storage
                            .from("chat-media")
                            .upload(fileName, blob, { contentType: "audio/webm" });
                        if (error) throw error;

                        const { data } = supabase.storage.from("chat-media").getPublicUrl(fileName);
                        const tempId = `temp-${Date.now()}`;
                        await sendMessage("🔊", null, data.publicUrl, tempId, duration);

                        modal.classList.add("hidden");
                        showToast("Success", "Voice note sent", "default");

                    } catch (error) {
                        console.error("Failed to upload voice note:", error);
                        showToast("Error", "Failed to upload voice note: " + error.message, "destructive");
                    } finally {
                        window.isSendingMedia = false;
                        sendBtn.disabled = false;
                        sendBtn.innerHTML = `<i data-lucide="send" class="h-4 w-4"></i>`;
                        lucide.createIcons();
                        stream.getTracks().forEach(track => track.stop());
                        URL.revokeObjectURL(audioUrl);
                        audioChunks = [];
                        audio.remove();
                        modal.remove();
                    }
                };
                sendBtn.addEventListener("click", sendHandler);
                eventListeners.push({ element: sendBtn, event: "click", handler: sendHandler });

                const cancelHandler = () => {
                    mediaRecorder.stop();
                    modal.classList.add("hidden");
                    stream.getTracks().forEach(track => track.stop());
                    clearInterval(timerInterval);
                    audioChunks = [];
                    URL.revokeObjectURL(audioUrl);
                    if (audio) audio.remove();
                    modal.remove();
                };
                cancelBtn.addEventListener("click", cancelHandler);
                eventListeners.push({ element: cancelBtn, event: "click", handler: cancelHandler });
            };

            const startHandler = () => {
                mediaRecorder.start();
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
                waveform.classList.remove("hidden");
                startBtn.classList.add("hidden");
                stopBtn.classList.remove("hidden");
            };
            startBtn.addEventListener("click", startHandler);
            eventListeners.push({ element: startBtn, event: "click", handler: startHandler });

            const stopHandler = () => {
                mediaRecorder.stop();
            };
            stopBtn.addEventListener("click", stopHandler);
            eventListeners.push({ element: stopBtn, event: "click", handler: stopHandler });
        } catch (err) {
            console.error("Failed to record sound:", err);
            showToast("Error", "Failed to record sound: " + err.message, "destructive");
            window.isSendingMedia = false;
        }
    };
    recordVoiceBtn.addEventListener("click", handleVoiceRecord);
    eventListeners.push({ element: recordVoiceBtn, event: "click", handler: handleVoiceRecord });
}

    if (emojiPickerBtn) {
        const emojis = ["😊", "😂", "👍", "❤️", "🔥", "👀", "🙌", "💡"];
        const picker = document.createElement("div");
        picker.className = "absolute bottom-12 left-0 bg-slate-800/90 border border-slate-700/30 rounded-lg p-2 shadow-lg z-10 hidden flex-wrap gap-2";
        emojis.forEach(emoji => {
            const btn = document.createElement("button");
            btn.className = "text-lg hover:bg-slate-700/50 rounded p-1";
            btn.textContent = emoji;
            const emojiHandler = () => {
                chatInput.value += emoji;
                picker.classList.add("hidden");
                chatInput.focus();
            };
            btn.addEventListener("click", emojiHandler);
            eventListeners.push({ element: btn, event: "click", handler: emojiHandler });
            picker.appendChild(btn);
        });

        emojiPickerBtn.parentElement.appendChild(picker);

        const togglePicker = () => picker.classList.toggle("hidden");
        emojiPickerBtn.addEventListener("click", togglePicker);
        eventListeners.push({ element: emojiPickerBtn, event: "click", handler: togglePicker });
    }

    if (voiceCallBtn) {
        const voiceCallHandler = () => showToast("Info", "Voice call feature not yet available", "default");
        voiceCallBtn.addEventListener("click", voiceCallHandler);
        eventListeners.push({ element: voiceCallBtn, event: "click", handler: voiceCallHandler });
    }

    if (videoCallBtn) {
        const videoCallHandler = () => showToast("Info", "Video calling feature not yet available", "default");
        videoCallBtn.addEventListener("click", videoCallHandler);
        eventListeners.push({ element: videoCallBtn, event: "click", handler: videoCallHandler });
    }

    if (refreshChatBtn) {
        const refreshChatHandler = async () => {
            refreshChatBtn.disabled = true;
            refreshChatBtn.querySelector("i").classList.add("animate-spin");
            await initializeChat();
            refreshChatBtn.disabled = false;
            refreshChatBtn.querySelector("i").classList.remove("animate-spin");
        };
        refreshChatBtn.addEventListener("click", refreshChatHandler);
        eventListeners.push({ element: refreshChatBtn, event: "click", handler: refreshChatHandler });
    }

    if (expandUsersBtn) {
        const toggleUsersList = () => {
            const onlineUsersList = document.getElementById("onlineUsersList");
            onlineUsersList.classList.toggle("hidden");
            const icon = expandUsersBtn.querySelector("i");
            icon.classList.toggle("rotate-180");
        };
        expandUsersBtn.addEventListener("click", toggleUsersList);
        eventListeners.push({ element: expandUsersBtn, event: "click", handler: toggleUsersList });
    }
}

// Inisialisasi chat
async function initializeChat() {
    if (isChatInitialized) {
        console.log("Chat sudah diinisialisasi, melewati...");
        return;
    }

    if (!window.currentUser) {
        console.log("Tidak ada pengguna, menonaktifkan chat...");
        disableChat();
        return;
    }

    if (!isValidUuid(window.currentUser.id)) {
        console.error(`Invalid user ID: ${window.currentUser.id}`);
        showToast("Error", "Invalid user ID", "destructive");
        disableChat();
        return;
    }

    console.log("Menginisialisasi chat...");
    isChatInitialized = true;

    try {
        const chatInput = document.getElementById("chatInput");
        const sendMessageBtn = document.getElementById("sendMessageBtn");
        const chatMessages = document.getElementById("chatMessages");
        const adminMessages = document.getElementById("adminMessages");

        if (!chatInput || !sendMessageBtn || !chatMessages || !adminMessages) {
            console.error("Elemen DOM tidak ditemukan");
            showToast("Error", "DOM element not found", "destructive");
            return;
        }

        const profile = await fetchUserProfile(window.currentUser.id);
        window.currentUser.profile = profile;

        chatInput.disabled = false;
        sendMessageBtn.disabled = false;
        chatInput.placeholder = "Type your message....";

        const { data: adminData, error: adminError } = await supabase
            .from("admin_messages")
            .select("*")
            .order("created_at", { ascending: true })
            .limit(10);
        if (adminError) throw adminError;

        adminMessagesList = adminData || [];
        adminMessages.innerHTML = "";
        for (const msg of adminMessagesList) {
            await appendAdminMessage(msg);
        }

        const cached = JSON.parse(localStorage.getItem("chatMessages") || "[]");
        messagesList = cached;

        for (const msg of messagesList) {
            await appendMessage(msg);
        }

        const { data, error } = await supabase
            .from("messages")
            .select("*, profiles(full_name, avatar_url)")
            .order("created_at", { ascending: true })
            .limit(50);
        if (error) throw error;

        messagesList = data || [];
        localStorage.setItem("chatMessages", JSON.stringify(messagesList));
        chatMessages.innerHTML = "";
        for (const msg of messagesList) {
            await appendMessage(msg);
        }

        const adminChannel = supabase
            .channel("realtime-admin-messages")
            .on(
                "postgres_changes",
                {
                    event: "INSERT",
                    schema: "public",
                    table: "admin_messages",
                },
                async (payload) => {
                    const msg = payload.new;
                    if (adminMessagesList.some(existingMsg => existingMsg.id === msg.id)) return;

                    adminMessagesList.push(msg);
                    await appendAdminMessage(msg);
                    showToast("Info”, ”New admin message", "default");
                }
            )
            .subscribe();
        supabaseChannels.push(adminChannel);

        const messagesChannel = supabase
            .channel("realtime-messages")
            .on(
                "postgres_changes",
                {
                    event: "INSERT",
                    schema: "public",
                    table: "messages",
                },
                async (payload) => {
                    const msg = payload.new;

                    const existingMsgIndex = messagesList.findIndex(m => m.id === msg.id);

                    if (existingMsgIndex !== -1) {
                        const profile = await fetchUserProfile(msg.user_id);
                        msg.full_name = profile.full_name;
                        msg.avatar_url = profile.avatar_url;
                        messagesList[existingMsgIndex] = { ...msg, full_name: profile.full_name, avatar_url: profile.avatar_url };
                        localStorage.setItem("chatMessages", JSON.stringify(messagesList.slice(-100)));
                        await appendMessage(messagesList[existingMsgIndex], true);
                        return;
                    }

                    const profile = await fetchUserProfile(msg.user_id);
                    msg.full_name = profile.full_name;
                    msg.avatar_url = profile.avatar_url;

                    messagesList.push(msg);
                    localStorage.setItem("chatMessages", JSON.stringify(messagesList.slice(-100)));
                    await appendMessage(msg);

                    if (Array.isArray(msg.mentions) && msg.mentions.includes(window.currentUser?.id)) {
                        showToast("Info", `${msg.full_name} call you!`, "default");
                    }
                }
            )
            .on(
                "postgres_changes",
                {
                    event: "UPDATE",
                    schema: "public",
                    table: "messages",
                },
                async (payload) => {
                    const updatedMsg = payload.new;
                    const index = messagesList.findIndex(msg => msg.id === updatedMsg.id);
                    if (index !== -1) {
                        const profile = await fetchUserProfile(updatedMsg.user_id);
                        updatedMsg.full_name = profile.full_name;
                        updatedMsg.avatar_url = profile.avatar_url;
                        messagesList[index] = { ...messagesList[index], ...updatedMsg };
                        localStorage.setItem("chatMessages", JSON.stringify(messagesList.slice(-100)));
                        await appendMessage(messagesList[index], true);
                    }
                }
            )
            .subscribe();
        supabaseChannels.push(messagesChannel);

        const presenceChannel = supabase
            .channel("presence")
            .on("presence", { event: "sync" }, async () => {
                const state = presenceChannel.presenceState();

                const users = Object.values(state).flat();

                const filteredUsers = users.filter(p => {
                    if (!window.currentUser || !window.currentUser.id) {
                        console.warn("window.currentUser atau window.currentUser.id tidak tersedia");
                        return true;
                    }
                    return p.user_id !== window.currentUser.id;
                });

                const typingUsers = filteredUsers.filter(user => user.isTyping);
                const typingIndicator = document.getElementById("typingIndicator");
                if (typingIndicator) {
                    if (typingUsers.length > 0) {
                        typingIndicator.classList.remove("hidden");
                        typingIndicator.querySelector("span").textContent = `${typingUsers[0].full_name} sedang mengetik...`;
                    } else {
                        typingIndicator.classList.add("hidden");
                    }
                }

                onlineUsers = filteredUsers.map(user => ({
                    user_id: user.user_id,
                    full_name: user.full_name,
                    avatar_url: user.avatar_url,
                    isTyping: user.isTyping,
                }));
                updateOnlineUsers(onlineUsers);

                const participantCount = document.querySelector("#pageCommunications .text-xs.text-slate-400 span");
                if (participantCount) {
                    const totalUsers = users.length;
                    participantCount.textContent = `${totalUsers} active participants`;
                }
            })
            .subscribe((status) => {
                if (status === "SUBSCRIBED") {
                    if (!window.currentUser || !window.currentUser.id || !window.currentUser.profile) {
                        console.warn("window.currentUser tidak lengkap:", window.currentUser);
                        return;
                    }
                    presenceChannel.track({
                        user_id: window.currentUser.id,
                        full_name: window.currentUser.profile.full_name,
                        avatar_url: window.currentUser.profile.avatar_url,
                        isTyping: false,
                    }).catch(err => {
                        console.error("Gagal track pengguna:", err);
                    });
                } else if (status === "CLOSED" || status === "TIMED_OUT") {
                    console.warn("Subscription presence gagal, mencoba ulang...");
                    setTimeout(() => presenceChannel.subscribe(), 2000);
                }
            });
        supabaseChannels.push(presenceChannel);

        updateConnectionLatency();
        latencyInterval = setInterval(updateConnectionLatency, 10000);

        bindEventListeners();

    } catch (err) {
        console.error("Inisialisasi chat gagal:", err);
        showToast("Error", "Failed chat initialization: " + err.message, "destructive");
        disableChat();
        isChatInitialized = false;
    }
}

// Fungsi nonaktifkan chat
function disableChat() {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    const chatMessages = document.getElementById("chatMessages");

    if (chatInput) {
        chatInput.disabled = true;
        chatInput.placeholder = "Login to chat...";
    }

    if (sendMessageBtn) {
        sendMessageBtn.disabled = true;
        sendMessageBtn.classList.add("opacity-50", "cursor-not-allowed");
    }

    if (chatMessages) {
        chatMessages.innerHTML = `
            <div class="text-center text-slate-400 py-4">Silakan login untuk mengakses chat</div>
        `;
    }
}



// Event listener untuk navigasi halaman
function handlePageNavigation() {
    const navCommunications = document.getElementById("navCommunications");
    if (navCommunications) {
        const navigateHandler = () => {
            console.log("Navigasi ke halaman Communications, menginisialisasi chat...");
            cleanupChat();
            setTimeout(initializeChat, 100);
        };
        navCommunications.addEventListener("click", navigateHandler, { once: true });
        eventListeners.push({ element: navCommunications, event: "click", handler: navigateHandler });
    }
}

// Event listener DOM loaded
document.addEventListener("DOMContentLoaded", () => {
    console.log("DOM loaded, memulai inisialisasi...");
    lucide.createIcons();
    handlePageNavigation();
    // Tambahkan penundaan kecil untuk memastikan DOM benar-benar siap
    setTimeout(() => {
        initializeChat().catch(err => {
            console.error("Gagal inisialisasi chat di DOMContentLoaded:", err);
            showToast("Error", "Failed to load chat, please try again", "destructive");
        });
    }, 100);
});






















































// Pastikan DOM dimuat sebelum eksekusi
document.addEventListener("DOMContentLoaded", () => {
  initSettings();
});

// Inisialisasi halaman settings
async function initSettings() {
  try {
    await checkUser(); // Pastikan user login
    setupEventListeners(); // Setup semua event listener
    await loadSettings(); // Muat data profil pengguna
  } catch (err) {
    console.error("Error inisialisasi settings:", err);
    
  }
}

// Fungsi cek apakah user login
async function checkUser() {
  const { data: { session }, error } = await supabase.auth.getSession();
  if (error || !session?.user) {
    
    throw new Error("User not authenticated");
  }
  window.currentUser = session.user;
}

// Setup event listeners
function setupEventListeners() {
  const changeProfilePictureBtn = document.getElementById("changeProfilePictureBtn");
  const profilePictureInput = document.getElementById("profilePictureInput");
  const removeProfilePictureBtn = document.getElementById("removeProfilePictureBtn");
  const saveProfileBtn = document.getElementById("saveProfileBtn");
  const changePasswordBtn = document.getElementById("changePasswordBtn");
  const deleteAccountBtn = document.getElementById("deleteAccountBtn");
  const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
  const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
  const copyReferralBtn = document.getElementById("copyReferralBtn");
  const connectWalletBtn = document.getElementById("connectWalletBtn");

  // Validasi semua elemen ada
  if (!changeProfilePictureBtn || !profilePictureInput || !removeProfilePictureBtn ||
      !saveProfileBtn || !changePasswordBtn || !deleteAccountBtn || !cancelDeleteBtn ||
      !confirmDeleteBtn || !copyReferralBtn || !connectWalletBtn) {
    console.error("Salah satu elemen halaman settings tidak ditemukan");
    showToast("Error", "Some elements not found", "destructive");
    return;
  }

  // Profile Picture Events
  changeProfilePictureBtn.addEventListener("click", () => profilePictureInput.click());
  profilePictureInput.addEventListener("change", handleProfilePictureUpload);
  removeProfilePictureBtn.addEventListener("click", removeProfilePicture);

  // Save Profile
  saveProfileBtn.addEventListener("click", saveProfile);

  // Password Toggle Visibility
  document.querySelectorAll(".password-toggle").forEach((icon) => {
    icon.addEventListener("click", () => {
      const input = icon.closest(".relative")?.querySelector("input");
      if (input) {
        input.type = input.type === "password" ? "text" : "password";
        icon.classList.toggle("fa-eye-slash");
        icon.classList.toggle("fa-eye");
      }
    });
  });

  // Change Password Button
  changePasswordBtn.addEventListener("click", changePassword);

  // Delete Account Modal
  deleteAccountBtn.addEventListener("click", () => {
    const modal = document.getElementById("deleteAccountModal");
    if (modal) modal.style.display = "flex";
  });

  cancelDeleteBtn.addEventListener("click", () => {
    const modal = document.getElementById("deleteAccountModal");
    if (modal) modal.style.display = "none";
  });

  confirmDeleteBtn.addEventListener("click", deleteAccount);

  // Copy Referral Code
  copyReferralBtn.addEventListener("click", () => {
    const referralCodeInput = document.getElementById("referralCodeInput");
    if (!referralCodeInput) {
      showToast("Error", "Kode referral tidak tersedia", "destructive");
      return;
    }
    navigator.clipboard.writeText(referralCodeInput.value)
      .then(() => showToast("Success", "Referral code copied!"))
      .catch(err => {
        console.error("Failed to copy referral code:", err);
        showToast("Error", "Failed to copy referral code", "destructive");
      });
  });

  // Connect Wallet Button
  connectWalletBtn.addEventListener("click", connectWallet);
}

// Fungsi untuk menghapus akun pengguna
async function deleteAccount() {
  try {
    showLoading();
    const user = window.currentUser;
    if (!user) {
      throw new Error("User not authenticated");
    }

    // Hapus data profil dari tabel profiles
    const { error: profileError } = await supabase
      .from("profiles")
      .delete()
      .eq("id", user.id);
    if (profileError) throw profileError;

    // Hapus akun pengguna dari Supabase Auth
    // Catatan: Ini memerlukan hak admin atau kebijakan khusus di Supabase
    const { error: authError } = await supabase.auth.signOut();
    if (authError) throw authError;

    // Tutup modal hapus akun
    const modal = document.getElementById("deleteAccountModal");
    if (modal) modal.style.display = "none";

    showToast("Success", "Account successfully deleted. You will be logged out.");

    // Tunda logout untuk memastikan notifikasi terlihat
    setTimeout(() => {
      window.location.href = "/login"; // Arahkan ke halaman login
    }, 2000);
  } catch (err) {
    console.error("Error deleting an account:", err);
    showToast("Error", "Failed to delete account: " + err.message, "destructive");
  } finally {
    hideLoading();
  }
}

// Handle Upload Gambar Profil
async function handleProfilePictureUpload(e) {
  const file = e.target.files[0];
  if (!file) return;

  const allowedTypes = ["image/png", "image/jpeg"];
  if (file.size > 15 * 1024 * 1024) {
    showToast("Error", "Maximum file size 15MB", "destructive");
    return;
  }
  if (!allowedTypes.includes(file.type)) {
    showToast("Error", "File format must be PNG or JPEG", "destructive");
    return;
  }

  try {
    showLoading();
    const user = window.currentUser;
    const fileName = `${user.email.replace(/[@.]/g, "_")}/avatar_${Date.now()}.${file.name.split(".").pop()}`;
    const { error: uploadError } = await supabase.storage.from("avatars").upload(fileName, file, { upsert: true });
    if (uploadError) throw uploadError;

    const { error: updateError } = await supabase.from("profiles")
      .update({ avatar_url: fileName })
      .eq("id", user.id);
    if (updateError) throw updateError;

    await loadSettings(); // Refresh UI
    showToast("Success”, ”Profile photo successfully changed");
  } catch (err) {
    console.error("Error upload foto profil:", err);
    showToast("Error", "Failed to upload profile picture", "destructive");
  } finally {
    hideLoading();
  }
}

// Hapus Foto Profil
async function removeProfilePicture() {
  try {
    showLoading();
    const user = window.currentUser;
    const { error } = await supabase.from("profiles")
      .update({ avatar_url: null })
      .eq("id", user.id);
    if (error) throw error;

    await loadSettings(); // Refresh UI
    showToast("Success", "Profile photo successfully deleted");
  } catch (err) {
    console.error("Error delete profile picture:", err);
    showToast("Error", "Failed to delete profile picture", "destructive");
  } finally {
    hideLoading();
  }
}

// Simpan Perubahan Profil
async function saveProfile() {
  try {
    showLoading();
    const fullNameInput = document.getElementById("settingsFullNameInput");
    const walletAddressInput = document.getElementById("walletAddressInput");

    if (!fullNameInput || !walletAddressInput) {
      throw new Error("Input not found");
    }

    const fullName = fullNameInput.value.trim();
    const walletAddress = walletAddressInput.value.trim();

    if (!fullName) {
      toggleError(fullNameInput, true, "Full name required.");
      return;
    }

    const user = window.currentUser;
    const { error } = await supabase.from("profiles")
      .update({ full_name: fullName, wallet_address: walletAddress })
      .eq("id", user.id);
    if (error) throw error;

    showToast("Success", "Profile saved successfully");
    await loadSettings(); // Refresh UI
  } catch (err) {
    console.error("Save profile error:", err);
    showToast("Error", "Failed to save profile", "destructive");
  } finally {
    hideLoading();
  }
}

// Ubah Kata Sandi
async function changePassword() {
  try {
    showLoading();
    const currentInput = document.getElementById("currentPasswordInput");
    const newInput = document.getElementById("newPasswordInput");
    const confirmInput = document.getElementById("confirmNewPasswordInput");

    if (!currentInput || !newInput || !confirmInput) {
      throw new Error("Password input not found");
    }

    const currentPass = currentInput.value;
    const newPass = newInput.value;
    const confirmPass = confirmInput.value;

    if (!currentPass || !newPass || !confirmPass) {
      showToast("Error", "All fields must be filled in", "destructive");
      return;
    }

    if (newPass !== confirmPass) {
      showToast("Error", "Confirmation password does not match", "destructive");
      return;
    }

    if (newPass.length < 6) {
      showToast("Error", "Password at least 6 characters", "destructive");
      return;
    }

    const { error } = await supabase.auth.updateUser({
      password: newPass
    });

    if (error) throw error;

    currentInput.value = "";
    newInput.value = "";
    confirmInput.value = "";
    showToast("Success”, ”Password changed successfully");
  } catch (err) {
    console.error("Error ubah kata sandi:", err);
    showToast("Error", err.message || "Failed to change password", "destructive");
  } finally {
    hideLoading();
  }
}

// Hubungkan Dompet (MetaMask)
async function connectWallet() {
  if (!window.ethereum) {
    console.log("MetaMask not detected");
    showToast("Error", "MetaMask is not detected. Please install it from <a href='https://metamask.io/download/' target='_blank'>sini</a>.", "destructive");
    return;
  }
  if (!window.ethereum.isMetaMask) {
    console.log("Extensions instead of MetaMask");
    showToast("Error", "The detected extension is not MetaMask. Make sure you are using MetaMask.", "destructive");
    return;
  }
  try {
    showLoading();
    console.log("Request MetaMask account access...");
    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
    const walletAddress = accounts[0];
    console.log("Wallet Address:", walletAddress);

    const walletInput = document.getElementById("walletAddressInput");
    if (walletInput) {
      walletInput.value = walletAddress;
    } else {
      console.error("Elemen walletAddressInput not found");
    }

    const { data: { session } } = await supabase.auth.getSession();
    if (session?.user) {
      console.log("Save wallet address...");
      const { error } = await supabase.from("profiles")
        .update({ wallet_address: walletAddress || null }) // Pastikan null jika kosong
        .eq("id", session.user.id);
      if (error) throw error;

      const userWallet = document.getElementById("userWallet");
      if (userWallet) {
        userWallet.textContent = walletAddress;
      }
      showToast("Success", "Wallet successfully connected");
    } else {
      showToast("Info", "You are not logged in yet. Login to save wallet address.");
    }
  } catch (err) {
    console.error("Failed to connect wallet:", err);
    if (err.code === 4001) {
      showToast("Info", "User rejects wallet connection");
    } else {
      showToast("Error", "Failed to connect wallet: " + err.message, "destructive");
    }
  } finally {
    hideLoading();
  }
}

async function loadSettings() {
    try {
        showLoading();
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();
        if (sessionError || !session?.user) {
            throw new Error("User is not authenticated");
        }

        const user = session.user;

        // Cek apakah profil sudah ada
        const { data, error } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", user.id)
            .single();

        if (error) {
            if (error.code === "PGRST116") {
                // Profil belum ada, buat otomatis
                const generatedReferralCode = await generateReferralCode();
                const fullName = user.user_metadata.full_name || user.email.split("@")[0];

                const { error: insertError } = await supabase.from("profiles").insert({
                    id: user.id,
                    email: user.email,
                    points: 0,
                    wallet_address: null,
                    booster: null,
                    avatar_url: null,
                    full_name: fullName,
                    referral_code: generatedReferralCode,
                    mining_speed: 0,
                    invited_users: 0
                });

                if (insertError) throw insertError;

                // Ambil lagi profil setelah dibuat
                const { data: newData } = await supabase
                    .from("profiles")
                    .select("*")
                    .eq("id", user.id)
                    .single();

                // Update UI
                populateSettingsForm(newData, user);
                updateProfilePicture(newData.avatar_url, newData.full_name || user.email);
            } else {
                throw error;
            }
        } else {
            // Profil ditemukan, lanjutkan dengan data yang ada
            populateSettingsForm(data, user);
            updateProfilePicture(data.avatar_url, data.full_name || user.email);
        }
    } catch (err) {
        console.error("Error loading settings:", err);
        showToast("Error", "Failed to load profile", "destructive");
    } finally {
        hideLoading();
    }
}

// Fungsi bantu untuk isi form settings
function populateSettingsForm(data, user) {
    const fullNameInput = document.getElementById("settingsFullNameInput");
    const walletAddressInput = document.getElementById("walletAddressInput");
    const emailDisplay = document.getElementById("emailDisplay");
    const referralCodeInput = document.getElementById("referralCodeInput");
    const invitedUsersCount = document.getElementById("invitedUsersCount");

    if (fullNameInput) fullNameInput.value = data.full_name || "";
    if (walletAddressInput) walletAddressInput.value = data.wallet_address || "";
    if (emailDisplay) emailDisplay.textContent = user.email;
    if (referralCodeInput) referralCodeInput.value = data.referral_code || "";
    if (invitedUsersCount) invitedUsersCount.textContent = data.invited_users || "0";
}

// Update Preview Foto Profil
function updateProfilePicture(avatarUrl, nameOrEmail) {
  const preview = document.getElementById("profilePicturePreview");
  const sidebar = document.getElementById("sidebarProfilePicture");

  if (!preview || !sidebar) return;

  const initial = (nameOrEmail || "U")[0].toUpperCase();

  if (avatarUrl) {
    const { publicUrl } = supabase.storage.from("avatars").getPublicUrl(avatarUrl).data;
    preview.innerHTML = `<img src="${publicUrl}" class="h-28 w-28 rounded-full object-cover" alt="Profile" />`;
    sidebar.innerHTML = `<img src="${publicUrl}" class="h-12 w-12 rounded-full object-cover" alt="Profile" />`;
  } else {
    preview.innerHTML = `
      <div class="h-28 w-28 rounded-full bg-gradient-to-br from-cyan-600 to-slate-800 text-white flex items-center justify-center text-3xl font-bold shadow-lg">
        ${initial}
      </div>`;
    sidebar.innerHTML = `
      <div class="h-12 w-12 rounded-full bg-gradient-to-br from-cyan-600 to-slate-800 text-white flex items-center justify-center text-xl font-bold">
        ${initial}
      </div>`;
  }
}

// Fungsi Toggle Error
function toggleError(inputElement, hasError, message = "") {
  if (!inputElement) return;

  const parent = inputElement.closest(".relative") || inputElement.parentElement;
  const errorDiv = parent?.querySelector(".error-message");

  if (hasError) {
    inputElement.classList.add("input-error", "shake");
    setTimeout(() => inputElement.classList.remove("shake"), 500);
    if (errorDiv) {
      errorDiv.textContent = message;
      errorDiv.classList.remove("hidden");
    }
  } else {
    inputElement.classList.remove("input-error", "shake");
    if (errorDiv) {
      errorDiv.textContent = "";
      errorDiv.classList.add("hidden");
    }
  }
}



// Loading Overlay
function showLoading() {
  let overlay = document.getElementById("loadingOverlay");
  if (!overlay) {
    overlay = document.createElement("div");
    overlay.id = "loadingOverlay";
    overlay.className = "fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden";
    overlay.innerHTML = `<div class="loader border-t-4 border-cyan-500 rounded-full w-12 h-12 animate-spin"></div>`;
    document.body.appendChild(overlay);
  }
  overlay.classList.remove("hidden");
}

function hideLoading() {
  const overlay = document.getElementById("loadingOverlay");
  if (overlay) overlay.classList.add("hidden");
}




document.addEventListener('DOMContentLoaded', () => {
  // Inisialisasi container dan ukuran
  const container = document.getElementById('particleContainer');
  const width = container.clientWidth;
  const height = container.clientHeight;

  // Membuat scene tanpa background
  const scene = new THREE.Scene();
  

  // Kamera
  const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
  camera.position.set(0, 0, 50);

  // Renderer dengan transparansi aktif
  const renderer = new THREE.WebGLRenderer({
    antialias: true,
    alpha: true, // ← Penting untuk transparansi
    powerPreference: "high-performance"
  });
  renderer.setSize(width, height);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  container.appendChild(renderer.domElement);

  // Pencahayaan minimal (opsional)
  const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0x7dd3fc, 0.8);
  directionalLight.position.set(1, 1, 1);
  scene.add(directionalLight);

  // Konfigurasi jumlah partikel
  const particleCount = 2500;
  const geometry = new THREE.BufferGeometry();
  const positions = new Float32Array(particleCount * 3);
  const colors = new Float32Array(particleCount * 3);
  const sizes = new Float32Array(particleCount);

  // Palet warna biru
  const colorPalette = [
    new THREE.Color(0x7dd3fc),
    new THREE.Color(0x38bdf8), 
    new THREE.Color(0x0ea5e9),
    new THREE.Color(0x0284c7)
  ];

  // Path huruf A-Q-U-L-A
  const letterPaths = {
    'A': [ [-8,-10,0], [-4,10,0], [0,-10,0], [4,10,0], [8,-10,0], [-6,0,0], [6,0,0] ],
    'Q': [ [0,10,0], [6,8,0], [8,4,0], [8,-4,0], [6,-8,0], [0,-10,0], [-6,-8,0], [-8,-4,0], [-8,4,0], [-6,8,0], [4,-6,0], [8,-10,0] ],
    'U': [ [-8,10,0], [-8,-4,0], [-6,-8,0], [-2,-10,0], [2,-10,0], [6,-8,0], [8,-4,0], [8,10,0] ],
    'L': [ [-8,10,0], [-8,-10,0], [8,-10,0] ],
    'A2': [ [-8,-10,0], [-4,10,0], [0,-10,0], [4,10,0], [8,-10,0], [-6,0,0], [6,0,0] ]
  };

  // Posisi horizontal tiap huruf
  const letterPositions = { 'A': -44, 'Q': -22, 'U': 0, 'L': 22, 'A2': 44 };

  // Distribusi partikel pada path huruf
  let pIndex = 0;
  const particlesPerLetter = Math.floor(particleCount / 5);
  const particleDensity = 3;

  for (const [letter, path] of Object.entries(letterPaths)) {
    for (let i = 0; i < particlesPerLetter && pIndex < particleCount; i++) {
      const segment = i % (path.length - 1);
      const progress = (i % particleDensity) / particleDensity;

      const start = path[segment];
      const end = path[segment + 1] || path[0];

      positions[pIndex * 3] = THREE.MathUtils.lerp(start[0] + letterPositions[letter], end[0] + letterPositions[letter], progress) + (Math.random() - 0.5) * 1.5;
      positions[pIndex * 3 + 1] = THREE.MathUtils.lerp(start[1], end[1], progress) + (Math.random() - 0.5) * 1.5;
      positions[pIndex * 3 + 2] = THREE.MathUtils.lerp(start[2], end[2], progress) + (Math.random() - 0.5) * 8;

      const colorIndex = Math.floor(pIndex / (particleCount / colorPalette.length)) % colorPalette.length;
      colors[pIndex * 3] = colorPalette[colorIndex].r;
      colors[pIndex * 3 + 1] = colorPalette[colorIndex].g;
      colors[pIndex * 3 + 2] = colorPalette[colorIndex].b;

      sizes[pIndex] = Math.random() * 0.6 + 0.8;

      pIndex++;
    }
  }

  // Set atribut geometri
  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
  geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

  // Material partikel
  const material = new THREE.PointsMaterial({
    size: 1.2,
    vertexColors: true,
    transparent: true,
    opacity: 0.95,
    blending: THREE.AdditiveBlending,
    sizeAttenuation: true,
    alphaTest: 0.1
  });

  const particles = new THREE.Points(geometry, material);
  scene.add(particles);

  // Variabel animasi
  let time = 0;
  const rotationSpeed = 0.15;

  // Loop animasi
  function animate() {
    requestAnimationFrame(animate);
    time += 0.01;

    particles.rotation.y = Math.sin(time * rotationSpeed) * 0.15;
    particles.rotation.x = Math.cos(time * rotationSpeed * 0.8) * 0.1;

    const positions = geometry.attributes.position.array;
    for (let i = 0; i < positions.length; i += 3) {
      positions[i + 2] += Math.sin(time + i * 0.01) * 0.1;
    }
    geometry.attributes.position.needsUpdate = true;

    renderer.render(scene, camera);
  }

  // Resize handler
  function onWindowResize() {
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  }

  window.addEventListener('resize', onWindowResize);
  animate();
});


// Cegah zoom pakai Ctrl/Cmd + Scroll Mouse
window.addEventListener('wheel', function (e) {
    if (e.ctrlKey || e.metaKey) {
      e.preventDefault();
    }
  }, { passive: false });

  // Cegah zoom pakai Ctrl/Cmd + '+' / '-' / '=' atau reset zoom dengan '0'
  window.addEventListener('keydown', function (e) {
    const key = e.key;
    const ctrlOrCmd = e.ctrlKey || e.metaKey;

    if (ctrlOrCmd && (key === '+' || key === '-' || key === '=')) {
      e.preventDefault();
    }

    if (ctrlOrCmd && key === '0') {
      e.preventDefault();
    }
  });

  // Cegah gesture zoom di iOS Safari
  document.addEventListener('gesturestart', function (e) {
    e.preventDefault();
  }, { passive: false });

  // Cegah pinch-to-zoom (2 jari)
  document.addEventListener('touchstart', function (e) {
    if (e.touches.length > 1) {
      e.preventDefault();
    }
  }, { passive: false });

  // Cegah double-tap zoom
  let lastTouchEnd = 0;
  document.addEventListener("touchend", function (e) {
    const now = new Date().getTime();
    if (now - lastTouchEnd <= 300) {
      e.preventDefault();
    }
    lastTouchEnd = now;
  }, { passive: false });

  // Reset zoom saat halaman dimuat (untuk beberapa perangkat tertentu)
  window.onload = () => {
    document.body.style.zoom = "reset";
    document.documentElement.style.touchAction = 'manipulation';
  };










































//start aqula visual
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize Three.js scene
    const container = document.getElementById('particleContainer');
    const width = container.clientWidth;
    const height = container.clientHeight;
    
    // Create scene with subtle fog
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0f172a);
    scene.fog = new THREE.FogExp2(0x0f172a, 0.005);
    
    // Create camera with optimal view
    const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
    camera.position.set(0, 0, 50);
    
    // Create high-quality renderer
    const renderer = new THREE.WebGLRenderer({ 
      antialias: true,
      powerPreference: "high-performance"
    });
    renderer.setSize(width, height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);
    
    // Lighting setup for clarity
    const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0x7dd3fc, 0.8);
    directionalLight.position.set(1, 1, 1);
    scene.add(directionalLight);
    
    // Create particle system
    const particleCount = 2500;
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array(particleCount * 3);
    const colors = new Float32Array(particleCount * 3);
    const sizes = new Float32Array(particleCount);
    
    // Color palette (blue gradient)
    const colorPalette = [
      new THREE.Color(0x7dd3fc),
      new THREE.Color(0x38bdf8), 
      new THREE.Color(0x0ea5e9),
      new THREE.Color(0x0284c7)
    ];
    
    // Define clear letter paths for A-Q-U-L-A
    const letterPaths = {
      'A': [
        [-8,-10,0], [-4,10,0], [0,-10,0], [4,10,0], [8,-10,0], // Outer shape
        [-6,0,0], [6,0,0] // Crossbar (less prominent)
      ],
      'Q': [
        [0,10,0], [6,8,0], [8,4,0], [8,-4,0], [6,-8,0], // Main circle
        [0,-10,0], [-6,-8,0], [-8,-4,0], [-8,4,0], [-6,8,0],
        [4,-6,0], [8,-10,0] // Tail
      ],
      'U': [
        [-8,10,0], [-8,-4,0], [-6,-8,0], [-2,-10,0], // Left curve
        [2,-10,0], [6,-8,0], [8,-4,0], [8,10,0]  // Right curve
      ],
      'L': [
        [-8,10,0], [-8,-10,0], [8,-10,0] // Simple L shape
      ],
      'A2': [
        [-8,-10,0], [-4,10,0], [0,-10,0], [4,10,0], [8,-10,0], // Outer shape
        [-6,0,0], [6,0,0] // Crossbar (less prominent)
      ]
    };
    
    // Position letters with good spacing
    const letterPositions = {
      'A': -44,
      'Q': -22,
      'U': 0,
      'L': 22,
      'A2': 44
    };
    
    // Create particles along letter paths (ensuring readability)
    let pIndex = 0;
    const particlesPerLetter = particleCount / 5;
    const particleDensity = 3; // Higher density for clearer letters
    
    for (const [letter, path] of Object.entries(letterPaths)) {
      for (let i = 0; i < particlesPerLetter && pIndex < particleCount; i++) {
        // Distribute particles evenly along path
        const segment = i % (path.length - 1);
        const progress = (i % particleDensity) / particleDensity;
        
        const start = path[segment];
        const end = path[segment + 1] || path[0];
        
        // Position with slight randomness but constrained to maintain shape
        positions[pIndex * 3] = THREE.MathUtils.lerp(
          start[0] + letterPositions[letter],
          end[0] + letterPositions[letter],
          progress
        ) + (Math.random() - 0.5) * 1.5;
        
        positions[pIndex * 3 + 1] = THREE.MathUtils.lerp(
          start[1],
          end[1],
          progress
        ) + (Math.random() - 0.5) * 1.5;
        
        positions[pIndex * 3 + 2] = THREE.MathUtils.lerp(
          start[2],
          end[2],
          progress
        ) + (Math.random() - 0.5) * 8;
        
        // Color based on letter position
        const colorIndex = Math.floor(pIndex / (particleCount / colorPalette.length)) % colorPalette.length;
        colors[pIndex * 3] = colorPalette[colorIndex].r;
        colors[pIndex * 3 + 1] = colorPalette[colorIndex].g; 
        colors[pIndex * 3 + 2] = colorPalette[colorIndex].b;
        
        // Slightly larger particles for better visibility
        sizes[pIndex] = Math.random() * 0.6 + 0.8;
        
        pIndex++;
      }
    }
    
    // Set geometry attributes
    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
    
    // Create particle material with clear visibility
    const material = new THREE.PointsMaterial({
      size: 1.2,
      vertexColors: true,
      transparent: true,
      opacity: 0.95,
      blending: THREE.AdditiveBlending,
      sizeAttenuation: true,
      alphaTest: 0.1
    });
    
    const particles = new THREE.Points(geometry, material);
    scene.add(particles);
    
    // Animation variables
    let time = 0;
    const rotationSpeed = 0.15;
    
    // Animation loop with constrained movement
    function animate() {
      requestAnimationFrame(animate);
      time += 0.01;
      
      // Gentle rotation that doesn't obscure letters
      particles.rotation.y = Math.sin(time * rotationSpeed) * 0.15;
      particles.rotation.x = Math.cos(time * rotationSpeed * 0.8) * 0.1;
      
      // Subtle floating movement while maintaining shape
      const positions = geometry.attributes.position.array;
      for (let i = 0; i < positions.length; i += 3) {
        // Only modify Z position for depth movement
        positions[i + 2] += Math.sin(time + i * 0.01) * 0.1;
      }
      geometry.attributes.position.needsUpdate = true;
      
      renderer.render(scene, camera);
    }
    
    // Handle window resize
    function onWindowResize() {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    }
    
    window.addEventListener('resize', onWindowResize);
    animate();
  });

































</script>
<div id="toastContainer" class="fixed bottom-5 right-5 z-[200] flex flex-col gap-3"></div>


  </body>
</html>
